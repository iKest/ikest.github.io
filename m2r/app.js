(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{18:function(T,j,i){T.exports=i(41)},19:function(T,j,i){var S=i(20),d=i(21);d=d.__esModule?d.default:d,typeof d=="string"&&(d=[[T.i,d,""]]);var a={};a.insert="head",a.singleton=!1;var U=S(d,a);T.exports=d.locals||{}},21:function(T,j,i){},41:function(T,j,i){"use strict";i.r(j);var S=i(19),d=i(0),a=i.n(d),U=i(1),x=i.n(U),V=i(12),I=i.n(V),X=i(16),z=i(17),W=i(15);const $={type:a.a.AUTO,disableContextMenu:!0,render:{transparent:!0},scale:{parent:"gameContainer",mode:a.a.Scale.FIT,autoCenter:a.a.Scale.CENTER_BOTH,width:640,height:960,expandParent:!1},physics:{default:"matter",matter:{debug:!1,gravity:{x:0,y:0}}}};class G extends a.a.Scene{constructor(e){super(e);this.key=e.key,this.log=x.a.get(this.key),this.log.info("boot")}init(){this.log.info("init"),this.events.once("shutdown",this.shutdown,this),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this),this.events.off("destroy",this.destroy,this)}shutdown(){this.log.info("shutdown"),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.once("destroy",this.destroy,this)}sleep(){this.log.info("sleep"),this.events.off("pause",this.pause,this),this.events.once("wake",this.wake,this)}pause(){this.log.info("pause"),this.events.once("resume",this.resume,this)}wake(){this.log.info("wake"),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this)}resume(){this.log.info("resume"),this.events.once("pause",this.pause,this)}destroy(){this.log.info("destroy"),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.off("shutdown",this.shutdown,this),this.log=void 0}}class Y extends G{constructor(){super({key:"BootScene"})}create(){this.log.info("create"),this.load.rexWebFont({google:{families:["Roboto"]}}),this.load.json("chainsmail_matter","assets/jsons/chainsmail_matter.json"),this.load.json("l_hand_matter","assets/jsons/l_hand_matter.json"),this.load.image("level_bg","assets/images/level_bg.jpg"),this.load.atlas("ui","assets/atlases/ui.png","assets/atlases/ui.json"),this.load.on("complete",()=>{document.querySelector(".loader").classList.toggle("loaded"),this.scene.start("LevelScene")}),this.load.start()}}var J=i(14),K=i.n(J),Q=i(5),k=i.n(Q);class Z{constructor(e,t,s,h,r,n=10,g=!1){this.scene=e,this.log=x.a.get("ChainsMail");const{SAT:y}=t,u=r.map(o=>{const c=new k.a(o);c.winding()&&c.rewind(!1);const p=c.points.map(({x:L,y:P})=>new y.Vector(L,P));return new y.Polygon(new y.Vector,p)});let O=u[0].points[0].x,E=u[0].points[0].x,v=u[0].points[0].y,_=u[0].points[0].y;u.forEach(o=>{o.points.forEach(({x:c,y:p})=>{c<O&&(O=c),c>E&&(E=c),p<v&&(v=p),p>_&&(_=p)})});const f=Math.ceil((E-O)/8)+4,w=Math.ceil((_-v)/8)+4,A=f*8,b=w*8,D=A*.5,C=b*.5;let m;g?m=this.scene.add.graphics():m=this.scene.make.graphics();const B=new a.a.Display.Color;m.fillStyle(16777215),m.beginPath(),u.forEach(o=>{o.translate(s-D+12,h-C),g&&m.fillStyle(B.random(50).color),m.fillPoints(o.points,!1,!0)});const N=m.createGeometryMask(),l=[];for(let o=0;o<f;o++)for(let c=0;c<w;c++){const p=s-D+(o%2===0?8:0)+o*8,L=h-C+c*8,P=new y.Circle(new y.Vector(p,L),8);if(u.some(M=>y.testPolygonCircle(M,P))){const M=this.scene.add.image(p,L,"ui","ring").setScale(.5).setOrigin(.5).setTint(7303032).setData("health",5).setData("isGold",!1);new t.Circle(new t.V(p,L),8,!0,{img:M,type:"ring"}),l.push(M),g||M.setMask(N)}}this.numRings=l.length;for(let o=0;o<n;o++)this.scene.helps.add(a.a.Utils.Array.GetRandom(l).setTint(10910720).setData("isGold",!0))}}class q extends a.a.GameObjects.Container{constructor(e,t,s,h){super(e,t,s);this.crash=h,this.goal=this.scene.add.circle(0,-0,32,16711680,.5),this.hammer=this.scene.add.image(225,25,"ui","hammer").setOrigin(.8,.8),this.add([this.goal,this.hammer]),this.setSize(64,64),this.tempMatrix=new a.a.GameObjects.Components.TransformMatrix,this.tempParentMatrix=new a.a.GameObjects.Components.TransformMatrix,this.physicsHammer=this.scene.matter.add.gameObject(this),this.physicsHammer.setBody({type:"circle",radius:32}),this.physicsHammer.setFriction(0),this.physicsHammer.setFrictionAir(0),this.physicsHammer.setBounce(0),this.scene.add.existing(this)}hitting(e){e?this.hammerTween=this.scene.tweens.add({targets:[this.hammer],angle:-15,yoyo:!0,duration:150,repeat:-1,onYoyo:()=>{this.hammerBoom()}}):(this.hammerTween!==null&&this.hammerTween.stop(),this.hammerTween=null,this.hammer.angle=0)}hammerBoom(){this.goal.getWorldTransformMatrix(this.tempMatrix,this.tempParentMatrix);const e=this.tempMatrix.decomposeMatrix(),t=new this.crash.Circle(new this.crash.Vector(e.translateX,e.translateY),32),s=new this.crash.Response;this.crash.testAll(t,s)}}class F extends a.a.GameObjects.Container{constructor(e,t,s,h,r,n,g,y,u,O,E=!1,v=0,_=!1){super(e,s,h);this.log=x.a.get(O),this.hand=this.scene.add.image(0,0,"ui",r);const f=n.map(b=>this.scene.add.image(0,0,"ui",b).setVisible(!1)),w=g.map(b=>this.scene.add.image(0,0,"ui",b).setVisible(!1));this.add([this.hand,...f,...w]);const{SAT:A}=t;_&&(this.shapeP=this.scene.add.graphics().setDepth(2).setAlpha(.3)),this.satPoligons={},this.fixtures=u.fixtures,this.fixtures.forEach(({label:b,vertices:D})=>{D.forEach(C=>{E&&C.forEach(l=>{E?l.x=this.hand.width-Math.round(l.x)+v:l.x=Math.round(l.x),l.y=Math.round(l.y)});const m=new k.a(C);m.winding()&&m.rewind(!1);const B=m.points.map(({x:l,y:o})=>new A.Vector(l,o)),N=new t.Polygon(new t.V(s-this.hand.width*.5,h),B,!0,{type:"finger",handName:O,fingerIndex:E?5-b.split("_")[1]:b.split("_")[1]-1});if(_){const l=new a.a.Display.Color;this.shapeP.fillStyle(16777215),this.shapeP.beginPath(),this.shapeP.fillStyle(l.random(50).color),this.shapeP.fillPoints(N.sat.points.map(({x:o,y:c})=>({x:o+s-this.hand.width*.5,y:c+h})),!1,!0)}})}),this.scene.add.existing(this),this.numRings=0,this.currentFinger=-1,this.ringsCoords=y,this.fingers=[{enable:!0,bint:w[0],ring:f[0],ringTween:null},{enable:!0,bint:w[1],ring:f[1],ringTween:null},{enable:!0,bint:w[2],ring:f[2],ringTween:null},{enable:!0,bint:w[3],ring:f[3],ringTween:null},{enable:!0,bint:w[4],ring:f[4],ringTween:null}],this.enable=!0}getRingCoords(e){const{x:t,y:s,w:h,h:r}=this.ringsCoords[e];return{x:this.x-this.hand.width*.5+t+h*.5,y:this.y-this.hand.height*.5+s+r*.5}}tweenRing(e){for(;!this.fingers[++this.currentFinger].enable&&this.currentFinger<5;);const t=this.fingers[this.currentFinger];if(t.enable){t.enable=!1;const s=this.getRingCoords(this.currentFinger),h=a.a.Math.Distance.BetweenPoints(s,e);t.ringTween=this.scene.tweens.add({targets:[e],x:s.x,y:s.y,duration:h*2,onComplete:()=>{this.log.info("ringTween complete"),t.ringTween=null,e.destroy(),t.bint.visible||(t.ring.setVisible(!0),this.numRings=this.getNumRings(),this.enable=this.fingers.some(r=>r.enable),this.scene.checkHands())},onStop:()=>{this.log.info("ringTween stoped"),t.ringTween=null,e.destroy()}})}else e.destroy()}hitFinger(e){const t=this.fingers[e];if(t.bint.visible)return;t.enable=!1,t.bint.setVisible(!0),t.ring.visible&&t.ring.setVisible(!1),t.ringTween!==null&&t.ringTween.stop(),this.numRings=this.getNumRings(),t.bint.setVisible(!0),this.enable=this.fingers.some(s=>s.enable),this.scene.checkHands()}getNumRings(){return this.fingers.filter(({ring:e})=>e.visible).length}}class ee extends G{constructor(){super({key:"LevelScene"})}init(){this.currentPointer=null,this.hammerTween=null,this.crash=new K.a,this.numGolds=10,this.helps=new Set,this.gameOver=!1,this.helpTimer=null}create(){this.log.info("create");const{centerX:e,centerY:t,width:s,height:h}=this.cameras.main;this.add.image(e,t,"level_bg"),this.chainsMail=new Z(this,this.crash,e,t+20,this.cache.json.get("chainsmail_matter").chainsmail.fixtures[0].vertices,this.numGolds,!1),this.numRings=this.chainsMail.numRings;const r=new F(this,this.crash,e-125,0,"l_hand",["l_ring_1","l_ring_2","l_ring_3","l_ring_4","l_ring_5"],["l_bint_1","l_bint_2","l_bint_3","l_bint_4","l_bint_5"],[{x:34,y:111,w:29,h:20},{x:67,y:133,w:28,h:15},{x:96,y:137,w:31,h:14},{x:127,y:126,w:33,h:22},{x:157,y:57,w:32,h:30}],this.cache.json.get("l_hand_matter").l_hand,"l_hand"),n=new F(this,this.crash,e+125,0,"r_hand",["r_ring_1","r_ring_2","r_ring_3","r_ring_4","r_ring_5"],["r_bint_1","r_bint_2","r_bint_3","r_bint_4","r_bint_5"],[{x:35,y:57,w:32,h:30},{x:64,y:126,w:33,h:22},{x:97,y:137,w:31,h:14},{x:129,y:133,w:28,h:15},{x:161,y:111,w:29,h:20}],this.cache.json.get("l_hand_matter").l_hand,"r_hand",!0,-2);this.hands={l_hand:r,r_hand:n},this.tweens.add({targets:[r,n],y:125,duration:200,onComplete:()=>{this.input.on("pointerdown",this.pressDown,this),this.input.on("pointerup",this.pressUp,this),this.restartBtn.setEnable(!0),this.helpBtn.setEnable(!0)}}),this.hammer=new q(this,e,h-150,this.crash),this.resp=new this.crash.Response,this.numRingsText=this.add.text(e,h-70,`RINGS IN MAIL: ${this.numRings}`,{fontFamily:"Roboto",fontSize:"32px",color:"#ffffff",align:"center"}).setOrigin(.5,1),this.numGoldsText=this.add.text(e,h-30,`GOLDS IN MAIL: ${this.helps.size}`,{fontFamily:"Roboto",fontSize:"32px",color:"#ffffff",align:"center"}).setOrigin(.5,1),this.crash.onCollision(this.onCollition.bind(this)),this.pan=this.rexGestures.add.pan({enable:!0}),this.pan.on("pan",g=>{this.hammer.physicsHammer.x+=g.dx,this.hammer.physicsHammer.y+=g.dy}),this.restartBtn=this.rexButtonn.add(this.add.image(s-10,10,"ui","restart").setScale(.4).setOrigin(1,0)).setEnable(!1).on("click",this.restartGame,this),this.helpBtn=this.rexButtonn.add(this.add.image(10,10,"ui","faq").setScale(.4).setOrigin(0,0)).setEnable(!1).on("click",this.showHelp,this),this.playObj=this.add.image(e,h-105,"ui","play").setDepth(5).setScale(.5).setOrigin(.5,1).setAlpha(0),this.playBtn=this.rexButtonn.add(this.playObj).setEnable(!1).on("click",()=>{this.hideBanner()}),this.bannerText=this.add.text(e,t,"",{fontFamily:"Roboto",fontSize:"72px",fontStyle:"bold",align:"center",stroke:"grey",strokeThickness:4}).setOrigin(.5).setDepth(5).setAlpha(0)}showHelp(){this.helpBtn.setEnable(!1),this.helpBtn.gameObject.setTint(8421504);const{x:e,y:t}=a.a.Utils.Array.GetRandom([...this.helps]),s=this.add.circle(e,t,32,16777215,1).setAlpha(0);this.tweens.add({targets:[s],alpha:.6,duration:300,onComplete:()=>{this.tweens.add({targets:[s],alpha:.3,duration:150,yoyo:!0,repeats:3,onComplete:()=>{s.destroy()}})}}),this.helpTimer=this.time.addEvent({delay:1e4,callback:()=>{this.helpBtn.gameObject.setTint(),this.gameOver||this.helpBtn.setEnable(!0),this.helpTimer=null},loop:!1})}checkHands(){if(this.log.info(this.hands.r_hand.enable,this.hands.l_hand.enable),this.hands.r_hand.enable||this.hands.l_hand.enable)return;this.gameOver=!0;const e=this.hands.r_hand.numRings+this.hands.l_hand.numRings;this.helpTimer!==null&&this.helpTimer.remove(),this.helpBtn.gameObject.setTint(),this.input.off("pointerdown",this.pressDown,this),this.input.off("pointerup",this.pressUp,this),this.pan.setEnable(!1),this.restartBtn.off("click",this.restartGame,this),this.helpBtn.off("click",this.showHelp,this),this.currentPointer=null,this.hammer.hitting(!1),e>0?this.gameWin(e):this.gameFail()}gameFail(){this.log.info("LEVEL LOOSE"),this.showBanner(`LEVEL
LOOSE`,"red")}gameWin(e){this.log.info("LEVEL COMPLETE"),this.showBanner(`LEVEL
COMPLETE
score: ${e}`,"green")}hideBanner(){this.playBtn.setEnable(!1),this.tweens.add({targets:[this.playObj,this.bannerText],alpha:0,duration:300,onComplete:()=>{this.restartGame()}})}showBanner(e,t){this.bannerText.setText(e),this.bannerText.setColor(t),this.tweens.add({targets:[this.playObj,this.bannerText],alpha:1,duration:300,onComplete:()=>{this.playBtn.setEnable(!0)}})}pressDown(e){if(this.currentPointer!==null)return;this.currentPointer=e;const{x:t,y:s}=e;this.hammer.physicsHammer.setPosition(t,s),this.hammer.hitting(!0)}pressUp(e){if(this.currentPointer!==e)return;this.currentPointer=null,this.hammer.hitting(!1)}onCollition(e,t,s,h){const r=t.data;if(r.type==="ring"){const n=r.img,g=n.getData("health")-1;n.setData("health",g),g<=0&&(this.numRingsText.setText(`RINGS IN MAIL: ${--this.numRings}`),this.crash.remove(t),n.getData("isGold")?(this.helps.delete(n),this.numGoldsText.setText(`GOLDS IN MAIL: ${this.helps.size}`),n.clearMask(),this.tweens.add({targets:[n],scale:.8,duration:150,onComplete:()=>{this.hands.l_hand.enable?this.hands.l_hand.tweenRing(n):this.hands.r_hand.enable?this.hands.r_hand.tweenRing(n):this.tweens.add({targets:[n],alpha:0,duration:150,onComplete:()=>{n.destroy()}})}})):this.tweens.add({targets:[n],alpha:0,duration:150,onComplete:()=>{n.destroy()}}))}else r.type==="finger"&&this.hands[r.handName].hitFinger(r.fingerIndex)}restartGame(){this.log.info("game restart"),this.scene.restart()}shutdown(){this.crash.clear(),this.input.off("pointerdown",this.pressDown,this),this.input.off("pointerup",this.pressUp,this),this.restartBtn.off("click",this.restartGame,this),this.helpBtn.off("click",this.showHelp,this),this.pan.off("pan"),super.shutdown()}}var H=Object.assign;I.a.disablePageScroll(),x.a.useDefaults(),x.a.setLevel(x.a.OFF);const R=x.a.get("index");R.info("start");const te={global:[{key:"rexWebFontLoader",plugin:X.a,start:!0},{key:"rexButtonn",plugin:z.a,start:!0,mapping:"rexButtonn"}],scene:[{key:"rexGestures",plugin:W.a,mapping:"rexGestures"}]};window.onload=()=>{window.game=new a.a.Game(H(H({},$),{plugins:te,scene:[Y,ee],callbacks:{preBoot:e=>{R.info("game booting start")},postBoot:e=>{R.info("game booting complete")}}}))}}},[[18,1,2]]]);
