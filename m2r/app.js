(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(w,T,i){w.exports=i(40)},18:function(w,T,i){var C=i(19),l=i(20);l=l.__esModule?l.default:l,typeof l=="string"&&(l=[[w.i,l,""]]);var a={};a.insert="head",a.singleton=!1;var O=C(l,a);w.exports=l.locals||{}},20:function(w,T,i){},40:function(w,T,i){"use strict";i.r(T);var C=i(18),l=i(0),a=i.n(l),O=i(1),x=i.n(O),G=i(9),P=i.n(G),B=i(16),V=i(15),F=i(14);const H={type:a.a.AUTO,disableContextMenu:!0,render:{transparent:!0},scale:{parent:"gameContainer",mode:a.a.Scale.FIT,autoCenter:a.a.Scale.CENTER_BOTH,width:640,height:960,expandParent:!1},physics:{default:"matter",matter:{debug:!1,gravity:{x:0,y:0}}}};class L extends a.a.Scene{constructor(t){super(t);this.key=t.key,this.log=x.a.get(this.key),this.log.info("boot")}init(){this.log.info("init"),this.events.once("shutdown",this.shutdown,this),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this),this.events.off("destroy",this.destroy,this)}shutdown(){this.log.info("shutdown"),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.once("destroy",this.destroy,this)}sleep(){this.log.info("sleep"),this.events.off("pause",this.pause,this),this.events.once("wake",this.wake,this)}pause(){this.log.info("pause"),this.events.once("resume",this.resume,this)}wake(){this.log.info("wake"),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this)}resume(){this.log.info("resume"),this.events.once("pause",this.pause,this)}destroy(){this.log.info("destroy"),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.off("shutdown",this.shutdown,this),this.log=void 0}}class X extends L{constructor(){super({key:"BootScene"})}create(){this.log.info("create"),this.load.rexWebFont({google:{families:["Roboto"]}}),this.load.json("chainsmail_matter","assets/jsons/chainsmail_matter.json"),this.load.json("l_hand_matter","assets/jsons/l_hand_matter.json"),this.load.image("level_bg","assets/images/level_bg.jpg"),this.load.atlas("ui","assets/atlases/ui.png","assets/atlases/ui.json"),this.load.on("complete",()=>{document.querySelector(".loader").classList.toggle("loaded"),this.scene.start("LevelScene")}),this.load.start()}}var I=i(12),J=i.n(I),Y=i(13),W=i.n(Y);class ${constructor(t,s,n,o,e,u=10,b=!1){this.scene=t,this.log=x.a.get("ChainsMail");const{SAT:p}=s,m=e.map(r=>{const h=new W.a(r);h.winding()&&h.rewind(!1);const g=h.points.map(({x:E,y:j})=>new p.Vector(E,j));return new p.Polygon(new p.Vector,g)});let c=m[0].points[0].x,d=m[0].points[0].x,f=m[0].points[0].y,M=m[0].points[0].y;m.forEach(r=>{r.points.forEach(({x:h,y:g})=>{h<c&&(c=h),h>d&&(d=h),g<f&&(f=g),g>M&&(M=g)})}),this.log.info("bbBox:",c,f,d,M);const A=Math.ceil((d-c)/8)+4,N=Math.ceil((M-f)/8)+4,Z=A*8,q=N*8,k=Z*.5,U=q*.5;let y;b?y=this.scene.add.graphics():y=this.scene.make.graphics();const tt=new a.a.Display.Color;y.fillStyle(16777215),y.beginPath(),m.forEach(r=>{r.translate(n-k+12,o-U),b&&y.fillStyle(tt.random(50).color),y.fillPoints(r.points,!1,!0)});const st=y.createGeometryMask(),_=[];for(let r=0;r<A;r++)for(let h=0;h<N;h++){const g=n-k+(r%2===0?8:0)+r*8,E=o-U+h*8,j=new p.Circle(new p.Vector(g,E),8);if(m.some(v=>p.testPolygonCircle(v,j))){const v=this.scene.add.image(g,E,"ui","ring").setScale(.5).setOrigin(.5).setTint(7303032).setData("health",5).setData("isGold",!1).setData("type","ring");new s.Circle(new s.V(g,E),8,!0,{img:v}),_.push(v),b||v.setMask(st)}}this.numRings=_.length;for(let r=0;r<u;r++)a.a.Utils.Array.GetRandom(_).setTint(10910720).setData("isGold",!0)}}class D extends a.a.GameObjects.Container{constructor(t,s,n,o,e,u,b,p,m){super(t,s,n);this.hand=this.scene.add.image(0,0,"ui",o);const c=e.map(f=>this.scene.add.image(0,0,"ui",f).setVisible(!1)),d=u.map(f=>this.scene.add.image(0,0,"ui",f).setVisible(!1));this.add([this.hand,...c,...d]),this.fixtures=p[m].fixtures,this.scene.add.existing(this),this.numRings=0,this.currentFinger=-1,this.ringsCoords=b,this.fingers=[{enable:!0,bint:d[0],ring:c[0],ringTween:null},{enable:!0,bint:d[1],ring:c[1],ringTween:null},{enable:!0,bint:d[2],ring:c[2],ringTween:null},{enable:!0,bint:d[3],ring:c[3],ringTween:null},{enable:!0,bint:d[4],ring:c[4],ringTween:null}],this.enable=!0}getRingCoords(t){const{x:s,y:n,w:o,h:e}=this.ringsCoords[t];return{x:this.x-this.hand.width*.5+s+o*.5,y:this.y-this.hand.height*.5+n+e*.5}}tweenRing(t){for(;!this.fingers[++this.currentFinger].enable&&this.currentFinger<5;);const s=this.fingers[this.currentFinger];if(s.enable){s.enable=!1,this.enable=this.fingers.filter(({enable:e})=>e).length>0;const n=this.getRingCoords(this.currentFinger),o=a.a.Math.Distance.BetweenPoints(n,t);s.ringTween=this.scene.tweens.add({targets:[t],x:n.x,y:n.y,duration:o*2,onComplete:()=>{s.ringTween=null,t.destroy(),s.bint.visible||(s.ring.setVisible(!0),this.numRings=this.getNumRings())}})}else t.destroy()}addRing(t){}hitFinger(t){const s=this.fingers[t];s.enable=!1,s.bint.setVisible(!0),s.ring.visible&&(s.ring.setVisible(!1),this.numRings=this.getNumRings()),s.bint.setVisible(!0),this.enable=this.fingers.filter(({enable:n})=>n).length>0}getNumRings(){return this.fingers.filter(({ring:t})=>t.visible).length}}class z extends a.a.GameObjects.Container{constructor(t,s,n,o){super(t,s,n);this.crash=o,this.goal=this.scene.add.circle(0,-0,32,16711680,.5),this.hammer=this.scene.add.image(225,25,"ui","hammer").setOrigin(.8,.8),this.add([this.goal,this.hammer]),this.setSize(64,64),this.tempMatrix=new a.a.GameObjects.Components.TransformMatrix,this.tempParentMatrix=new a.a.GameObjects.Components.TransformMatrix,this.physicsHammer=this.scene.matter.add.gameObject(this),this.physicsHammer.setBody({type:"circle",radius:32}),this.physicsHammer.setFriction(0),this.physicsHammer.setFrictionAir(0),this.physicsHammer.setBounce(0),this.scene.add.existing(this)}hitting(t){t?this.hammerTween=this.scene.tweens.add({targets:[this.hammer],angle:-15,yoyo:!0,duration:150,repeat:-1,onYoyo:()=>{this.hammerBoom()}}):(this.hammerTween!==null&&this.hammerTween.stop(),this.hammerTween=null,this.hammer.angle=0)}hammerBoom(){this.goal.getWorldTransformMatrix(this.tempMatrix,this.tempParentMatrix);const t=this.tempMatrix.decomposeMatrix(),s=new this.crash.Circle(new this.crash.Vector(t.translateX,t.translateY),32),n=new this.crash.Response;this.crash.testAll(s,n)}}class K extends L{constructor(){super({key:"LevelScene"})}init(){this.currentPointer=null,this.hammerTween=null,this.crash=new J.a,this.numGolds=10}create(){this.log.info("create");const{centerX:t,centerY:s,width:n,height:o}=this.cameras.main;this.add.image(t,s,"level_bg"),this.chainsMail=new $(this,this.crash,t,s+20,this.cache.json.get("chainsmail_matter").chainsmail.fixtures[0].vertices,this.numGolds,!1),this.numRings=this.chainsMail.numRings;const e=new D(this,t-125,0,"l_hand",["l_ring_1","l_ring_2","l_ring_3","l_ring_4","l_ring_5"],["l_bint_1","l_bint_2","l_bint_3","l_bint_4","l_bint_5"],[{x:34,y:111,w:29,h:20},{x:67,y:133,w:28,h:15},{x:96,y:137,w:31,h:14},{x:127,y:126,w:33,h:22},{x:157,y:57,w:32,h:30}],this.cache.json.get("l_hand_matter"),"l_hand"),u=new D(this,t+125,0,"r_hand",["r_ring_1","r_ring_2","r_ring_3","r_ring_4","r_ring_5"],["r_bint_1","r_bint_2","r_bint_3","r_bint_4","r_bint_5"],[{x:35,y:57,w:32,h:30},{x:64,y:126,w:33,h:22},{x:97,y:137,w:31,h:14},{x:129,y:133,w:28,h:15},{x:161,y:111,w:29,h:20}],this.cache.json.get("l_hand_matter"),"l_hand");this.tweens.add({targets:[e,u],y:125,duration:200}),this.hands=[e,u],this.hammer=new z(this,t,o-150,this.crash),this.resp=new this.crash.Response,this.numRingsText=this.add.text(t,o-70,`RINGS IN MAIL: ${this.numRings}`,{fontFamily:"Roboto",fontSize:"32px",color:"#ffffff",align:"center"}).setOrigin(.5,1),this.numGoldsText=this.add.text(t,o-30,`GOLDS IN MAIL: ${this.numGolds}`,{fontFamily:"Roboto",fontSize:"32px",color:"#ffffff",align:"center"}).setOrigin(.5,1),this.joystick=this.rexVirtualJoystick.add(this,{x:400,y:300,radius:100,base:this.add.circle(0,0,100,16777215,.5),thumb:this.add.circle(0,0,50,2290649224,.5),enable:!1}).setVisible(!1).on("update",this.dumpJoyStickState,this),this.crash.onCollision(this.onCollition.bind(this)),this.restartBtn=this.rexButtonn.add(this.add.image(n-10,10,"ui","restart").setScale(.4).setOrigin(1,0)).setEnable(!0).on("click",this.restartGame,this),this.helpBtn=this.rexButtonn.add(this.add.image(10,10,"ui","faq").setScale(.4).setOrigin(0,0)).setEnable(!0).on("click",this.showHelp,this),this.input.on("pointerdown",this.pressDown,this),this.input.on("pointerup",this.pressUp,this)}showHelp(){}dumpJoyStickState(){const{forceX:t,forceY:s}=this.joystick;this.hammer.physicsHammer.setVelocity(t*.01,s*.01)}pressDown(t){if(this.currentPointer!==null)return;this.currentPointer=t;const{x:s,y:n}=t;this.joystick.setPosition(s,n).setVisible(!0).setEnable(!0),this.hammer.hitting(!0)}pressUp(t){if(this.currentPointer!==t)return;this.currentPointer=null,this.joystick.setVisible(!1).setEnable(!1),this.hammer.hitting(!1)}onCollition(t,s,n,o){const e=s.data.img,u=e.getData("health")-1;e.setData("health",u),u<=0&&(this.numRingsText.setText(`RINGS IN MAIL: ${--this.numRings}`),this.crash.remove(s),e.getData("isGold")?(this.numGoldsText.setText(`GOLDS IN MAIL: ${--this.numGolds}`),e.clearMask(),this.tweens.add({targets:[e],scale:.8,duration:150,onComplete:()=>{this.hands[0].enable?this.hands[0].tweenRing(e):this.hands[1].enable?this.hands[1].tweenRing(e):this.tweens.add({targets:[e],alpha:0,duration:150,onComplete:()=>{e.destroy()}})}})):this.tweens.add({targets:[e],alpha:0,duration:150,onComplete:()=>{e.destroy()}}))}restartGame(){this.log.info("click restart"),this.scene.restart()}shutdown(){this.crash.clear(),this.input.off("pointerdown",this.pressDown,this),this.input.off("pointerup",this.pressUp,this),this.restartBtn.off("click",this.restartGame,this),this.helpBtn.off("click",this.showHelp,this),this.joystick.off("update",this.dumpJoyStickState,this),super.shutdown()}}var S=Object.assign;P.a.disablePageScroll(),x.a.useDefaults(),x.a.setLevel(x.a.OFF);const R=x.a.get("index");R.info("start");const Q={global:[{key:"rexWebFontLoader",plugin:B.a,start:!0},{key:"rexButtonn",plugin:V.a,start:!0,mapping:"rexButtonn"},{key:"rexVirtualJoystick",plugin:F.a,start:!0,mapping:"rexVirtualJoystick"}],scene:[]};window.onload=()=>{window.game=new a.a.Game(S(S({},H),{plugins:Q,scene:[X,K],callbacks:{preBoot:t=>{R.info("game booting start")},postBoot:t=>{R.info("game booting complete")}}}))}}},[[17,1,2]]]);
