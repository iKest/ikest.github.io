(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(g,b,h){g.exports=h(48)},23:function(g,b,h){var L=h(24),c=h(25);c=c.__esModule?c.default:c,typeof c=="string"&&(c=[[g.i,c,""]]);var d={};d.insert="head",d.singleton=!1;var T=L(c,d);g.exports=c.locals||{}},25:function(g,b,h){},48:function(g,b,h){"use strict";h.r(b);var L=h(23),c=h(0),d=h.n(c),T=h(1),w=h.n(T),U=h(15),C=h.n(U),D=h(9),R=h.n(D),N=h(21),z=h(20),X=h(19);const F={type:d.a.AUTO,disableContextMenu:!0,render:{transparent:!0},scale:{parent:"gameContainer",mode:d.a.Scale.NONE,width:"100%",height:"100%",expandParent:!1}},B=(()=>{const n=[];let s=!1;const o=()=>{s||(s=!0,window.requestAnimationFrame?window.requestAnimationFrame(a):setTimeout(a,66))},a=()=>{n.forEach(function(i){i()}),s=!1},t=i=>{i&&n.push(i)};return{add:i=>{n.length||window.addEventListener("resize",o),t(i)}}})(),E=function(){var n,s,o,a,t,i;const r=document.createElement("canvas").getContext("2d"),f=(n=window.devicePixelRatio)!=null?n:1,x=(i=(t=(a=(o=(s=r.webkitBackingStorePixelRatio)!=null?s:r.mozBackingStorePixelRatio)!=null?o:r.msBackingStorePixelRatio)!=null?a:r.oBackingStorePixelRatio)!=null?t:r.backingStorePixelRatio)!=null?i:1,y=f/x;return y>1?y:1}();class k extends d.a.Scene{constructor(n){super(n);this.key=n.key,this.log=w.a.get(this.key),this.log.info("boot")}init(){this.log.info("init"),this.events.once("shutdown",this.shutdown,this),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this),this.events.off("destroy",this.destroy,this),this.scale.on("resize",this.resize,this)}shutdown(){this.log.info("shutdown"),this.scale.off("resize",this.resize,this),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.once("destroy",this.destroy,this)}sleep(){this.log.info("sleep"),this.events.off("pause",this.pause,this),this.events.once("wake",this.wake,this)}pause(){this.log.info("pause"),this.events.once("resume",this.resume,this)}wake(){this.log.info("wake"),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this)}resume(){this.log.info("resume"),this.events.once("pause",this.pause,this)}destroy(){this.log.info("destroy"),this.scale.off("resize",this.resize,this),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.off("shutdown",this.shutdown,this),this.log=void 0}resize(n,s,o,a){const{width:t,height:i}=n;this.cameras.resize(t,i)}}class G extends k{constructor(){super({key:"BootScene"})}create(){this.log.info("create"),this.load.rexWebFont({google:{families:["Roboto"]}}),this.load.image("level_bg_tile","assets/images/backgrounddetailed2.png"),this.load.image("web_500","assets/images/web_500.png"),this.load.image("web_256","assets/images/web_256.png"),this.load.image("restart","assets/images/restart.png"),this.load.spritesheet("spider","assets/sprites/spider.png",{frameWidth:120,frameHeight:148,startFrame:0,endFrame:18}),this.load.on("complete",()=>{this.anims.create({key:"walk",frames:"spider",frameRate:19,repeat:-1}),document.querySelector(".loader").classList.toggle("loaded"),this.scene.start("LevelScene")}),this.load.start()}}var W=h(18),J=h.n(W),V=h(2),m=h.n(V),Y=h(4),I=h.n(Y),$=h(10),O=h.n($),H=h(11),S=h.n(H);const Z=.005,A=.001;class K extends k{constructor(){super({key:"LevelScene"});this.currentPointer=null,this.isWalk=!1,this.currentRotation=0,this.points=[],this.inside=!1,this.drawing=!1,this.startIndexes=null,this.endIndexes=null}create(){this.log.info("create");const{centerX:n,centerY:s,width:o,height:a}=this.cameras.main;this.bg=this.add.tileSprite(n,s,o+1e3,a+1e3,"level_bg_tile").setOrigin(.5).setScrollFactor(0);const t=[[this.createCirclePoly(0,0,400,50)]];let i=[[this.createCirclePoly(0,0,150,30)]];this.web=m.a.difference(t,i),i=[[this.createCirclePoly(0,275,100,10)]],this.web=m.a.difference(this.web,i),i=[[this.createCirclePoly(0,-275,100,10)]],this.web=m.a.difference(this.web,i),i=[[this.createCirclePoly(275,0,100,10)]],this.web=m.a.difference(this.web,i),i=[[this.createCirclePoly(-275,0,100,10)]],this.web=m.a.difference(this.web,i),this.getArea(this.web[0]),this.log.info(this.web);const r={type:"FeatureCollection",features:[{type:"Feature",properties:{id:"web"},geometry:{type:"Polygon",coordinates:this.web[0]}}]};this.webLookUp=new S.a(r),this.webGraphics=this.add.graphics(0,0),this.drawWeb(this.web,this.webGraphics),this.graphics=this.add.graphics(0,0),this.graphics.lineStyle(4,15713599,1),this.spider=this.add.sprite(0,0,"spider").play("walk").setRotation(this.currentRotation+Math.PI*.5),this.cameras.main.startFollow(this.spider,!0),this.bg.x=n-this.cameras.main.scrollX%500,this.bg.y=s-this.cameras.main.scrollY%500,this.areaText=this.add.text(n,10,`area: ${Math.ceil(this.getArea(this.web[0]))}`,{color:"#ffffff",fontFamily:"Roboto",fontSize:"32px",align:"center"}).setOrigin(.5,0).setScrollFactor(0),this.mipmap=this.cameras.add(o-150,a-150,150,150).setZoom(.1).startFollow(this.spider,!0);const f=this.add.circle(0,0,100,16777215,.5),x=this.add.circle(0,0,50,2290649224,.5);this.joystick=this.rexVirtualJoystick.add(this,{x:0,y:0,radius:100,base:f,thumb:x,fixed:!0,enable:!1}).setVisible(!1).on("update",this.dumpJoyStickState,this),this.restartBtn=this.rexButtonn.add(this.add.image(o-10,10,"restart").setScale(.4).setOrigin(1,0).setScrollFactor(0)).setEnable(!0).on("click",()=>{this.restartGame()}),this.mipmap.ignore([this.restartBtn.gameObject,this.bg,f,x,this.areaText]),this.input.on("pointerdown",this.pressDown,this),this.input.on("pointerup",this.pressUp,this)}drawPoly(n,s){const o=O.a.flatten(n),a=O()(o.vertices,o.holes,o.dimensions);for(let t=0;t<a.length;t+=3)s.beginPath(),s.moveTo(o.vertices[a[t]*2],o.vertices[a[t]*2+1]),s.lineTo(o.vertices[a[t+1]*2],o.vertices[a[t+1]*2+1]),s.lineTo(o.vertices[a[t+2]*2],o.vertices[a[t+2]*2+1]),s.closePath(),s.fillPath();n.forEach(t=>{s.beginPath(),s.moveTo(t[0][0],t[0][1]);for(let i=1;i<t.length;i++)s.lineTo(t[i][0],t[i][1]);s.closePath(),s.strokePath()})}drawWeb(n,s){s.clear(),s.lineStyle(4,15713599,1),s.fillStyle(10053375,.5),n.forEach(o=>{this.drawPoly(o,s)})}createCirclePoly(n,s,o,a){const t=new d.a.Geom.Circle(n,s,o);return t.getPoints(!1,a).map(i=>[i.x,i.y])}getArea(n){const s=new I.a(n[0]),o=[n[0]];let a=Math.abs(s.area());if(n.length>1)for(let t=1;t<n.length;t++){const i=new I.a(n[t]),r=Math.abs(i.area());r>1e3&&(a-=r,o.push(n[t]))}return this.web[0]=o,a}resize(n,s,o,a){super.resize(n,s,o,a);const{width:t,height:i,centerX:r,centerY:f}=this.cameras.main;this.bg.setSize(t+1e3,i+1e3).setOrigin(.5),this.restartBtn.gameObject.setPosition(t-10,10),this.bg.x=r-this.cameras.main.scrollX%500,this.bg.y=f-this.cameras.main.scrollY%500,this.mipmap.setPosition(t-150,i-150),this.areaText.setPosition(r,10)}dumpJoyStickState(){}pressDown(n){if(this.currentPointer!==null)return;this.currentPointer=n;const{x:s,y:o}=n;this.joystick.setPosition(s,o).setVisible(!0).setEnable(!0)}pressUp(n){if(this.currentPointer!==n)return;this.currentPointer=null,this.joystick.setVisible(!1).setEnable(!1)}restartGame(){this.log.info("click restart"),this.scene.restart()}update(n,s){if(this.joystick.force===0)return;const o=Math.abs(d.a.Math.Angle.ShortestBetween(this.joystick.angle,d.a.Math.RadToDeg(this.currentRotation)));if(o!==0){const u=s*Z*this.joystick.force,l=u<o?u:o;this.currentRotation=d.a.Math.Angle.RotateTo(this.currentRotation,this.joystick.rotation,l/o),this.spider.rotation=this.currentRotation+Math.PI*.5}let{x:a,y:t}=this.spider;const i=s*this.joystick.force*A*Math.cos(this.currentRotation),r=s*this.joystick.force*A*Math.sin(this.currentRotation);this.spider.x+=i,this.spider.y+=r;const{centerX:f,centerY:x}=this.cameras.main;this.bg.x=f-this.cameras.main.scrollX%500,this.bg.y=x-this.cameras.main.scrollY%500;const y=new d.a.Geom.Line(a,t,this.spider.x,this.spider.y);let p=this.checkWebIntersections(y,this.web);if(p.intersect){const u=this.webLookUp.search(this.spider.x,this.spider.y);if(this.log.info("isInside:",u!==void 0),this.inside)this.startIndexes=p.indexes,this.inside=!1,this.drawing=!0,this.points.push(p.point),a=p.point[0],t=p.point[1],this.inside=!1,this.drawing=!0,this.log.info("inside:",this.inside,"drawing:",this.drawing);else{if(this.drawing){this.graphics.clear(),this.graphics.lineStyle(4,15713599,1),this.endIndexes=p.indexes,this.points.push(p.point);const l=J()(this.points.map(e=>({x:e[0],y:e[1]})),.8,!1).map(e=>[e.x,e.y]);this.log.info(this.points.length,"-->",l.length),this.points.length=0;const _=new I.a(l),q=new I.a(this.web[this.startIndexes[0]][this.startIndexes[1]]),P=_.winding(),j=q.winding();if(this.log.info(j,P,this.startIndexes[2],this.endIndexes[2]),j)if(P)if(this.startIndexes[2]>this.endIndexes[2])for(let e=this.endIndexes[2];e<this.startIndexes[2]+1;e++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e]);else{for(let e=this.endIndexes[2];e<this.web[this.endIndexes[0]][this.endIndexes[1]].length;e++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e]);for(let e=0;e<this.startIndexes[2]+1;e++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e])}else if(this.startIndexes[2]<this.endIndexes[2])for(let e=this.endIndexes[2];e>this.startIndexes[2];e--)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e]);else{for(let e=this.endIndexes[2];e>0;e--)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e]);for(let e=this.web[this.endIndexes[0]][this.endIndexes[1]].length-1;e>this.startIndexes[2];e--)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e])}else if(P)if(this.startIndexes[2]>this.endIndexes[2])for(let e=this.endIndexes[2]+1;e<this.startIndexes[2];e++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e]);else{for(let e=this.endIndexes[2]+1;e<this.web[this.endIndexes[0]][this.endIndexes[1]].length;e++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e]);for(let e=0;e<this.startIndexes[2];e++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e])}else if(this.startIndexes[2]<this.endIndexes[2])for(let e=this.endIndexes[2];e>this.startIndexes[2];e--)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e]);else{for(let e=this.endIndexes[2];e>0;e--)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e]);for(let e=this.web[this.endIndexes[0]][this.endIndexes[1]].length-1;e<this.startIndexes[2];e++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][e])}this.web=m.a.union(this.web,[l]),this.log.info("web",this.web),this.areaText.setText(`area: ${Math.ceil(this.getArea(this.web[0]))}`);const ee={type:"FeatureCollection",features:[{type:"Feature",properties:{id:"web"},geometry:{type:"Polygon",coordinates:this.web[0]}}]};this.webLookUp=new S.a(ee),this.drawWeb(this.web,this.webGraphics),this.drawing=!1}this.inside=!0,this.log.info("inside:",this.inside,"drawing:",this.drawing)}}if(this.drawing)if(this.graphics.lineBetween(a,t,this.spider.x,this.spider.y),this.points.length>4){p=!1;for(let u=1;u<this.points.length-3;u++){const l=new d.a.Geom.Line(this.points[u-1][0],this.points[u-1][1],this.points[u][0],this.points[u][1]);if(p=d.a.Geom.Intersects.LineToLine(y,l),p)break}p?(this.log.info("intersect"),this.graphics.clear(),this.graphics.lineStyle(4,15713599,1),this.points.length=0,this.drawing=!1):this.points.push([this.spider.x,this.spider.y])}else this.points.push([this.spider.x,this.spider.y])}checkWebIntersections(n,s){const o=new d.a.Geom.Point;let a=!1;for(let t=0;t<s.length;t++)for(let i=0;i<s[t].length;i++)for(let r=0;r<s[t][i].length-1;r++){const f=new d.a.Geom.Line(s[t][i][r][0],s[t][i][r][1],s[t][i][r+1][0],s[t][i][r+1][1]);if(a=d.a.Geom.Intersects.LineToLine(n,f,o),a)return this.log.info("collide with web",t,i,r),{intersect:a,point:[o.x,o.y],indexes:[t,i,r]}}return{intersect:a}}shutdown(){this.crash.clear(),this.input.off("pointerdown",this.pressDown,this),this.input.off("pointerup",this.pressUp,this),this.restartBtn.off("click"),this.joystick.off("update",this.dumpJoyStickState,this),super.shutdown()}}var M=Object.assign;C.a.disablePageScroll(),w.a.useDefaults(),w.a.setLevel(w.a.OFF);const v=w.a.get("index");v.info("start");const Q={global:[{key:"rexWebFontLoader",plugin:N.a,start:!0},{key:"rexButtonn",plugin:z.a,start:!0,mapping:"rexButtonn"},{key:"rexVirtualJoystick",plugin:X.a,start:!0,mapping:"rexVirtualJoystick"}],scene:[]};window.onload=()=>{window.game=new d.a.Game(M(M({},F),{plugins:Q,scene:[G,K],callbacks:{preBoot:n=>{v.info("game booting start")},postBoot:n=>{v.info("game booting complete"),window.scrollTo(0,1),n.scale.resize(window.innerWidth*E,R()()*E),B.add(()=>{n.scale.resize(window.innerWidth*E,R()()*E)})}}}))}}},[[22,1,2]]]);
