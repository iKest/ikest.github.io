(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{24:function(m,I,r){m.exports=r(50)},25:function(m,I,r){var L=r(26),f=r(27);f=f.__esModule?f.default:f,typeof f=="string"&&(f=[[m.i,f,""]]);var h={};h.insert="head",h.singleton=!1;var M=L(f,h);m.exports=f.locals||{}},27:function(m,I,r){},50:function(m,I,r){"use strict";r.r(I);var L=r(25),f=r(0),h=r.n(f),M=r(2),w=r.n(M),C=r(16),D=r.n(C),U=r(11),k=r.n(U),N=r(21),F=r(23),z=r(22),X=r(20);const G={type:h.a.AUTO,disableContextMenu:!0,render:{transparent:!0},scale:{parent:"gameContainer",mode:h.a.Scale.NONE,width:"100%",height:"100%",expandParent:!1}},B=(()=>{const e=[];let s=!1;const t=()=>{s||(s=!0,window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,66))},n=()=>{e.forEach(function(o){o()}),s=!1},i=o=>{o&&e.push(o)};return{add:o=>{e.length||window.addEventListener("resize",t),i(o)}}})(),v=function(){var e,s,t,n,i,o;const c=document.createElement("canvas").getContext("2d"),u=(e=window.devicePixelRatio)!=null?e:1,x=(o=(i=(n=(t=(s=c.webkitBackingStorePixelRatio)!=null?s:c.mozBackingStorePixelRatio)!=null?t:c.msBackingStorePixelRatio)!=null?n:c.oBackingStorePixelRatio)!=null?i:c.backingStorePixelRatio)!=null?o:1,g=u/x;return g>1?g:1}();class A extends h.a.Scene{constructor(e){super(e);this.key=e.key,this.log=w.a.get(this.key),this.log.info("boot")}init(){this.log.info("init"),this.events.once("shutdown",this.shutdown,this),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this),this.events.off("destroy",this.destroy,this),this.scale.on("resize",this.resize,this)}shutdown(){this.log.info("shutdown"),this.scale.off("resize",this.resize,this),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.once("destroy",this.destroy,this)}sleep(){this.log.info("sleep"),this.events.off("pause",this.pause,this),this.events.once("wake",this.wake,this)}pause(){this.log.info("pause"),this.events.once("resume",this.resume,this)}wake(){this.log.info("wake"),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this)}resume(){this.log.info("resume"),this.events.once("pause",this.pause,this)}destroy(){this.log.info("destroy"),this.scale.off("resize",this.resize,this),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.off("shutdown",this.shutdown,this),this.log=void 0}resize(e,s,t,n){const{width:i,height:o}=e;this.cameras.resize(i,o)}}class W extends A{constructor(){super({key:"BootScene"})}create(){this.log.info("create"),this.load.rexWebFont({google:{families:["Roboto"]}}),this.load.image("level_bg_tile","assets/images/backgrounddetailed2.png"),this.load.image("web_500","assets/images/web_500.png"),this.load.image("web_256","assets/images/web_256.png"),this.load.image("restart","assets/images/restart.png"),this.load.spritesheet("spider","assets/sprites/spider.png",{frameWidth:120,frameHeight:148,startFrame:0,endFrame:18}),this.load.spritesheet("butterfly","assets/sprites/animated_butterfly.png",{frameWidth:256,frameHeight:256,startFrame:0,endFrame:12}),this.load.on("complete",()=>{this.anims.create({key:"walk",frames:"spider",frameRate:19,repeat:-1}),this.anims.create({key:"fly",frames:"butterfly",frameRate:26,repeat:-1}),document.querySelector(".loader").classList.toggle("loaded"),this.scene.start("LevelScene")}),this.load.start()}}var J=r(19),V=r.n(J),Y=r(3),y=r.n(Y),$=r(4),b=r.n($),H=r(12),S=r.n(H),Z=r(7),R=r.n(Z);const K=.005,O=.001;class Q extends h.a.GameObjects.Sprite{constructor(e,s,t,n,i){super(e,s,t,n);this.life=i,this.play("fly"),this.moveTo=e.rexMoveTo.add(this,{rotateToTarget:!1}),this.setScale(1/5*this.life),e.add.existing(this),this.point=new h.a.Geom.Point,this.fly()}fly(){let e=h.a.Math.RND.integerInRange(500,1e3);const s=h.a.Math.RND.integerInRange(100,200);let t=h.a.Math.Angle.Random();for(h.a.Math.RotateTo(this.point,this.x,this.y,t,e);!h.a.Geom.Rectangle.ContainsPoint(this.scene.worldRec,this.point);)t=h.a.Math.Angle.Random(),e=h.a.Math.RND.integerInRange(500,1e3),h.a.Math.RotateTo(this.point,this.x,this.y,t,e);this.moveTo.setSpeed(s),this.rotation=h.a.Math.Angle.Wrap(t+Math.PI*.5),this.moveTo.moveTo(this.point.x,this.point.y),this.moveTo.once("complete",this.completeFly,this)}completeFly(){const e=4e5+1e5*(this.life-1)*2;if(e<this.scene.area){const s=this.scene.webLookUp.search(this.x,this.y);s!==void 0?(this.anims.stop(),this.setAlpha(.5),this.setTint(65793),this.scene.umEnemies--,this.scene.enemiesText.setText(`enemies fly: ${this.scene.numEnemies}`)):this.fly()}else{const s=this.displayWidth*.5,t=this.scene.createCirclePoly(this.x,this.y,s,10);this.scene.makeHole(t),this.fly()}}}class _ extends A{constructor(){super({key:"LevelScene"});this.currentPointer=null,this.isWalk=!1,this.currentRotation=0,this.points=[],this.inside=!1,this.drawing=!1,this.startIndexes=null,this.endIndexes=null,this.startCollider=null,this.numEnemies=100}create(){this.log.info("create");const{centerX:e,centerY:s,width:t,height:n}=this.cameras.main;this.bg=this.add.tileSprite(e,s,t+1e3,n+1e3,"level_bg_tile").setOrigin(.5).setScrollFactor(0);const i=[[this.createCirclePoly(0,0,400,50)]],o=[[this.createCirclePoly(0,0,150,30)]];this.web=y.a.difference(i,o),this.getArea(this.web[0]),this.log.info(this.web);const c={type:"FeatureCollection",features:[{type:"Feature",properties:{id:"web"},geometry:{type:"Polygon",coordinates:this.web[0]}}]};this.worldRec=new h.a.Geom.Rectangle(-2500,-2500,5e3,5e3),this.webLookUp=new R.a(c),this.webGraphics=this.add.graphics(0,0),this.drawWeb(this.web,this.webGraphics),this.graphics=this.add.graphics(0,0),this.graphics.lineStyle(4,15713599,1),this.spider=this.add.sprite(0,0,"spider").play("walk").setRotation(this.currentRotation+Math.PI*.5),this.cameras.main.startFollow(this.spider,!0),this.enemies=[];for(let g=0;g<this.numEnemies;g++){const p=this.worldRec.getRandomPoint(),d=h.a.Math.RND.integerInRange(1,5);this.enemies.push(new Q(this,p.x,p.y,"butterfly",d))}this.bg.x=e-this.cameras.main.scrollX%500,this.bg.y=s-this.cameras.main.scrollY%500,this.areaText=this.add.text(e,10,`area: ${Math.ceil(this.getArea(this.web[0]))}`,{color:"#ffffff",fontFamily:"Roboto",fontSize:"32px",align:"center"}).setOrigin(.5,0).setScrollFactor(0),this.enemiesText=this.add.text(e,n-10,`enemies fly: ${this.numEnemies}`,{color:"#ffffff",fontFamily:"Roboto",fontSize:"32px",align:"center"}).setOrigin(.5,1).setScrollFactor(0),this.mipmap=this.cameras.add(t-150,n-150,150,150).setZoom(.1).startFollow(this.spider,!0);const u=this.add.circle(0,0,100,16777215,.5),x=this.add.circle(0,0,50,2290649224,.5);this.joystick=this.rexVirtualJoystick.add(this,{x:0,y:0,radius:100,base:u,thumb:x,fixed:!0,enable:!1}).setVisible(!1).on("update",this.dumpJoyStickState,this),this.restartBtn=this.rexButtonn.add(this.add.image(t-10,10,"restart").setScale(.4).setOrigin(1,0).setScrollFactor(0)).setEnable(!0).on("click",()=>{this.restartGame()}),this.mipmap.ignore([this.restartBtn.gameObject,this.bg,u,x,this.areaText]),this.input.on("pointerdown",this.pressDown,this),this.input.on("pointerup",this.pressUp,this)}drawPoly(e,s){const t=S.a.flatten(e),n=S()(t.vertices,t.holes,t.dimensions);for(let i=0;i<n.length;i+=3)s.beginPath(),s.moveTo(t.vertices[n[i]*2],t.vertices[n[i]*2+1]),s.lineTo(t.vertices[n[i+1]*2],t.vertices[n[i+1]*2+1]),s.lineTo(t.vertices[n[i+2]*2],t.vertices[n[i+2]*2+1]),s.closePath(),s.fillPath();e.forEach(i=>{s.beginPath(),s.moveTo(i[0][0],i[0][1]);for(let o=1;o<i.length;o++)s.lineTo(i[o][0],i[o][1]);s.closePath(),s.strokePath()})}drawWeb(e,s){s.clear(),s.lineStyle(4,15713599,1),s.fillStyle(10053375,.5),e.forEach(t=>{this.drawPoly(t,s)})}createCirclePoly(e,s,t,n){const i=new h.a.Geom.Circle(e,s,t);return i.getPoints(!1,n).map(o=>[o.x,o.y])}getArea(e){const s=new b.a(e[0]),t=[e[0]];let n=Math.abs(s.area());if(e.length>1)for(let i=1;i<e.length;i++){const o=new b.a(e[i]),c=Math.abs(o.area());c>1e3&&(n-=c,t.push(e[i]))}return this.web[0]=t,this.area=n,n}resize(e,s,t,n){super.resize(e,s,t,n);const{width:i,height:o,centerX:c,centerY:u}=this.cameras.main;this.bg.setSize(i+1e3,o+1e3).setOrigin(.5),this.restartBtn.gameObject.setPosition(i-10,10),this.bg.x=c-this.cameras.main.scrollX%500,this.bg.y=u-this.cameras.main.scrollY%500,this.mipmap.setPosition(i-150,o-150),this.areaText.setPosition(c,10),this.enemiesText.setPosition(c,o-10)}dumpJoyStickState(){}pressDown(e){if(this.currentPointer!==null)return;this.currentPointer=e;const{x:s,y:t}=e;this.joystick.setPosition(s,t).setVisible(!0).setEnable(!0)}pressUp(e){if(this.currentPointer!==e)return;this.currentPointer=null,this.joystick.setVisible(!1).setEnable(!1)}restartGame(){this.log.info("click restart"),this.scene.restart()}makeHole(e){if(this.web=y.a.difference(this.web,[[e]]),this.web.length>1){let t=this.web[0],n=this.getClearArea(t);for(let i=1;i<this.web.length;i++){const o=this.getClearArea(this.web[i]);o>n&&(n=o,t=this.web[i])}this.web=[t]}const s={type:"FeatureCollection",features:[{type:"Feature",properties:{id:"web"},geometry:{type:"Polygon",coordinates:this.web[0]}}]};if(this.webLookUp=new R.a(s),this.areaText.setText(`area: ${Math.ceil(this.getArea(this.web[0]))}`),this.drawWeb(this.web,this.webGraphics),this.drawing){const t=this.checkWebIntersections(this.startCollider,this.web);t.intersect?this.startIndexes=t.indexes:(this.graphics.clear(),this.graphics.lineStyle(4,15713599,1),this.drawing=!1)}else if(this.inside){const t=this.webLookUp.search(this.spider.x,this.spider.y);this.inside=t!==void 0}}getClearArea(e){const s=new b.a(e[0]);let t=Math.abs(s.area());if(e.length>1)for(let n=1;n<e.length;n++){const i=new b.a(e[n]);t-=Math.abs(i.area())}return t}update(e,s){if(Math.floor(Math.abs(this.joystick.force))===0)return;const t=Math.abs(h.a.Math.Angle.ShortestBetween(this.joystick.angle,h.a.Math.RadToDeg(this.currentRotation)));if(t!==0){const d=s*K*this.joystick.force,E=d<t?d:t;this.currentRotation=h.a.Math.Angle.RotateTo(this.currentRotation,this.joystick.rotation,E/t),this.spider.rotation=this.currentRotation+Math.PI*.5}let{x:n,y:i}=this.spider;const o=s*this.joystick.force*O*Math.cos(this.currentRotation),c=s*this.joystick.force*O*Math.sin(this.currentRotation);this.spider.x+=o,this.spider.y+=c;const{centerX:u,centerY:x}=this.cameras.main;this.bg.x=u-this.cameras.main.scrollX%500,this.bg.y=x-this.cameras.main.scrollY%500;const g=new h.a.Geom.Line(n,i,this.spider.x,this.spider.y);let p=this.checkWebIntersections(g,this.web);if(p.intersect)if(this.inside)this.startIndexes=p.indexes,this.inside=!1,this.drawing=!0,this.points.push(p.point),n=p.point[0],i=p.point[1],this.inside=!1,this.drawing=!0,this.startCollider=g,this.log.info("inside:",this.inside,"drawing:",this.drawing);else{if(this.drawing){this.graphics.clear(),this.graphics.lineStyle(4,15713599,1),this.endIndexes=p.indexes,this.points.push(p.point);const d=V()(this.points.map(a=>({x:a[0],y:a[1]})),.8,!1).map(a=>[a.x,a.y]);this.log.info(this.points.length,"-->",d.length),this.points.length=0;const E=new b.a(d),P=E.winding();if(this.log.info(this.startIndexes[1]>0,P,this.startIndexes[2],this.endIndexes[2]),!this.startIndexes[1]>0){if(P)if(this.startIndexes[2]>this.endIndexes[2])for(let l=this.endIndexes[2]+1;l<this.startIndexes[2];l++)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][l]);else{for(let l=this.endIndexes[2]+1;l<this.web[this.endIndexes[0]][this.endIndexes[1]].length;l++)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][l]);for(let l=0;l<this.startIndexes[2];l++)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][l])}else if(this.startIndexes[2]<this.endIndexes[2])for(let l=this.endIndexes[2];l>this.startIndexes[2];l--)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][l]);else{for(let l=this.endIndexes[2];l>0;l--)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][l]);for(let l=this.web[this.endIndexes[0]][this.endIndexes[1]].length-1;l<this.startIndexes[2];l++)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][l])}const a=[];for(let l=1;l<this.web[this.startIndexes[0]].length;l++)a.push(this.web[this.startIndexes[0]][l]);this.web=y.a.union(this.web,[d]),a.forEach(l=>{this.web=y.a.difference(this.web,[l])})}else{if(P)if(this.startIndexes[2]>this.endIndexes[2])for(let a=this.endIndexes[2];a<this.startIndexes[2]+1;a++)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a]);else{for(let a=this.endIndexes[2];a<this.web[this.endIndexes[0]][this.endIndexes[1]].length;a++)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a]);for(let a=0;a<this.startIndexes[2]+1;a++)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a])}else if(this.startIndexes[2]<this.endIndexes[2])for(let a=this.endIndexes[2];a>this.startIndexes[2];a--)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a]);else{for(let a=this.endIndexes[2];a>0;a--)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a]);for(let a=this.web[this.endIndexes[0]][this.endIndexes[1]].length-1;a>this.startIndexes[2];a--)d.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a])}this.web=y.a.union(this.web,[d])}this.log.info("web",this.web),this.areaText.setText(`area: ${Math.ceil(this.getArea(this.web[0]))}`);const ee={type:"FeatureCollection",features:[{type:"Feature",properties:{id:"web"},geometry:{type:"Polygon",coordinates:this.web[0]}}]};this.webLookUp=new R.a(ee),this.drawWeb(this.web,this.webGraphics),this.drawing=!1}this.inside=!0,this.log.info("inside:",this.inside,"drawing:",this.drawing)}if(this.drawing)if(this.graphics.lineBetween(n,i,this.spider.x,this.spider.y),this.points.length>4){p=!1;for(let d=1;d<this.points.length-3;d++){const E=new h.a.Geom.Line(this.points[d-1][0],this.points[d-1][1],this.points[d][0],this.points[d][1]);if(p=h.a.Geom.Intersects.LineToLine(g,E),p)break}p?(this.log.info("intersect"),this.graphics.clear(),this.graphics.lineStyle(4,15713599,1),this.points.length=0,this.drawing=!1):this.points.push([this.spider.x,this.spider.y])}else this.points.push([this.spider.x,this.spider.y])}checkWebIntersections(e,s){const t=new h.a.Geom.Point;let n=!1;for(let i=0;i<s.length;i++)for(let o=0;o<s[i].length;o++)for(let c=0;c<s[i][o].length-1;c++){const u=new h.a.Geom.Line(s[i][o][c][0],s[i][o][c][1],s[i][o][c+1][0],s[i][o][c+1][1]);if(n=h.a.Geom.Intersects.LineToLine(e,u,t),n)return this.log.info("collide with web",i,o,c),{intersect:n,point:[t.x,t.y],indexes:[i,o,c]}}return{intersect:n}}shutdown(){this.crash.clear(),this.input.off("pointerdown",this.pressDown,this),this.input.off("pointerup",this.pressUp,this),this.restartBtn.off("click"),this.joystick.off("update",this.dumpJoyStickState,this),super.shutdown()}}var j=Object.assign;D.a.disablePageScroll(),w.a.useDefaults(),w.a.setLevel(w.a.OFF);const T=w.a.get("index");T.info("start");const q={global:[{key:"rexWebFontLoader",plugin:N.a,start:!0},{key:"rexButtonn",plugin:F.a,start:!0,mapping:"rexButtonn"},{key:"rexVirtualJoystick",plugin:X.a,start:!0,mapping:"rexVirtualJoystick"},{key:"rexMoveTo",plugin:z.a,start:!0,mapping:"rexMoveTo"}],scene:[]};window.onload=()=>{window.game=new h.a.Game(j(j({},G),{plugins:q,scene:[W,_],callbacks:{preBoot:e=>{T.info("game booting start")},postBoot:e=>{T.info("game booting complete"),window.scrollTo(0,1),e.scale.resize(window.innerWidth*v,k()()*v),B.add(()=>{e.scale.resize(window.innerWidth*v,k()()*v)})}}}))}}},[[24,1,2]]]);
