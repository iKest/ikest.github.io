(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{24:function(w,I,h){w.exports=h(50)},25:function(w,I,h){var A=h(26),m=h(27);m=m.__esModule?m.default:m,typeof m=="string"&&(m=[[w.i,m,""]]);var c={};c.insert="head",c.singleton=!1;var L=A(m,c);w.exports=m.locals||{}},27:function(w,I,h){},50:function(w,I,h){"use strict";h.r(I);var A=h(25),m=h(0),c=h.n(m),L=h(2),b=h.n(L),N=h(16),F=h.n(N),z=h(11),k=h.n(z),X=h(21),B=h(23),W=h(22),G=h(20);const J={type:c.a.AUTO,disableContextMenu:!0,render:{transparent:!0},scale:{parent:"gameContainer",mode:c.a.Scale.NONE,width:"100%",height:"100%",expandParent:!1}},V=(()=>{const e=[];let s=!1;const t=()=>{s||(s=!0,window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,66))},n=()=>{e.forEach(function(o){o()}),s=!1},i=o=>{o&&e.push(o)};return{add:o=>{e.length||window.addEventListener("resize",t),i(o)}}})(),T=function(){var e,s,t,n,i,o;const r=document.createElement("canvas").getContext("2d"),g=(e=window.devicePixelRatio)!=null?e:1,p=(o=(i=(n=(t=(s=r.webkitBackingStorePixelRatio)!=null?s:r.mozBackingStorePixelRatio)!=null?t:r.msBackingStorePixelRatio)!=null?n:r.oBackingStorePixelRatio)!=null?i:r.backingStorePixelRatio)!=null?o:1,u=g/p;return u>1?u:1}();class S extends c.a.Scene{constructor(e){super(e);this.key=e.key,this.log=b.a.get(this.key),this.log.info("boot")}init(){this.log.info("init"),this.events.once("shutdown",this.shutdown,this),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this),this.events.off("destroy",this.destroy,this),this.scale.on("resize",this.resize,this)}shutdown(){this.log.info("shutdown"),this.scale.off("resize",this.resize,this),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.once("destroy",this.destroy,this)}sleep(){this.log.info("sleep"),this.events.off("pause",this.pause,this),this.events.once("wake",this.wake,this)}pause(){this.log.info("pause"),this.events.once("resume",this.resume,this)}wake(){this.log.info("wake"),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this)}resume(){this.log.info("resume"),this.events.once("pause",this.pause,this)}destroy(){this.log.info("destroy"),this.scale.off("resize",this.resize,this),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.off("shutdown",this.shutdown,this),this.log=void 0}resize(e,s,t,n){const{width:i,height:o}=e;this.cameras.resize(i,o)}}class Y extends S{constructor(){super({key:"BootScene"})}create(){this.log.info("create"),this.load.rexWebFont({google:{families:["Roboto"]}}),this.load.image("level_bg_tile","assets/images/backgrounddetailed2.png"),this.load.image("web_500","assets/images/web_500.png"),this.load.image("web_256","assets/images/web_256.png"),this.load.image("restart","assets/images/restart.png"),this.load.spritesheet("spider","assets/sprites/spider.png",{frameWidth:120,frameHeight:148,startFrame:0,endFrame:18}),this.load.spritesheet("butterfly","assets/sprites/animated_butterfly.png",{frameWidth:256,frameHeight:256,startFrame:0,endFrame:12}),this.load.on("complete",()=>{this.anims.create({key:"walk",frames:"spider",frameRate:19,repeat:-1}),this.anims.create({key:"fly",frames:"butterfly",frameRate:26,repeat:-1}),document.querySelector(".loader").classList.toggle("loaded"),this.scene.start("LevelScene")}),this.load.start()}}var $=h(19),H=h.n($),Z=h(3),E=h.n(Z),K=h(4),v=h.n(K),Q=h(12),O=h.n(Q),_=h(7),P=h.n(_),q=(e,s,t)=>new Promise((n,i)=>{var o=p=>{try{g(t.next(p))}catch(u){i(u)}},r=p=>{try{g(t.throw(p))}catch(u){i(u)}},g=p=>p.done?n(p.value):Promise.resolve(p.value).then(o,r);g((t=t.apply(e,s)).next())});const ee=.005,j=.001,C=e=>new Promise(s=>setTimeout(s,e)),te=Math.pow(2,-53),se=(e,s)=>Math.abs(e-s)<te,D=(e,s,t,n,i)=>{const o=s[0]-e[0],r=s[1]-e[1],g=n[0]-t[0],p=n[1]-t[1],u=o*p-g*r;if(se(u,0))return 0;const f=e[0]-t[0],l=e[1]-t[1],y=o*l-r*f;if(y<0===u>0)return-1;const x=g*l-p*f;if(x<0===u>0)return-1;if(y>u===u>0||x>u===u>0)return-1;const R=x/u;return i!==void 0&&Array.isArray(i)&&(i[0]=e[0]+R*o,i[1]=e[1]+R*r),1};class ie extends c.a.GameObjects.Sprite{constructor(e,s,t,n,i){super(e,s,t,n);this.life=i,this.moveTo=e.rexMoveTo.add(this,{rotateToTarget:!1}),this.setScale(1/5*this.life),e.add.existing(this),this.point=new c.a.Geom.Point,this.fly()}fly(){let e=c.a.Math.RND.integerInRange(500,1e3);const s=c.a.Math.RND.integerInRange(100,200);let t=c.a.Math.Angle.Random();for(c.a.Math.RotateTo(this.point,this.x,this.y,t,e);!c.a.Geom.Rectangle.ContainsPoint(this.scene.worldRec,this.point);)t=c.a.Math.Angle.Random(),e=c.a.Math.RND.integerInRange(500,1e3),c.a.Math.RotateTo(this.point,this.x,this.y,t,e);this.moveTo.setSpeed(s),this.rotation=c.a.Math.Angle.Wrap(t+Math.PI*.5),this.moveTo.moveTo(this.point.x,this.point.y),this.moveTo.once("complete",this.completeFly,this),this.setTint(),this.play("fly")}completeFly(){return q(this,null,function*(){const e=4e5+1e5*this.life*2,s=this.scene.webLookUp.search(this.x,this.y);if(s!==void 0)if(e<this.scene.area)this.anims.stop(),this.setTint(65280),yield C(3e3),this.setAlpha(.5),this.setTint(65793),this.scene.numEnemies--,this.scene.enemiesText.setText(`enemies fly: ${this.scene.numEnemies}`);else{this.anims.stop(),this.setTint(16711680),yield C(3e3);const t=this.displayWidth*.5,n=this.scene.createCirclePoly(this.x,this.y,t,10);this.scene.makeHole(n),this.fly()}else this.fly()})}}class ne extends S{constructor(){super({key:"LevelScene"});this.currentPointer=null,this.isWalk=!1,this.currentRotation=0,this.points=[],this.inside=!1,this.drawing=!1,this.startIndexes=null,this.endIndexes=null,this.startCollider=null,this.numEnemies=100}create(){this.log.info("create");const{centerX:e,centerY:s,width:t,height:n}=this.cameras.main;this.bg=this.add.tileSprite(e,s,t+1e3,n+1e3,"level_bg_tile").setOrigin(.5).setScrollFactor(0);const i=[[this.createCirclePoly(0,0,400,50)]],o=[[this.createCirclePoly(0,0,150,30)]];this.web=E.a.difference(i,o),this.getArea(this.web[0]),this.log.info(this.web);const r={type:"FeatureCollection",features:[{type:"Feature",properties:{id:"web"},geometry:{type:"Polygon",coordinates:this.web[0]}}]};this.worldRec=new c.a.Geom.Rectangle(-2500,-2500,5e3,5e3),this.webLookUp=new P.a(r),this.webGraphics=this.add.graphics(0,0),this.drawWeb(this.web,this.webGraphics),this.graphics=this.add.graphics(0,0),this.graphics.lineStyle(4,15713599,1),this.spider=this.add.sprite(0,0,"spider").play("walk").setRotation(this.currentRotation+Math.PI*.5),this.cameras.main.startFollow(this.spider,!0),this.enemies=[];for(let u=0;u<this.numEnemies;u++){const f=this.worldRec.getRandomPoint(),l=c.a.Math.RND.integerInRange(1,5);this.enemies.push(new ie(this,f.x,f.y,"butterfly",l))}this.bg.x=e-this.cameras.main.scrollX%500,this.bg.y=s-this.cameras.main.scrollY%500,this.areaText=this.add.text(e,10,`area: ${Math.ceil(this.getArea(this.web[0]))}`,{color:"#ffffff",fontFamily:"Roboto",fontSize:"32px",align:"center"}).setOrigin(.5,0).setScrollFactor(0),this.enemiesText=this.add.text(e,n-10,`enemies fly: ${this.numEnemies}`,{color:"#ffffff",fontFamily:"Roboto",fontSize:"32px",align:"center"}).setOrigin(.5,1).setScrollFactor(0),this.mipmap=this.cameras.add(t-150,n-150,150,150).setZoom(.1).startFollow(this.spider,!0);const g=this.add.circle(0,0,100,16777215,.5),p=this.add.circle(0,0,50,2290649224,.5);this.joystick=this.rexVirtualJoystick.add(this,{x:0,y:0,radius:100,base:g,thumb:p,fixed:!0,enable:!1}).setVisible(!1).on("update",this.dumpJoyStickState,this),this.restartBtn=this.rexButtonn.add(this.add.image(t-10,10,"restart").setScale(.4).setOrigin(1,0).setScrollFactor(0)).setEnable(!0).on("click",()=>{this.restartGame()}),this.mipmap.ignore([this.restartBtn.gameObject,this.bg,g,p,this.areaText]),this.input.on("pointerdown",this.pressDown,this),this.input.on("pointerup",this.pressUp,this)}drawPoly(e,s){const t=O.a.flatten(e),n=O()(t.vertices,t.holes,t.dimensions);for(let i=0;i<n.length;i+=3)s.beginPath(),s.moveTo(t.vertices[n[i]*2],t.vertices[n[i]*2+1]),s.lineTo(t.vertices[n[i+1]*2],t.vertices[n[i+1]*2+1]),s.lineTo(t.vertices[n[i+2]*2],t.vertices[n[i+2]*2+1]),s.closePath(),s.fillPath();e.forEach(i=>{s.beginPath(),s.moveTo(i[0][0],i[0][1]);for(let o=1;o<i.length;o++)s.lineTo(i[o][0],i[o][1]);s.closePath(),s.strokePath()})}drawWeb(e,s){s.clear(),s.lineStyle(4,15713599,1),s.fillStyle(10053375,.5),e.forEach(t=>{this.drawPoly(t,s)})}createCirclePoly(e,s,t,n){const i=new c.a.Geom.Circle(e,s,t);return i.getPoints(!1,n).map(o=>[o.x,o.y])}getArea(e){const s=new v.a(e[0]),t=[e[0]];let n=Math.abs(s.area());if(e.length>1)for(let i=1;i<e.length;i++){const o=new v.a(e[i]),r=Math.abs(o.area());r>1e3&&(n-=r,t.push(e[i]))}return this.web[0]=t,this.area=n,n}resize(e,s,t,n){super.resize(e,s,t,n);const{width:i,height:o,centerX:r,centerY:g}=this.cameras.main;this.bg.setSize(i+1e3,o+1e3).setOrigin(.5),this.restartBtn.gameObject.setPosition(i-10,10),this.bg.x=r-this.cameras.main.scrollX%500,this.bg.y=g-this.cameras.main.scrollY%500,this.mipmap.setPosition(i-150,o-150),this.areaText.setPosition(r,10),this.enemiesText.setPosition(r,o-10)}dumpJoyStickState(){}pressDown(e){if(this.currentPointer!==null)return;this.currentPointer=e;const{x:s,y:t}=e;this.joystick.setPosition(s,t).setVisible(!0).setEnable(!0)}pressUp(e){if(this.currentPointer!==e)return;this.currentPointer=null,this.joystick.setVisible(!1).setEnable(!1)}restartGame(){this.log.info("click restart"),this.scene.restart()}makeHole(e){if(this.web=E.a.difference(this.web,[[e]]),this.web.length>1){let t=this.web[0],n=this.getClearArea(t);for(let i=1;i<this.web.length;i++){const o=this.getClearArea(this.web[i]);o>n&&(n=o,t=this.web[i])}this.web=[t]}const s={type:"FeatureCollection",features:[{type:"Feature",properties:{id:"web"},geometry:{type:"Polygon",coordinates:this.web[0]}}]};if(this.webLookUp=new P.a(s),this.areaText.setText(`area: ${Math.ceil(this.getArea(this.web[0]))}`),this.drawWeb(this.web,this.webGraphics),this.drawing){const t=this.checkWebIntersections(this.startCollider,this.web);t.intersect>0?this.startIndexes=t.indexes:(this.graphics.clear(),this.graphics.lineStyle(4,15713599,1),this.drawing=!1)}else if(this.inside){const t=this.webLookUp.search(this.spider.x,this.spider.y);this.inside=t!==void 0}}getClearArea(e){const s=new v.a(e[0]);let t=Math.abs(s.area());if(e.length>1)for(let n=1;n<e.length;n++){const i=new v.a(e[n]);t-=Math.abs(i.area())}return t}update(e,s){if(Math.floor(Math.abs(this.joystick.force))===0)return;const t=Math.abs(c.a.Math.Angle.ShortestBetween(this.joystick.angle,c.a.Math.RadToDeg(this.currentRotation)));if(t!==0){const l=s*ee*this.joystick.force,y=l<t?l:t;this.currentRotation=c.a.Math.Angle.RotateTo(this.currentRotation,this.joystick.rotation,y/t),this.spider.rotation=this.currentRotation+Math.PI*.5}let{x:n,y:i}=this.spider;const o=s*this.joystick.force*j*Math.cos(this.currentRotation),r=s*this.joystick.force*j*Math.sin(this.currentRotation);this.spider.x+=o,this.spider.y+=r;const{centerX:g,centerY:p}=this.cameras.main;this.bg.x=g-this.cameras.main.scrollX%500,this.bg.y=p-this.cameras.main.scrollY%500;const u=[[n,i],[this.spider.x,this.spider.y]];let f=this.checkWebIntersections(u,this.web);if(f.intersect>0)if(this.inside)this.startIndexes=f.indexes,this.inside=!1,this.drawing=!0,this.points.push(f.point),n=f.point[0],i=f.point[1],this.inside=!1,this.drawing=!0,this.startCollider=u,this.log.info("inside:",this.inside,"drawing:",this.drawing);else{if(this.drawing){this.graphics.clear(),this.graphics.lineStyle(4,15713599,1),this.endIndexes=f.indexes,this.points.push(f.point);const l=H()(this.points.map(a=>({x:a[0],y:a[1]})),.8,!1).map(a=>[a.x,a.y]);this.log.info(this.points.length,"-->",l.length),this.points.length=0;const y=new v.a(l),x=y.winding();if(this.log.info(this.startIndexes[1]>0,x,this.startIndexes[2],this.endIndexes[2]),!this.startIndexes[1]>0){if(x)if(this.startIndexes[2]>this.endIndexes[2])for(let d=this.endIndexes[2]+1;d<this.startIndexes[2];d++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][d]);else{for(let d=this.endIndexes[2]+1;d<this.web[this.endIndexes[0]][this.endIndexes[1]].length;d++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][d]);for(let d=0;d<this.startIndexes[2];d++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][d])}else if(this.startIndexes[2]<this.endIndexes[2])for(let d=this.endIndexes[2];d>this.startIndexes[2];d--)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][d]);else{for(let d=this.endIndexes[2];d>0;d--)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][d]);for(let d=this.web[this.endIndexes[0]][this.endIndexes[1]].length-1;d<this.startIndexes[2];d++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][d])}const a=[];for(let d=1;d<this.web[this.startIndexes[0]].length;d++)a.push(this.web[this.startIndexes[0]][d]);this.web=E.a.union(this.web,[l]),a.forEach(d=>{this.web=E.a.difference(this.web,[d])})}else{if(x)if(this.startIndexes[2]>this.endIndexes[2])for(let a=this.endIndexes[2];a<this.startIndexes[2]+1;a++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a]);else{for(let a=this.endIndexes[2];a<this.web[this.endIndexes[0]][this.endIndexes[1]].length;a++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a]);for(let a=0;a<this.startIndexes[2]+1;a++)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a])}else if(this.startIndexes[2]<this.endIndexes[2])for(let a=this.endIndexes[2];a>this.startIndexes[2];a--)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a]);else{for(let a=this.endIndexes[2];a>0;a--)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a]);for(let a=this.web[this.endIndexes[0]][this.endIndexes[1]].length-1;a>this.startIndexes[2];a--)l.push(this.web[this.startIndexes[0]][this.startIndexes[1]][a])}this.web=E.a.union(this.web,[l])}this.log.info("web",this.web),this.areaText.setText(`area: ${Math.ceil(this.getArea(this.web[0]))}`);const R={type:"FeatureCollection",features:[{type:"Feature",properties:{id:"web"},geometry:{type:"Polygon",coordinates:this.web[0]}}]};this.webLookUp=new P.a(R),this.drawWeb(this.web,this.webGraphics),this.drawing=!1}this.inside=!0,this.log.info("inside:",this.inside,"drawing:",this.drawing)}if(this.drawing)if(this.graphics.lineBetween(n,i,this.spider.x,this.spider.y),this.points.length>2){f=0;for(let l=1;l<this.points.length-1&&!(f=D(u[0],u[1],this.points[l-1],this.points[l]),f>0);l++);f>0?(this.log.info("intersect"),this.graphics.clear(),this.graphics.lineStyle(4,15713599,1),this.points.length=0,this.drawing=!1):this.points.push([this.spider.x,this.spider.y])}else this.points.push([this.spider.x,this.spider.y])}checkWebIntersections(e,s){const t=[];let n=-1;for(let i=0;i<s.length;i++)for(let o=0;o<s[i].length;o++)for(let r=0;r<s[i][o].length-1;r++)if(n=D(e[0],e[1],s[i][o][r],s[i][o][r+1],t),n>0)return this.log.info("collide with web",i,o,r),{intersect:n,point:t,indexes:[i,o,r]};return{intersect:n}}shutdown(){this.crash.clear(),this.input.off("pointerdown",this.pressDown,this),this.input.off("pointerup",this.pressUp,this),this.restartBtn.off("click"),this.joystick.off("update",this.dumpJoyStickState,this),super.shutdown()}}var U=Object.assign;F.a.disablePageScroll(),b.a.useDefaults(),b.a.setLevel(b.a.OFF);const M=b.a.get("index");M.info("start");const oe={global:[{key:"rexWebFontLoader",plugin:X.a,start:!0},{key:"rexButtonn",plugin:B.a,start:!0,mapping:"rexButtonn"},{key:"rexVirtualJoystick",plugin:G.a,start:!0,mapping:"rexVirtualJoystick"},{key:"rexMoveTo",plugin:W.a,start:!0,mapping:"rexMoveTo"}],scene:[]};window.onload=()=>{window.game=new c.a.Game(U(U({},J),{plugins:oe,scene:[Y,ne],callbacks:{preBoot:e=>{M.info("game booting start")},postBoot:e=>{M.info("game booting complete"),window.scrollTo(0,1),e.scale.resize(window.innerWidth*T,k()()*T),V.add(()=>{e.scale.resize(window.innerWidth*T,k()()*T)})}}}))}}},[[24,1,2]]]);
