!function(){"use strict";"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function t(t,i){return t(i={exports:{}},i.exports),i.exports}var i=t(function(t,i){var e;t.exports=((e=function(){var t=0,i=document.createElement("div");function s(t){return i.appendChild(t.dom),t}function h(e){for(var s=0;s<i.children.length;s++)i.children[s].style.display=s===e?"block":"none";t=e}i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),h(++t%i.children.length)},!1);var a=(performance||Date).now(),n=a,o=0,l=s(new e.Panel("FPS","#0ff","#002")),r=s(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=s(new e.Panel("MB","#f08","#201"));return h(0),{REVISION:16,dom:i,addPanel:s,showPanel:h,begin:function(){a=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(r.update(t-a,200),n+1e3<=t&&(l.update(1e3*o/(t-n),100),n=t,o=0,c)){var i=performance.memory;c.update(i.usedJSHeapSize/1048576,i.jsHeapSizeLimit/1048576)}return t},update:function(){a=this.end()},domElement:i,setMode:h}}).Panel=function(t,i,e){var s=1/0,h=0,a=Math.round,n=a(window.devicePixelRatio||1),o=80*n,l=48*n,r=3*n,c=2*n,d=3*n,p=15*n,g=74*n,u=30*n,f=document.createElement("canvas");f.width=o,f.height=l,f.style.cssText="width:80px;height:48px";var x=f.getContext("2d");return x.font="bold "+9*n+"px Helvetica,Arial,sans-serif",x.textBaseline="top",x.fillStyle=e,x.fillRect(0,0,o,l),x.fillStyle=i,x.fillText(t,r,c),x.fillRect(d,p,g,u),x.fillStyle=e,x.globalAlpha=.9,x.fillRect(d,p,g,u),{dom:f,update:function(l,m){s=Math.min(s,l),h=Math.max(h,l),x.fillStyle=e,x.globalAlpha=1,x.fillRect(0,0,o,p),x.fillStyle=i,x.fillText(a(l)+" "+t+" ("+a(s)+"-"+a(h)+")",r,c),x.drawImage(f,d+n,p,g-n,u,d,p,g-n,u),x.fillRect(d+g-n,p,n,u),x.fillStyle=e,x.globalAlpha=.9,x.fillRect(d+g-n,p,n,a((1-l/m)*u))}}},e)});const e=5e3,s=5e3,h=300,a=200*Math.PI,n=200,o=200,l=40,r=1,c=-6,d=1e3,p=15,g=new Map([["purple-lavender",["#911eb4","#e6beff"]],["green-mint",["#3cb44b","#aaffc3"]],["blue-cian",["#4363d8","#42d4f4"]],["navi-teal",["#000075","#469990"]],["olive-lime",["#808000","#bfef45"]],["yellow-biege",["#ffe119","#fffac8"]],["orange-apricot",["#f58231","#ffd8b1"]],["red-pink",["#e6194B","#fabebe"]],["maroon-brown",["#800000","#9A6324"]]]);var u=t(function(t){var i=Object.prototype.hasOwnProperty,e="~";function s(){}function h(t,i,e){this.fn=t,this.context=i,this.once=e||!1}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(e=!1)),a.prototype.eventNames=function(){var t,s,h=[];if(0===this._eventsCount)return h;for(s in t=this._events)i.call(t,s)&&h.push(e?s.slice(1):s);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(t)):h},a.prototype.listeners=function(t,i){var s=e?e+t:t,h=this._events[s];if(i)return!!h;if(!h)return[];if(h.fn)return[h.fn];for(var a=0,n=h.length,o=new Array(n);a<n;a++)o[a]=h[a].fn;return o},a.prototype.emit=function(t,i,s,h,a,n){var o=e?e+t:t;if(!this._events[o])return!1;var l,r,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,i),!0;case 3:return c.fn.call(c.context,i,s),!0;case 4:return c.fn.call(c.context,i,s,h),!0;case 5:return c.fn.call(c.context,i,s,h,a),!0;case 6:return c.fn.call(c.context,i,s,h,a,n),!0}for(r=1,l=new Array(d-1);r<d;r++)l[r-1]=arguments[r];c.fn.apply(c.context,l)}else{var p,g=c.length;for(r=0;r<g;r++)switch(c[r].once&&this.removeListener(t,c[r].fn,void 0,!0),d){case 1:c[r].fn.call(c[r].context);break;case 2:c[r].fn.call(c[r].context,i);break;case 3:c[r].fn.call(c[r].context,i,s);break;case 4:c[r].fn.call(c[r].context,i,s,h);break;default:if(!l)for(p=1,l=new Array(d-1);p<d;p++)l[p-1]=arguments[p];c[r].fn.apply(c[r].context,l)}}return!0},a.prototype.on=function(t,i,s){var a=new h(i,s||this),n=e?e+t:t;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],a]:this._events[n].push(a):(this._events[n]=a,this._eventsCount++),this},a.prototype.once=function(t,i,s){var a=new h(i,s||this,!0),n=e?e+t:t;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],a]:this._events[n].push(a):(this._events[n]=a,this._eventsCount++),this},a.prototype.removeListener=function(t,i,h,a){var n=e?e+t:t;if(!this._events[n])return this;if(!i)return 0==--this._eventsCount?this._events=new s:delete this._events[n],this;var o=this._events[n];if(o.fn)o.fn!==i||a&&!o.once||h&&o.context!==h||(0==--this._eventsCount?this._events=new s:delete this._events[n]);else{for(var l=0,r=[],c=o.length;l<c;l++)(o[l].fn!==i||a&&!o[l].once||h&&o[l].context!==h)&&r.push(o[l]);r.length?this._events[n]=1===r.length?r[0]:r:0==--this._eventsCount?this._events=new s:delete this._events[n]}return this},a.prototype.removeAllListeners=function(t){var i;return t?(i=e?e+t:t,this._events[i]&&(0==--this._eventsCount?this._events=new s:delete this._events[i])):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},a.prefixed=e,a.EventEmitter=a,t.exports=a}),f=function(t,i,e,s,h,a,n){var o=[h-t,a-i],l=[e-t,s-i],r=x(l,l),c=x(o,l)/r,d=[l[0]*(c=(c=c<0?0:c)>1?1:c)+t-h,l[1]*c+i-a];return x(d,d)<=n*n};function x(t,i){return t[0]*i[0]+t[1]*i[1]}function m(t,i,e,s){return Math.sqrt(Math.pow(t-e,2)+Math.pow(i-s,2))}var v=function(t,i,e,s,h,a,n){return n=n||1,Math.abs(m(t,i,e,s)-(m(t,i,h,a)+m(e,s,h,a)))<=n},M=function(t,i,e,s){var h,a,n=t.length,o=!1;for(h=0,a=n-2;h<n;h+=2)t[h+1]>e!=t[a+1]>e&&i<(t[a]-t[h])*(e-t[h+1])/(t[a+1]-t[h+1])+t[h]&&(o=!o),a=h;if(o)return!0;for(h=0;h<n;h+=2){var l,r,c=t[h],d=t[h+1];if(h===n-2?(l=t[0],r=t[1]):(l=t[h+2],r=t[h+3]),v(c,d,l,r,i,e,s))return!0}return!1},y=function(t,i,e,s){if(M(t,i,e))return!0;for(var h=t.length,a=0;a<h-2;a+=2)if(f(t[a],t[a+1],t[a+2],t[a+3],i,e,s))return!0;return f(t[0],t[1],t[h-2],t[h-1],i,e,s)};var w=function(t,i){for(var e,s,h,a,n,o,l=t,r=i,c=[l,r],d=0;d<c.length;d++)for(var p=c[d],g=0;g<p.length;g+=2){var u=(g+2)%p.length,f={x:p[u+1]-p[g+1],y:p[g]-p[u]};for(e=s=null,o=0;o<l.length;o+=2)h=f.x*l[o]+f.y*l[o+1],(null===e||h<e)&&(e=h),(null===s||h>s)&&(s=h);for(a=n=null,o=0;o<r.length;o+=2)h=f.x*r[o]+f.y*r[o+1],(null===a||h<a)&&(a=h),(null===n||h>n)&&(n=h);if(s<a||n<e)return!1}return!0},S=w,b=y;const P=(t,i)=>{let e=t+Math.random()*(i+1-t);return e=Math.floor(e)},I=(t,i)=>{let e=Math.atan(Math.abs(t/i));return t>0&&i<0?e=Math.PI-e:t<0&&i<0?e=Math.PI+e:t<0&&i>0&&(e=2*Math.PI-e),e},T=(t,i,e,s,h)=>{return{x:Math.cos(h)*(e-t)-Math.sin(h)*(s-i)+t,y:Math.sin(h)*(e-t)+Math.cos(h)*(s-i)+i}},Y=(t,i,e,s)=>{const h=s-i,a=e-t;let n=Math.atan2(h,a);return(n*=180/Math.PI)<0&&(n=-1*n+180),n},X=(t,i)=>{let e=Math.atan2(i,t);return(e*=180/Math.PI)<0&&(e=-1*e+180),e},k=(t,i)=>{let e=Math.abs(i*Math.sin(t)),s=Math.abs(i*Math.cos(t));return t<Math.PI/2?s*=-1:t<Math.PI?(e*=1,s*=1):t<3*Math.PI/2?e*=-1:(e*=-1,s*=-1),{vx:e,vy:s}};class _{constructor(t,i){if(this.gameMap=t,this.x=+(i.x||0),this.y=+(i.y||0),this.width=i.size||i.width||0,this.height=i.size||i.height||0,this.id=i.id||"",!this.width||!this.height)throw new Error("element size can not be undefined")}prepare(){this.paintX=this.gameMap.view.relativeX(this.x),this.paintY=this.gameMap.view.relativeY(this.y),this.paintWidth=this.gameMap.view.relativeW(this.width),this.paintHeight=this.gameMap.view.relativeH(this.height);const t=this.paintWidth/2,i=this.paintHeight/2;this.visible=this.paintX+t>0&&this.paintX-t<this.gameMap.view.width&&this.paintY+i>0&&this.paintY-i<this.gameMap.view.height}}class F extends _{constructor(t,i){super(t,i),this.lightDirection=!0,this.point=i.point,this.lightSize=this.width/2,this.onField=i.onField}update(){this.action()}action(){if(!this.visible)return;this.lightSize+=this.lightDirection?1:-1,(this.lightSize>this.width||this.lightSize<this.width/2)&&(this.lightDirection=!this.lightDirection)}render(){this.prepare(),this.visible&&(this.gameMap.ctx.save(),this.gameMap.ctx.fillStyle="#f032e6",this.gameMap.ctx.globalAlpha=.2,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(this.paintX,this.paintY,this.lightSize*this.paintWidth/this.width,0,2*Math.PI),this.gameMap.ctx.fill(),this.gameMap.ctx.globalAlpha=1,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(this.paintX,this.paintY,Math.floor(this.paintWidth/2),0,2*Math.PI),this.gameMap.ctx.fill(),this.gameMap.ctx.restore())}}class A{constructor(t,i,e,s,h){this.x=t,this.y=i,this.speed=e,this.angle=h,this.dt=s}}class H{constructor(t,i,e,s,h,a){this.cX=t,this.cY=i,this.lX=e,this.lY=s,this.rX=h,this.rY=a}set(t,i,e,s,h,a){this.cX=t,this.cY=i,this.lX=e,this.lY=s,this.rX=h,this.rY=a}}class D extends _{constructor(t,i){super(t,i),this.point=0,this.isSpeedUp=!1,this.status="idle",this.color=i.color,this.stopped=!1,this.head=[],this.visionAngle=170,this.closestSnakeDistance=5e3,this.closestFoodDistance=5e3,this.closestSnakeID="",this.foodID="",this.closestSnake={},this.closestFood={},this.seeSnake=!1,this.collidedV=!1,this.collidedH=!1,this.movementQueue=[],this.colliderIdx=0,this.colliders=[],this.speed=h,this.oldSpeed=h,this.turnSpeed=.2,this.vx=0,this.vy=0,this.toAngle=(i.angle||0)+a,this.angle=(i.angle||0)+a,this.length=i.length||0,this.isPlayer=i.isPlayer||!1,this.updateSize(),this.velocity(),this.calcHead()}resetSnake(){this.point=0,this.isSpeedUp=!1,this.status="idle",this.stopped=!1,this.foodsEated=new Map,this.head=[],this.visionAngle=170,this.closestSnakeDistance=5e3,this.closestFoodDistance=5e3,this.closestSnakeID="",this.foodID="",this.closestSnake={},this.closestFood={},this.seeSnake=!1,this.collidedV=!1,this.collidedH=!1,this.movementQueue=[],this.colliderIdx=0,this.speed=h,this.oldSpeed=h,this.turnSpeed=1,this.vx=0,this.vy=0}setStatus(t){this.status=t}zeroFood(){this.closestFoodDistance=5e4,"eating"!==this.status&&"seefood"!==this.status||(this.status="idle")}zeroSnake(){this.closestSnakeDistance=5e4,this.closestSnakeID=""}setFood(t,i,e,s){this.closestFoodDistance=t,this.closestFood.x=i,this.closestFood.y=e,this.foodID=s,this.status="seefood"}setSnake(t,i,e,s){this.closestSnakeDistance=t,this.closestSnake.x=i,this.closestSnake.y=e,this.closestSnakeID=s}updateSize(t=0){this.width+=t,this.height+=t,this.length+=100*t,this.movementQueueLen=Math.ceil(this.length/(this.oldSpeed*this.dt))}directionTo(t){const i=Math.abs(this.toAngle%(2*Math.PI));let e=Math.floor(this.toAngle/(2*Math.PI));this.toAngle=t,i>=3*Math.PI/2&&this.toAngle<=Math.PI/2?e+=1:i<=Math.PI/2&&this.toAngle>=3*Math.PI/2&&(e-=1),this.toAngle+=e*Math.PI*2}moveTo(t,i,e=!1){if(e&&(this.collidedV||this.collidedH))return;const s=t-this.x,h=this.y-i,a=I(s,h);this.directionTo(a)}velocity(){const t=this.angle%(2*Math.PI),i=Math.abs(this.speed*Math.sin(t)),e=Math.abs(this.speed*Math.cos(t));t<Math.PI/2?(this.vx=i,this.vy=-e):t<Math.PI?(this.vx=i,this.vy=e):t<3*Math.PI/2?(this.vx=-i,this.vy=e):(this.vx=-i,this.vy=-e)}turnAround(t){const i=this.toAngle-this.angle;if(Math.abs(i)<=this.turnSpeed*this.gameMap.scale){const{toAngle:t}=this;this.toAngle=a+t%(2*Math.PI),this.angle=a+t%(2*Math.PI)}else this.angle+=Math.sign(i)*this.turnSpeed*this.gameMap.scale}speedUp(){this.isSpeedUp||(this.isSpeedUp=!0,this.oldSpeed=this.speed,this.speed*=2)}speedDown(){this.isSpeedUp&&(this.isSpeedUp=!1,this.speed=this.oldSpeed)}eat(t,i){this.point+=i.point;const e=i.point/15;this.updateSize(e)}action(){if(this.colliderIdx=0,this.stopped)return;this.movementQueue.push(new A(this.x,this.y,this.speed,this.dt,this.angle)),this.movementQueue.length>this.movementQueueLen&&this.movementQueue.shift(),this.turnAround(),this.velocity(),this.x+=this.vx*this.dt,this.y+=this.vy*this.dt,this.calcHead();let t=this.length;if(this.movementQueue.length){let i=this.movementQueue.length-1;for(;i;){const e=this.movementQueue[i];let{x:s,y:h,angle:a,dt:n,speed:o}=e;if(t>0&&t<o*n){const e=this.movementQueue[i+1]||this,a=t/(o*n);s=e.x-(e.x-s)*a,h=e.y-(e.y-h)*a}else if(t<0)break;i-=1,t-=o*n;const l=T(s,h,s+.5*this.width,h,a),r=T(s,h,s-.5*this.width,h,a);this.addCollider(s,h,r.x,r.y,l.x,l.y)}}this.x>2*this.width&&this.x<this.gameMap.width-2*this.width&&(this.collidedH=!1),this.y>2*this.height&&this.y<this.gameMap.height-2*this.height&&(this.collidedV=!1),this.gameMap.bounds.forEach((t,i)=>{if(S(this.head,t)){const t=k(this.angle%(2*Math.PI),this.speed);switch(i){case"UP":this.collideV||(this.moveTo(this.x+t.vx,this.y-t.vy),this.collidedV=!0);break;case"LEFT":case"RIGHT":this.collideH||(this.moveTo(this.x-t.vx,this.y+t.vy),this.collidedH=!0);break;default:this.collideV||(this.moveTo(this.x+t.vx,this.y-t.vy),this.collidedV=!0)}}})}render(){this.prepare();const t=c/this.gameMap.scale;this.gameMap.ctx.save(),this.gameMap.ctx.beginPath(),this.gameMap.ctx.moveTo(this.paintX,this.paintY);for(let t=2;t<this.colliderIdx;t+=1)this.gameMap.ctx.lineTo(this.gameMap.view.relativeX(this.colliders[t].cX),this.gameMap.view.relativeY(this.colliders[t].cY));this.gameMap.ctx.lineCap="butt",this.gameMap.ctx.lineJoin="round",[,this.gameMap.ctx.strokeStyle]=this.color,this.gameMap.ctx.lineWidth=this.paintWidth,this.gameMap.ctx.shadowOffsetY=Math.round(4)/this.gameMap.scale,this.gameMap.ctx.shadowBlur=Math.round(7)/this.gameMap.scale,this.gameMap.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.gameMap.ctx.stroke(),this.gameMap.ctx.restore();let i=T(this.paintX,this.paintY,this.paintX-.5*this.paintWidth,this.paintY-this.paintHeight,this.angle),e=T(this.paintX,this.paintY,this.paintX+.5*this.paintWidth,this.paintY-this.paintHeight,this.angle),s=T(this.paintX,this.paintY,this.paintX+.5*this.paintWidth,this.paintY,this.angle),h=T(this.paintX,this.paintY,this.paintX-.5*this.paintWidth,this.paintY,this.angle);this.gameMap.ctx.save(),this.gameMap.ctx.beginPath(),this.gameMap.ctx.moveTo(i.x,i.y),this.gameMap.ctx.lineTo(e.x,e.y),this.gameMap.ctx.lineTo(s.x,s.y),this.gameMap.ctx.lineTo(h.x,h.y),this.gameMap.ctx.closePath(),[this.gameMap.ctx.fillStyle]=this.color,this.gameMap.ctx.shadowOffsetY=Math.round(4)/this.gameMap.scale,this.gameMap.ctx.shadowBlur=Math.round(7)/this.gameMap.scale,this.gameMap.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.gameMap.ctx.fill(),this.gameMap.ctx.restore(),this.gameMap.ctx.save(),this.gameMap.ctx.beginPath(),this.gameMap.ctx.moveTo(i.x,i.y+t),this.gameMap.ctx.lineTo(e.x,e.y+t),this.gameMap.ctx.lineTo(s.x,s.y+t),this.gameMap.ctx.lineTo(h.x,h.y+t),this.gameMap.ctx.closePath(),[this.gameMap.ctx.fillStyle]=this.color,this.gameMap.ctx.fill(),this.gameMap.ctx.restore(),i=T(this.paintX,this.paintY,this.paintX-.3*this.paintWidth,this.paintY-.8*this.paintHeight,this.angle),e=T(this.paintX,this.paintY,this.paintX+.3*this.paintWidth,this.paintY-.8*this.paintHeight,this.angle),s=T(this.paintX,this.paintY,this.paintX+.3*this.paintWidth,this.paintY-.2*this.paintHeight,this.angle),h=T(this.paintX,this.paintY,this.paintX-.3*this.paintWidth,this.paintY-.2*this.paintHeight,this.angle),this.gameMap.ctx.save(),this.gameMap.ctx.beginPath(),this.gameMap.ctx.moveTo(i.x,i.y+t),this.gameMap.ctx.lineTo(e.x,e.y+t),this.gameMap.ctx.lineTo(s.x,s.y+t),this.gameMap.ctx.lineTo(h.x,h.y+t),this.gameMap.ctx.closePath(),[,this.gameMap.ctx.fillStyle]=this.color,this.gameMap.ctx.fill(),this.gameMap.ctx.restore()}update(t){this.dt=t,this.action()}calcHead(){const t=T(this.x,this.y,this.x-.5*this.width,this.y-this.height,this.angle),i=T(this.x,this.y,this.x+.5*this.width,this.y-this.height,this.angle),e=T(this.x,this.y,this.x+.5*this.width,this.y,this.angle),s=T(this.x,this.y,this.x-.5*this.width,this.y,this.angle);this.head[0]=t.x,this.head[1]=t.y,this.head[2]=i.x,this.head[3]=i.y,this.head[4]=e.x,this.head[5]=e.y,this.head[6]=s.x,this.head[7]=s.y,this.addCollider(.5*(t.x+i.x),.5*(t.y+i.y),t.x,t.y,i.x,i.y),this.addCollider(this.x,this.y,s.x,s.y,e.x,e.y)}addCollider(t,i,e,s,h,a){this.colliderIdx===this.colliders.length?this.colliders.push(new H(t,i,e,s,h,a)):this.colliders[this.colliderIdx].set(t,i,e,s,h,a),this.colliderIdx+=1}}const E=(t,i,e=1)=>{const s=document.createElement("canvas");s.width=t*e,s.height=i*e;const h=s.getContext("2d"),a=["#eee","#aaa"],l=n/e,r=o/e;for(let s=0,n=0;s<=t;s+=l,n+=1)for(let o=0,c=0;o<=i;o+=r,c+=1){const d=t*e-s,p=i*e-o,g=d<l?d:l,u=p<r?p:r;h.fillStyle=a[(n+c)%a.length],h.fillRect(s,o,g,u)}return h.lineWidth=3,h.strokeRect(0,0,t*e,i*e),s};class W{constructor(t,i,e){this.gameMap=t,this.margin=i,this.radius=e,this.image=document.createElement("canvas"),this.initImage()}initImage(){this.image.width=2*this.radius,this.image.height=2*this.radius,this.x=this.gameMap.view.width-2*this.radius-this.margin,this.y=this.gameMap.view.height-2*this.radius-this.margin,this.mapX=this.x+this.radius/2,this.mapY=this.y+this.radius/2;const t=this.image.getContext("2d");this.smallMapWidth=this.gameMap.width>this.gameMap.height?this.radius:this.gameMap.width*this.radius/this.gameMap.height,this.smallMapHeight=this.gameMap.width>this.gameMap.height?this.gameMap.height*this.radius/this.gameMap.width:this.radius;const i=this.radius-this.smallMapWidth/2,e=this.radius-this.smallMapHeight/2;t.save(),t.beginPath(),t.arc(this.radius,this.radius,this.radius-1,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.lineWidth=2,t.strokeStyle="#fff",t.stroke(),t.fillStyle="#ccc",t.fillRect(i,e,this.smallMapWidth,this.smallMapHeight),t.restore()}resize(){this.x=this.gameMap.view.width-2*this.radius-this.margin,this.y=this.gameMap.view.height-2*this.radius-this.margin,this.mapX=this.x+this.radius/2,this.mapY=this.y+this.radius/2}render(){const t=this.smallMapWidth/this.gameMap.paintWidth,i=this.smallMapWidth/this.gameMap.width,{ctx:e}=this.gameMap,s=this.gameMap.view.x*t+this.mapX,h=this.gameMap.view.y*t+this.mapY,a=this.gameMap.view.width*t,n=this.gameMap.view.height*t;e.save(),e.globalAlpha=.8,e.drawImage(this.image,this.x,this.y),e.strokeStyle="#fff",e.strokeRect(s,h,a,n),this.gameMap.units.forEach(t=>{const s=t.x*i+this.mapX,h=t.y*i+this.mapY;e.fillStyle="#f00",e.fillRect(s-2,h-2,4,4)}),e.restore()}}class z{constructor(t,i,e,s=0,h=0){this.width=i,this.height=e,this.x=s,this.y=h,this.gameMap=t}trace(t,i){this.x=t/this.gameMap.scale-this.width/2,this.y=i/this.gameMap.scale-this.height/2}absoluteX(t){return(t+this.x)*this.gameMap.scale}absoluteY(t){return(t+this.y)*this.gameMap.scale}relativeX(t){return t/this.gameMap.scale-this.x}relativeY(t){return t/this.gameMap.scale-this.y}relativeW(t){return t/this.gameMap.scale}relativeH(t){return t/this.gameMap.scale}}const C=new i;C.showPanel(0),document.body.appendChild(C.dom);const R=window.requestAnimationFrame||window.webkitRequestAnimationFrame,L=()=>window.performance&&window.performance.now?window.performance.now():(new Date).getTime(),O=new class extends u{constructor(t=document.createElement("canvas"),i=e,h=s,a=1){super(),this.canvas=t,this.width=e,this.height=s,this.bounds=new Map([["UP",[-50,0,e+50,0,e+50,-50,-50,-50]],["LEFT",[0,0,0,s,-50,s,-50,0]],["RIGHT",[e,0,e+50,0,e+50,s,e,s]],["DOWN",[-50,s,-50,s+50,e+50,s+50,e+50,s]]]),this.aviableColors=[],g.forEach(t=>this.aviableColors.push(t)),this.vWidth=i,this.vHeight=h,this.scale=a,this.scaled=!1,this.canvas.width=i,this.canvas.height=h,this.ctx=this.canvas.getContext("2d"),this.paintSizeReset(),this.tileImage=E(8*n,8*o),this.view=new z(this,i,h),this.smallMap=new W(this,30,50),this.units=[],this.foods=[],this.foodEatedPool=[]}resize(t,i){this.vWidth=t,this.vHeight=i,this.canvas.width=t,this.canvas.height=i,this.view.width=t,this.view.height=i,this.smallMap.resize()}initUnits(t,i){this.player=new D(this,{x:P(50,e-50),y:P(50,s-50),size:l,length:r,angle:2*Math.random()*Math.PI,id:i,color:this.aviableColors.splice(P(0,this.aviableColors.length-1),1)[0],isPlayer:!0}),this.units.push(this.player);for(let i=t-1;i;i-=1)this.units.push(new D(this,{x:P(50,e-50),y:P(50,s-50),size:l,length:r,angle:2*Math.random()*Math.PI,color:this.aviableColors.splice(P(0,this.aviableColors.length-1),1)[0],id:`unit${i}`}))}initFoods(t){this.foodsOnFields=t;for(let i=0;i<t;i+=1)this.foods.push(new F(this,{size:p,point:1,x:P(p,e-p),y:P(p,s-p),id:i,onField:!0}))}setScale(t){this.scale!==t&&(this.scale=t<1?1:t,this.paintSizeReset(),this.emit("scale_changed"))}setToScale(t){this.toScale=t}relative(t){return t/this.scale}clear(){this.ctx.clearRect(0,0,this.view.width,this.view.height)}update(t){this.scaled&&this.scale<2?this.setToScale(this.scale+.1):this.scale>1&&!this.scaled&&this.setToScale(this.scale-.1),this.toScale&&this.scale!==this.toScale&&this.setScale(this.toScale),this.updateFood(),this.updateUnits(t),this.view.trace(this.player.x,this.player.y),this.clear(),this.render(),this.renderFood(),this.renderUnits(),this.addFood(),this.units.forEach(t=>{const i=window.devicePixelRatio,e=Math.floor(.8*t.width/(i*this.scale));this.ctx.save(),this.ctx.translate(t.paintX,t.paintY),this.ctx.font="bold ".concat(e,"px Quicksand"),this.ctx.textAlign="center",this.ctx.textBaseline="bottom",[this.ctx.fillStyle]=t.color,this.ctx.fillText(t.id,0,-Math.floor((t.width+10)/(i*this.scale))),this.ctx.restore()}),this.smallMap.render(),this.ctx.save(),this.ctx.translate(100,100),this.ctx.beginPath(),this.ctx.lineTo(10,-12),this.ctx.lineTo(14,-6),this.ctx.lineTo(12,4),this.ctx.lineTo(8,6),this.ctx.lineTo(6,12),this.ctx.lineTo(0,14),this.ctx.lineTo(-6,12),this.ctx.lineTo(-8,6),this.ctx.lineTo(-12,4),this.ctx.lineTo(-14,-6),this.ctx.lineTo(-10,-12),this.ctx.closePath(),this.ctx.arc(-6,-2,4,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.arc(6,-2,4,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.moveTo(0,2),this.ctx.lineTo(-4,6),this.ctx.lineTo(0,8),this.ctx.lineTo(4,6),this.ctx.closePath(),this.ctx.fillStyle="red",this.ctx.fill(),this.ctx.restore(),this.checkCollisions()}render(){const{view:t}=this,i=this.relative(this.tileImage.width),e=this.relative(this.tileImage.height),s=t.x<0?-t.x:-t.x%i,h=t.y<0?-t.y:-t.y%e,a=t.x+t.width>this.paintWidth?this.paintWidth-t.x:s+t.width+i,n=t.y+t.height>this.paintHeight?this.paintHeight-t.y:h+t.height+e;for(let t=s;t<=a;t+=i)for(let s=h;s<=n;s+=e){const h=a-t,o=n-s,l=h<i?h:i,r=o<e?o:e;this.ctx.drawImage(this.tileImage,0,0,l*this.scale,r*this.scale,t,s,l,r)}}paintSizeReset(){this.paintWidth=this.relative(this.width),this.paintHeight=this.relative(this.height)}checkCollisions(){this.units.forEach(t=>{t.zeroSnake(),this.units.forEach(i=>{if(t.id!==i.id)for(let e=1;e<i.colliderIdx;e+=1){if(S(t.head,[i.colliders[e].lX,i.colliders[e].lY,i.colliders[e].rX,i.colliders[e].rY,i.colliders[e-1].rX,i.colliders[e-1].rY,i.colliders[e-1].lX,i.colliders[e-1].lY])){console.log("BAAM!!!");break}if(t.id!==this.player.id){const s=Math.round(i.colliders[e].cX-t.x),h=Math.round(i.colliders[e].cY-t.y),a=Math.abs(s)+Math.abs(h),n=Y(t.x,t.y,i.colliders[e].cX,i.colliders[e].cY),o=X(t.vx,t.vy);n<=o+t.visionAngle/2&&n>=o-t.visionAngle/2&&a<t.closestSnakeDistance&&t.setSnake(a,i.colliders[e].cX,i.colliders[e].cY,i.id)}}})})}updateUnits(t){this.units.forEach(i=>{if(i.id!==this.player.id){if(i.closestSnakeDistance<3*i.width){i.zeroFood();const t=I(i.x-i.closestSnake.x,i.closestSnake.y-i.y);i.directionTo(t)}"eating"!==i.status&&"seefood"!==i.status||this.foods[i.foodID].onField||i.zeroFood(),"seefood"===i.status&&(i.setStatus("eating"),i.moveTo(i.closestFood.x,i.closestFood.y))}i.update(t)})}updateFood(){for(let t=this.foods.length-1;t>0;t-=1){const i=this.foods[t];this.foods[t].onField&&(i.update(),this.units.forEach(e=>{if(b(e.head,i.x,i.y,.5*i.width))e.eat(i.id,i),i.onField=!1,this.foodsOnFields-=1,this.foodEatedPool.push(t),e.zeroFood();else if("idle"===e.status||"seefood"===e.status){const s=Math.round(i.x-e.x),h=Math.round(i.y-e.y),a=Math.abs(s)+Math.abs(h),n=Y(e.x,e.y,i.x,i.y),o=X(e.vx,e.vy);n<=o+e.visionAngle/2&&n>=o-e.visionAngle/2&&a<e.closestFoodDistance&&e.setFood(a,i.x,i.y,t)}}))}}addFood(){if(this.foodsOnFields<500){const t=this.foodEatedPool.pop();t&&(this.foodsOnFields+=1,this.foods[t].onField=!0,this.foods[t].x=P(p,e-p),this.foods[t].y=P(p,s-p))}}renderFood(){for(let t=0;t<this.foods.length;t+=1)this.foods[t].onField&&this.foods[t].render()}renderUnits(){for(let t=0;t<this.units.length;t+=1)this.units[t].render()}}(document.getElementById("cas"),window.innerWidth,window.innerHeight),U={};let Q,V,B=0,j=L();function q(){C.begin(),Q=L(),B=Math.min(1,(Q-j)/1e3),O.update(B),C.end(),j=Q,R(q)}O.initUnits(6,"player"),[V]=O.units.filter(t=>"player"===t.id),O.initFoods(d),function(){function t(t){if(t.preventDefault(),t.touches)U.x=t.touches[0].pageX,U.y=t.touches[0].pageY;else{const i=t||window.event;U.x=i.clientX,U.y=i.clientY}const i=(U.x+O.view.x)*O.scale,e=(U.y+O.view.y)*O.scale;V.moveTo(i,e,!0)}window.addEventListener("resize",()=>{const t=window.innerWidth,i=window.innerHeight;O.resize(t,i)}),navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)?(window.addEventListener("touchstart",t),window.addEventListener("touchmove",t)):(window.addEventListener("mousemove",t),window.addEventListener("mousedown",()=>{V.speedUp(),O.scaled=!0}),window.addEventListener("mouseup",()=>{V.speedDown(),O.scaled=!1}))}(),q()}();
//# sourceMappingURL=bundle.js.map
