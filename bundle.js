!function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}var i=e(function(t,e){var i;t.exports=((i=function(){var t=0,e=document.createElement("div");function n(t){return e.appendChild(t.dom),t}function r(i){for(var n=0;n<e.children.length;n++)e.children[n].style.display=n===i?"block":"none";t=i}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(i){i.preventDefault(),r(++t%e.children.length)},!1);var s=(performance||Date).now(),o=s,a=0,h=n(new i.Panel("FPS","#0ff","#002")),l=n(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=n(new i.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:n,showPanel:r,begin:function(){s=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-s,200),o+1e3<=t&&(h.update(1e3*a/(t-o),100),o=t,a=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){s=this.end()},domElement:e,setMode:r}}).Panel=function(t,e,i){var n=1/0,r=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,h=48*o,l=3*o,c=2*o,u=3*o,f=15*o,d=74*o,p=30*o,y=document.createElement("canvas");y.width=a,y.height=h,y.style.cssText="width:80px;height:48px";var v=y.getContext("2d");return v.font="bold "+9*o+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=i,v.fillRect(0,0,a,h),v.fillStyle=e,v.fillText(t,l,c),v.fillRect(u,f,d,p),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(u,f,d,p),{dom:y,update:function(h,g){n=Math.min(n,h),r=Math.max(r,h),v.fillStyle=i,v.globalAlpha=1,v.fillRect(0,0,a,f),v.fillStyle=e,v.fillText(s(h)+" "+t+" ("+s(n)+"-"+s(r)+")",l,c),v.drawImage(y,u+o,f,d-o,p,u,f,d-o,p),v.fillRect(u+d-o,f,o,p),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(u+d-o,f,o,s((1-h/g)*p))}}},i)}),n=e(function(t){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}});function r(){}function s(){s.init.call(this)}function o(t){return void 0===t._maxListeners?s.defaultMaxListeners:t._maxListeners}function a(t,e,i,n){var s,a,h,l;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),h=a[e]):(a=t._events=new r,t._eventsCount=0),h){if("function"==typeof h?h=a[e]=n?[i,h]:[h,i]:n?h.unshift(i):h.push(i),!h.warned&&(s=o(t))&&s>0&&h.length>s){h.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=h.length,l=c,"function"==typeof console.warn?console.warn(l):console.log(l)}}else h=a[e]=i,++t._eventsCount;return t}function h(t,e,i){var n=!1;function r(){t.removeListener(e,r),n||(n=!0,i.apply(t,arguments))}return r.listener=i,r}function l(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function c(t,e){for(var i=new Array(e);e--;)i[e]=t[e];return i}r.prototype=Object.create(null),s.EventEmitter=s,s.usingDomains=!1,s.prototype.domain=void 0,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.init=function(){this.domain=null,s.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new r,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},s.prototype.getMaxListeners=function(){return o(this)},s.prototype.emit=function(t){var e,i,n,r,s,o,a,h="error"===t;if(o=this._events)h=h&&null==o.error;else if(!h)return!1;if(a=this.domain,h){if(e=arguments[1],!a){if(e instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=a,e.domainThrown=!1,a.emit("error",e),!1}if(!(i=o[t]))return!1;var u="function"==typeof i;switch(n=arguments.length){case 1:!function(t,e,i){if(e)t.call(i);else for(var n=t.length,r=c(t,n),s=0;s<n;++s)r[s].call(i)}(i,u,this);break;case 2:!function(t,e,i,n){if(e)t.call(i,n);else for(var r=t.length,s=c(t,r),o=0;o<r;++o)s[o].call(i,n)}(i,u,this,arguments[1]);break;case 3:!function(t,e,i,n,r){if(e)t.call(i,n,r);else for(var s=t.length,o=c(t,s),a=0;a<s;++a)o[a].call(i,n,r)}(i,u,this,arguments[1],arguments[2]);break;case 4:!function(t,e,i,n,r,s){if(e)t.call(i,n,r,s);else for(var o=t.length,a=c(t,o),h=0;h<o;++h)a[h].call(i,n,r,s)}(i,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(n-1),s=1;s<n;s++)r[s-1]=arguments[s];!function(t,e,i,n){if(e)t.apply(i,n);else for(var r=t.length,s=c(t,r),o=0;o<r;++o)s[o].apply(i,n)}(i,u,this,r)}return!0},s.prototype.addListener=function(t,e){return a(this,t,e,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(t,e){return a(this,t,e,!0)},s.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,h(this,t,e)),this},s.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,h(this,t,e)),this},s.prototype.removeListener=function(t,e){var i,n,s,o,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(i=n[t]))return this;if(i===e||i.listener&&i.listener===e)0==--this._eventsCount?this._events=new r:(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(s=-1,o=i.length;o-- >0;)if(i[o]===e||i[o].listener&&i[o].listener===e){a=i[o].listener,s=o;break}if(s<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new r,this;delete n[t]}else!function(t,e){for(var i=e,n=i+1,r=t.length;n<r;i+=1,n+=1)t[i]=t[n];t.pop()}(i,s);n.removeListener&&this.emit("removeListener",t,a||e)}return this},s.prototype.removeAllListeners=function(t){var e,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new r,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new r:delete i[t]),this;if(0===arguments.length){for(var n,s=Object.keys(i),o=0;o<s.length;++o)"removeListener"!==(n=s[o])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new r,this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},s.prototype.listeners=function(t){var e,i=this._events;return i&&(e=i[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(e):[]},s.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):l.call(t,e)},s.prototype.listenerCount=l,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var u=t.performance&&t.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date},f="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function d(){throw new Error("setTimeout has not been defined")}function p(){throw new Error("clearTimeout has not been defined")}var y=d,v=p;function g(t){if(y===setTimeout)return setTimeout(t,0);if((y===d||!y)&&setTimeout)return y=setTimeout,setTimeout(t,0);try{return y(t,0)}catch(e){try{return y.call(null,t,0)}catch(e){return y.call(this,t,0)}}}"function"==typeof f.setTimeout&&(y=setTimeout),"function"==typeof f.clearTimeout&&(v=clearTimeout);var m,x=[],w=!1,b=-1;function M(){w&&m&&(w=!1,m.length?x=m.concat(x):b=-1,x.length&&Y())}function Y(){if(!w){var t=g(M);w=!0;for(var e=x.length;e;){for(m=x,x=[];++b<e;)m&&m[b].run();b=-1,e=x.length}m=null,w=!1,function(t){if(v===clearTimeout)return clearTimeout(t);if((v===p||!v)&&clearTimeout)return v=clearTimeout,clearTimeout(t);try{v(t)}catch(e){try{return v.call(null,t)}catch(e){return v.call(this,t)}}}(t)}}function _(t,e){this.fun=t,this.array=e}_.prototype.run=function(){this.fun.apply(null,this.array)};function X(){}var S=X,A=X,P=X,B=X,E=X,L=X,k=X;var R=f.performance||{},C=R.now||R.mozNow||R.msNow||R.oNow||R.webkitNow||function(){return(new Date).getTime()};var T=new Date;for(var I={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];x.push(new _(t,e)),1!==x.length||w||g(Y)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:S,addListener:A,once:P,off:B,removeListener:E,removeAllListeners:L,emit:k,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*C.call(R),i=Math.floor(e),n=Math.floor(e%1*1e9);return t&&(i-=t[0],(n-=t[1])<0&&(i--,n+=1e9)),[i,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-T)/1e3}},O=e(function(e){(function(){var t,i,n,r,s,o;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:null!=I&&I.hrtime?(e.exports=function(){return(t()-s)/1e6},i=I.hrtime,r=(t=function(){var t;return 1e9*(t=i())[0]+t[1]})(),o=1e9*I.uptime(),s=r-o):Date.now?(e.exports=function(){return Date.now()-n},n=Date.now()):(e.exports=function(){return(new Date).getTime()-n},n=(new Date).getTime())}).call(t)}),D="undefined"==typeof window?t:window,j=["moz","webkit"],F="AnimationFrame",z=D["request"+F],W=D["cancel"+F]||D["cancelRequest"+F],H=0;!z&&H<j.length;H++)z=D[j[H]+"Request"+F],W=D[j[H]+"Cancel"+F]||D[j[H]+"CancelRequest"+F];if(!z||!W){var N=0,U=0,Q=[];z=function(t){if(0===Q.length){var e=O(),i=Math.max(0,1e3/60-(e-N));N=i+e,setTimeout(function(){var t=Q.slice(0);Q.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(N)}catch(t){setTimeout(function(){throw t},0)}},Math.round(i))}return Q.push({handle:++U,callback:t,cancelled:!1}),U},W=function(t){for(var e=0;e<Q.length;e++)Q[e].handle===t&&(Q[e].cancelled=!0)}}var q=function(t){return z.call(D,t)};q.cancel=function(){W.apply(D,arguments)},q.polyfill=function(t){t||(t=D),t.requestAnimationFrame=z,t.cancelAnimationFrame=W};var $=V;function V(t){if(!(this instanceof V))return new V(t);this.running=!1,this.last=u(),this._frame=0,this._tick=this.tick.bind(this),t&&this.on("tick",t)}n(V,s.EventEmitter),V.prototype.start=function(){if(!this.running)return this.running=!0,this.last=u(),this._frame=q(this._tick),this},V.prototype.stop=function(){return this.running=!1,0!==this._frame&&q.cancel(this._frame),this._frame=0,this},V.prototype.tick=function(){this._frame=q(this._tick);var t=u(),e=t-this.last;this.emit("tick",e),this.last=t};var J=Object.prototype.hasOwnProperty,K=Array.isArray,G=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),Z=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)void 0!==t[n]&&(i[n]=t[n]);return i},tt={arrayToObject:Z,assign:function(t,e){return Object.keys(e).reduce(function(t,i){return t[i]=e[i],t},t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],n=0;n<e.length;++n)for(var r=e[n],s=r.obj[r.prop],o=Object.keys(s),a=0;a<o.length;++a){var h=o[a],l=s[h];"object"==typeof l&&null!==l&&-1===i.indexOf(l)&&(e.push({obj:s,prop:h}),i.push(l))}return function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(K(i)){for(var n=[],r=0;r<i.length;++r)void 0!==i[r]&&n.push(i[r]);e.obj[e.prop]=n}}}(e),t},decode:function(t,e,i){var n=t.replace(/\+/g," ");if("iso-8859-1"===i)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(t){return n}},encode:function(t,e,i){if(0===t.length)return t;var n="string"==typeof t?t:String(t);if("iso-8859-1"===i)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});for(var r="",s=0;s<n.length;++s){var o=n.charCodeAt(s);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?r+=n.charAt(s):o<128?r+=G[o]:o<2048?r+=G[192|o>>6]+G[128|63&o]:o<55296||o>=57344?r+=G[224|o>>12]+G[128|o>>6&63]+G[128|63&o]:(s+=1,o=65536+((1023&o)<<10|1023&n.charCodeAt(s)),r+=G[240|o>>18]+G[128|o>>12&63]+G[128|o>>6&63]+G[128|63&o])}return r},isBuffer:function(t){return!(!t||"object"!=typeof t||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},merge:function t(e,i,n){if(!i)return e;if("object"!=typeof i){if(K(e))e.push(i);else{if(!e||"object"!=typeof e)return[e,i];(n&&(n.plainObjects||n.allowPrototypes)||!J.call(Object.prototype,i))&&(e[i]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(i);var r=e;return K(e)&&!K(i)&&(r=Z(e,n)),K(e)&&K(i)?(i.forEach(function(i,r){if(J.call(e,r)){var s=e[r];s&&"object"==typeof s&&i&&"object"==typeof i?e[r]=t(s,i,n):e.push(i)}else e[r]=i}),e):Object.keys(i).reduce(function(e,r){var s=i[r];return J.call(e,r)?e[r]=t(e[r],s,n):e[r]=s,e},r)}},et=String.prototype.replace,it=/%20/g,nt={default:"RFC3986",formatters:{RFC1738:function(t){return et.call(t,it,"+")},RFC3986:function(t){return t}},RFC1738:"RFC1738",RFC3986:"RFC3986"},rt=(Object.prototype.hasOwnProperty,Array.isArray,Array.prototype.push,Date.prototype.toISOString),st=(nt.formatters[nt.default],Object.prototype.hasOwnProperty),ot={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:tt.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},at=function(t){return t.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},ht=function(t,e,i){if(t){var n=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,r=/(\[[^[\]]*])/g,s=/(\[[^[\]]*])/.exec(n),o=s?n.slice(0,s.index):n,a=[];if(o){if(!i.plainObjects&&st.call(Object.prototype,o)&&!i.allowPrototypes)return;a.push(o)}for(var h=0;null!==(s=r.exec(n))&&h<i.depth;){if(h+=1,!i.plainObjects&&st.call(Object.prototype,s[1].slice(1,-1))&&!i.allowPrototypes)return;a.push(s[1])}return s&&a.push("["+n.slice(s.index)+"]"),function(t,e,i){for(var n=e,r=t.length-1;r>=0;--r){var s,o=t[r];if("[]"===o&&i.parseArrays)s=[].concat(n);else{s=i.plainObjects?Object.create(null):{};var a="["===o.charAt(0)&&"]"===o.charAt(o.length-1)?o.slice(1,-1):o,h=parseInt(a,10);i.parseArrays||""!==a?!isNaN(h)&&o!==a&&String(h)===a&&h>=0&&i.parseArrays&&h<=i.arrayLimit?(s=[])[h]=n:s[a]=n:s={0:n}}n=s}return n}(a,e,i)}},lt=function(t,e){var i=function(t){if(!t)return ot;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?ot.charset:t.charset;return{allowDots:void 0===t.allowDots?ot.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:ot.allowPrototypes,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:ot.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:ot.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:ot.comma,decoder:"function"==typeof t.decoder?t.decoder:ot.decoder,delimiter:"string"==typeof t.delimiter||tt.isRegExp(t.delimiter)?t.delimiter:ot.delimiter,depth:"number"==typeof t.depth?t.depth:ot.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:ot.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:ot.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:ot.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:ot.strictNullHandling}}(e);if(""===t||null==t)return i.plainObjects?Object.create(null):{};for(var n="string"==typeof t?function(t,e){var i,n={},r=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,s=e.parameterLimit===1/0?void 0:e.parameterLimit,o=r.split(e.delimiter,s),a=-1,h=e.charset;if(e.charsetSentinel)for(i=0;i<o.length;++i)0===o[i].indexOf("utf8=")&&("utf8=%E2%9C%93"===o[i]?h="utf-8":"utf8=%26%2310003%3B"===o[i]&&(h="iso-8859-1"),a=i,i=o.length);for(i=0;i<o.length;++i)if(i!==a){var l,c,u=o[i],f=u.indexOf("]="),d=-1===f?u.indexOf("="):f+1;-1===d?(l=e.decoder(u,ot.decoder,h),c=e.strictNullHandling?null:""):(l=e.decoder(u.slice(0,d),ot.decoder,h),c=e.decoder(u.slice(d+1),ot.decoder,h)),c&&e.interpretNumericEntities&&"iso-8859-1"===h&&(c=at(c)),c&&e.comma&&c.indexOf(",")>-1&&(c=c.split(",")),st.call(n,l)?n[l]=tt.combine(n[l],c):n[l]=c}return n}(t,i):t,r=i.plainObjects?Object.create(null):{},s=Object.keys(n),o=0;o<s.length;++o){var a=s[o],h=ht(a,n[a],i);r=tt.merge(r,h,i)}return tt.compact(r)};const ct=1e4,ut=.4,ft=.01,dt=.005,pt=.5,yt=40,vt=0,gt=20,mt=-6,xt=0,wt=4,bt=7,Mt=.3,Yt=300,_t=1e3,Xt=150,St=!1;var At=e(function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function s(t,e,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new r(n,s||t,o),h=i?i+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,n,r=[];if(0===this._eventsCount)return r;for(n in t=this._events)e.call(t,n)&&r.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},a.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,s=n.length,o=new Array(s);r<s;r++)o[r]=n[r].fn;return o},a.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,r,s,o){var a=i?i+t:t;if(!this._events[a])return!1;var h,l,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,r),!0;case 5:return c.fn.call(c.context,e,n,r,s),!0;case 6:return c.fn.call(c.context,e,n,r,s,o),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var f,d=c.length;for(l=0;l<d;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,n);break;case 4:c[l].fn.call(c[l].context,e,n,r);break;default:if(!h)for(f=1,h=new Array(u-1);f<u;f++)h[f-1]=arguments[f];c[l].fn.apply(c[l].context,h)}}return!0},a.prototype.on=function(t,e,i){return s(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return s(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,n,r){var s=i?i+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||r&&!a.once||n&&a.context!==n||o(this,s);else{for(var h=0,l=[],c=a.length;h<c;h++)(a[h].fn!==e||r&&!a[h].once||n&&a[h].context!==n)&&l.push(a[h]);l.length?this._events[s]=1===l.length?l[0]:l:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&o(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a});const Pt=function(t,e,i){return e===i?0:e<i?-t:null==e?1:null==i?-1:t},Bt=function(t,e,i,n,r,s){return Rt(t(r),t(s),e,i,n,r,s)},Et=function(t,e,i,n,r,s){return Rt(r[t],s[t],e,i,n,r,s)},Lt=function(t,e,i,n,r,s){const o=t.asc||t.desc,a=t.asc?1:-1;if(!o)throw Error("sort: Invalid 'by' sorting configuration.\n      Expecting object with 'asc' or 'desc' key");return kt(o)(o,e,i,a,r,s)},kt=function(t){const e=typeof t;return"string"===e?Et:"function"===e?Bt:Lt},Rt=function(t,e,i,n,r,s,o){if(t===e||null==t&&null==e){if(i.length>n){return kt(i[n])(i[n],i,n+1,r,s,o)}return 0}return Pt(r,t,e)},Ct=function(t,e,i){if(!Array.isArray(e))return e;let n;return Array.isArray(i)&&i.length<2&&([i]=i),n=i?"string"==typeof i?function(t,e,i,n){return Pt(t,i[e],n[e])}.bind(void 0,t,i):"function"==typeof i?function(t,e,i,n){return Pt(t,e(i),e(n))}.bind(void 0,t,i):kt(i[0]).bind(void 0,i.shift(),i,0,t):Pt.bind(void 0,t),e.sort(n)};var Tt=function(t){return{asc:e=>Ct(1,t,e),desc:e=>Ct(-1,t,e),by:e=>{if(!Array.isArray(t))return t;if(!Array.isArray(e))throw Error("sort: Invalid usage of 'by' sorter. Array syntax is required.\n          Did you mean to use 'asc' or 'desc' sorter instead?");if(1===e.length){const i=e[0].asc?1:-1,n=e[0].asc||e[0].desc;if(!n)throw Error("sort: Invalid 'by' sorting configuration.\n            Expecting object with 'asc' or 'desc' key");return Ct(i,t,n)}const i=Lt.bind(void 0,e.shift(),e,0,void 0);return t.sort(i)}}},It=function(t,e,i,n,r){var s=n-t,o=r-e;return s*s+o*o<=i*i},Ot=function(t,e,i,n,r,s,o){var a=[r-t,s-e],h=[i-t,n-e],l=Dt(h,h),c=Dt(a,h)/l,u=[h[0]*(c=(c=c<0?0:c)>1?1:c)+t-r,h[1]*c+e-s];return Dt(u,u)<=o*o};function Dt(t,e){return t[0]*e[0]+t[1]*e[1]}var jt=function(t,e,i,n,r,s,o){var a=i/2,h=n/2,l=Math.abs(r-(t+i/2)),c=Math.abs(s-(e+n/2));if(l>a+o||c>h+o)return!1;if(l<=a||c<=h)return!0;var u=l-a,f=c-h;return u*u+f*f<=o*o};function Ft(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))}var zt,Wt,Ht,Nt=function(t,e,i,n,r,s,o){return o=o||1,Math.abs(Ft(t,e,i,n)-(Ft(t,e,r,s)+Ft(i,n,r,s)))<=o},Ut=function(t,e,i,n){var r,s,o=t.length,a=!1;for(r=0,s=o-2;r<o;r+=2)t[r+1]>i!=t[s+1]>i&&e<(t[s]-t[r])*(i-t[r+1])/(t[s+1]-t[r+1])+t[r]&&(a=!a),s=r;if(a)return!0;for(r=0;r<o;r+=2){var h,l,c=t[r],u=t[r+1];if(r===o-2?(h=t[0],l=t[1]):(h=t[r+2],l=t[r+3]),Nt(c,u,h,l,e,i,n))return!0}return!1},Qt=function(t,e,i,n){if(Ut(t,e,i))return!0;for(var r=t.length,s=0;s<r-2;s+=2)if(Ot(t[s],t[s+1],t[s+2],t[s+3],e,i,n))return!0;return Ot(t[0],t[1],t[r-2],t[r-1],e,i,n)},qt=10;function $t(){zt=[],Wt=[];for(var t=0;t<=qt;t++){var e=4<<t;zt[t]=.5/Math.cos(4*Math.acos(0)/e),Wt[t]=.5/(Math.cos(2*Math.acos(0)/e)*Math.cos(2*Math.acos(0)/e))}Ht=!0}function Vt(t,e,i,n,r,s,o){for(var a=1;a<=qt;a++){var h=(i+r)*zt[a],l=(n+s)*zt[a],c=t-h,u=e-l;if(c*c+u*u<=o)return!0;var f=r-h,d=s-l;if(c*f+u*d>=0&&c*f+u*d<=f*f+d*d&&(u*f-c*d>=0||o*(f*f+d*d)>=(u*f-c*d)*(u*f-c*d)))return!0;var p=i-h,y=n-l;if(c*p+u*y>=0&&c*p+u*y<=p*p+y*y&&(u*p-c*y<=0||o*(p*p+y*y)>=(u*p-c*y)*(u*p-c*y)))return!0;var v=(i+h)*Wt[a],g=(n+l)*Wt[a];if((v-t)*(v-t)+(g-e)*(g-e)<o)r=h,s=l;else{var m=h-v+h,x=l-g+l;if(!((m-t)*(m-t)+(x-e)*(x-e)<o)){var w=v-h,b=g-l;if(u*w-c*b<=0||o*(w*w+b*b)>(u*w-c*b)*(u*w-c*b))if(c*w+u*b>0){if(Math.abs(c*w+u*b)<=w*w+b*b||(t-v)*(i-v)+(e-g)*(n-g)>=0){r=h,s=l;continue}}else if(-(c*w+u*b)<=w*w+b*b||(t-m)*(r-m)+(e-x)*(s-x)>=0){i=h,n=l;continue}return!1}i=h,n=l}}return!1}var Jt={ellipseCircle:function(t,e,i,n,r,s,o){Ht||$t();var a=Math.abs(r-t),h=Math.abs(s-e);return a*a+(n-h)*(n-h)<=o*o||(i-a)*(i-a)+h*h<=o*o||a*n+h*i<=i*n||(a*n+h*i-i*n)*(a*n+h*i-i*n)<=o*o*(i*i+n*n)&&a*i-h*n>=-n*n&&a*i-h*n<=i*i||((a-i)*(a-i)+(h-n)*(h-n)<=o*o||a<=i&&h-o<=n||h<=n&&a-o<=i)&&Vt(a,h,i,0,0,n,o*o)},ellipseEllipse:function(t,e,i,n,r,s,o,a){Ht||$t();var h=Math.abs(r-t)*a,l=Math.abs(s-e)*o;i*=a;var c=o*a;return h*h+((n*=o)-l)*(n-l)<=c*c||(i-h)*(i-h)+l*l<=c*c||h*n+l*i<=i*n||(h*n+l*i-i*n)*(h*n+l*i-i*n)<=c*c*(i*i+n*n)&&h*i-l*n>=-n*n&&h*i-l*n<=i*i||((h-i)*(h-i)+(l-n)*(l-n)<=c*c||h<=i&&l-c<=n||l<=n&&h-c<=i)&&Vt(h,l,i,0,0,n,c*c)}},Kt=function(t,e,i,n,r,s,o){return Jt.ellipseCircle(t,e,i,n,r,s,o)},Gt=function(t,e,i,n,r,s,o,a){a=a||1;var h=0;return h+=It(t,e,i,n,r)?1:0,h+=It(t,e,i,n+s,r)?1:0,h+=It(t,e,i,n,r+o)?1:0,0===(h+=It(t,e,i,n+s,r+o)?1:0)?jt(n,r,s,o,t,e,i):h>=1&&h<=3||(4===h?!(It(t,e,i-a,n,r)&&It(t,e,i-a,n+s,r)&&It(t,e,i-a,n,r+o)&&It(t,e,i-a,n+s,r+o)):void 0)},Zt=function(t,e,i,n,r,s,o,a){return a=a||1,Ot(n,r,s,o,t,e,i)&&!(It(t,e,i-a,n,r)&&It(t,e,i-a,s,o))},te=function(t,e,i,n,r,s){return s=s||1,It(t,e,i,n,r)&&!It(t,e,i-s,n,r)},ee=function(t,e,i,n,r,s,o,a){var h=i-t,l=n-e,c=o-r,u=a-s,f=(-l*(t-r)+h*(e-s))/(-c*l+h*u),d=(c*(e-s)-u*(t-r))/(-c*l+h*u);return f>=0&&f<=1&&d>=0&&d<=1},ie=function(t,e,i,n,r,s){var o=r.length;if(Ut(r,t,e,s))return!0;for(var a=0;a<o;a+=2){var h=(a+2)%o;if(ee(t,e,i,n,r[a],r[a+1],r[h],r[h+1]))return!0}return!1},ne=function(t,e){for(var i,n,r,s,o,a,h=t,l=e,c=[h,l],u=0;u<c.length;u++)for(var f=c[u],d=0;d<f.length;d+=2){var p=(d+2)%f.length,y={x:f[p+1]-f[d+1],y:f[d]-f[p]};for(i=n=null,a=0;a<h.length;a+=2)r=y.x*h[a]+y.y*h[a+1],(null===i||r<i)&&(i=r),(null===n||r>n)&&(n=r);for(s=o=null,a=0;a<l.length;a+=2)r=y.x*l[a]+y.y*l[a+1],(null===s||r<s)&&(s=r),(null===o||r>o)&&(o=r);if(n<s||o<i)return!1}return!0},re=function(t,e,i,n,r){return ne(t,[e,i,e+n,i,e+n,i+r,e,i+r])},se=function(t,e,i,n,r,s,o,a){r-=t,o-=t,s-=e,a-=e;var h=Math.pow(o-r,2)/i/i+Math.pow(a-s,2)/n/n,l=2*r*(o-r)/i/i+2*s*(a-s)/n/n,c=l*l-4*h*(r*r/i/i+s*s/n/n-1);if(0===c){var u=-l/2/h;return u>=0&&u<=1}if(c>0){var f=Math.sqrt(c),d=(-l+f)/2/h,p=(-l-f)/2/h;return d>=0&&d<=1||p>=0&&p<=1}return!1},oe=function(t,e,i,n,r,s,o,a){return se(r,s,o,a,t,e,i,n)},ae=function(t,e,i,n,r){if(Ut(t,e,i))return!0;for(var s=t.length,o=0;o<s-2;o+=2)if(oe(t[o],t[o+1],t[o+2],t[o+3],e,i,n,r))return!0;return oe(t[0],t[1],t[s-2],t[s-1],e,i,n,r)},he=function(t,e,i,n,r,s){return r>=t&&r<=t+i&&s>=e&&s<=e+n},le=function(t,e,i,n,r){const s=Math.atan2(n-e,i-t)-Math.PI/2,o=r/2,a=Math.cos(s)*o,h=Math.sin(s)*o;return[t-a,e-h,i-a,n-h,i+a,n+h,t+a,e+h]},ce=function(t,e,i,n,r,s,o,a,h,l){return h||l?function(t,e,i,n,r,s,o,a,h,l){if(h&&l)return ne(le(t,e,i,n,h),le(r,s,o,a,l));if(h)return ie(r,s,o,a,le(t,e,i,n,h));if(l)return ie(t,e,i,n,le(r,s,o,a,h))}(t,e,i,n,r,s,o,a,h,l):ee(t,e,i,n,r,s,o,a)};var ue=function(t,e,i,n,r,s,o,a){return!(!he(r,s,o,a,t,e)&&!he(r,s,o,a,i,n))||(ce(t,e,i,n,r,s,r+o,s)||ce(t,e,i,n,r+o,s,r+o,s+a)||ce(t,e,i,n,r,s+a,r+o,s+a)||ce(t,e,i,n,r,s,r,s+a))},fe=function(t,e,i,n,r,s,o,a){return he(r,s,o,a,t,e)||se(t,e,i,n,r,s,r+o,s)||se(t,e,i,n,r,s+a,r+o,s+a)||se(t,e,i,n,r,s,r,s+a)||se(t,e,i,n,r+o,s,r+o,s+a)},de=function(t,e,i,n,r,s){return Math.pow(r-t,2)/(i*i)+Math.pow(s-e,2)/(n*n)<=1},pe={circlePoint:It,circleCircle:function(t,e,i,n,r,s){var o=t-n,a=r-e,h=i+s;return o*o+a*a<=h*h},circleLine:function(t,e,i,n,r,s,o){return Ot(n,r,s,o,t,e,i)},circleBox:function(t,e,i,n,r,s,o){return jt(n,r,s,o,t,e,i)},circlePolygon:function(t,e,i,n){return Qt(n,t,e,i)},circleEllipse:function(t,e,i,n,r,s,o){return Kt(n,r,s,o,t,e,i)},circleOutlineBox:Gt,circleOutlineLine:Zt,circleOutlinePoint:te,polygonPoint:Ut,polygonLine:function(t,e,i,n,r,s){return ie(e,i,n,r,t,s)},polygonPolygon:ne,polygonBox:re,polygonCircle:Qt,polygonEllipse:ae,boxPoint:he,boxBox:function(t,e,i,n,r,s,o,a){return t<r+o&&t+i>r&&e<s+a&&e+n>s},boxLine:function(t,e,i,n,r,s,o,a){return ue(r,s,o,a,t,e,i,n)},boxPolygon:function(t,e,i,n,r){return re(r,t,e,i,n)},boxCircle:jt,boxEllipse:function(t,e,i,n,r,s,o,a){return fe(r,s,o,a,t,e,i,n)},boxCircleOutline:function(t,e,i,n,r,s,o,a){return Gt(r,s,o,t,e,i,n,a)},pointBox:function(t,e,i,n,r,s){return he(i,n,r,s,t,e)},pointPolygon:function(t,e,i,n){return Ut(i,t,e,n)},pointCircle:function(t,e,i,n,r){return It(i,n,r,t,e)},pointLine:function(t,e,i,n,r,s){return Nt(i,n,r,s,t,e)},pointEllipse:function(t,e,i,n,r,s){return de(i,n,r,s,t,e)},pointCircleOutline:function(t,e,i,n,r,s){return te(t,e,i,n,r,s)},lineLine:ce,lineBox:ue,linePolygon:ie,lineCircle:Ot,linePoint:Nt,lineEllipse:oe,lineCircleOutline:function(t,e,i,n,r,s,o,a){return Zt(r,s,o,t,e,i,n,a)},ellipsePoint:de,ellipseLine:se,ellipseBox:fe,ellipseCircle:Kt,ellipseEllipse:function(t,e,i,n,r,s,o,a){return Jt.ellipseEllipse(t,e,i,n,r,s,o,a)},ellipsePolygon:function(t,e,i,n,r){return ae(r,t,e,i,n)}},ye=pe.polygonPolygon,ve=pe.polygonCircle,ge=e(function(t,e){t.exports=function(){function t(t,n,r,s,o){!function t(i,n,r,s,o){for(;s>r;){if(s-r>600){var a=s-r+1,h=n-r+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(h-a/2<0?-1:1),f=Math.max(r,Math.floor(n-h*c/a+u)),d=Math.min(s,Math.floor(n+(a-h)*c/a+u));t(i,n,f,d,o)}var p=i[n],y=r,v=s;for(e(i,r,n),o(i[s],p)>0&&e(i,r,s);y<v;){for(e(i,y,v),y++,v--;o(i[y],p)<0;)y++;for(;o(i[v],p)>0;)v--}0===o(i[r],p)?e(i,r,v):e(i,++v,s),v<=n&&(r=v+1),n<=v&&(s=v-1)}}(t,n,r||0,s||t.length-1,o||i)}function e(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function i(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function s(t,e){o(t,0,t.children.length,e,t)}function o(t,e,i,n,r){r||(r=p(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var s=e;s<i;s++){var o=t.children[s];a(r,t.leaf?n(o):o)}return r}function a(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function h(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(e,i,n,r,s){for(var o=[i,n];o.length;)if(!((n=o.pop())-(i=o.pop())<=r)){var a=i+Math.ceil((n-i)/r/2)*r;t(e,a,i,n,s),o.push(i,a,a,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,i=[];if(!d(t,e))return i;for(var n=this.toBBox,r=[];e;){for(var s=0;s<e.children.length;s++){var o=e.children[s],a=e.leaf?n(o):o;d(t,a)&&(e.leaf?i.push(o):f(t,a)?this._all(o,i):r.push(o))}e=r.pop()}return i},n.prototype.collides=function(t){var e=this.data;if(!d(t,e))return!1;for(var i=[];e;){for(var n=0;n<e.children.length;n++){var r=e.children[n],s=e.leaf?this.toBBox(r):r;if(d(t,s)){if(e.leaf||f(t,s))return!0;i.push(r)}}e=i.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=p([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var i,n,s,o=this.data,a=this.toBBox(t),h=[],l=[];o||h.length;){if(o||(o=h.pop(),n=h[h.length-1],i=l.pop(),s=!0),o.leaf){var c=r(t,o.children,e);if(-1!==c)return o.children.splice(c,1),h.push(o),this._condense(h),this}s||o.leaf||!f(o,a)?n?(i++,o=n.children[i],s=!1):o=null:(h.push(o),l.push(i),i=0,n=o,o=o.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},n.prototype._build=function(t,e,i,n){var r,o=i-e+1,a=this._maxEntries;if(o<=a)return s(r=p(t.slice(e,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(r=p([])).leaf=!1,r.height=n;var h=Math.ceil(o/a),l=h*Math.ceil(Math.sqrt(a));y(t,e,i,l,this.compareMinX);for(var c=e;c<=i;c+=l){var u=Math.min(c+l-1,i);y(t,c,u,h,this.compareMinY);for(var f=c;f<=u;f+=h){var d=Math.min(f+h-1,u);r.children.push(this._build(t,f,d,n-1))}}return s(r,this.toBBox),r},n.prototype._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var r=1/0,s=1/0,o=void 0,a=0;a<e.children.length;a++){var h=e.children[a],l=c(h),u=(f=t,d=h,(Math.max(d.maxX,f.maxX)-Math.min(d.minX,f.minX))*(Math.max(d.maxY,f.maxY)-Math.min(d.minY,f.minY))-l);u<s?(s=u,r=l<r?l:r,o=h):u===s&&l<r&&(r=l,o=h)}e=o||e.children[0]}var f,d;return e},n.prototype._insert=function(t,e,i){var n=i?t:this.toBBox(t),r=[],s=this._chooseSubtree(n,this.data,e,r);for(s.children.push(t),a(s,n);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)},n.prototype._split=function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var o=this._chooseSplitIndex(i,r,n),a=p(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,s(i,this.toBBox),s(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},n.prototype._splitRoot=function(t,e){this.data=p([t,e]),this.data.height=t.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,i){for(var n,r,s,a,h,l,u,f=1/0,d=1/0,p=e;p<=i-e;p++){var y=o(t,0,p,this.toBBox),v=o(t,p,i,this.toBBox),g=(r=y,s=v,a=void 0,h=void 0,l=void 0,u=void 0,a=Math.max(r.minX,s.minX),h=Math.max(r.minY,s.minY),l=Math.min(r.maxX,s.maxX),u=Math.min(r.maxY,s.maxY),Math.max(0,l-a)*Math.max(0,u-h)),m=c(y)+c(v);g<f?(f=g,n=p,d=m<d?m:d):g===f&&m<d&&(d=m,n=p)}return n},n.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:h,r=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var r=this.toBBox,s=o(t,0,e,r),h=o(t,i-e,i,r),l=u(s)+u(h),c=e;c<i-e;c++){var f=t.children[c];a(s,t.leaf?r(f):f),l+=u(s)}for(var d=i-e-1;d>=e;d--){var p=t.children[d];a(h,t.leaf?r(p):p),l+=u(h)}return l},n.prototype._adjustParentBBoxes=function(t,e,i){for(var n=i;n>=0;n--)a(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():s(t[e],this.toBBox)},n}()}),me=we,xe=we;function we(t,e){if(!(this instanceof we))return new we(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||be,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function be(t,e){return t<e?-1:t>e?1:0}we.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,n=e[t];t>0;){var r=t-1>>1,s=e[r];if(i(n,s)>=0)break;e[t]=s,t=r}e[t]=n},_down:function(t){for(var e=this.data,i=this.compare,n=this.length>>1,r=e[t];t<n;){var s=1+(t<<1),o=s+1,a=e[s];if(o<this.length&&i(e[o],a)<0&&(s=o,a=e[o]),i(a,r)>=0)break;e[t]=a,t=s}e[t]=r}},me.default=xe;var Me=_e,Ye=_e;function _e(t,e,i,n,r,s){for(var o,a,h,l,c=t.data,u=[],f=t.toBBox,d=new me(null,Xe);c;){for(o=0;o<c.children.length;o++)a=c.children[o],h=Se(e,i,c.leaf?f(a):a),(!s||h<=s)&&d.push({node:a,isItem:c.leaf,dist:h});for(;d.length&&d.peek().isItem;)if(l=d.pop().node,r&&!r(l)||u.push(l),n&&u.length===n)return u;(c=d.pop())&&(c=c.node)}return u}function Xe(t,e){return t.dist-e.dist}function Se(t,e,i){var n=Ae(t,i.minX,i.maxX),r=Ae(e,i.minY,i.maxY);return n*n+r*r}function Ae(t,e,i){return t<e?e-t:t<=i?0:t-i}Me.default=Ye;var Pe="EPSILON"in Number?Number.EPSILON:2.220446049250313e-16,Be=function(t,e){return Math.abs(t-e)<Pe};function Ee(t,e){this.set(t,e)}Ee.prototype.add=function(t,e){return t instanceof Ee?(this.x+=t.x,this.y+=t.y):(this.x+=t||0,this.y+=e||0),this},Ee.prototype.angle=function(t){if(void 0!==t)return this.set(this.length(),0).rotate(t);var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},Ee.prototype.angleDeg=function(t){return void 0!==t?this.angle(t/180*Math.PI):180*this.angle()/Math.PI},Ee.prototype.clone=Ee.prototype.copy=function(){return new Ee(this.x,this.y)},Ee.prototype.cross=function(t,e){return t instanceof Ee?this.x*t.y-this.y*t.x:this.x*e-this.y*t},Ee.prototype.distance=function(t,e){var i=this.distanceSq(t,e);if(void 0!==i)return Math.sqrt(i)},Ee.prototype.distanceSq=function(t,e){var i,n;if(t instanceof Ee)i=t.x-this.x,n=t.y-this.y;else{if(void 0===e)return;i=t-this.x,n=e-this.y}return i*i+n*n},Ee.prototype.dot=function(t,e){return t instanceof Ee?this.x*t.x+this.y*t.y:this.x*t+this.y*e},Ee.prototype.equals=function(t,e,i){return t instanceof Ee?(e=e||0,Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e):void 0!==e&&(i=i||0,Math.abs(this.x-t)<=i&&Math.abs(this.y-e)<=i)},Ee.prototype.length=function(){return Math.sqrt(this.lengthSq())},Ee.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},Ee.prototype.negate=function(){return this.scale(-1)},Ee.prototype.normalize=function(){return this.scale(1/this.length())},Ee.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(this.x*e-this.y*i,this.x*i+this.y*e)},Ee.prototype.rotateDeg=function(t){return this.rotate(t/180*Math.PI)},Ee.prototype.scale=function(t,e){return this.x*=t,this.y*=e||t,this},Ee.prototype.set=function(t,e){return t instanceof Ee?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0),this},Ee.prototype.setPolar=function(t,e){return this.set(e,0).rotate(t)},Ee.prototype.setPolarDeg=function(t,e){return this.setPolar(t/180*Math.PI,e)},Ee.prototype.sub=function(t,e){return void 0!==e?(this.x-=t,this.y-=e):(this.x-=t.x,this.y-=t.y),this},Ee.prototype.toString=function(){return"("+this.x+", "+this.y+")"};var Le=Ee;function ke(t,e,i){return i=i||0,Math.abs(t-e)<Math.abs(i)}var Re=function(t,e){return ke(t,0,e)},Ce=function(t,e,i){return t>e?t<i?t:i:e},Te=1/3,Ie=new Le(0,0),Oe=1e-4,De=30;function je(t){return"[object Array]"===Object.prototype.toString.call(t)}function Fe(t){if(!je(t))throw"Polygon must be an array of points";switch(typeof t[0]){case"number":if(t.length%2!=0)throw"Polygon that contains array of numbers must has even length ([x0, y0, x1, y1, ...., xn, yn])";for(var e=[],i=0;i<t.length;i+=2)e.push(new Le(t[i],t[i+1]));return e;case"object":return t.map(je(t[0])?t=>new Le(t[0],t[1]):t=>new Le(t.x,t.y));default:throw"Passed polygon is not an array of 2D coordinates"}}function ze(t){if(1===t.length)return new Le(t[0]);var e=new Le(0,0);t.forEach(t=>e.add(t)),e.scale(1/t.length);var i=new Le,n=0;return t.forEach((r,s)=>{var o=new Le(r),a=new Le(s+1===t.length?t[0]:t[s+1]);o.add(-e.x,-e.y),a.add(-e.x,-e.y);var h=.5*o.cross(a);n+=h,i.add(o.add(a).scale(Te).scale(h))}),Re(n,Oe)?i.set(t[0]):i.scale(1/n).add(e)}function We(t,e){for(var i=t[0],n=e.dot(t[0]),r=0,s=1;s<t.length;s++)(r=e.dot(t[s]))>n&&(n=r,i=t[s]);return new Le(i)}function He(t,e,i){var n=We(t,i),r=We(e,i.negate());return new Le(n.sub(r))}function Ne(t,e){var i=new Le(0,0),n=new Le(t).negate(),r=new Le(e).sub(t),s=r.dot(r);if(Re(s,Oe))return i.set(t);var o=n.dot(r)/s;return o=Ce(o,0,1),i.set(r.scale(o).add(t))}function Ue(t,e){t=Fe(t),e=Fe(e);var i,n,r,s=ze(t),o=ze(e).add(s.negate());i=He(t,e,o),n=He(t,e,o.negate());for(var a=0;a<De;a++){var h=Ne(i,n);if(Re(h.length(),Oe))return{distance:0};o.set(h.negate().normalize());var l=(r=He(t,e,o)).dot(o),c=i.dot(o);if(Re(l-c,Oe))return{distance:l,direction:o,p1:i,p2:n};i.distanceSq(Ie)<n.distanceSq(Ie)?n=r:i=r}return{distance:0}}var Qe={intersect:function(t,e){return Re(Ue(t,e),Oe)},distance:Ue},qe=e(function(t,e){!function(){function e(t,e,i){this.next=i,i&&(i.prev=this),this.prev=e,e&&(e.next=this),this.data=t}function i(){if(!(this instanceof i))return new i;this._head=null,this._tail=null,this.length=0}i.prototype={push:function(t){this._tail=new e(t,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(0!==this.length){var t=this._tail;return this._tail=t.prev,t.prev&&(t.prev=this._tail.next=null),this.length--,1===this.length?this._head=this._tail:0===this.length&&(this._head=this._tail=null),t.data}},unshift:function(t){this._head=new e(t,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(0!==this.length){var t=this._head;return this._head=t.next,t.next&&(t.next=this._head.prev=null),this.length--,1===this.length?this._tail=this._head:0===this.length&&(this._head=this._tail=null),t.data}},item:function(t){t<0&&(t=this.length+t);for(var e=this._head;t-- >0&&e;)e=e.next;return e?e.data:void 0},slice:function(t,e){if(t||(t=0),e||(e=this.length),e<0&&(e=this.length+e),t<0&&(t=this.length+t),e===t)return[];if(e<t)throw new Error("invalid offset: "+t+","+e+" (length="+this.length+")");for(var i=e-t,n=new Array(i),r=0,s=this._head;t-- >0&&s;)s=s.next;for(;r<i&&s;)n[r++]=s.data,s=s.next;return n},drop:function(){i.call(this)},forEach:function(t,e){for(var i=this._head,n=0,r=this.length;n<r&&i;)t.call(e||this,i.data,n,this),i=i.next,n++},map:function(t,e){var n=new i;return this.forEach(function(i,r,s){n.push(t.call(e||s,i,r,s))}),n},filter:function(t,e){var n=new i;return this.forEach(function(i,r,s){t.call(e||s,i,r,s)&&n.push(i)}),n},reduce:function(t,e,i){var n=0,r=this._head,s=this.length;for(e||(n=1,e=r&&r.data,r=r&&r.next);n<s&&r;)e=t.call(i||this,e,r.data,this),n++,r=r.next;return e}},t.exports=i}()});class $e extends qe{constructor(){super()}every(t,e){let i,n=this._head,r=0;const s=this.length;let o=!0;for(;r<s&&n&&o;)o=t.call(e||this,n.data,i,r,this),i=n.data,n=n.next,r+=1}getHead(){if(this._head)return this._head.data}getTail(){if(this._tail)return this._tail.data}}const Ve=(t,e)=>{let i=t+Math.random()*(e+1-t);return i=Math.floor(i)},Je=t=>0|t,Ke=(t,e,i,n,r,s)=>{const o=i-t,a=n-e;return{x:Je(s*o-r*a+t),y:Je(r*o+s*a+e)}},Ge=(t,e,i,n)=>{const r=2*Math.PI*Math.random(),s=Math.random()+Math.random(),o=(s>1?2-s:s)*(i-.5*n);return{x:Je(Math.cos(r)*o+t),y:Je(Math.sin(r)*o+e)}},Ze=(t,e,i)=>t+(e-t)*i,ti=(t,e)=>Math.atan2(Math.sin(t-e),Math.cos(t-e)),ei=(t,e,i,n)=>{const r=t-i,s=e-n;return r*r+s*s},ii=(t,e,i)=>{const n=(e-t)/e*.5;return(Math.sin(i)*n+(1-n))*e},ni=2*Math.PI;function ri(t){const e=t%ni;return e<0?e+ni:e}const{sqrt:si}=Math,oi=(t,e,i,n,r,s,o)=>{const a=[],h=(s-n)*(s-n)+(o-r)*(o-r),l=2*((s-n)*(n-t)+(o-r)*(r-e)),c=l*l-4*h*(t*t+e*e+n*n+r*r-2*(t*n+e*r)-i*i);if(c>0){const t=si(c),e=(-l+t)/(2*h),i=(-l-t)/(2*h);e>=0&&e<=1&&a.push({x:Ze(n,s,e),y:Ze(r,o,e)}),i>=0&&i<=1&&a.push({x:Ze(n,s,i),y:Ze(r,o,i)})}return a},ai=(t,e,i,n,r,s,o)=>{const a=oi(t,e,i,n,r,s,r),h=oi(t,e,i,s,r,s,o),l=oi(t,e,i,s,o,n,o),c=oi(t,e,i,n,o,n,r),u=[],f=i*i,d=n-t,p=r-e,y=s-t,v=o-e,g=d*d,m=p*p,x=y*y,w=v*v;return a.length>0&&(2===a.length?a[0].x>a[1].x?u.push(a[1],a[0]):u.push(a[0],a[1]):u.push(a[0])),x+m<f&&u.push({x:s,y:r}),h.length>0&&(2===h.length?h[0].y>h[1].y?u.push(h[1],h[0]):u.push(h[0],h[1]):u.push(h[0])),x+w<f&&u.push({x:s,y:o}),l.length>0&&(2===l.length?l[0].x<l[1].x?u.push(l[1],l[0]):u.push(l[0],l[1]):u.push(l[0])),g+w<f&&u.push({x:n,y:o}),c.length>0&&(2===c.length?c[0].y<c[1].y?u.push(c[1],c[0]):u.push(c[0],c[1]):u.push(c[0])),g+m<f&&u.push({x:n,y:r}),u},hi=(t,e,i,n,r,s,o)=>{const a={type:0,isec:[]},h=t-r,l=e-s,c=i*h+n*l;let u=o*o-h*h+l*l+c*c;if(u<0)return a;if(c<(u=Math.sqrt(u))){if(Be(u,0))return a.type=1,a.isec.push({x:i*c+t,y:n*c+e}),a;if(c+u>=0){u=-u,a.type=2;const r=c-u;return a.isec.push({x:i*r+t,y:n*r+e}),a}return a}a.type=3;const f=c-u,d=c+u;return a.isec.push({x:i*f+t,y:n*f+e},{x:i*d+t,y:n*d+e}),a};class li{constructor(t,e){if(this.gameMap=t,this.x=+(e.x||0),this.y=+(e.y||0),this.width=e.size||e.width||0,this.height=e.size||e.height||0,!this.width||!this.height)throw new Error("element size can not be undefined");this.lightDirection=!0,this.lightSpeed=e.lightSpeed,this.point=e.point,this.lightSize=this.width/2,this.minX=this.x-this.width,this.minY=this.y-this.width,this.maxX=this.x+this.width,this.maxY=this.y+this.width,this.delta=.5*Math.random()*Math.PI}render(t){this.delta+=this.lightSpeed*t,this.lightSize=ii(.5*this.width,this.width,this.delta);const e=this.gameMap.view.relativeX(this.x),i=this.gameMap.view.relativeY(this.y),n=this.gameMap.view.relativeW(this.width);this.gameMap.ctx.fillStyle=`hsla(${ii(180,360,.5*this.delta)}, ${ii(80,100,.4*this.delta)}%, 50%, 0.2)`,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(e,i,this.lightSize*n/this.width,0,2*Math.PI),this.gameMap.ctx.fill(),this.gameMap.ctx.fillStyle=`hsl(${ii(180,360,.5*this.delta)}, ${ii(80,100,.4*this.delta)}%, 50%)`,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(e,i,.5*n,0,2*Math.PI),this.gameMap.ctx.fill()}}class ci{constructor(t,e,i,n,r,s,o,a,h){this.x=t,this.y=e,this.vx=i,this.vy=n,this.speed=r,this.angle=s,this.sin=Math.sin(s),this.cos=Math.cos(s),this.nextAngle=s,this.poly={},this.aabb={},this.aabb.parent=this,this.snake=h,this.aabb.snakeIdx=h.idx,this.setIdx(a),this.calcPoly(o),this.isHead=!1}setNext(t,e,i){this.nextX=t,this.nextY=e,this.nextAngle=i,this.nextSin=Math.sin(i),this.nextCos=Math.cos(i),this.calcPoly(.5*this.width)}setXY(t,e){this.x=t,this.y=e,this.calcPoly(.5*this.width)}calcRotates(t){const e=Ke(this.x,this.y,this.x,this.y+t,this.sin,this.cos),i=Ke(this.x,this.y,this.x,this.y-t,this.sin,this.cos),n=Ke(this.nextX,this.nextY,this.nextX,this.nextY+t,this.nextSin,this.nextCos);return{rotateLeft:i,rotateRight:e,nextRotateLeft:Ke(this.nextX,this.nextY,this.nextX,this.nextY-t,this.nextSin,this.nextCos),nextRotateRight:n}}setIdx(t){this.aabb.idx=t}calcPoly(t){const e=this.calcRotates(.5*t);this.poly.l0X=e.nextRotateLeft.x,this.poly.l0Y=e.nextRotateLeft.y,this.poly.r0X=e.nextRotateRight.x,this.poly.r0Y=e.nextRotateRight.y,this.poly.l1X=e.rotateLeft.x,this.poly.l1Y=e.rotateLeft.y,this.poly.r1X=e.rotateRight.x,this.poly.r1Y=e.rotateRight.y,this.width=t}getPoly(t){return Be(t,this.width)||this.calcPoly(t),this.poly}setAABB(t){const e=this.calcRotates(.5*t);this.aabb.minX=Math.min(e.rotateRight.x,e.rotateLeft.x,e.nextRotateLeft.x,e.nextRotateRight.x),this.aabb.minY=Math.min(e.rotateRight.y,e.rotateLeft.y,e.nextRotateLeft.y,e.nextRotateRight.y),this.aabb.maxX=Math.max(e.rotateRight.x,e.rotateLeft.x,e.nextRotateLeft.x,e.nextRotateRight.x),this.aabb.maxY=Math.max(e.rotateRight.y,e.rotateLeft.y,e.nextRotateLeft.y,e.nextRotateRight.y)}getAABB(){return this.aabb}destroy(){this.poly=void 0,this.aabb.parent=void 0,this.aabb=void 0}}const{log:ui}=console;class fi{constructor(t,e){this.gameMap=t,this.x=+(e.x||0),this.y=+(e.y||0),this.width=+(e.size||e.width||0),this.height=+(e.size||e.height||0),this.shadowSize=this.width+gt,this.needResize=!1,this.point=0,this.isSpeedUp=!1,this.fillColor="",this.stopped=!1,this.isActive=e.isAcive||!0,this.head={},this.head.aabb={},this.head.aabb.snakeIdx=this.idx=e.idx,this.head.aabb.parent=this.head,this.head.snake=this,this.head.getPoly=t=>this.head.poly,this.head.getAABB=()=>this.head.aabb,this.head.isHead=!0,this.head.poly={},this.head.width=this.width,this.closestDistance=5e3,this.visionAngle=170,this.closestSnake=null,this.closestFood=null,this.closestSnakeID=null,this.closestFoodID=null,this.colliders=this.gameMap.globalColliders,this.movementQueue=new $e,this.mIdx=0,this.collidersArray=[],this.speed=this.oldSpeed=ut,this.turnSpeed=ft,this.vx=0,this.vy=0,this.oldVx=0,this.oldVy=0,this.fillColor=e.fillColor||"#fff",this.angle=this.toAngle=e.angle||0,this.length=this.lastLength=e.length||0,this.viewLength=0,this.isPlayer=e.isPlayer,this.key=e.key,this.inQuene=!1,this.distances=[],this.updateSize(),this.turnAround(0),this.calcHead()}zeroClosest(){this.closestDistance=5e3}setXY(t,e){this.x=t,this.y=e,this.calcHead()}setAngle(t){this.angle=t,this.toAngle=t,this.velocity(),this.calcHead()}setClosest(t){this.closestDistance=t}updateSize(t=0){this.width+=.4*t,this.height+=.4*t,this.lastLength=this.length,this.length+=15*t,this.width>this.shadowSize-.1*gt&&(this.needResize=!0),this.head.width=this.width}turnAround(t){const e=ti(this.toAngle,this.angle),i=this.turnSpeed*t*this.gameMap.scale;if(Math.abs(e)<=i)this.angle=this.toAngle,this.tau=0;else{this.angle+=Math.sign(e)*i;const t=this.height*Math.sin(this.angle);this.tau=this.speed/t}this.vx=Math.cos(this.angle),this.vy=Math.sin(this.angle)}speedUp(){this.isSpeedUp||(this.isSpeedUp=!0,this.oldSpeed=this.speed,this.speed*=2)}speedDown(){this.isSpeedUp&&(this.isSpeedUp=!1,this.speed=this.oldSpeed)}eat(t){this.point+=t.point;const e=t.point/200;this.updateSize(e)}update(t){if(this.stopped||Be(this.speed,0))return;let e=!1;const i=this.speed*t;let n=this.movementQueue.getTail();if(n&&Be(n.angle,this.angle)&&(this.colliders.remove(n.getAABB()),n.speed+=i,e=!0),e||(n=new ci(this.x,this.y,this.vx,this.vy,i,this.angle,this.width,this.mIdx,this),this.movementQueue.push(n),this.mIdx+=1),this.viewLength+=i,this.turnAround(t),this.x+=this.vx*i,this.y+=this.vy*i,n.setNext(this.x,this.y,this.angle),n.setAABB(this.shadowSize),this.colliders.insert(n.getAABB()),this.movementQueue.length>0&&this.viewLength>this.length){let t;for(;this.movementQueue.length>0&&this.viewLength>this.length;)t=this.movementQueue.shift(),this.colliders.remove(t.getAABB()),this.viewLength-=t.speed;const e=this.length-this.viewLength;if(e>0){const i=e/t.speed;t.speed=e;const n=t.nextX-(t.nextX-t.x)*i,r=t.nextY-(t.nextY-t.y)*i;t.setXY(n,r),t.setAABB(this.shadowSize),this.movementQueue.unshift(t),this.colliders.insert(t.getAABB()),this.viewLength+=t.speed}}this.needResize&&!this.inQuene&&(this.gameMap.updateQuene.push(this),this.inQuene=!0),this.colliders.remove(this.head.getAABB()),this.calcHead(),this.head.aabb.idx=this.mIdx,this.colliders.insert(this.head.getAABB())}updateAABBs(){this.mIdx=0,this.movementQueue.forEach(t=>{this.colliders.remove(t.getAABB()),t.setAABB(this.shadowSize),t.setIdx(this.mIdx),this.mIdx+=1,this.collidersArray.push(t.getAABB())}),ui(`${this.key} resize width ${this.collidersArray.length} colliders`),this.colliders.load(this.collidersArray),this.collidersArray.length=0,this.head.aabb.idx=this.mIdx}calcHead(){const t=Ke(this.x,this.y,this.x+this.height,this.y-.5*this.width,this.vy,this.vx),e=Ke(this.x,this.y,this.x+this.height,this.y+.5*this.width,this.vy,this.vx),i=Ke(this.x,this.y,this.x,this.y+.5*this.width,this.vy,this.vx),n=Ke(this.x,this.y,this.x,this.y-.5*this.width,this.vy,this.vx),r=Ke(this.x,this.y,this.x+this.width,this.y,this.vy,this.vx);this.head.poly.l1X=t.x,this.head.poly.l1Y=t.y,this.head.poly.r1X=e.x,this.head.poly.r1Y=e.y,this.head.poly.r0X=i.x,this.head.poly.r0Y=i.y,this.head.poly.l0X=n.x,this.head.poly.l0Y=n.y,this.head.nextX=r.x,this.head.nextY=r.y,this.head.x=this.x,this.head.y=this.y,this.head.cX=.5*(this.head.x+this.head.nextX),this.head.cY=.5*(this.head.y+this.head.nextY),this.head.aabb.minX=Math.min(this.head.poly.l0X,this.head.poly.l1X,this.head.poly.r0X,this.head.poly.r1X),this.head.aabb.minY=Math.min(this.head.poly.l0Y,this.head.poly.l1Y,this.head.poly.r0Y,this.head.poly.r1Y),this.head.aabb.maxX=Math.max(this.head.poly.l0X,this.head.poly.l1X,this.head.poly.r0X,this.head.poly.r1X),this.head.aabb.maxY=Math.max(this.head.poly.l0Y,this.head.poly.l1Y,this.head.poly.r0Y,this.head.poly.r1Y)}}class di{constructor(t,e,i){this.gameMap=t,this.margin=e,this.radius=i,this.image=document.createElement("canvas"),this.initImage()}initImage(){this.image.width=2*(this.radius+2),this.image.height=2*(this.radius+2),this.x=this.gameMap.view.width-2*(this.radius+2)-this.margin,this.y=this.gameMap.view.height-2*(this.radius+2)-this.margin,this.mapX=this.x+this.radius+2,this.mapY=this.y+this.radius+2;const t=this.image.getContext("2d");t.save(),t.beginPath(),t.arc(this.radius+2,this.radius+2,this.radius,0,2*Math.PI),t.fillStyle="#ccc",t.fill(),t.beginPath(),t.arc(this.radius+2,this.radius+2,this.radius+1,0,2*Math.PI),t.lineWidth=2,t.strokeStyle="#fff",t.stroke(),t.beginPath(),t.arc(this.radius+2,this.radius+2,this.radius+1,0,2*Math.PI),t.strokeStyle="#FF0000",t.setLineDash([5,5]),t.stroke(),t.restore()}render(){const t=this.radius/this.gameMap.paintRadius,e=this.radius/this.gameMap.radius,{ctx:i}=this.gameMap,n=this.gameMap.view.x*t+this.mapX,r=this.gameMap.view.y*t+this.mapY,s=this.gameMap.view.width*t,o=this.gameMap.view.height*t;i.save(),i.globalAlpha=.8,i.drawImage(this.image,this.x,this.y),i.strokeStyle="#fff",i.strokeRect(n,r,s,o);let a=-1;for(;++a<this.gameMap.units.length;){const t=this.gameMap.units[a],n=t.x*e+this.mapX,r=t.y*e+this.mapY;i.fillStyle=t.isPlayer?"#1E90FF":"#F00",i.fillRect(n-1,r-1,2,2)}i.restore()}}class pi{constructor(t,e,i,n=0,r=0){this.width=e,this.height=i,this.x=n,this.y=r,this.gameMap=t,this.aabb={}}trace(t){this.x=this.aabb.minX=t.x/this.gameMap.scale-.5*this.width,this.y=this.aabb.minY=t.y/this.gameMap.scale-.5*this.height,this.aabb.minX=this.absoluteW(this.x),this.aabb.minY=this.absoluteW(this.y),this.aabb.maxX=this.aabb.minX+this.absoluteW(this.width),this.aabb.maxY=this.aabb.minY+this.absoluteH(this.height)}absoluteX(t){return(t+this.x)*this.gameMap.scale}absoluteY(t){return(t+this.y)*this.gameMap.scale}absoluteW(t){return t*this.gameMap.scale}absoluteH(t){return t*this.gameMap.scale}relativeX(t){return t/this.gameMap.scale-this.x}relativeY(t){return t/this.gameMap.scale-this.y}relativeW(t){return t/this.gameMap.scale}relativeH(t){return t/this.gameMap.scale}}const yi=(t,e)=>e.snakeIdx!==t,{log:vi}=console;var gi={BLUR:"blur",BOOT:"boot",DESTROY:"destroy",FOCUS:"focus",HIDDEN:"hidden",PAUSE:"pause",POST_RENDER:"postrender",POST_STEP:"poststep",PRE_RENDER:"prerender",PRE_STEP:"prestep",READY:"ready",RESUME:"resume",STEP:"step",VISIBLE:"visible"};const mi=(t,e=!0)=>{let i;const n=t;if(void 0!==document.hidden)i="visibilitychange";else{["webkit","moz","ms"].forEach(t=>{void 0!==document[`${t}Hidden`]&&(document.hidden=()=>document[`${t}Hidden`],i=`${t}visibilitychange`)})}const r=t=>{document.hidden||"pause"===t.type?n.emit(gi.HIDDEN):n.emit(gi.VISIBLE)};i&&document.addEventListener(i,r,!1),window.onblur=()=>{n.emit(gi.BLUR)},window.onfocus=()=>{n.emit(gi.FOCUS)},window.focus&&e&&window.focus()},xi=new i,{log:wi}=console,bi=lt(window.location.search,{ignoreQueryPrefix:!0}),Mi=parseInt(bi.units,10),Yi=parseInt(bi.foods,10),_i=parseInt(bi.radius,10);xi.showPanel(0),document.body.appendChild(xi.dom);const Xi=document.getElementById("cas"),Si=window.innerWidth,Ai=window.innerHeight,Pi={SPACE:32},Bi=new class extends At{constructor({playerID:t="player",canvas:e=document.createElement("canvas"),vWidth:i=window.innerWidth,vHeight:n=window.innerHeight,scale:r=1,x:s=0,y:o=0,radius:a=ct,drawDebug:h=St}){super(),this.canvas=e,this.radius=a,this.pow2R=a*a,this.x=s,this.y=o,this.vWidth=i,this.vHeight=n,this.canvas.width=i,this.canvas.height=n,this.ctx=this.canvas.getContext("2d"),this.drawDebug=h,this.view=new pi(this,i,n),this.smallMap=new di(this,30,50),this.units=[],this.playerID=t,this.foods=new ge,this.globalColliders=new ge,this.updateQuene=new $e,this.setScale(r),this.toScale=this.scale,this.numBotsToUpdate=0,this.botUpdateIdx=0,this.foodsOnField=0}initUnits(t){let e=-1;for(;++e<t;){let i=Ge(this.x,this.y,this.radius,2*yt*2);const n=e===t-1,r=new fi(this,{x:i.x,y:i.y,size:yt,length:vt,angle:2*Math.random()*Math.PI,fillColor:"#00FF00",idx:e,isPlayer:n,isActive:!0,key:n?this.playerID:`unit${e}`});for(;this.globalColliders.collides(r.head.getAABB());)i=Ge(this.x,this.y,this.radius,2*yt*4),r.setXY(i.x,i.y);this.units.push(r),this.globalColliders.insert(r.head.getAABB())}this.player=this.units[this.units.length-1],this.numBotsToUpdate=Math.ceil(this.units.length/(60*pt)),vi(`${this.numBotsToUpdate} bots will be updated in one tick`)}initFoods(t){this.foodsOnField=t;for(let e=t;e;e-=1){const t=Ve(1,10),e=Math.floor(2*t+10),i=Ge(this.x,this.y,this.radius,2*e);this.foods.insert(new li(this,{size:e,point:t,x:i.x,y:i.y,lightSpeed:dt}))}}updateAABBsQuene(){let t=!0;for(;this.updateQuene.length>0&&t;){const e=this.updateQuene.shift();e.inQuene=!1,e.needResize=e.width>this.shadowSize-.1*gt,e.isActive&&e.needResize&&e.width>.9*e.shadowSize?(t=!1,e.needResize=!1,e.shadowSize+=gt,e.updateAABBs(),vi(`AABBs Quene updated. Quene length: ${this.updateQuene.length}, updated Snake ${e.idx}`)):vi(`Snake ${e.idx} shift from quene without update`)}}setScale(t){this.scale!==t&&(this.scale=t<1?1:t,this.paintRadius=this.view.relativeW(this.radius),this.emit("scale_changed"))}setToScale(t){this.toScale=t}clear(){this.ctx.clearRect(0,0,this.view.width,this.view.height)}update(t){this.updateAABBsQuene(),this.checkCollisions(),this.scale!==this.toScale&&this.setScale(this.toScale);let e=-1;for(;++e<this.units.length;){const i=this.units[e];i.update(t);const n=i.head.getPoly(),r=[n.l0X,n.l0Y,n.r0X,n.r0Y,n.r1X,n.r1Y,n.l1X,n.l1Y],s=hi(n.l1X,n.l1Y,i.vx,i.vy,this.x,this.y,this.radius),o=hi(n.r1X,n.r1Y,i.vx,i.vy,this.x,this.y,this.radius);if(2===s.type&&2===o.type){Math.min(ei(s.isec[0][0],s.isec[0][1],n.l1X,n.l1Y),ei(o.isec[0][0],o.isec[0][1],n.r1X,n.r1Y));const t=this.foods.search(i.head.getAABB());let a=-1;for(;++a<t.length;)if(ve(r,t[a].x,t[a].y,.5*t[a].width)){this.foods.remove(t[a]),this.units[e].eat(t[a]);const i=Math.floor(30*Math.random()+50),n=Math.floor(i/3),r=Ge(this.x,this.y,this.radius,2*n);this.foods.insert(new li(this,{size:n,point:i,x:r.x,y:r.y,lightSpeed:dt}))}}else this.kill(i)}this.updateBots()}kill(t){}render(t){this.view.trace(this.player),this.clear(),this.drawBackup(),this.drawFoods(t),this.drawSnakes(),this.smallMap.render()}drawBackup(){const{view:t,ctx:e}=this,{aabb:i}=t,n=i.minX-this.x,r=i.minY-this.y,s=i.maxX-this.x,o=i.maxY-this.y,a=n*n,h=r*r,l=s*s,c=o*o,u=a+h,f=l+h,d=a+c,p=l+c;Math.max(u,f,d,p)>this.pow2R?this.drawBounds():(e.save(),e.fillStyle="#FFFFE0",e.fillRect(0,0,t.width,t.height),e.restore()),e.restore()}checkCollisions(){let t=-1;for(;++t<this.units.length;){const e=this.units[t].head.getPoly(),i=this.globalColliders.search(this.units[t].head.getAABB());let n=-1;for(;++n<i.length;)if(i[n].snakeIdx!==this.units[t].idx){const t=i[n].parent.getPoly(i[n].parent.width);if(ye([e.l0X,e.l0Y,e.r0X,e.r0Y,e.r1X,e.r1Y,e.l1X,e.l1Y],[t.l0X,t.l0Y,t.r0X,t.r0Y,t.r1X,t.r1Y,t.l1X,t.l1Y]))break}}}updateBots(){const t=this.botUpdateIdx;let e=0,i=!0;for(;i;){if(this.units[this.botUpdateIdx].isActive&&!this.units[this.botUpdateIdx].isPlayer){e+=1;const t=this.units[this.botUpdateIdx];0!==t.distances.length&&(t.distances.length=0);const i=yi.bind(null,t.idx),{cX:n,cY:r,x:s,y:o}=t.head,a=t.head.getPoly(),h=[a.l0X,a.l0Y,a.r0X,a.r0Y,a.r1X,a.r1Y,a.l1X,a.l1Y],l=Me(this.foods,n,r,1);l.length>0&&(t.toAngle=Math.atan2(l[0].y-o,l[0].x-s));const c=Me(this.globalColliders,n,r,void 0,i,9e4);if(c.length>0){let e=-1,i=0,n=0;for(;++e<c.length;){const r=c[e].parent.getPoly(),s=Qe.distance(h,[r.l0X,r.l0Y,r.r0X,r.r0Y,r.r1X,r.r1Y,r.l1X,r.l1Y]);if(s.distance<=Yt&&s.distance>0){s.direction.negate();const e=s.direction.clone().scale(Yt/s.distance);t.distances.push(s),i+=2*e.x*e.y,n+=e.x*e.x-e.y*e.y}}if(t.distances.length>0){const e=.5*Math.atan2(i,n);t.head.sumDirectionX=Math.cos(e),t.head.sumDirectionY=Math.sin(e)}}}this.botUpdateIdx=(this.botUpdateIdx+1)%this.units.length,i=this.botUpdateIdx!==t&&e<this.numBotsToUpdate}}drawBounds(){const{ctx:t,view:e}=this,i=[],n=e.relativeX(this.x),r=e.relativeY(this.y),s=ai(n,r,this.paintRadius,0,0,e.width,e.height);if(s.length>0){t.save(),t.beginPath(),t.moveTo(s[0].x,s[0].y);let o=-1;for(;++o<s.length;){const a=s[(o+1)%s.length];if(!Be(s[o].x,a.x)||!Be(s[o].y,a.y)){const h=s[o].x,l=s[o].y,c=a.x,u=a.y;let f=ri(Math.atan2(l-r,h-n)),d=ri(Math.atan2(u-r,c-n));const p=.5*(h+c),y=.5*(l+u);if(ti(d,f)<0){const t=f;f=d,d=t}p>0&&p<e.width&&y>0&&y<e.height?(t.arc(n,r,this.paintRadius,f,d),i.push({angle1:f,angle2:d})):t.lineTo(c,u)}}for(t.fillStyle="#FFFFE0",t.closePath(),t.fill(),t.restore(),o=-1,t.save(),t.lineCap="square",t.strokeStyle="#FFFFFF",t.lineWidth=e.relativeW(10),t.shadowOffsetY=e.relativeW(wt),t.shadowOffsetX=e.relativeW(xt),t.shadowBlur=e.relativeW(bt),t.shadowColor="rgba(0, 0, 0, 0.5)",t.beginPath();++o<i.length;)t.beginPath(),t.arc(n,r,this.paintRadius+.5*e.relativeW(10),i[o].angle1,i[o].angle2),t.stroke();t.restore(),o=-1,t.save();const a=e.relativeW(15),h=e.relativeW(30);for(t.lineCap="square",t.strokeStyle="#FF0000",t.lineWidth=e.relativeW(10);++o<i.length;){t.beginPath(),t.arc(n,r,this.paintRadius+.5*e.relativeW(10),i[o].angle1,i[o].angle2);const s=this.paintRadius*i[o].angle1;t.setLineDash([a,h]),t.lineDashOffset=s,t.stroke()}t.restore()}}drawFoods(t){const e=this.foods.search(this.view.aabb);let i=-1;for(this.ctx.save();++i<e.length;)e[i].render(t);this.ctx.restore()}drawSnakes(){const{view:t,ctx:e}=this,i=this.globalColliders.search(t.aabb);Tt(i).asc(["snakeIdx","idx"]);let n=0,r=0;for(;n<i.length;){const s=i[n].parent.snake,o=s.idx,a=s.width,h=s.fillColor;if(e.save(),e.lineCap="butt",e.lineJoin="round",e.strokeStyle=h,e.lineWidth=t.relativeW(a),s.isSpeedUp){const i=s.width*Mt;e.shadowBlur=t.relativeW(Ve(i-3,i+3)),e.shadowColor="rgba(255, 0, 0, 0.5)"}else e.shadowColor="rgba(0, 0, 0, 0)";let l=!1,c=i[r].idx;for(e.beginPath(),e.moveTo(t.relativeX(i[r].parent.x),t.relativeY(i[r].parent.y));r<i.length&&i[r].snakeIdx===o;){l=i[r].parent.isHead;const n=i[r].idx;l||(c!==n&&e.moveTo(t.relativeX(i[r].parent.x),t.relativeY(i[r].parent.y)),e.lineTo(t.relativeX(i[r].parent.nextX),t.relativeY(i[r].parent.nextY))),c=n+1,r+=1}e.stroke(),e.restore(),l&&this.drawHead(s),n=r}if(this.drawDebug){for(e.save(),e.lineWidth=1,n=-1;++n<i.length;){const r=i[n].parent.getPoly(i[n].parent.snake.width),s=i[n];e.strokeStyle="#000",e.beginPath(),e.moveTo(t.relativeX(r.l0X),t.relativeY(r.l0Y)),e.lineTo(t.relativeX(r.r0X),t.relativeY(r.r0Y)),e.lineTo(t.relativeX(r.r1X),t.relativeY(r.r1Y)),e.lineTo(t.relativeX(r.l1X),t.relativeY(r.l1Y)),e.closePath(),e.stroke(),e.strokeStyle="#FF1493",e.beginPath(),e.moveTo(t.relativeX(s.minX),t.relativeY(s.minY)),e.lineTo(t.relativeX(s.maxX),t.relativeY(s.minY)),e.lineTo(t.relativeX(s.maxX),t.relativeY(s.maxY)),e.lineTo(t.relativeX(s.minX),t.relativeY(s.maxY)),e.closePath(),e.stroke()}e.strokeStyle="FF0000",e.beginPath(),e.moveTo(t.relativeX(t.aabb.minX),t.relativeY(t.aabb.minY)),e.lineTo(t.relativeX(t.aabb.maxX),t.relativeY(t.aabb.minY)),e.lineTo(t.relativeX(t.aabb.maxX),t.relativeY(t.aabb.maxY)),e.lineTo(t.relativeX(t.aabb.minX),t.relativeY(t.aabb.maxY)),e.closePath(),e.stroke(),e.restore()}}drawHead(t){const{view:e,ctx:i}=this;i.save(),i.translate(e.relativeX(t.x),e.relativeY(t.y)),i.rotate(t.angle),i.fillStyle="blue",i.shadowOffsetY=e.relativeW(4),i.shadowBlur=e.relativeW(7),i.shadowColor="rgba(0, 0, 0, 0.5)",i.fillRect(0,-.5*e.relativeW(t.width),e.relativeH(t.height),e.relativeW(t.width)),i.setTransform(1,0,0,1,0,0),i.translate(e.relativeX(t.x),e.relativeY(t.y+mt)),i.rotate(t.angle),i.fillStyle="blue",i.shadowOffsetY=0,i.shadowBlur=0,i.shadowColor="rgba(0, 0, 0, 0)",i.fillRect(0,-.5*e.relativeW(t.width),e.relativeH(t.height),e.relativeW(t.width)),i.fillStyle="white";const n=e.relativeW(t.width),r=e.relativeH(t.height);if(i.fillRect(.2*r,-.3*n,.6*r,.6*n),i.setTransform(1,0,0,1,0,0),i.restore(),this.drawDebug){i.save();const{head:n}=t,r=e.relativeH(t.height+50),s=e.relativeX(n.x),o=e.relativeY(n.y);if(i.lineWidth=1,t.angle!==t.toAngle){const e=s+Math.cos(t.toAngle)*r,n=o+Math.sin(t.toAngle)*r;i.beginPath(),i.moveTo(s,o),i.lineTo(e,n),i.arc(s,o,r,t.toAngle,t.angle,ti(t.angle,t.toAngle)<0),i.globalAlpha=.3,i.fillStyle="#DC143C",i.fill(),i.globalAlpha=1,i.beginPath(),i.moveTo(s,o),i.lineTo(e,n),i.strokeStyle="#DC143C",i.stroke()}if(i.strokeStyle="#8A2BE2",i.beginPath(),i.moveTo(s,o),i.lineTo(s+t.vx*r,o+t.vy*r),i.stroke(),i.lineWidth=1,i.strokeStyle="#FFD700",t.distances.length>0){let e=-1;for(;++e<t.distances.length;)i.beginPath(),i.moveTo(s,o),i.lineTo(s+t.distances[e].direction.x*r,o+t.distances[e].direction.y*r),i.stroke();i.strokeStyle="#CD853F",i.beginPath(),i.moveTo(s,o),i.lineTo(s+n.sumDirectionX*r*1.5,o+n.sumDirectionY*r*1.5),i.stroke()}i.restore()}}}({playerID:"player",canvas:Xi,vWidth:Si,vHeight:Ai,radius:_i||ct});wi(`     ${Bi.radius}`);let Ei=!1;const Li={},ki=$(t=>{xi.begin(),Ei&&Bi.scale<2?Bi.setToScale(Bi.scale+.1):Bi.scale>1&&!Ei&&Bi.setToScale(Bi.scale-.1),Bi.update(t),Bi.render(t),xi.end()});wi(" "),wi(" "),Bi.initUnits(Mi||Xt),wi(` ${Bi.units.length} `),wi(" "),Bi.initFoods(Yi||_t),wi(` ${Bi.foodsOnField}  `),wi("  "),function(){function t(t){if(t.preventDefault(),t.touches)Li.x=t.touches[0].pageX,Li.y=t.touches[0].pageY;else{const e=t||window.event;Li.x=e.clientX,Li.y=e.clientY}Bi.player.toAngle=function(t,e,i,n){const r=i-t,s=n-e;return Math.atan2(s,r)}(Bi.player.x,Bi.player.y,Bi.view.absoluteX(Li.x),Bi.view.absoluteY(Li.y))}navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)?(window.addEventListener("touchstart",t),window.addEventListener("touchmove",t)):(window.addEventListener("mousemove",t),window.addEventListener("mousedown",()=>{Bi.player.speedUp(),Ei=!0}),window.addEventListener("mouseup",()=>{Bi.player.speedDown(),Ei=!1}),window.addEventListener("keyup",t=>{switch(t.keyCode){case Pi.SPACE:Bi.drawDebug=!Bi.drawDebug,wi(`Draw debug: ${Bi.drawDebug}`)}})),mi(Bi),Bi.on(gi.HIDDEN,function(){ki.stop(),Bi.emit(gi.PAUSE),wi(" ")}),Bi.on(gi.VISIBLE,function(){ki.start(),Bi.emit(gi.RESUME),wi(" ")})}(),wi("  "),Bi.emit(gi.VISIBLE)}();
//# sourceMappingURL=bundle.js.map
