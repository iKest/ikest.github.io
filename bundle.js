!function(){"use strict";const t=5e3,i=5e3,e=5,s=200*Math.PI,h=200,a=200,n=40,o=0,l=1e3,c=15,r=new Map([["purple-lavender",["#911eb4","#e6beff"]],["green-mint",["#3cb44b","#aaffc3"]],["blue-cian",["#4363d8","#42d4f4"]],["navi-teal",["#000075","#469990"]],["olive-lime",["#808000","#bfef45"]],["yellow-biege",["#ffe119","#fffac8"]],["orange-apricot",["#f58231","#ffd8b1"]],["red-pink",["#e6194B","#fabebe"]],["maroon-brown",["#800000","#9A6324"]]]);var d,p=(function(t){var i=Object.prototype.hasOwnProperty,e="~";function s(){}function h(t,i,e){this.fn=t,this.context=i,this.once=e||!1}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(e=!1)),a.prototype.eventNames=function(){var t,s,h=[];if(0===this._eventsCount)return h;for(s in t=this._events)i.call(t,s)&&h.push(e?s.slice(1):s);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(t)):h},a.prototype.listeners=function(t,i){var s=e?e+t:t,h=this._events[s];if(i)return!!h;if(!h)return[];if(h.fn)return[h.fn];for(var a=0,n=h.length,o=new Array(n);a<n;a++)o[a]=h[a].fn;return o},a.prototype.emit=function(t,i,s,h,a,n){var o=e?e+t:t;if(!this._events[o])return!1;var l,c,r=this._events[o],d=arguments.length;if(r.fn){switch(r.once&&this.removeListener(t,r.fn,void 0,!0),d){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,i),!0;case 3:return r.fn.call(r.context,i,s),!0;case 4:return r.fn.call(r.context,i,s,h),!0;case 5:return r.fn.call(r.context,i,s,h,a),!0;case 6:return r.fn.call(r.context,i,s,h,a,n),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];r.fn.apply(r.context,l)}else{var p,g=r.length;for(c=0;c<g;c++)switch(r[c].once&&this.removeListener(t,r[c].fn,void 0,!0),d){case 1:r[c].fn.call(r[c].context);break;case 2:r[c].fn.call(r[c].context,i);break;case 3:r[c].fn.call(r[c].context,i,s);break;case 4:r[c].fn.call(r[c].context,i,s,h);break;default:if(!l)for(p=1,l=new Array(d-1);p<d;p++)l[p-1]=arguments[p];r[c].fn.apply(r[c].context,l)}}return!0},a.prototype.on=function(t,i,s){var a=new h(i,s||this),n=e?e+t:t;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],a]:this._events[n].push(a):(this._events[n]=a,this._eventsCount++),this},a.prototype.once=function(t,i,s){var a=new h(i,s||this,!0),n=e?e+t:t;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],a]:this._events[n].push(a):(this._events[n]=a,this._eventsCount++),this},a.prototype.removeListener=function(t,i,h,a){var n=e?e+t:t;if(!this._events[n])return this;if(!i)return 0==--this._eventsCount?this._events=new s:delete this._events[n],this;var o=this._events[n];if(o.fn)o.fn!==i||a&&!o.once||h&&o.context!==h||(0==--this._eventsCount?this._events=new s:delete this._events[n]);else{for(var l=0,c=[],r=o.length;l<r;l++)(o[l].fn!==i||a&&!o[l].once||h&&o[l].context!==h)&&c.push(o[l]);c.length?this._events[n]=1===c.length?c[0]:c:0==--this._eventsCount?this._events=new s:delete this._events[n]}return this},a.prototype.removeAllListeners=function(t){var i;return t?(i=e?e+t:t,this._events[i]&&(0==--this._eventsCount?this._events=new s:delete this._events[i])):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},a.prefixed=e,a.EventEmitter=a,t.exports=a}(d={exports:{}},d.exports),d.exports),g=function(t,i,e,s,h,a,n){var o=[h-t,a-i],l=[e-t,s-i],c=u(l,l),r=u(o,l)/c,d=[l[0]*(r=(r=r<0?0:r)>1?1:r)+t-h,l[1]*r+i-a];return u(d,d)<=n*n};function u(t,i){return t[0]*i[0]+t[1]*i[1]}function x(t,i,e,s){return Math.sqrt(Math.pow(t-e,2)+Math.pow(i-s,2))}var v=function(t,i,e,s,h,a,n){return n=n||1,Math.abs(x(t,i,e,s)-(x(t,i,h,a)+x(e,s,h,a)))<=n},f=function(t,i,e,s){var h,a,n=t.length,o=!1;for(h=0,a=n-2;h<n;h+=2)t[h+1]>e!=t[a+1]>e&&i<(t[a]-t[h])*(e-t[h+1])/(t[a+1]-t[h+1])+t[h]&&(o=!o),a=h;if(o)return!0;for(h=0;h<n;h+=2){var l,c,r=t[h],d=t[h+1];if(h===n-2?(l=t[0],c=t[1]):(l=t[h+2],c=t[h+3]),v(r,d,l,c,i,e,s))return!0}return!1},m=function(t,i,e,s){if(f(t,i,e))return!0;for(var h=t.length,a=0;a<h-2;a+=2)if(g(t[a],t[a+1],t[a+2],t[a+3],i,e,s))return!0;return g(t[0],t[1],t[h-2],t[h-1],i,e,s)};var M=function(t,i){for(var e,s,h,a,n,o,l=t,c=i,r=[l,c],d=0;d<r.length;d++)for(var p=r[d],g=0;g<p.length;g+=2){var u=(g+2)%p.length,x={x:p[u+1]-p[g+1],y:p[g]-p[u]};for(e=s=null,o=0;o<l.length;o+=2)h=x.x*l[o]+x.y*l[o+1],(null===e||h<e)&&(e=h),(null===s||h>s)&&(s=h);for(a=n=null,o=0;o<c.length;o+=2)h=x.x*c[o]+x.y*c[o+1],(null===a||h<a)&&(a=h),(null===n||h>n)&&(n=h);if(s<a||n<e)return!1}return!0},y=M,w=m;const S=(t,i)=>{let e=t+Math.random()*(i+1-t);return e=Math.floor(e)},b=(t,i)=>{let e=Math.atan(Math.abs(t/i));return t>0&&i<0?e=Math.PI-e:t<0&&i<0?e=Math.PI+e:t<0&&i>0&&(e=2*Math.PI-e),e},P=(t,i,e,s,h)=>{return{x:Math.round(Math.cos(h)*(e-t)-Math.sin(h)*(s-i)+t),y:Math.round(Math.sin(h)*(e-t)+Math.cos(h)*(s-i)+i)}},I=(t,i,e,s)=>{const h=s-i,a=e-t;let n=Math.atan2(h,a);return(n*=180/Math.PI)<0&&(n=-1*n+180),n},Y=(t,i)=>{let e=Math.atan2(i,t);return(e*=180/Math.PI)<0&&(e=-1*e+180),e},T=(t,i)=>{let e=Math.abs(i*Math.sin(t)),s=Math.abs(i*Math.cos(t));return t<Math.PI/2?s*=-1:t<Math.PI?(e*=1,s*=1):t<3*Math.PI/2?e*=-1:(e*=-1,s*=-1),{vx:e,vy:s}};class X{constructor(t,i){if(this.gameMap=t,this.x=+(i.x||0),this.y=+(i.y||0),this.width=i.size||i.width||0,this.height=i.size||i.height||0,this.id=i.id||"",!this.width||!this.height)throw new Error("element size can not be undefined")}prepare(){this.paintX=this.gameMap.view.relativeX(this.x),this.paintY=this.gameMap.view.relativeY(this.y),this.paintWidth=this.gameMap.view.relativeW(this.width),this.paintHeight=this.gameMap.view.relativeH(this.height);const t=this.paintWidth/2,i=this.paintHeight/2;this.visible=this.paintX+t>0&&this.paintX-t<this.gameMap.view.width&&this.paintY+i>0&&this.paintY-i<this.gameMap.view.height}}class _ extends X{constructor(t,i){super(t,i),this.lightDirection=!0,this.point=i.point,this.lightSize=this.width/2,this.onField=i.onField}update(){this.prepare(),this.action(),this.render()}action(){if(!this.visible)return;this.lightSize+=this.lightDirection?1:-1,(this.lightSize>this.width||this.lightSize<this.width/2)&&(this.lightDirection=!this.lightDirection)}render(){this.visible&&(this.gameMap.ctx.save(),this.gameMap.ctx.fillStyle="#f032e6",this.gameMap.ctx.globalAlpha=.2,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(this.paintX,this.paintY,this.lightSize*this.paintWidth/this.width,0,2*Math.PI),this.gameMap.ctx.fill(),this.gameMap.ctx.globalAlpha=1,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(this.paintX,this.paintY,this.paintWidth/2,0,2*Math.PI),this.gameMap.ctx.fill(),this.gameMap.ctx.restore())}}class k{constructor(t,i,e,s){this.x=t,this.y=i,this.speed=e,this.angle=s}}class F{constructor(t,i,e,s,h,a){this.cX=t,this.cY=i,this.lX=e,this.lY=s,this.rX=h,this.rY=a}set(t,i,e,s,h,a){this.cX=t,this.cY=i,this.lX=e,this.lY=s,this.rX=h,this.rY=a}}class A extends X{constructor(t,i){super(t,i),this.point=0,this.isSpeedUp=!1,this.status="idle",this.color=i.color,this.stopped=!1,this.head=[],this.visionAngle=170,this.closestSnakeDistance=5e3,this.closestFoodDistance=5e3,this.closestSnakeID="",this.foodID="",this.closestSnake={},this.closestFood={},this.seeSnake=!1,this.collidedV=!1,this.collidedH=!1,this.offset=-6,this.movementQueue=[],this.colliderIdx=0,this.colliders=[],this.speed=e,this.oldSpeed=e,this.turnSpeed=.2,this.vx=0,this.vy=0,this.toAngle=(i.angle||0)+s,this.angle=(i.angle||0)+s,this.length=i.length||0,this.isPlayer=i.isPlayer||!1,this.updateSize(),this.velocity(),this.calcHead()}resetSnake(){this.point=0,this.isSpeedUp=!1,this.status="idle",this.stopped=!1,this.foodsEated=new Map,this.head=[],this.visionAngle=170,this.closestSnakeDistance=5e3,this.closestFoodDistance=5e3,this.closestSnakeID="",this.foodID="",this.closestSnake={},this.closestFood={},this.seeSnake=!1,this.collidedV=!1,this.collidedH=!1,this.movementQueue=[],this.colliderIdx=0,this.speed=e,this.oldSpeed=e,this.turnSpeed=.2,this.vx=0,this.vy=0}setStatus(t){this.status=t}zeroFood(){this.closestFoodDistance=5e4,"eating"!==this.status&&"seefood"!==this.status||(this.status="idle")}zeroSnake(){this.closestSnakeDistance=5e4,this.closestSnakeID=""}setFood(t,i,e,s){this.closestFoodDistance=t,this.closestFood.x=i,this.closestFood.y=e,this.foodID=s,this.status="seefood"}setSnake(t,i,e,s){this.closestSnakeDistance=t,this.closestSnake.x=i,this.closestSnake.y=e,this.closestSnakeID=s}updateSize(t=0){this.width+=t,this.height+=t,this.length+=100*t,this.movementQueueLen=Math.ceil(this.length/this.oldSpeed)}directionTo(t){const i=Math.abs(this.toAngle%(2*Math.PI));let e=Math.floor(this.toAngle/(2*Math.PI));this.toAngle=t,i>=3*Math.PI/2&&this.toAngle<=Math.PI/2?e+=1:i<=Math.PI/2&&this.toAngle>=3*Math.PI/2&&(e-=1),this.toAngle+=e*Math.PI*2}moveTo(t,i,e=!1){if(e&&(this.collidedV||this.collidedH))return;const s=t-this.x,h=this.y-i,a=b(s,h);this.directionTo(a)}velocity(){const t=this.angle%(2*Math.PI),i=Math.abs(this.speed*Math.sin(t)),e=Math.abs(this.speed*Math.cos(t));t<Math.PI/2?(this.vx=i,this.vy=-e):t<Math.PI?(this.vx=i,this.vy=e):t<3*Math.PI/2?(this.vx=-i,this.vy=e):(this.vx=-i,this.vy=-e)}turnAround(){const t=this.toAngle-this.angle;if(Math.abs(t)<=this.turnSpeed*this.gameMap.scale){const{toAngle:t}=this;this.toAngle=s+t%(2*Math.PI),this.angle=s+t%(2*Math.PI)}else this.angle+=Math.sign(t)*this.turnSpeed*this.gameMap.scale}speedUp(){this.isSpeedUp||(this.isSpeedUp=!0,this.oldSpeed=this.speed,this.speed*=2)}speedDown(){this.isSpeedUp&&(this.isSpeedUp=!1,this.speed=this.oldSpeed)}eat(t,i){this.point+=i.point;const e=i.point/15;this.updateSize(e)}action(){this.colliderIdx=0,this.stopped||(this.movementQueue.push(new k(this.x,this.y,this.speed,this.angle)),this.movementQueue.length>this.movementQueueLen&&this.movementQueue.shift(),this.turnAround(),this.velocity(),this.x+=this.vx,this.y+=this.vy,this.calcHead(),this.x>2*this.width&&this.x<this.gameMap.width-2*this.width&&(this.collidedH=!1),this.y>2*this.height&&this.y<this.gameMap.height-2*this.height&&(this.collidedV=!1),this.gameMap.bounds.forEach((t,i)=>{if(y(this.head,t)){const t=T(this.angle%(2*Math.PI),this.speed);switch(i){case"UP":this.collideV||(this.moveTo(this.x+t.vx,this.y-t.vy),this.collidedV=!0);break;case"LEFT":case"RIGHT":this.collideH||(this.moveTo(this.x-t.vx,this.y+t.vy),this.collidedH=!0);break;default:this.collideV||(this.moveTo(this.x+t.vx,this.y-t.vy),this.collidedV=!0)}}}))}render(){this.gameMap.ctx.save(),this.gameMap.ctx.beginPath(),this.gameMap.ctx.moveTo(this.paintX,this.paintY);let t=this.length;if(this.movementQueue.length){let i=this.movementQueue.length-1;for(;i;){const e=this.movementQueue[i];let{x:s}=e,{y:h}=e,{angle:a}=e;if(t>0&&t<e.speed){const n=this.movementQueue[i+1]||this,o=t/e.speed;s=n.x-(n.x-s)*o,h=n.y-(n.y-h)*o,a=n.angle-(n.angle-a)*o}else if(t<0)break;i-=1,t-=e.speed,this.gameMap.ctx.lineTo(this.gameMap.view.relativeX(s),this.gameMap.view.relativeY(h));const n=P(s,h,s+.5*this.width,h,a),o=P(s,h,s-.5*this.width,h,a);this.addCollider(s,h,o.x,o.y,n.x,n.y)}}this.gameMap.ctx.lineCap="butt",this.gameMap.ctx.lineJoin="round",[,this.gameMap.ctx.strokeStyle]=this.color,this.gameMap.ctx.lineWidth=this.paintWidth,this.gameMap.ctx.shadowOffsetY=Math.round(4)/this.gameMap.scale,this.gameMap.ctx.shadowBlur=Math.round(7)/this.gameMap.scale,this.gameMap.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.gameMap.ctx.stroke(),this.gameMap.ctx.restore();let i=P(this.paintX,this.paintY,this.paintX-.5*this.paintWidth,this.paintY-this.paintHeight,this.angle),e=P(this.paintX,this.paintY,this.paintX+.5*this.paintWidth,this.paintY-this.paintHeight,this.angle),s=P(this.paintX,this.paintY,this.paintX+.5*this.paintWidth,this.paintY,this.angle),h=P(this.paintX,this.paintY,this.paintX-.5*this.paintWidth,this.paintY,this.angle);this.gameMap.ctx.save(),this.gameMap.ctx.beginPath(),this.gameMap.ctx.moveTo(i.x,i.y),this.gameMap.ctx.lineTo(e.x,e.y),this.gameMap.ctx.lineTo(s.x,s.y),this.gameMap.ctx.lineTo(h.x,h.y),this.gameMap.ctx.closePath(),[this.gameMap.ctx.fillStyle]=this.color,this.gameMap.ctx.shadowOffsetY=Math.round(4)/this.gameMap.scale,this.gameMap.ctx.shadowBlur=Math.round(7)/this.gameMap.scale,this.gameMap.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.gameMap.ctx.fill(),this.gameMap.ctx.restore(),this.gameMap.ctx.save(),this.gameMap.ctx.beginPath(),this.gameMap.ctx.moveTo(i.x,i.y+this.offset),this.gameMap.ctx.lineTo(e.x,e.y+this.offset),this.gameMap.ctx.lineTo(s.x,s.y+this.offset),this.gameMap.ctx.lineTo(h.x,h.y+this.offset),this.gameMap.ctx.closePath(),[this.gameMap.ctx.fillStyle]=this.color,this.gameMap.ctx.fill(),this.gameMap.ctx.restore(),i=P(this.paintX,this.paintY,this.paintX-.3*this.paintWidth,this.paintY-.8*this.paintHeight,this.angle),e=P(this.paintX,this.paintY,this.paintX+.3*this.paintWidth,this.paintY-.8*this.paintHeight,this.angle),s=P(this.paintX,this.paintY,this.paintX+.3*this.paintWidth,this.paintY-.2*this.paintHeight,this.angle),h=P(this.paintX,this.paintY,this.paintX-.3*this.paintWidth,this.paintY-.2*this.paintHeight,this.angle),this.gameMap.ctx.save(),this.gameMap.ctx.beginPath(),this.gameMap.ctx.moveTo(i.x,i.y+this.offset),this.gameMap.ctx.lineTo(e.x,e.y+this.offset),this.gameMap.ctx.lineTo(s.x,s.y+this.offset),this.gameMap.ctx.lineTo(h.x,h.y+this.offset),this.gameMap.ctx.closePath(),[,this.gameMap.ctx.fillStyle]=this.color,this.gameMap.ctx.fill(),this.gameMap.ctx.restore()}update(){this.prepare(),this.action(),this.render()}calcHead(){const t=P(this.x,this.y,this.x-.5*this.width,this.y-this.height,this.angle),i=P(this.x,this.y,this.x+.5*this.width,this.y-this.height,this.angle),e=P(this.x,this.y,this.x+.5*this.width,this.y,this.angle),s=P(this.x,this.y,this.x-.5*this.width,this.y,this.angle);this.head[0]=t.x,this.head[1]=t.y,this.head[2]=i.x,this.head[3]=i.y,this.head[4]=e.x,this.head[5]=e.y,this.head[6]=s.x,this.head[7]=s.y,this.addCollider(.5*(t.x+i.x),.5*(t.y+i.y),t.x,t.y,i.x,i.y),this.addCollider(this.x,this.y,s.x,s.y,e.x,e.y)}addCollider(t,i,e,s,h,a){this.colliderIdx+=1,this.colliderIdx>this.colliders.length-1?this.colliders.push(new F(t,i,e,s,h,a)):this.colliders[this.colliderIdx].set(t,i,e,s,h,a)}}const W=(t,i,e=1)=>{const s=document.createElement("canvas");s.width=t*e,s.height=i*e;const n=s.getContext("2d"),o=["#eee","#aaa"],l=h/e,c=a/e;for(let s=0,h=0;s<=t;s+=l,h+=1)for(let a=0,r=0;a<=i;a+=c,r+=1){const d=t*e-s,p=i*e-a,g=d<l?d:l,u=p<c?p:c;n.fillStyle=o[(h+r)%o.length],n.fillRect(s,a,g,u)}return n.lineWidth=3,n.strokeRect(0,0,t*e,i*e),s};class H{constructor(t,i,e){this.gameMap=t,this.margin=i,this.radius=e,this.image=document.createElement("canvas"),this.initImage()}initImage(){this.image.width=2*this.radius,this.image.height=2*this.radius,this.x=this.gameMap.view.width-2*this.radius-this.margin,this.y=this.gameMap.view.height-2*this.radius-this.margin,this.mapX=this.x+this.radius/2,this.mapY=this.y+this.radius/2;const t=this.image.getContext("2d");this.smallMapWidth=this.gameMap.width>this.gameMap.height?this.radius:this.gameMap.width*this.radius/this.gameMap.height,this.smallMapHeight=this.gameMap.width>this.gameMap.height?this.gameMap.height*this.radius/this.gameMap.width:this.radius;const i=this.radius-this.smallMapWidth/2,e=this.radius-this.smallMapHeight/2;t.save(),t.beginPath(),t.arc(this.radius,this.radius,this.radius-1,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.lineWidth=2,t.strokeStyle="#fff",t.stroke(),t.fillStyle="#ccc",t.fillRect(i,e,this.smallMapWidth,this.smallMapHeight),t.restore()}resize(){this.x=this.gameMap.view.width-2*this.radius-this.margin,this.y=this.gameMap.view.height-2*this.radius-this.margin,this.mapX=this.x+this.radius/2,this.mapY=this.y+this.radius/2}render(){const t=this.smallMapWidth/this.gameMap.paintWidth,i=this.smallMapWidth/this.gameMap.width,{ctx:e}=this.gameMap,s=this.gameMap.view.x*t+this.mapX,h=this.gameMap.view.y*t+this.mapY,a=this.gameMap.view.width*t,n=this.gameMap.view.height*t;e.save(),e.globalAlpha=.8,e.drawImage(this.image,this.x,this.y),e.strokeStyle="#fff",e.strokeRect(s,h,a,n),this.gameMap.units.forEach(t=>{const s=t.x*i+this.mapX,h=t.y*i+this.mapY;e.fillStyle="#f00",e.fillRect(s-2,h-2,4,4)}),e.restore()}}class D{constructor(t,i,e,s=0,h=0){this.width=i,this.height=e,this.x=s,this.y=h,this.gameMap=t}trace(t){this.x=t.x/this.gameMap.scale-this.width/2,this.y=t.y/this.gameMap.scale-this.height/2}absoluteX(t){return(t+this.x)*this.gameMap.scale}absoluteY(t){return(t+this.y)*this.gameMap.scale}relativeX(t){return t/this.gameMap.scale-this.x}relativeY(t){return t/this.gameMap.scale-this.y}relativeW(t){return t/this.gameMap.scale}relativeH(t){return t/this.gameMap.scale}}const z=window.requestAnimationFrame||window.webkitRequestAnimationFrame,C=new class extends p{constructor(e=document.createElement("canvas"),s=t,n=i,o=1){super(),this.canvas=e,this.width=t,this.height=i,this.bounds=new Map([["UP",[-50,0,t+50,0,t+50,-50,-50,-50]],["LEFT",[0,0,0,i,-50,i,-50,0]],["RIGHT",[t,0,t+50,0,t+50,i,t,i]],["DOWN",[-50,i,-50,i+50,t+50,i+50,t+50,i]]]),this.aviableColors=[],r.forEach(t=>this.aviableColors.push(t)),this.vWidth=s,this.vHeight=n,this.scale=o,this.canvas.width=s,this.canvas.height=n,this.ctx=this.canvas.getContext("2d"),this.paintSizeReset(),this.tileImage=W(8*h,8*a),this.view=new D(this,s,n),this.smallMap=new H(this,30,50),this.units=[],this.foods=[],this.foodEatedPool=[]}resize(t,i){this.vWidth=t,this.vHeight=i,this.canvas.width=t,this.canvas.height=i,this.view.width=t,this.view.height=i,this.smallMap.resize()}initUnits(e,s){this.player=new A(this,{x:S(50,t-50),y:S(50,i-50),size:n,length:o,angle:2*Math.random()*Math.PI,id:s,color:this.aviableColors.splice(S(0,this.aviableColors.length-1),1)[0],isPlayer:!0}),this.units.push(this.player);for(let s=e-1;s;s-=1)this.units.push(new A(this,{x:S(50,t-50),y:S(50,i-50),size:n,length:o,angle:2*Math.random()*Math.PI,color:this.aviableColors.splice(S(0,this.aviableColors.length-1),1)[0],id:`unit${s}`}))}initFoods(e){this.foodsOnFields=e;for(let s=0;s<e;s+=1)this.foods.push(new _(this,{size:c,point:1,x:S(c,t-c),y:S(c,i-c),id:s,onField:!0}))}setScale(t){this.scale!==t&&(this.scale=t<1?1:t,this.paintSizeReset(),this.emit("scale_changed"))}setToScale(t){this.toScale=t}relative(t){return t/this.scale}clear(){this.ctx.clearRect(0,0,this.view.width,this.view.height)}update(){this.checkCollisions(),this.toScale&&this.scale!==this.toScale&&this.setScale(this.toScale),this.ctx.clearRect(0,0,this.view.width,this.view.height),this.view.trace(this.player),this.render(),this.units.forEach(t=>{if(t.id!==this.player.id){if(t.closestSnakeDistance<3*t.width){t.zeroFood();const i=b(t.x-t.closestSnake.x,t.closestSnake.y-t.y);t.directionTo(i)}"eating"!==t.status&&"seefood"!==t.status||this.foods[t.foodID].onField||t.zeroFood(),"seefood"===t.status&&(t.setStatus("eating"),t.moveTo(t.closestFood.x,t.closestFood.y))}t.update()}),this.updateFood(),this.addFood(),this.units.forEach(t=>{const i=window.devicePixelRatio,e=Math.floor(.8*t.width/(i*this.scale));this.ctx.save(),this.ctx.translate(t.paintX,t.paintY),this.ctx.font="bold ".concat(e,"px Quicksand"),this.ctx.textAlign="center",this.ctx.textBaseline="bottom",[this.ctx.fillStyle]=t.color,this.ctx.fillText(t.id,0,-Math.round((t.width+10)/(i*this.scale))),this.ctx.restore()}),this.smallMap.render(),this.ctx.save(),this.ctx.translate(100,100),this.ctx.beginPath(),this.ctx.lineTo(10,-12),this.ctx.lineTo(14,-6),this.ctx.lineTo(12,4),this.ctx.lineTo(8,6),this.ctx.lineTo(6,12),this.ctx.lineTo(0,14),this.ctx.lineTo(-6,12),this.ctx.lineTo(-8,6),this.ctx.lineTo(-12,4),this.ctx.lineTo(-14,-6),this.ctx.lineTo(-10,-12),this.ctx.closePath(),this.ctx.arc(-6,-2,4,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.arc(6,-2,4,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.moveTo(0,2),this.ctx.lineTo(-4,6),this.ctx.lineTo(0,8),this.ctx.lineTo(4,6),this.ctx.closePath(),this.ctx.fillStyle="red",this.ctx.fill(),this.ctx.restore()}render(){const{view:t}=this,i=this.relative(this.tileImage.width),e=this.relative(this.tileImage.height),s=t.x<0?-t.x:-t.x%i,h=t.y<0?-t.y:-t.y%e,a=t.x+t.width>this.paintWidth?this.paintWidth-t.x:s+t.width+i,n=t.y+t.height>this.paintHeight?this.paintHeight-t.y:h+t.height+e;for(let t=s;t<=a;t+=i)for(let s=h;s<=n;s+=e){const h=a-t,o=n-s,l=h<i?h:i,c=o<e?o:e;this.ctx.drawImage(this.tileImage,0,0,l*this.scale,c*this.scale,t,s,l,c)}}paintSizeReset(){this.paintWidth=this.relative(this.width),this.paintHeight=this.relative(this.height)}checkCollisions(){this.units.forEach(t=>{t.zeroSnake(),this.units.forEach(i=>{if(t.id!==i.id)for(let e=i.colliders.length-1;e;e-=1){if(y(t.head,[i.colliders[e].lX,i.colliders[e].lY,i.colliders[e].rX,i.colliders[e].rY,i.colliders[e-1].rX,i.colliders[e-1].rY,i.colliders[e-1].lX,i.colliders[e-1].lY])){console.log("BAAM!!!");break}if(t.id!==this.player.id){const s=Math.round(i.colliders[e].cX-t.x),h=Math.round(i.colliders[e].cY-t.y),a=Math.abs(s)+Math.abs(h),n=I(t.x,t.y,i.colliders[e].cX,i.colliders[e].cY),o=Y(t.vx,t.vy);n<=o+t.visionAngle/2&&n>=o-t.visionAngle/2&&a<t.closestSnakeDistance&&t.setSnake(a,i.colliders[e].cX,i.colliders[e].cY,i.id)}}})})}updateFood(){for(let t=this.foods.length-1;t>0;t-=1){const i=this.foods[t];this.foods[t].onField&&(i.update(),this.units.forEach(e=>{if(w(e.head,i.x,i.y,.5*i.width))e.eat(i.id,i),i.onField=!1,this.foodsOnFields-=1,this.foodEatedPool.push(t),e.zeroFood();else if("idle"===e.status||"seefood"===e.status){const s=Math.round(i.x-e.x),h=Math.round(i.y-e.y),a=Math.abs(s)+Math.abs(h),n=I(e.x,e.y,i.x,i.y),o=Y(e.vx,e.vy);n<=o+e.visionAngle/2&&n>=o-e.visionAngle/2&&a<e.closestFoodDistance&&e.setFood(a,i.x,i.y,t)}}))}}addFood(){if(this.foodsOnFields<500){const e=this.foodEatedPool.pop();e&&(this.foodsOnFields+=1,this.foods[e].onField=!0,this.foods[e].x=S(c,t-c),this.foods[e].y=S(c,i-c))}}}(document.getElementById("cas"),window.innerWidth,window.innerHeight);let E=!1;const L={},O=0;let R,Q=+new Date;function U(){const t=+new Date;t-Q>O&&(Q=t,E&&C.scale<2?C.setToScale(C.scale+.1):C.scale>1&&!E&&C.setToScale(C.scale-.1),C.update()),z(U)}C.initUnits(6,"player"),[R]=C.units.filter(t=>"player"===t.id),C.initFoods(l),function(){function t(t){if(t.preventDefault(),t.touches)L.x=t.touches[0].pageX,L.y=t.touches[0].pageY;else{const i=t||window.event;L.x=i.clientX,L.y=i.clientY}const i=(L.x+C.view.x)*C.scale,e=(L.y+C.view.y)*C.scale;R.moveTo(i,e,!0)}window.addEventListener("resize",()=>{const t=window.innerWidth,i=window.innerHeight;C.resize(t,i)}),navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)?(window.addEventListener("touchstart",t),window.addEventListener("touchmove",t)):(window.addEventListener("mousemove",t),window.addEventListener("mousedown",()=>{R.speedUp(),E=!0}),window.addEventListener("mouseup",()=>{R.speedDown(),E=!1}))}(),U()}();
//# sourceMappingURL=bundle.js.map
