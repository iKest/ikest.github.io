!function(){"use strict";const t=5e3,e=5e3,i=5,s=180*Math.PI,h=200,a=200,n=40,o=200,r=2e3,l=(t,e)=>{let i=t+Math.random()*(e+1-t);return i=Math.floor(i)},c=(t,e,i)=>{const s=t.x-e.x,h=t.y-e.y,a=t.width+e.width;return!(Math.abs(s)>a||Math.abs(h)>t.height+e.height)&&(!!i||Math.hypot(s,h)<a/2)},p=(t,e)=>{let i=Math.atan(Math.abs(t/e));return t>0&&e<0?i=Math.PI-i:t<0&&e<0?i=Math.PI+i:t<0&&e>0&&(i=2*Math.PI-i),i},d=(t,e,i)=>{return{x:Math.round(Math.cos(i)*(e.x-t.x)-Math.sin(i)*(e.y-t.y)+t.x),y:Math.round(Math.sin(i)*(e.x-t.x)+Math.cos(i)*(e.y-t.y)+t.y)}},g=(t,e,i=1)=>{const s=document.createElement("canvas");s.width=t*i,s.height=e*i;const n=s.getContext("2d"),o=["#eee","#aaa"],r=h/i,l=a/i;for(let s=0,h=0;s<=t;s+=r,h+=1)for(let a=0,c=0;a<=e;a+=l,c+=1){const p=t*i-s,d=e*i-a,g=p<r?p:r,u=d<l?d:l;n.fillStyle=o[(h+c)%o.length],n.fillRect(s,a,g,u)}return n.lineWidth=3,n.strokeRect(0,0,t*i,e*i),s};class u{constructor(t,e=n,i=n){this.width=e,this.height=i,this.ctx=t,this.angle=0,this.x=0,this.y=0}setSize(t,e){this.width=t,this.height=e}render(t,e,i){const s={x:t-.5*this.width,y:e-this.height},h={x:t+.5*this.width,y:e-this.height},a={x:t+.5*this.width,y:e},n={x:t-.5*this.width,y:e},o={x:t,y:e};let r=d(o,s,i),l=d(o,h,i),c=d(o,a,i),p=d(o,n,i);this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(r.x,r.y),this.ctx.lineTo(l.x,l.y),this.ctx.lineTo(c.x,c.y),this.ctx.lineTo(p.x,p.y),this.ctx.closePath(),this.ctx.fillStyle="blue",this.ctx.shadowOffsetY=4,this.ctx.shadowColor="red",this.ctx.fill(),this.ctx.restore(),s.x=t-.5*this.width+.2*this.width,s.y=e-this.height+.2*this.height,h.x=t+.5*this.width-.2*this.width,h.y=e-this.height+.2*this.height,a.x=t+.5*this.width-.2*this.width,a.y=e-.2*this.height,n.x=t-.5*this.width+.2*this.width,n.y=e-.2*this.height,r=d(o,s,i),l=d(o,h,i),c=d(o,a,i),p=d(o,n,i),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(r.x,r.y),this.ctx.lineTo(l.x,l.y),this.ctx.lineTo(c.x,c.y),this.ctx.lineTo(p.x,p.y),this.ctx.closePath(),this.ctx.fillStyle="white",this.ctx.fill(),this.ctx.restore()}}var v,m=(function(t){var e=Object.prototype.hasOwnProperty,i="~";function s(){}function h(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,s,h=[];if(0===this._eventsCount)return h;for(s in t=this._events)e.call(t,s)&&h.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(t)):h},a.prototype.listeners=function(t,e){var s=i?i+t:t,h=this._events[s];if(e)return!!h;if(!h)return[];if(h.fn)return[h.fn];for(var a=0,n=h.length,o=new Array(n);a<n;a++)o[a]=h[a].fn;return o},a.prototype.emit=function(t,e,s,h,a,n){var o=i?i+t:t;if(!this._events[o])return!1;var r,l,c=this._events[o],p=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),p){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,s),!0;case 4:return c.fn.call(c.context,e,s,h),!0;case 5:return c.fn.call(c.context,e,s,h,a),!0;case 6:return c.fn.call(c.context,e,s,h,a,n),!0}for(l=1,r=new Array(p-1);l<p;l++)r[l-1]=arguments[l];c.fn.apply(c.context,r)}else{var d,g=c.length;for(l=0;l<g;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),p){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,s);break;case 4:c[l].fn.call(c[l].context,e,s,h);break;default:if(!r)for(d=1,r=new Array(p-1);d<p;d++)r[d-1]=arguments[d];c[l].fn.apply(c[l].context,r)}}return!0},a.prototype.on=function(t,e,s){var a=new h(e,s||this),n=i?i+t:t;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],a]:this._events[n].push(a):(this._events[n]=a,this._eventsCount++),this},a.prototype.once=function(t,e,s){var a=new h(e,s||this,!0),n=i?i+t:t;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],a]:this._events[n].push(a):(this._events[n]=a,this._eventsCount++),this},a.prototype.removeListener=function(t,e,h,a){var n=i?i+t:t;if(!this._events[n])return this;if(!e)return 0==--this._eventsCount?this._events=new s:delete this._events[n],this;var o=this._events[n];if(o.fn)o.fn!==e||a&&!o.once||h&&o.context!==h||(0==--this._eventsCount?this._events=new s:delete this._events[n]);else{for(var r=0,l=[],c=o.length;r<c;r++)(o[r].fn!==e||a&&!o[r].once||h&&o[r].context!==h)&&l.push(o[r]);l.length?this._events[n]=1===l.length?l[0]:l:0==--this._eventsCount?this._events=new s:delete this._events[n]}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&(0==--this._eventsCount?this._events=new s:delete this._events[e])):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},a.prefixed=i,a.EventEmitter=a,t.exports=a}(v={exports:{}},v.exports),v.exports);class x{constructor(t,e,i){this.gameMap=t,this.margin=e,this.radius=i,this.image=document.createElement("canvas"),this.initImage()}initImage(){this.image.width=2*this.radius,this.image.height=2*this.radius,this.x=this.gameMap.view.width-2*this.radius-this.margin,this.y=this.gameMap.view.height-2*this.radius-this.margin,this.mapX=this.x+this.radius/2,this.mapY=this.y+this.radius/2;const t=this.image.getContext("2d");this.smallMapWidth=this.gameMap.width>this.gameMap.height?this.radius:this.gameMap.width*this.radius/this.gameMap.height,this.smallMapHeight=this.gameMap.width>this.gameMap.height?this.gameMap.height*this.radius/this.gameMap.width:this.radius;const e=this.radius-this.smallMapWidth/2,i=this.radius-this.smallMapHeight/2;t.save(),t.beginPath(),t.arc(this.radius,this.radius,this.radius-1,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.lineWidth=2,t.strokeStyle="#fff",t.stroke(),t.fillStyle="#ccc",t.fillRect(e,i,this.smallMapWidth,this.smallMapHeight),t.restore()}render(){const t=this.smallMapWidth/this.gameMap.paintWidth,{ctx:e}=this.gameMap,i=this.gameMap.view.x*t+this.mapX,s=this.gameMap.view.y*t+this.mapY,h=this.gameMap.view.width*t,a=this.gameMap.view.height*t;e.save(),e.globalAlpha=.8,e.drawImage(this.image,this.x,this.y),e.fillStyle="#f00",e.fillRect(i+h/2-2,s+a/2-2,4,4),e.restore()}}class w{constructor(t,e,i,s=0,h=0){this.width=e,this.height=i,this.x=s,this.y=h,this.gameMap=t}trace(t){this.x=t.x/this.gameMap.scale-this.width/2,this.y=t.y/this.gameMap.scale-this.height/2}absoluteX(t){return(t+this.x)*this.gameMap.scale}absoluteY(t){return(t+this.y)*this.gameMap.scale}relativeX(t){return t/this.gameMap.scale-this.x}relativeY(t){return t/this.gameMap.scale-this.y}relativeW(t){return t/this.gameMap.scale}relativeH(t){return t/this.gameMap.scale}}class f extends m{constructor(i,s,n,o=1){super(),this.canvas=i,this.width=t,this.height=e,this.vWidth=s,this.vHeight=n,this.scale=o,this.canvas.width=s,this.canvas.height=n,this.ctx=this.canvas.getContext("2d"),this.paintSizeReset(),this.tileImage=g(8*h,8*a),this.view=new w(this,s,n),this.smallMap=new x(this,30,50)}setScale(t){this.scale!==t&&(this.scale=t<1?1:t,this.paintSizeReset(),this.emit("scale_changed"))}setToScale(t){this.toScale=t}relative(t){return t/this.scale}clear(){this.ctx.clearRect(0,0,this.view.width,this.view.height)}update(t,e){this.toScale&&this.scale!==this.toScale&&this.setScale(this.toScale),this.clear(),this.view.trace(t),this.render(),e(),this.smallMap.render()}limit(t){const e=t,i=(e.width||1)/2;e.x<i?e.x=i:e.x+i>this.width&&(e.x=this.width-i);const s=(e.height||1)/2;e.y<s?e.y=s:e.y+s>this.height&&(e.y=this.height-s)}render(){const{view:t}=this,e=this.relative(this.tileImage.width),i=this.relative(this.tileImage.height),s=t.x<0?-t.x:-t.x%e,h=t.y<0?-t.y:-t.y%i,a=t.x+t.width>this.paintWidth?this.paintWidth-t.x:s+t.width+e,n=t.y+t.height>this.paintHeight?this.paintHeight-t.y:h+t.height+i;for(let t=s;t<=a;t+=e)for(let s=h;s<=n;s+=i){const h=a-t,o=n-s,r=h<e?h:e,l=o<i?o:i;this.ctx.drawImage(this.tileImage,0,0,r*this.scale,l*this.scale,t,s,r,l)}}paintSizeReset(){this.paintWidth=this.relative(this.width),this.paintHeight=this.relative(this.height)}}let M;const y=(i=document.createElement("canvas"),s=t,h=e,a=1)=>(M||(M=new f(i,s,h,a)),M);class S{constructor(t){if(this.gameMap=y(),this.x=+(t.x||0),this.y=+(t.y||0),this.width=t.size||t.width||0,this.height=t.size||t.height||0,!this.width||!this.height)throw new Error("element size can not be undefined")}prepare(){this.paintX=this.gameMap.view.relativeX(this.x),this.paintY=this.gameMap.view.relativeY(this.y),this.paintWidth=this.gameMap.view.relativeW(this.width),this.paintHeight=this.gameMap.view.relativeH(this.height);const t=this.paintWidth/2,e=this.paintHeight/2;this.visible=this.paintX+t>0&&this.paintX-t<this.gameMap.view.width&&this.paintY+e>0&&this.paintY-e<this.gameMap.view.height}}class _{constructor(t,e,i,s){this.x=t,this.y=e,this.speed=i,this.angle=s}}class b extends S{constructor(t){super(t),this.point=0,this.isSpeedUp=!1,this.fillColor="",this.stopped=!1,this.movementQueue=[],this.speed=i,this.oldSpeed=i,this.turnSpeed=.1,this.vx=0,this.vy=0,this.fillColor=t.fillColor||"#fff",this.toAngle=(t.angle||0)+s,this.angle=(t.angle||0)+s,this.length=t.length||0,this.header=new u(this.gameMap.ctx),this.updateSize(),this.velocity()}updateSize(t=0){this.width+=t,this.height+=t,this.length+=50*t,this.header.setSize(this.width,this.height),this.movementQueueLen=Math.ceil(this.length/this.oldSpeed)}moveTo(t,e){const i=t-this.x,s=this.y-e,h=p(i,s),a=Math.abs(this.toAngle%(2*Math.PI));let n=Math.floor(this.toAngle/(2*Math.PI));this.toAngle=h,a>=3*Math.PI/2&&this.toAngle<=Math.PI/2?n+=1:a<=Math.PI/2&&this.toAngle>=3*Math.PI/2&&(n-=1),this.toAngle+=n*Math.PI*2}velocity(){const t=this.angle%(2*Math.PI),e=Math.abs(this.speed*Math.sin(t)),i=Math.abs(this.speed*Math.cos(t));t<Math.PI/2?(this.vx=e,this.vy=-i):t<Math.PI?(this.vx=e,this.vy=i):t<3*Math.PI/2?(this.vx=-e,this.vy=i):(this.vx=-e,this.vy=-i)}turnAround(){const t=this.toAngle-this.angle;if(Math.abs(t)<=this.turnSpeed){const{toAngle:t}=this;this.toAngle=s+t%(2*Math.PI),this.angle=s+t%(2*Math.PI)}else this.angle+=Math.sign(t)*this.turnSpeed}speedUp(){this.isSpeedUp||(this.isSpeedUp=!0,this.oldSpeed=this.speed,this.speed*=2)}speedDown(){this.isSpeedUp&&(this.isSpeedUp=!1,this.speed=this.oldSpeed)}eat(t){this.point+=t.point;const e=t.point/200;return this.updateSize(e),e}action(){this.stopped||(this.movementQueue.push(new _(this.x,this.y,this.speed,this.angle)),this.movementQueue.length>this.movementQueueLen&&this.movementQueue.shift(),this.turnAround(),this.velocity(),this.x+=this.vx,this.y+=this.vy,this.gameMap.limit(this))}render(){this.gameMap.ctx.save(),this.gameMap.ctx.beginPath(),this.gameMap.ctx.moveTo(this.paintX,this.paintY);let t=this.length;if(this.movementQueue.length){let e=this.movementQueue.length-1;for(;e;){const i=this.movementQueue[e];let{x:s}=i,{y:h}=i;if(t>0&&t<i.speed){const a=this.movementQueue[e+1]||this,n=t/i.speed;s=a.x-(a.x-s)*n,h=a.y-(a.y-h)*n}else if(t<0)break;e-=1,t-=i.speed,this.gameMap.ctx.lineTo(this.gameMap.view.relativeX(s),this.gameMap.view.relativeY(h))}}this.gameMap.ctx.lineCap="butt",this.gameMap.ctx.lineJoin="round",this.gameMap.ctx.strokeStyle=this.fillColor,this.gameMap.ctx.lineWidth=this.width,this.gameMap.ctx.shadowOffsetY=Math.round(4),this.gameMap.ctx.shadowBlur=Math.round(7),this.gameMap.ctx.shadowColor="gray",this.gameMap.ctx.stroke(),this.gameMap.ctx.restore(),this.header.render(this.paintX,this.paintY,this.angle)}update(){this.prepare(),this.action(),this.render()}}class P extends S{constructor(t){super(t),this.lightDirection=!0,this.point=t.point,this.lightSize=this.width/2}update(){this.prepare(),this.action(),this.render()}action(){if(!this.visible)return;this.lightSize+=this.lightDirection?1:-1,(this.lightSize>this.width||this.lightSize<this.width/2)&&(this.lightDirection=!this.lightDirection)}render(){this.visible&&(this.gameMap.ctx.fillStyle="#fff",this.gameMap.ctx.globalAlpha=.2,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(this.paintX,this.paintY,this.lightSize*this.paintWidth/this.width,0,2*Math.PI),this.gameMap.ctx.fill(),this.gameMap.ctx.globalAlpha=1,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(this.paintX,this.paintY,this.paintWidth/2,0,2*Math.PI),this.gameMap.ctx.fill())}}const I=window.requestAnimationFrame||window.webkitRequestAnimationFrame,A=document.getElementById("cas"),C=window.innerWidth,W=window.innerHeight,z=y(A,C,W);let Y;const X={},E=new Map,L=[],T=0;let H=+new Date;function k(){const t=+new Date;t-H>T&&(H=t,z.update(Y,()=>{E.forEach(t=>{t.update()}),Y.update(),L.forEach(t=>{if(t.update(),!t.visible||!c(Y,t))return;const e=Y.eat(t);L.splice(L.indexOf(t),1);const i=z.scale+e/(4*Y.width);i<1.4&&z.setToScale(i)})})),I(k)}!function(i,s){Y=new b({x:i,y:s,size:n,length:o,angle:2*Math.random()*Math.PI,fillColor:"#00FF00"});for(let i=0;i<r;i+=1){const i=Math.floor(30*Math.random()+50),s=Math.floor(i/3);L.push(new P({size:s,point:i,x:l(s,t-s),y:l(s,e-s)}))}(function(){navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)?(window.addEventListener("touchstart",t),window.addEventListener("touchmove",t)):(window.addEventListener("mousemove",t),window.addEventListener("mousedown",()=>{Y.speedUp()}),window.addEventListener("mouseup",()=>{Y.speedDown()}));function t(t){if(t.preventDefault(),t.touches)X.x=t.touches[0].pageX,X.y=t.touches[0].pageY;else{const e=t||window.event;X.x=e.clientX,X.y=e.clientY}const e=(X.x+z.view.x)*z.scale,i=(X.y+z.view.y)*z.scale;Y.moveTo(e,i)}})(),k()}(l(50,t-50),l(50,e-50))}();
//# sourceMappingURL=bundle.js.map
