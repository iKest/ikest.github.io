!function(){"use strict";window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),function(){function t(t){t&&(t.setTargetAtTime||(t.setTargetAtTime=t.setTargetValueAtTime))}window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=webkitAudioContext,AudioContext.prototype.hasOwnProperty("createGain")||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),AudioContext.prototype.hasOwnProperty("createDelay")||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),AudioContext.prototype.hasOwnProperty("createScriptProcessor")||(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),AudioContext.prototype.hasOwnProperty("createPeriodicWave")||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var e=this.internal_createGain();return t(e.gain),e},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(e){var i=e?this.internal_createDelay(e):this.internal_createDelay();return t(i.delayTime),i},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var e=this.internal_createBufferSource();return e.start?(e.internal_start=e.start,e.start=function(t,i,n){void 0!==n?e.internal_start(t||0,i,n):e.internal_start(t||0,i||0)}):e.start=function(t,e,i){e||i?this.noteGrainOn(t||0,e,i):this.noteOn(t||0)},e.stop?(e.internal_stop=e.stop,e.stop=function(t){e.internal_stop(t||0)}):e.stop=function(t){this.noteOff(t||0)},t(e.playbackRate),e},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var e=this.internal_createDynamicsCompressor();return t(e.threshold),t(e.knee),t(e.ratio),t(e.reduction),t(e.attack),t(e.release),e},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var e=this.internal_createBiquadFilter();return t(e.frequency),t(e.detune),t(e.Q),t(e.gain),e},AudioContext.prototype.hasOwnProperty("createOscillator")&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var e=this.internal_createOscillator();return e.start?(e.internal_start=e.start,e.start=function(t){e.internal_start(t||0)}):e.start=function(t){this.noteOn(t||0)},e.stop?(e.internal_stop=e.stop,e.stop=function(t){e.internal_stop(t||0)}):e.stop=function(t){this.noteOff(t||0)},e.setPeriodicWave||(e.setPeriodicWave=e.setWaveTable),t(e.frequency),t(e.detune),e})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=webkitOfflineAudioContext)}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function t(t,e){return t(e={exports:{}},e.exports),e.exports}var e=t(function(t,e){var i;t.exports=((i=function(){var t=0,e=document.createElement("div");function n(t){return e.appendChild(t.dom),t}function r(i){for(var n=0;n<e.children.length;n++)e.children[n].style.display=n===i?"block":"none";t=i}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(i){i.preventDefault(),r(++t%e.children.length)},!1);var s=(performance||Date).now(),a=s,o=0,h=n(new i.Panel("FPS","#0ff","#002")),l=n(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=n(new i.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:n,showPanel:r,begin:function(){s=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(l.update(t-s,200),a+1e3<=t&&(h.update(1e3*o/(t-a),100),a=t,o=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){s=this.end()},domElement:e,setMode:r}}).Panel=function(t,e,i){var n=1/0,r=0,s=Math.round,a=s(window.devicePixelRatio||1),o=80*a,h=48*a,l=3*a,c=2*a,u=3*a,d=15*a,p=74*a,f=30*a,g=document.createElement("canvas");g.width=o,g.height=h,g.style.cssText="width:80px;height:48px";var y=g.getContext("2d");return y.font="bold "+9*a+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=i,y.fillRect(0,0,o,h),y.fillStyle=e,y.fillText(t,l,c),y.fillRect(u,d,p,f),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(u,d,p,f),{dom:g,update:function(h,m){n=Math.min(n,h),r=Math.max(r,h),y.fillStyle=i,y.globalAlpha=1,y.fillRect(0,0,o,d),y.fillStyle=e,y.fillText(s(h)+" "+t+" ("+s(n)+"-"+s(r)+")",l,c),y.drawImage(g,u+a,d,p-a,f,u,d,p-a,f),y.fillRect(u+p-a,d,a,f),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(u+p-a,d,a,s((1-h/m)*f))}}},i)}),i=Object.prototype.hasOwnProperty,n=Array.isArray,r=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),s=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)void 0!==t[n]&&(i[n]=t[n]);return i},a={arrayToObject:s,assign:function(t,e){return Object.keys(e).reduce(function(t,i){return t[i]=e[i],t},t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],r=0;r<e.length;++r)for(var s=e[r],a=s.obj[s.prop],o=Object.keys(a),h=0;h<o.length;++h){var l=o[h],c=a[l];"object"==typeof c&&null!==c&&-1===i.indexOf(c)&&(e.push({obj:a,prop:l}),i.push(c))}return function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(n(i)){for(var r=[],s=0;s<i.length;++s)void 0!==i[s]&&r.push(i[s]);e.obj[e.prop]=r}}}(e),t},decode:function(t,e,i){var n=t.replace(/\+/g," ");if("iso-8859-1"===i)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(t){return n}},encode:function(t,e,i){if(0===t.length)return t;var n="string"==typeof t?t:String(t);if("iso-8859-1"===i)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});for(var s="",a=0;a<n.length;++a){var o=n.charCodeAt(a);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?s+=n.charAt(a):o<128?s+=r[o]:o<2048?s+=r[192|o>>6]+r[128|63&o]:o<55296||o>=57344?s+=r[224|o>>12]+r[128|o>>6&63]+r[128|63&o]:(a+=1,o=65536+((1023&o)<<10|1023&n.charCodeAt(a)),s+=r[240|o>>18]+r[128|o>>12&63]+r[128|o>>6&63]+r[128|63&o])}return s},isBuffer:function(t){return!(!t||"object"!=typeof t||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},merge:function t(e,r,a){if(!r)return e;if("object"!=typeof r){if(n(e))e.push(r);else{if(!e||"object"!=typeof e)return[e,r];(a&&(a.plainObjects||a.allowPrototypes)||!i.call(Object.prototype,r))&&(e[r]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(r);var o=e;return n(e)&&!n(r)&&(o=s(e,a)),n(e)&&n(r)?(r.forEach(function(n,r){if(i.call(e,r)){var s=e[r];s&&"object"==typeof s&&n&&"object"==typeof n?e[r]=t(s,n,a):e.push(n)}else e[r]=n}),e):Object.keys(r).reduce(function(e,n){var s=r[n];return i.call(e,n)?e[n]=t(e[n],s,a):e[n]=s,e},o)}},o=String.prototype.replace,h=/%20/g,l={default:"RFC3986",formatters:{RFC1738:function(t){return o.call(t,h,"+")},RFC3986:function(t){return t}},RFC1738:"RFC1738",RFC3986:"RFC3986"},c=(Object.prototype.hasOwnProperty,Array.isArray,Array.prototype.push,Date.prototype.toISOString),u=(l.formatters[l.default],Object.prototype.hasOwnProperty),d={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:a.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},p=function(t){return t.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},f=function(t,e,i){if(t){var n=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,r=/(\[[^[\]]*])/g,s=/(\[[^[\]]*])/.exec(n),a=s?n.slice(0,s.index):n,o=[];if(a){if(!i.plainObjects&&u.call(Object.prototype,a)&&!i.allowPrototypes)return;o.push(a)}for(var h=0;null!==(s=r.exec(n))&&h<i.depth;){if(h+=1,!i.plainObjects&&u.call(Object.prototype,s[1].slice(1,-1))&&!i.allowPrototypes)return;o.push(s[1])}return s&&o.push("["+n.slice(s.index)+"]"),function(t,e,i){for(var n=e,r=t.length-1;r>=0;--r){var s,a=t[r];if("[]"===a&&i.parseArrays)s=[].concat(n);else{s=i.plainObjects?Object.create(null):{};var o="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,h=parseInt(o,10);i.parseArrays||""!==o?!isNaN(h)&&a!==o&&String(h)===o&&h>=0&&i.parseArrays&&h<=i.arrayLimit?(s=[])[h]=n:s[o]=n:s={0:n}}n=s}return n}(o,e,i)}},g=function(t,e){var i=function(t){if(!t)return d;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?d.charset:t.charset;return{allowDots:void 0===t.allowDots?d.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:d.allowPrototypes,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:d.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:d.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:d.comma,decoder:"function"==typeof t.decoder?t.decoder:d.decoder,delimiter:"string"==typeof t.delimiter||a.isRegExp(t.delimiter)?t.delimiter:d.delimiter,depth:"number"==typeof t.depth?t.depth:d.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:d.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:d.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:d.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:d.strictNullHandling}}(e);if(""===t||null==t)return i.plainObjects?Object.create(null):{};for(var n="string"==typeof t?function(t,e){var i,n={},r=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,s=e.parameterLimit===1/0?void 0:e.parameterLimit,o=r.split(e.delimiter,s),h=-1,l=e.charset;if(e.charsetSentinel)for(i=0;i<o.length;++i)0===o[i].indexOf("utf8=")&&("utf8=%E2%9C%93"===o[i]?l="utf-8":"utf8=%26%2310003%3B"===o[i]&&(l="iso-8859-1"),h=i,i=o.length);for(i=0;i<o.length;++i)if(i!==h){var c,f,g=o[i],y=g.indexOf("]="),m=-1===y?g.indexOf("="):y+1;-1===m?(c=e.decoder(g,d.decoder,l),f=e.strictNullHandling?null:""):(c=e.decoder(g.slice(0,m),d.decoder,l),f=e.decoder(g.slice(m+1),d.decoder,l)),f&&e.interpretNumericEntities&&"iso-8859-1"===l&&(f=p(f)),f&&e.comma&&f.indexOf(",")>-1&&(f=f.split(",")),u.call(n,c)?n[c]=a.combine(n[c],f):n[c]=f}return n}(t,i):t,r=i.plainObjects?Object.create(null):{},s=Object.keys(n),o=0;o<s.length;++o){var h=s[o],l=f(h,n[h],i);r=a.merge(r,l,i)}return a.compact(r)};const y=1e4,m=.4,v=5e-6,x=.01,w=.005,b=.5,A=5e-5*Math.PI,M=40,_=0,S=20,P=-6,Y=0,X=4,C=7,E=.3,k=300,B=1e3,T=150,R=!1;var O=t(function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function s(t,e,n,s,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new r(n,s||t,a),h=i?i+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],o]:t._events[h].push(o):(t._events[h]=o,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),o.prototype.eventNames=function(){var t,n,r=[];if(0===this._eventsCount)return r;for(n in t=this._events)e.call(t,n)&&r.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},o.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,s=n.length,a=new Array(s);r<s;r++)a[r]=n[r].fn;return a},o.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},o.prototype.emit=function(t,e,n,r,s,a){var o=i?i+t:t;if(!this._events[o])return!1;var h,l,c=this._events[o],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,r),!0;case 5:return c.fn.call(c.context,e,n,r,s),!0;case 6:return c.fn.call(c.context,e,n,r,s,a),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var d,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,n);break;case 4:c[l].fn.call(c[l].context,e,n,r);break;default:if(!h)for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];c[l].fn.apply(c[l].context,h)}}return!0},o.prototype.on=function(t,e,i){return s(this,t,e,i,!1)},o.prototype.once=function(t,e,i){return s(this,t,e,i,!0)},o.prototype.removeListener=function(t,e,n,r){var s=i?i+t:t;if(!this._events[s])return this;if(!e)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==e||r&&!o.once||n&&o.context!==n||a(this,s);else{for(var h=0,l=[],c=o.length;h<c;h++)(o[h].fn!==e||r&&!o[h].once||n&&o[h].context!==n)&&l.push(o[h]);l.length?this._events[s]=1===l.length?l[0]:l:a(this,s)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&a(this,e)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o});const I=function(t,e,i){return e===i?0:e<i?-t:null==e?1:null==i?-1:t},F=function(t,e,i,n,r,s){return j(t(r),t(s),e,i,n,r,s)},L=function(t,e,i,n,r,s){return j(r[t],s[t],e,i,n,r,s)},D=function(t,e,i,n,r,s){const a=t.asc||t.desc,o=t.asc?1:-1;if(!a)throw Error("sort: Invalid 'by' sorting configuration.\n      Expecting object with 'asc' or 'desc' key");return U(a)(a,e,i,o,r,s)},U=function(t){const e=typeof t;return"string"===e?L:"function"===e?F:D},j=function(t,e,i,n,r,s,a){if(t===e||null==t&&null==e){if(i.length>n){return U(i[n])(i[n],i,n+1,r,s,a)}return 0}return I(r,t,e)},W=function(t,e,i){if(!Array.isArray(e))return e;let n;return Array.isArray(i)&&i.length<2&&([i]=i),n=i?"string"==typeof i?function(t,e,i,n){return I(t,i[e],n[e])}.bind(void 0,t,i):"function"==typeof i?function(t,e,i,n){return I(t,e(i),e(n))}.bind(void 0,t,i):U(i[0]).bind(void 0,i.shift(),i,0,t):I.bind(void 0,t),e.sort(n)};var V=function(t){return{asc:e=>W(1,t,e),desc:e=>W(-1,t,e),by:e=>{if(!Array.isArray(t))return t;if(!Array.isArray(e))throw Error("sort: Invalid usage of 'by' sorter. Array syntax is required.\n          Did you mean to use 'asc' or 'desc' sorter instead?");if(1===e.length){const i=e[0].asc?1:-1,n=e[0].asc||e[0].desc;if(!n)throw Error("sort: Invalid 'by' sorting configuration.\n            Expecting object with 'asc' or 'desc' key");return W(i,t,n)}const i=D.bind(void 0,e.shift(),e,0,void 0);return t.sort(i)}}},z=function(t,e,i,n,r){var s=n-t,a=r-e;return s*s+a*a<=i*i},H=function(t,e,i,n,r,s,a){var o=[r-t,s-e],h=[i-t,n-e],l=$(h,h),c=$(o,h)/l,u=[h[0]*(c=(c=c<0?0:c)>1?1:c)+t-r,h[1]*c+e-s];return $(u,u)<=a*a};function $(t,e){return t[0]*e[0]+t[1]*e[1]}var q=function(t,e,i,n,r,s,a){var o=i/2,h=n/2,l=Math.abs(r-(t+i/2)),c=Math.abs(s-(e+n/2));if(l>o+a||c>h+a)return!1;if(l<=o||c<=h)return!0;var u=l-o,d=c-h;return u*u+d*d<=a*a};function N(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))}var Q,G,J,K=function(t,e,i,n,r,s,a){return a=a||1,Math.abs(N(t,e,i,n)-(N(t,e,r,s)+N(i,n,r,s)))<=a},Z=function(t,e,i,n){var r,s,a=t.length,o=!1;for(r=0,s=a-2;r<a;r+=2)t[r+1]>i!=t[s+1]>i&&e<(t[s]-t[r])*(i-t[r+1])/(t[s+1]-t[r+1])+t[r]&&(o=!o),s=r;if(o)return!0;for(r=0;r<a;r+=2){var h,l,c=t[r],u=t[r+1];if(r===a-2?(h=t[0],l=t[1]):(h=t[r+2],l=t[r+3]),K(c,u,h,l,e,i,n))return!0}return!1},tt=function(t,e,i,n){if(Z(t,e,i))return!0;for(var r=t.length,s=0;s<r-2;s+=2)if(H(t[s],t[s+1],t[s+2],t[s+3],e,i,n))return!0;return H(t[0],t[1],t[r-2],t[r-1],e,i,n)},et=10;function it(){Q=[],G=[];for(var t=0;t<=et;t++){var e=4<<t;Q[t]=.5/Math.cos(4*Math.acos(0)/e),G[t]=.5/(Math.cos(2*Math.acos(0)/e)*Math.cos(2*Math.acos(0)/e))}J=!0}function nt(t,e,i,n,r,s,a){for(var o=1;o<=et;o++){var h=(i+r)*Q[o],l=(n+s)*Q[o],c=t-h,u=e-l;if(c*c+u*u<=a)return!0;var d=r-h,p=s-l;if(c*d+u*p>=0&&c*d+u*p<=d*d+p*p&&(u*d-c*p>=0||a*(d*d+p*p)>=(u*d-c*p)*(u*d-c*p)))return!0;var f=i-h,g=n-l;if(c*f+u*g>=0&&c*f+u*g<=f*f+g*g&&(u*f-c*g<=0||a*(f*f+g*g)>=(u*f-c*g)*(u*f-c*g)))return!0;var y=(i+h)*G[o],m=(n+l)*G[o];if((y-t)*(y-t)+(m-e)*(m-e)<a)r=h,s=l;else{var v=h-y+h,x=l-m+l;if(!((v-t)*(v-t)+(x-e)*(x-e)<a)){var w=y-h,b=m-l;if(u*w-c*b<=0||a*(w*w+b*b)>(u*w-c*b)*(u*w-c*b))if(c*w+u*b>0){if(Math.abs(c*w+u*b)<=w*w+b*b||(t-y)*(i-y)+(e-m)*(n-m)>=0){r=h,s=l;continue}}else if(-(c*w+u*b)<=w*w+b*b||(t-v)*(r-v)+(e-x)*(s-x)>=0){i=h,n=l;continue}return!1}i=h,n=l}}return!1}var rt={ellipseCircle:function(t,e,i,n,r,s,a){J||it();var o=Math.abs(r-t),h=Math.abs(s-e);return o*o+(n-h)*(n-h)<=a*a||(i-o)*(i-o)+h*h<=a*a||o*n+h*i<=i*n||(o*n+h*i-i*n)*(o*n+h*i-i*n)<=a*a*(i*i+n*n)&&o*i-h*n>=-n*n&&o*i-h*n<=i*i||((o-i)*(o-i)+(h-n)*(h-n)<=a*a||o<=i&&h-a<=n||h<=n&&o-a<=i)&&nt(o,h,i,0,0,n,a*a)},ellipseEllipse:function(t,e,i,n,r,s,a,o){J||it();var h=Math.abs(r-t)*o,l=Math.abs(s-e)*a;i*=o;var c=a*o;return h*h+((n*=a)-l)*(n-l)<=c*c||(i-h)*(i-h)+l*l<=c*c||h*n+l*i<=i*n||(h*n+l*i-i*n)*(h*n+l*i-i*n)<=c*c*(i*i+n*n)&&h*i-l*n>=-n*n&&h*i-l*n<=i*i||((h-i)*(h-i)+(l-n)*(l-n)<=c*c||h<=i&&l-c<=n||l<=n&&h-c<=i)&&nt(h,l,i,0,0,n,c*c)}},st=function(t,e,i,n,r,s,a){return rt.ellipseCircle(t,e,i,n,r,s,a)},at=function(t,e,i,n,r,s,a,o){o=o||1;var h=0;return h+=z(t,e,i,n,r)?1:0,h+=z(t,e,i,n+s,r)?1:0,h+=z(t,e,i,n,r+a)?1:0,0===(h+=z(t,e,i,n+s,r+a)?1:0)?q(n,r,s,a,t,e,i):h>=1&&h<=3||(4===h?!(z(t,e,i-o,n,r)&&z(t,e,i-o,n+s,r)&&z(t,e,i-o,n,r+a)&&z(t,e,i-o,n+s,r+a)):void 0)},ot=function(t,e,i,n,r,s,a,o){return o=o||1,H(n,r,s,a,t,e,i)&&!(z(t,e,i-o,n,r)&&z(t,e,i-o,s,a))},ht=function(t,e,i,n,r,s){return s=s||1,z(t,e,i,n,r)&&!z(t,e,i-s,n,r)},lt=function(t,e,i,n,r,s,a,o){var h=i-t,l=n-e,c=a-r,u=o-s,d=(-l*(t-r)+h*(e-s))/(-c*l+h*u),p=(c*(e-s)-u*(t-r))/(-c*l+h*u);return d>=0&&d<=1&&p>=0&&p<=1},ct=function(t,e,i,n,r,s){var a=r.length;if(Z(r,t,e,s))return!0;for(var o=0;o<a;o+=2){var h=(o+2)%a;if(lt(t,e,i,n,r[o],r[o+1],r[h],r[h+1]))return!0}return!1},ut=function(t,e){for(var i,n,r,s,a,o,h=t,l=e,c=[h,l],u=0;u<c.length;u++)for(var d=c[u],p=0;p<d.length;p+=2){var f=(p+2)%d.length,g={x:d[f+1]-d[p+1],y:d[p]-d[f]};for(i=n=null,o=0;o<h.length;o+=2)r=g.x*h[o]+g.y*h[o+1],(null===i||r<i)&&(i=r),(null===n||r>n)&&(n=r);for(s=a=null,o=0;o<l.length;o+=2)r=g.x*l[o]+g.y*l[o+1],(null===s||r<s)&&(s=r),(null===a||r>a)&&(a=r);if(n<s||a<i)return!1}return!0},dt=function(t,e,i,n,r){return ut(t,[e,i,e+n,i,e+n,i+r,e,i+r])},pt=function(t,e,i,n,r,s,a,o){r-=t,a-=t,s-=e,o-=e;var h=Math.pow(a-r,2)/i/i+Math.pow(o-s,2)/n/n,l=2*r*(a-r)/i/i+2*s*(o-s)/n/n,c=l*l-4*h*(r*r/i/i+s*s/n/n-1);if(0===c){var u=-l/2/h;return u>=0&&u<=1}if(c>0){var d=Math.sqrt(c),p=(-l+d)/2/h,f=(-l-d)/2/h;return p>=0&&p<=1||f>=0&&f<=1}return!1},ft=function(t,e,i,n,r,s,a,o){return pt(r,s,a,o,t,e,i,n)},gt=function(t,e,i,n,r){if(Z(t,e,i))return!0;for(var s=t.length,a=0;a<s-2;a+=2)if(ft(t[a],t[a+1],t[a+2],t[a+3],e,i,n,r))return!0;return ft(t[0],t[1],t[s-2],t[s-1],e,i,n,r)},yt=function(t,e,i,n,r,s){return r>=t&&r<=t+i&&s>=e&&s<=e+n},mt=function(t,e,i,n,r){const s=Math.atan2(n-e,i-t)-Math.PI/2,a=r/2,o=Math.cos(s)*a,h=Math.sin(s)*a;return[t-o,e-h,i-o,n-h,i+o,n+h,t+o,e+h]},vt=function(t,e,i,n,r,s,a,o,h,l){return h||l?function(t,e,i,n,r,s,a,o,h,l){if(h&&l)return ut(mt(t,e,i,n,h),mt(r,s,a,o,l));if(h)return ct(r,s,a,o,mt(t,e,i,n,h));if(l)return ct(t,e,i,n,mt(r,s,a,o,h))}(t,e,i,n,r,s,a,o,h,l):lt(t,e,i,n,r,s,a,o)};var xt=function(t,e,i,n,r,s,a,o){return!(!yt(r,s,a,o,t,e)&&!yt(r,s,a,o,i,n))||(vt(t,e,i,n,r,s,r+a,s)||vt(t,e,i,n,r+a,s,r+a,s+o)||vt(t,e,i,n,r,s+o,r+a,s+o)||vt(t,e,i,n,r,s,r,s+o))},wt=function(t,e,i,n,r,s,a,o){return yt(r,s,a,o,t,e)||pt(t,e,i,n,r,s,r+a,s)||pt(t,e,i,n,r,s+o,r+a,s+o)||pt(t,e,i,n,r,s,r,s+o)||pt(t,e,i,n,r+a,s,r+a,s+o)},bt=function(t,e,i,n,r,s){return Math.pow(r-t,2)/(i*i)+Math.pow(s-e,2)/(n*n)<=1},At={circlePoint:z,circleCircle:function(t,e,i,n,r,s){var a=t-n,o=r-e,h=i+s;return a*a+o*o<=h*h},circleLine:function(t,e,i,n,r,s,a){return H(n,r,s,a,t,e,i)},circleBox:function(t,e,i,n,r,s,a){return q(n,r,s,a,t,e,i)},circlePolygon:function(t,e,i,n){return tt(n,t,e,i)},circleEllipse:function(t,e,i,n,r,s,a){return st(n,r,s,a,t,e,i)},circleOutlineBox:at,circleOutlineLine:ot,circleOutlinePoint:ht,polygonPoint:Z,polygonLine:function(t,e,i,n,r,s){return ct(e,i,n,r,t,s)},polygonPolygon:ut,polygonBox:dt,polygonCircle:tt,polygonEllipse:gt,boxPoint:yt,boxBox:function(t,e,i,n,r,s,a,o){return t<r+a&&t+i>r&&e<s+o&&e+n>s},boxLine:function(t,e,i,n,r,s,a,o){return xt(r,s,a,o,t,e,i,n)},boxPolygon:function(t,e,i,n,r){return dt(r,t,e,i,n)},boxCircle:q,boxEllipse:function(t,e,i,n,r,s,a,o){return wt(r,s,a,o,t,e,i,n)},boxCircleOutline:function(t,e,i,n,r,s,a,o){return at(r,s,a,t,e,i,n,o)},pointBox:function(t,e,i,n,r,s){return yt(i,n,r,s,t,e)},pointPolygon:function(t,e,i,n){return Z(i,t,e,n)},pointCircle:function(t,e,i,n,r){return z(i,n,r,t,e)},pointLine:function(t,e,i,n,r,s){return K(i,n,r,s,t,e)},pointEllipse:function(t,e,i,n,r,s){return bt(i,n,r,s,t,e)},pointCircleOutline:function(t,e,i,n,r,s){return ht(t,e,i,n,r,s)},lineLine:vt,lineBox:xt,linePolygon:ct,lineCircle:H,linePoint:K,lineEllipse:ft,lineCircleOutline:function(t,e,i,n,r,s,a,o){return ot(r,s,a,t,e,i,n,o)},ellipsePoint:bt,ellipseLine:pt,ellipseBox:wt,ellipseCircle:st,ellipseEllipse:function(t,e,i,n,r,s,a,o){return rt.ellipseEllipse(t,e,i,n,r,s,a,o)},ellipsePolygon:function(t,e,i,n,r){return gt(r,t,e,i,n)}},Mt=At.polygonPolygon,_t=At.polygonCircle,St=t(function(t,e){t.exports=function(){function t(t,n,r,s,a){!function t(i,n,r,s,a){for(;s>r;){if(s-r>600){var o=s-r+1,h=n-r+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(h-o/2<0?-1:1),d=Math.max(r,Math.floor(n-h*c/o+u)),p=Math.min(s,Math.floor(n+(o-h)*c/o+u));t(i,n,d,p,a)}var f=i[n],g=r,y=s;for(e(i,r,n),a(i[s],f)>0&&e(i,r,s);g<y;){for(e(i,g,y),g++,y--;a(i[g],f)<0;)g++;for(;a(i[y],f)>0;)y--}0===a(i[r],f)?e(i,r,y):e(i,++y,s),y<=n&&(r=y+1),n<=y&&(s=y-1)}}(t,n,r||0,s||t.length-1,a||i)}function e(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function i(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function s(t,e){a(t,0,t.children.length,e,t)}function a(t,e,i,n,r){r||(r=f(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var s=e;s<i;s++){var a=t.children[s];o(r,t.leaf?n(a):a)}return r}function o(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function h(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function p(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(e,i,n,r,s){for(var a=[i,n];a.length;)if(!((n=a.pop())-(i=a.pop())<=r)){var o=i+Math.ceil((n-i)/r/2)*r;t(e,o,i,n,s),a.push(i,o,o,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,i=[];if(!p(t,e))return i;for(var n=this.toBBox,r=[];e;){for(var s=0;s<e.children.length;s++){var a=e.children[s],o=e.leaf?n(a):a;p(t,o)&&(e.leaf?i.push(a):d(t,o)?this._all(a,i):r.push(a))}e=r.pop()}return i},n.prototype.collides=function(t){var e=this.data;if(!p(t,e))return!1;for(var i=[];e;){for(var n=0;n<e.children.length;n++){var r=e.children[n],s=e.leaf?this.toBBox(r):r;if(p(t,s)){if(e.leaf||d(t,s))return!0;i.push(r)}}e=i.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=f([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var i,n,s,a=this.data,o=this.toBBox(t),h=[],l=[];a||h.length;){if(a||(a=h.pop(),n=h[h.length-1],i=l.pop(),s=!0),a.leaf){var c=r(t,a.children,e);if(-1!==c)return a.children.splice(c,1),h.push(a),this._condense(h),this}s||a.leaf||!d(a,o)?n?(i++,a=n.children[i],s=!1):a=null:(h.push(a),l.push(i),i=0,n=a,a=a.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},n.prototype._build=function(t,e,i,n){var r,a=i-e+1,o=this._maxEntries;if(a<=o)return s(r=f(t.slice(e,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,n-1))),(r=f([])).leaf=!1,r.height=n;var h=Math.ceil(a/o),l=h*Math.ceil(Math.sqrt(o));g(t,e,i,l,this.compareMinX);for(var c=e;c<=i;c+=l){var u=Math.min(c+l-1,i);g(t,c,u,h,this.compareMinY);for(var d=c;d<=u;d+=h){var p=Math.min(d+h-1,u);r.children.push(this._build(t,d,p,n-1))}}return s(r,this.toBBox),r},n.prototype._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var r=1/0,s=1/0,a=void 0,o=0;o<e.children.length;o++){var h=e.children[o],l=c(h),u=(d=t,p=h,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-l);u<s?(s=u,r=l<r?l:r,a=h):u===s&&l<r&&(r=l,a=h)}e=a||e.children[0]}var d,p;return e},n.prototype._insert=function(t,e,i){var n=i?t:this.toBBox(t),r=[],s=this._chooseSubtree(n,this.data,e,r);for(s.children.push(t),o(s,n);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)},n.prototype._split=function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var a=this._chooseSplitIndex(i,r,n),o=f(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,s(i,this.toBBox),s(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},n.prototype._splitRoot=function(t,e){this.data=f([t,e]),this.data.height=t.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,i){for(var n,r,s,o,h,l,u,d=1/0,p=1/0,f=e;f<=i-e;f++){var g=a(t,0,f,this.toBBox),y=a(t,f,i,this.toBBox),m=(r=g,s=y,o=void 0,h=void 0,l=void 0,u=void 0,o=Math.max(r.minX,s.minX),h=Math.max(r.minY,s.minY),l=Math.min(r.maxX,s.maxX),u=Math.min(r.maxY,s.maxY),Math.max(0,l-o)*Math.max(0,u-h)),v=c(g)+c(y);m<d?(d=m,n=f,p=v<p?v:p):m===d&&v<p&&(p=v,n=f)}return n},n.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:h,r=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var r=this.toBBox,s=a(t,0,e,r),h=a(t,i-e,i,r),l=u(s)+u(h),c=e;c<i-e;c++){var d=t.children[c];o(s,t.leaf?r(d):d),l+=u(s)}for(var p=i-e-1;p>=e;p--){var f=t.children[p];o(h,t.leaf?r(f):f),l+=u(h)}return l},n.prototype._adjustParentBBoxes=function(t,e,i){for(var n=i;n>=0;n--)o(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():s(t[e],this.toBBox)},n}()}),Pt=Xt,Yt=Xt;function Xt(t,e){if(!(this instanceof Xt))return new Xt(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||Ct,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function Ct(t,e){return t<e?-1:t>e?1:0}Xt.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,n=e[t];t>0;){var r=t-1>>1,s=e[r];if(i(n,s)>=0)break;e[t]=s,t=r}e[t]=n},_down:function(t){for(var e=this.data,i=this.compare,n=this.length>>1,r=e[t];t<n;){var s=1+(t<<1),a=s+1,o=e[s];if(a<this.length&&i(e[a],o)<0&&(s=a,o=e[a]),i(o,r)>=0)break;e[t]=o,t=s}e[t]=r}},Pt.default=Yt;var Et=Bt,kt=Bt;function Bt(t,e,i,n,r,s){for(var a,o,h,l,c=t.data,u=[],d=t.toBBox,p=new Pt(null,Tt);c;){for(a=0;a<c.children.length;a++)o=c.children[a],h=Rt(e,i,c.leaf?d(o):o),(!s||h<=s)&&p.push({node:o,isItem:c.leaf,dist:h});for(;p.length&&p.peek().isItem;)if(l=p.pop().node,r&&!r(l)||u.push(l),n&&u.length===n)return u;(c=p.pop())&&(c=c.node)}return u}function Tt(t,e){return t.dist-e.dist}function Rt(t,e,i){var n=Ot(t,i.minX,i.maxX),r=Ot(e,i.minY,i.maxY);return n*n+r*r}function Ot(t,e,i){return t<e?e-t:t<=i?0:t-i}Et.default=kt;var It="EPSILON"in Number?Number.EPSILON:2.220446049250313e-16,Ft=function(t,e){return Math.abs(t-e)<It};function Lt(t,e){this.set(t,e)}Lt.prototype.add=function(t,e){return t instanceof Lt?(this.x+=t.x,this.y+=t.y):(this.x+=t||0,this.y+=e||0),this},Lt.prototype.angle=function(t){if(void 0!==t)return this.set(this.length(),0).rotate(t);var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},Lt.prototype.angleDeg=function(t){return void 0!==t?this.angle(t/180*Math.PI):180*this.angle()/Math.PI},Lt.prototype.clone=Lt.prototype.copy=function(){return new Lt(this.x,this.y)},Lt.prototype.cross=function(t,e){return t instanceof Lt?this.x*t.y-this.y*t.x:this.x*e-this.y*t},Lt.prototype.distance=function(t,e){var i=this.distanceSq(t,e);if(void 0!==i)return Math.sqrt(i)},Lt.prototype.distanceSq=function(t,e){var i,n;if(t instanceof Lt)i=t.x-this.x,n=t.y-this.y;else{if(void 0===e)return;i=t-this.x,n=e-this.y}return i*i+n*n},Lt.prototype.dot=function(t,e){return t instanceof Lt?this.x*t.x+this.y*t.y:this.x*t+this.y*e},Lt.prototype.equals=function(t,e,i){return t instanceof Lt?(e=e||0,Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e):void 0!==e&&(i=i||0,Math.abs(this.x-t)<=i&&Math.abs(this.y-e)<=i)},Lt.prototype.length=function(){return Math.sqrt(this.lengthSq())},Lt.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},Lt.prototype.negate=function(){return this.scale(-1)},Lt.prototype.normalize=function(){return this.scale(1/this.length())},Lt.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(this.x*e-this.y*i,this.x*i+this.y*e)},Lt.prototype.rotateDeg=function(t){return this.rotate(t/180*Math.PI)},Lt.prototype.scale=function(t,e){return this.x*=t,this.y*=e||t,this},Lt.prototype.set=function(t,e){return t instanceof Lt?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0),this},Lt.prototype.setPolar=function(t,e){return this.set(e,0).rotate(t)},Lt.prototype.setPolarDeg=function(t,e){return this.setPolar(t/180*Math.PI,e)},Lt.prototype.sub=function(t,e){return void 0!==e?(this.x-=t,this.y-=e):(this.x-=t.x,this.y-=t.y),this},Lt.prototype.toString=function(){return"("+this.x+", "+this.y+")"};var Dt=Lt;function Ut(t,e,i){return i=i||0,Math.abs(t-e)<Math.abs(i)}var jt=function(t,e){return Ut(t,0,e)},Wt=function(t,e,i){return t>e?t<i?t:i:e},Vt=1/3,zt=new Dt(0,0),Ht=1e-4,$t=30;function qt(t){return"[object Array]"===Object.prototype.toString.call(t)}function Nt(t){if(!qt(t))throw"Polygon must be an array of points";switch(typeof t[0]){case"number":if(t.length%2!=0)throw"Polygon that contains array of numbers must has even length ([x0, y0, x1, y1, ...., xn, yn])";for(var e=[],i=0;i<t.length;i+=2)e.push(new Dt(t[i],t[i+1]));return e;case"object":return t.map(qt(t[0])?t=>new Dt(t[0],t[1]):t=>new Dt(t.x,t.y));default:throw"Passed polygon is not an array of 2D coordinates"}}function Qt(t){if(1===t.length)return new Dt(t[0]);var e=new Dt(0,0);t.forEach(t=>e.add(t)),e.scale(1/t.length);var i=new Dt,n=0;return t.forEach((r,s)=>{var a=new Dt(r),o=new Dt(s+1===t.length?t[0]:t[s+1]);a.add(-e.x,-e.y),o.add(-e.x,-e.y);var h=.5*a.cross(o);n+=h,i.add(a.add(o).scale(Vt).scale(h))}),jt(n,Ht)?i.set(t[0]):i.scale(1/n).add(e)}function Gt(t,e){for(var i=t[0],n=e.dot(t[0]),r=0,s=1;s<t.length;s++)(r=e.dot(t[s]))>n&&(n=r,i=t[s]);return new Dt(i)}function Jt(t,e,i){var n=Gt(t,i),r=Gt(e,i.negate());return new Dt(n.sub(r))}function Kt(t,e){var i=new Dt(0,0),n=new Dt(t).negate(),r=new Dt(e).sub(t),s=r.dot(r);if(jt(s,Ht))return i.set(t);var a=n.dot(r)/s;return a=Wt(a,0,1),i.set(r.scale(a).add(t))}function Zt(t,e){t=Nt(t),e=Nt(e);var i,n,r,s=Qt(t),a=Qt(e).add(s.negate());i=Jt(t,e,a),n=Jt(t,e,a.negate());for(var o=0;o<$t;o++){var h=Kt(i,n);if(jt(h.length(),Ht))return{distance:0};a.set(h.negate().normalize());var l=(r=Jt(t,e,a)).dot(a),c=i.dot(a);if(jt(l-c,Ht))return{distance:l,direction:a,p1:i,p2:n};i.distanceSq(zt)<n.distanceSq(zt)?n=r:i=r}return{distance:0}}var te={intersect:function(t,e){return jt(Zt(t,e),Ht)},distance:Zt},ee=t(function(t,e){!function(){function e(t,e,i){this.next=i,i&&(i.prev=this),this.prev=e,e&&(e.next=this),this.data=t}function i(){if(!(this instanceof i))return new i;this._head=null,this._tail=null,this.length=0}i.prototype={push:function(t){this._tail=new e(t,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(0!==this.length){var t=this._tail;return this._tail=t.prev,t.prev&&(t.prev=this._tail.next=null),this.length--,1===this.length?this._head=this._tail:0===this.length&&(this._head=this._tail=null),t.data}},unshift:function(t){this._head=new e(t,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(0!==this.length){var t=this._head;return this._head=t.next,t.next&&(t.next=this._head.prev=null),this.length--,1===this.length?this._tail=this._head:0===this.length&&(this._head=this._tail=null),t.data}},item:function(t){t<0&&(t=this.length+t);for(var e=this._head;t-- >0&&e;)e=e.next;return e?e.data:void 0},slice:function(t,e){if(t||(t=0),e||(e=this.length),e<0&&(e=this.length+e),t<0&&(t=this.length+t),e===t)return[];if(e<t)throw new Error("invalid offset: "+t+","+e+" (length="+this.length+")");for(var i=e-t,n=new Array(i),r=0,s=this._head;t-- >0&&s;)s=s.next;for(;r<i&&s;)n[r++]=s.data,s=s.next;return n},drop:function(){i.call(this)},forEach:function(t,e){for(var i=this._head,n=0,r=this.length;n<r&&i;)t.call(e||this,i.data,n,this),i=i.next,n++},map:function(t,e){var n=new i;return this.forEach(function(i,r,s){n.push(t.call(e||s,i,r,s))}),n},filter:function(t,e){var n=new i;return this.forEach(function(i,r,s){t.call(e||s,i,r,s)&&n.push(i)}),n},reduce:function(t,e,i){var n=0,r=this._head,s=this.length;for(e||(n=1,e=r&&r.data,r=r&&r.next);n<s&&r;)e=t.call(i||this,e,r.data,this),n++,r=r.next;return e}},t.exports=i}()});class ie extends ee{constructor(){super()}every(t,e){let i,n=this._head,r=0;const s=this.length;let a=!0;for(;r<s&&n&&a;)a=t.call(e||this,n.data,i,r,this),i=n.data,n=n.next,r+=1}getHead(){if(this._head)return this._head.data}getTail(){if(this._tail)return this._tail.data}}const ne=2*Math.PI,re=(t,e)=>{let i=t+Math.random()*(e+1-t);return i=Math.floor(i)},se=t=>0|t,ae=(t,e,i,n,r,s)=>{const a=i-t,o=n-e;return{x:se(s*a-r*o+t),y:se(r*a+s*o+e)}},oe=(t,e,i,n)=>{const r=ne*Math.random(),s=Math.random()+Math.random(),a=(s>1?2-s:s)*(i-.5*n);return{x:Math.trunc(Math.cos(r)*a+t),y:Math.trunc(Math.sin(r)*a+e)}},he=(t,e,i)=>t+(e-t)*i,le=(t,e)=>Math.atan2(Math.sin(t-e),Math.cos(t-e)),ce=(t,e,i,n)=>{const r=t-i,s=e-n;return r*r+s*s},ue=(t,e,i)=>{const n=(e-t)/e*.5;return(Math.sin(i)*n+(1-n))*e},de=(t,e,i)=>Math.min(i,Math.max(e,t)),pe=(t,e,i=.05)=>{if(t===e)return t;let n=t,r=e;const s=Math.abs(r-n);return s<=i||s>=ne-i?n=r:(s>Math.PI&&(e<t?r+=ne:r-=ne),e>t?n+=i:e<t&&(n-=i)),n},fe=t=>((t,e,i)=>{const n=i-e;return e+((t-e)%n+n)%n})(t,-Math.PI,Math.PI),ge=(t,e)=>{const i=fe(t),n=fe(e)-i;return 0===n?0:n-Math.floor((n- -Math.PI)/ne)*ne},ye=(t,e)=>{const i=t[0]*e[0]+t[1]*e[1];return[t[0]-2*i*e[0],t[1]-2*i*e[1]]},me=2*Math.PI;function ve(t){const e=t%me;return e<0?e+me:e}const{sqrt:xe}=Math,we=(t,e,i,n,r,s,a)=>{const o=[],h=(s-n)*(s-n)+(a-r)*(a-r),l=2*((s-n)*(n-t)+(a-r)*(r-e)),c=l*l-4*h*(t*t+e*e+n*n+r*r-2*(t*n+e*r)-i*i);if(c>0){const t=xe(c),e=(-l+t)/(2*h),i=(-l-t)/(2*h);e>=0&&e<=1&&o.push({x:he(n,s,e),y:he(r,a,e)}),i>=0&&i<=1&&o.push({x:he(n,s,i),y:he(r,a,i)})}return o},be=(t,e,i,n,r,s,a)=>{const o=we(t,e,i,n,r,s,r),h=we(t,e,i,s,r,s,a),l=we(t,e,i,s,a,n,a),c=we(t,e,i,n,a,n,r),u=[],d=i*i,p=n-t,f=r-e,g=s-t,y=a-e,m=p*p,v=f*f,x=g*g,w=y*y;return o.length>0&&(2===o.length?o[0].x>o[1].x?u.push(o[1],o[0]):u.push(o[0],o[1]):u.push(o[0])),x+v<d&&u.push({x:s,y:r}),h.length>0&&(2===h.length?h[0].y>h[1].y?u.push(h[1],h[0]):u.push(h[0],h[1]):u.push(h[0])),x+w<d&&u.push({x:s,y:a}),l.length>0&&(2===l.length?l[0].x<l[1].x?u.push(l[1],l[0]):u.push(l[0],l[1]):u.push(l[0])),m+w<d&&u.push({x:n,y:a}),c.length>0&&(2===c.length?c[0].y<c[1].y?u.push(c[1],c[0]):u.push(c[0],c[1]):u.push(c[0])),m+v<d&&u.push({x:n,y:r}),u},Ae=(t,e,i,n,r,s,a)=>{const o={type:0,isec:[]},h=r-t,l=s-e,c=i*h+n*l;let u=a*a-(h*h+l*l)+c*c;if(u<0)return o;if(c<(u=Math.sqrt(u))){if(Ft(u,0))return o.type=1,o.isec.push({x:i*c+t,y:n*c+e}),o;if(c+u>=0){u=-u,o.type=2;const r=c-u;return o.isec.push({x:i*r+t,y:n*r+e}),o}return o}o.type=3;const d=c-u,p=c+u;return o.isec.push({x:i*d+t,y:n*d+e},{x:i*p+t,y:n*p+e}),o};class Me{constructor(t,e){if(this.gameMap=t,this.x=+(e.x||0),this.y=+(e.y||0),this.width=e.size||e.width||0,this.height=e.size||e.height||0,!this.width||!this.height)throw new Error("element size can not be undefined");this.lightDirection=!0,this.lightSpeed=e.lightSpeed,this.point=e.point,this.lightSize=this.width/2,this.minX=this.x-this.width,this.minY=this.y-this.width,this.maxX=this.x+this.width,this.maxY=this.y+this.width,this.delta=.5*Math.random()*Math.PI}render(t){this.delta+=this.lightSpeed*t,this.lightSize=ue(.5*this.width,this.width,this.delta);const e=this.gameMap.view.relativeX(this.x),i=this.gameMap.view.relativeY(this.y),n=this.gameMap.view.relativeW(this.width);this.gameMap.ctx.fillStyle=`hsla(${ue(180,360,.5*this.delta)}, ${ue(80,100,.4*this.delta)}%, 50%, 0.2)`,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(e,i,this.lightSize*n/this.width,0,2*Math.PI),this.gameMap.ctx.fill(),this.gameMap.ctx.fillStyle=`hsl(${ue(180,360,.5*this.delta)}, ${ue(80,100,.4*this.delta)}%, 50%)`,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(e,i,.5*n,0,2*Math.PI),this.gameMap.ctx.fill()}}class _e{constructor(t,e,i,n,r,s,a,o,h){this.x=t,this.y=e,this.vx=i,this.vy=n,this.speed=r,this.angle=s,this.sin=Math.sin(s),this.cos=Math.cos(s),this.nextAngle=s,this.poly={},this.aabb={},this.aabb.parent=this,this.snake=h,this.aabb.snakeIdx=h.idx,this.setIdx(o),this.calcPoly(a),this.isHead=!1}setNext(t,e,i){this.nextX=t,this.nextY=e,this.nextAngle=i,this.nextSin=Math.sin(i),this.nextCos=Math.cos(i),this.calcPoly(.5*this.width)}setXY(t,e){this.x=t,this.y=e,this.calcPoly(.5*this.width)}calcRotates(t){const e=ae(this.x,this.y,this.x,this.y+t,this.sin,this.cos),i=ae(this.x,this.y,this.x,this.y-t,this.sin,this.cos),n=ae(this.nextX,this.nextY,this.nextX,this.nextY+t,this.nextSin,this.nextCos);return{rotateLeft:i,rotateRight:e,nextRotateLeft:ae(this.nextX,this.nextY,this.nextX,this.nextY-t,this.nextSin,this.nextCos),nextRotateRight:n}}setIdx(t){this.aabb.idx=t}calcPoly(t){const e=this.calcRotates(.5*t);this.poly.l0X=e.nextRotateLeft.x,this.poly.l0Y=e.nextRotateLeft.y,this.poly.r0X=e.nextRotateRight.x,this.poly.r0Y=e.nextRotateRight.y,this.poly.l1X=e.rotateLeft.x,this.poly.l1Y=e.rotateLeft.y,this.poly.r1X=e.rotateRight.x,this.poly.r1Y=e.rotateRight.y,this.width=t}getPoly(t){return Ft(t,this.width)||this.calcPoly(t),this.poly}setAABB(t){const e=this.calcRotates(.5*t);this.aabb.minX=Math.min(e.rotateRight.x,e.rotateLeft.x,e.nextRotateLeft.x,e.nextRotateRight.x),this.aabb.minY=Math.min(e.rotateRight.y,e.rotateLeft.y,e.nextRotateLeft.y,e.nextRotateRight.y),this.aabb.maxX=Math.max(e.rotateRight.x,e.rotateLeft.x,e.nextRotateLeft.x,e.nextRotateRight.x),this.aabb.maxY=Math.max(e.rotateRight.y,e.rotateLeft.y,e.nextRotateLeft.y,e.nextRotateRight.y)}getAABB(){return this.aabb}destroy(){this.poly=void 0,this.aabb.parent=void 0,this.aabb=void 0}}function Se(t,e){return Math.atan2(e,t)}const{log:Pe}=console;class Ye{constructor(t,e){this.gameMap=t,this.x=+(e.x||0),this.y=+(e.y||0),this.minWidth=this.width=+(e.size||e.width||0),this.minHeight=this.height=+(e.size||e.height||0),this.shadowSize=this.width+S,this.needResize=!1,this.point=0,this.isSpeedUp=!1,this.fillColor="",this.stopped=!1,this.isActive=e.isAcive||!0,this.head={},this.head.aabb={},this.head.aabb.snakeIdx=this.idx=e.idx,this.head.aabb.parent=this.head,this.head.snake=this,this.head.getPoly=t=>this.head.poly,this.head.getAABB=()=>this.head.aabb,this.head.isHead=!0,this.head.poly={},this.head.width=this.width,this.closestDistance=5e3,this.visionAngle=170,this.closestSnake=null,this.closestFood=null,this.closestSnakeID=null,this.closestFoodID=null,this.colliders=this.gameMap.globalColliders,this.movementQueue=new ie,this.mIdx=0,this.collidersArray=[],this.speed=this.oldSpeed=m,this.turnSpeed=x,this.oldVx=0,this.oldVy=0,this.fillColor=e.fillColor||"#fff",this.angle=this.toAngle=this.oldAngle=e.angle||0,this.length=this.minLength=e.length||0,this.viewLength=0,this.isPlayer=e.isPlayer,this.key=e.key,this.inQuene=!1,this.acceleration=0,this.isSpeedUp=!1,this.distances=[],this.vel=0,this.boundsAway=!1,this.updateSize(),this.vx=Math.cos(this.angle),this.vy=Math.sin(this.angle),this.calcHead()}zeroClosest(){this.closestDistance=5e3}setXY(t,e){this.x=t,this.y=e,this.calcHead()}setAngle(t){this.angle=t,this.toAngle=t,this.oldAngle=t,this.vx=Math.cos(this.angle),this.vy=Math.sin(this.angle),this.calcHead()}setClosest(t){this.closestDistance=t}updateSize(t=0){this.length+=15*t,this.width+=.4*t,this.height+=.4*t,this.length<=this.minLength&&(this.lenth=this.minLength,this.width=this.minWidth,this.height=this.minHeight,this.speedDown()),this.width>this.shadowSize-.1*S&&(this.needResize=!0),this.head.width=this.width;const e=.5*this.width*A*1e4,i=Se(this.height,-e),n=Se(this.height,e);this.halfVisionAngle=.5*le(n,i)}turnAround(t){const e=ge(this.angle,this.toAngle);if(Ft(e,0))return;const i=Math.sign(e);this.vel+=i*A*t*this.gameMap.scale,Math.abs(this.vel/e)>=1?(this.vel=0,this.angle=this.toAngle):this.angle+=this.vel,this.vx=Math.cos(this.angle),this.vy=Math.sin(this.angle),this.oldAngle=this.toAngle}speedUp(){this.isSpeedUp||(this.isSpeedUp=!0,this.acceleration=v)}speedDown(){this.isSpeedUp&&(this.isSpeedUp=!1,this.acceleration=-v)}eat(t){this.point+=t.point;const e=t.point/200;this.isPlayer||this.speedDown(),this.updateSize(e)}update(t){if(this.stopped||Ft(this.speed,0))return;let e=!1;const i=this.speed;this.isSpeedUp&&this.updateSize(.006*t*-1/15),this.isSpeedUp&&this.acceleration.speed>=3*m||!this.isSpeedUp&&this.speed<=m?this.acceleration=0:this.acceleration+=Math.sign(this.acceleration)*v*t,this.speed=de(i+this.acceleration*t,m,3*m);const n=.5*t*(this.speed+i);let r=this.movementQueue.getTail();if(r&&Ft(r.angle,this.angle)&&(this.colliders.remove(r.getAABB()),r.speed+=n,e=!0),e||(r=new _e(this.x,this.y,this.vx,this.vy,n,this.angle,this.width,this.mIdx,this),this.movementQueue.push(r),this.mIdx+=1),this.viewLength+=n,this.turnAround(t),this.x+=this.vx*n,this.y+=this.vy*n,r.setNext(this.x,this.y,this.angle),r.setAABB(this.shadowSize),this.colliders.insert(r.getAABB()),this.movementQueue.length>0&&this.viewLength>this.length){let t;for(;this.movementQueue.length>0&&this.viewLength>this.length;)t=this.movementQueue.shift(),this.colliders.remove(t.getAABB()),this.viewLength-=t.speed;const e=this.length-this.viewLength;if(e>0){const i=e/t.speed;t.speed=e;const n=t.nextX-(t.nextX-t.x)*i,r=t.nextY-(t.nextY-t.y)*i;t.setXY(n,r),t.setAABB(this.shadowSize),this.movementQueue.unshift(t),this.colliders.insert(t.getAABB()),this.viewLength+=t.speed}}this.needResize&&!this.inQuene&&(this.gameMap.updateQuene.push(this),this.inQuene=!0),this.colliders.remove(this.head.getAABB()),this.calcHead(),this.head.aabb.idx=this.mIdx,this.colliders.insert(this.head.getAABB())}updateAABBs(){this.mIdx=0,this.movementQueue.forEach(t=>{this.colliders.remove(t.getAABB()),t.setAABB(this.shadowSize),t.setIdx(this.mIdx),this.mIdx+=1,this.collidersArray.push(t.getAABB())}),Pe(`${this.key} resize width ${this.collidersArray.length} colliders`),this.colliders.load(this.collidersArray),this.collidersArray.length=0,this.head.aabb.idx=this.mIdx}calcHead(){const t=ae(this.x,this.y,this.x+this.height,this.y-.5*this.width,this.vy,this.vx),e=ae(this.x,this.y,this.x+this.height,this.y+.5*this.width,this.vy,this.vx),i=ae(this.x,this.y,this.x,this.y+.5*this.width,this.vy,this.vx),n=ae(this.x,this.y,this.x,this.y-.5*this.width,this.vy,this.vx),r=ae(this.x,this.y,this.x+this.width,this.y,this.vy,this.vx);this.head.poly.l1X=t.x,this.head.poly.l1Y=t.y,this.head.poly.r1X=e.x,this.head.poly.r1Y=e.y,this.head.poly.r0X=i.x,this.head.poly.r0Y=i.y,this.head.poly.l0X=n.x,this.head.poly.l0Y=n.y,this.head.nextX=r.x,this.head.nextY=r.y,this.head.x=this.x,this.head.y=this.y,this.head.cX=.5*(this.head.x+this.head.nextX),this.head.cY=.5*(this.head.y+this.head.nextY),this.head.aabb.minX=Math.min(this.head.poly.l0X,this.head.poly.l1X,this.head.poly.r0X,this.head.poly.r1X),this.head.aabb.minY=Math.min(this.head.poly.l0Y,this.head.poly.l1Y,this.head.poly.r0Y,this.head.poly.r1Y),this.head.aabb.maxX=Math.max(this.head.poly.l0X,this.head.poly.l1X,this.head.poly.r0X,this.head.poly.r1X),this.head.aabb.maxY=Math.max(this.head.poly.l0Y,this.head.poly.l1Y,this.head.poly.r0Y,this.head.poly.r1Y)}}class Xe{constructor(t,e,i){this.gameMap=t,this.margin=e,this.radius=i,this.image=document.createElement("canvas"),this.initImage()}initImage(){this.image.width=2*(this.radius+2),this.image.height=2*(this.radius+2),this.x=this.gameMap.view.width-2*(this.radius+2)-this.margin,this.y=this.gameMap.view.height-2*(this.radius+2)-this.margin,this.mapX=this.x+this.radius+2,this.mapY=this.y+this.radius+2;const t=this.image.getContext("2d");t.save(),t.beginPath(),t.arc(this.radius+2,this.radius+2,this.radius,0,2*Math.PI),t.fillStyle="#ccc",t.fill(),t.beginPath(),t.arc(this.radius+2,this.radius+2,this.radius+1,0,2*Math.PI),t.lineWidth=2,t.strokeStyle="#fff",t.stroke(),t.beginPath(),t.arc(this.radius+2,this.radius+2,this.radius+1,0,2*Math.PI),t.strokeStyle="#FF0000",t.setLineDash([5,5]),t.stroke(),t.restore()}render(){const t=this.radius/this.gameMap.paintRadius,e=this.radius/this.gameMap.radius,{ctx:i}=this.gameMap,n=this.gameMap.view.x*t+this.mapX,r=this.gameMap.view.y*t+this.mapY,s=this.gameMap.view.width*t,a=this.gameMap.view.height*t;i.save(),i.globalAlpha=.8,i.drawImage(this.image,this.x,this.y),i.strokeStyle="#fff",i.strokeRect(n,r,s,a);let o=-1;for(;++o<this.gameMap.units.length;){const t=this.gameMap.units[o],n=t.x*e+this.mapX,r=t.y*e+this.mapY;i.fillStyle=t.isPlayer?"#1E90FF":"#F00",i.fillRect(n-1,r-1,2,2)}i.restore()}}class Ce{constructor(t,e,i,n=0,r=0){this.width=e,this.height=i,this.x=n,this.y=r,this.gameMap=t,this.aabb={}}trace(t){this.x=this.aabb.minX=t.x/this.gameMap.scale-.5*this.width,this.y=this.aabb.minY=t.y/this.gameMap.scale-.5*this.height,this.aabb.minX=this.absoluteW(this.x),this.aabb.minY=this.absoluteW(this.y),this.aabb.maxX=this.aabb.minX+this.absoluteW(this.width),this.aabb.maxY=this.aabb.minY+this.absoluteH(this.height)}absoluteX(t){return(t+this.x)*this.gameMap.scale}absoluteY(t){return(t+this.y)*this.gameMap.scale}absoluteW(t){return t*this.gameMap.scale}absoluteH(t){return t*this.gameMap.scale}relativeX(t){return t/this.gameMap.scale-this.x}relativeY(t){return t/this.gameMap.scale-this.y}relativeW(t){return t/this.gameMap.scale}relativeH(t){return t/this.gameMap.scale}}const{log:Ee}=console,ke=(t,e)=>e.snakeIdx!==t,Be=(t,e)=>{const i=e.x-t.x,n=e.y-t.y,r=Math.sqrt(ce(e.x,e.y,t.x,t.y)),s=Math.asin(.5*e.width/r);return((t,e,i)=>{const n=Math.cos(e)*Math.cos(t)+Math.sin(e)*Math.sin(t);return Math.acos(n)<=i})(Math.atan2(n,i),t.angle,t.halfVisionAngle+s)};var Te={BLUR:"blur",BOOT:"boot",DESTROY:"destroy",FOCUS:"focus",HIDDEN:"hidden",PAUSE:"pause",POST_RENDER:"postrender",POST_STEP:"poststep",PRE_RENDER:"prerender",PRE_STEP:"prestep",READY:"ready",RESUME:"resume",STEP:"step",VISIBLE:"visible"};const Re=(t,e=!0)=>{let i;const n=t;if(void 0!==document.hidden)i="visibilitychange";else{["webkit","moz","ms"].forEach(t=>{void 0!==document[`${t}Hidden`]&&(document.hidden=()=>document[`${t}Hidden`],i=`${t}visibilitychange`)})}const r=t=>{document.hidden||"pause"===t.type?n.emit(Te.HIDDEN):n.emit(Te.VISIBLE)};i&&document.addEventListener(i,r,!1),window.onblur=()=>{n.emit(Te.BLUR)},window.onfocus=()=>{n.emit(Te.FOCUS)},window.focus&&e&&window.focus()};var Oe="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function Ie(){throw new Error("setTimeout has not been defined")}function Fe(){throw new Error("clearTimeout has not been defined")}var Le=Ie,De=Fe;function Ue(t){if(Le===setTimeout)return setTimeout(t,0);if((Le===Ie||!Le)&&setTimeout)return Le=setTimeout,setTimeout(t,0);try{return Le(t,0)}catch(e){try{return Le.call(null,t,0)}catch(e){return Le.call(this,t,0)}}}"function"==typeof Oe.setTimeout&&(Le=setTimeout),"function"==typeof Oe.clearTimeout&&(De=clearTimeout);var je,We=[],Ve=!1,ze=-1;function He(){Ve&&je&&(Ve=!1,je.length?We=je.concat(We):ze=-1,We.length&&$e())}function $e(){if(!Ve){var t=Ue(He);Ve=!0;for(var e=We.length;e;){for(je=We,We=[];++ze<e;)je&&je[ze].run();ze=-1,e=We.length}je=null,Ve=!1,function(t){if(De===clearTimeout)return clearTimeout(t);if((De===Fe||!De)&&clearTimeout)return De=clearTimeout,clearTimeout(t);try{De(t)}catch(e){try{return De.call(null,t)}catch(e){return De.call(this,t)}}}(t)}}function qe(t,e){this.fun=t,this.array=e}qe.prototype.run=function(){this.fun.apply(null,this.array)};function Ne(){}var Qe=Ne,Ge=Ne,Je=Ne,Ke=Ne,Ze=Ne,ti=Ne,ei=Ne;var ii=Oe.performance||{},ni=ii.now||ii.mozNow||ii.msNow||ii.oNow||ii.webkitNow||function(){return(new Date).getTime()};var ri=new Date;var si={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];We.push(new qe(t,e)),1!==We.length||Ve||Ue($e)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Qe,addListener:Ge,once:Je,off:Ke,removeListener:Ze,removeAllListeners:ti,emit:ei,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*ni.call(ii),i=Math.floor(e),n=Math.floor(e%1*1e9);return t&&(i-=t[0],(n-=t[1])<0&&(i--,n+=1e9)),[i,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-ri)/1e3}};const ai={android:!1,chromeOS:!1,cordova:!1,crosswalk:!1,desktop:!1,ejecta:!1,electron:!1,iOS:!1,iOSVersion:0,iPad:!1,iPhone:!1,kindle:!1,linux:!1,macOS:!1,node:!1,nodeWebkit:!1,pixelRatio:1,webApp:!1,windows:!1,windowsPhone:!1};var oi=(()=>{const t=navigator.userAgent;/Windows/.test(t)?ai.windows=!0:/Mac OS/.test(t)&&!/like Mac OS/.test(t)?ai.macOS=!0:/Android/.test(t)?ai.android=!0:/Linux/.test(t)?ai.linux=!0:/iP[ao]d|iPhone/i.test(t)?(ai.iOS=!0,navigator.appVersion.match(/OS (\d+)/),ai.iOSVersion=parseInt(RegExp.$1,10),ai.iPhone=-1!==t.toLowerCase().indexOf("iphone"),ai.iPad=-1!==t.toLowerCase().indexOf("ipad")):/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)?ai.kindle=!0:/CrOS/.test(t)&&(ai.chromeOS=!0),(/Windows Phone/i.test(t)||/IEMobile/i.test(t))&&(ai.android=!1,ai.iOS=!1,ai.macOS=!1,ai.windows=!0,ai.windowsPhone=!0);const e=/Silk/.test(t);return(ai.windows||ai.macOS||ai.linux&&!e||ai.chromeOS)&&(ai.desktop=!0),(ai.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(ai.desktop=!1),navigator.standalone&&(ai.webApp=!0),void 0!==window.cordova&&(ai.cordova=!0),void 0!==si&&si.versions&&si.versions.node&&(ai.node=!0),ai.node&&"object"==typeof si.versions&&(ai.nodeWebkit=!!si.versions["node-webkit"],ai.electron=!!si.versions.electron),void 0!==window.ejecta&&(ai.ejecta=!0),/Crosswalk/.test(t)&&(ai.crosswalk=!0),ai.pixelRatio=window.devicePixelRatio||1,ai})();const hi={chrome:!1,chromeVersion:0,edge:!1,firefox:!1,firefoxVersion:0,ie:!1,ieVersion:0,mobileSafari:!1,opera:!1,safari:!1,safariVersion:0,silk:!1,trident:!1,tridentVersion:0};var li=function(){const t=navigator.userAgent;return/Edge\/\d+/.test(t)?hi.edge=!0:/Chrome\/(\d+)/.test(t)&&!oi.windowsPhone?(hi.chrome=!0,hi.chromeVersion=parseInt(RegExp.$1,10)):/Firefox\D+(\d+)/.test(t)?(hi.firefox=!0,hi.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(t)&&oi.iOS?hi.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(t)?(hi.ie=!0,hi.ieVersion=parseInt(RegExp.$1,10)):/Opera/.test(t)?hi.opera=!0:/Safari/.test(t)&&!oi.windowsPhone?hi.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(t)&&(hi.ie=!0,hi.trident=!0,hi.tridentVersion=parseInt(RegExp.$1,10),hi.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(t)&&(hi.silk=!0),hi}();const ci={audioData:!1,dolby:!1,m4a:!1,mp3:!1,ogg:!1,opus:!1,wav:!1,webAudio:!1,webm:!1};var ui=function(){ci.audioData=!!window.Audio,ci.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);const t=document.createElement("audio"),e=!!t.canPlayType;try{if(e&&(t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(ci.ogg=!0),(t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||t.canPlayType("audio/opus;").replace(/^no$/,""))&&(ci.opus=!0),t.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(ci.mp3=!0),t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(ci.wav=!0),(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;").replace(/^no$/,""))&&(ci.m4a=!0),t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(ci.webm=!0),""!==t.canPlayType('audio/mp4;codecs="ec-3"')))if(li.edge)ci.dolby=!0;else if(li.safari&&li.safariVersion>=9&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){const t=parseInt(RegExp.$1,10),e=parseInt(RegExp.$2,10);(10===t&&e>=11||t>10)&&(ci.dolby=!0)}}catch(t){}return ci}();const di={available:!1,cancel:"",keyboard:!1,request:""};var pi=function(){const t=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"];for(let e=0;e<t.length;e++)if(document.documentElement[t[e]]){di.available=!0,di.request=t[e];break}const e=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(di.available)for(let t=0;t<e.length;t++)if(document[e[t]]){di.cancel=e[t];break}return window.Element&&Element.ALLOW_KEYBOARD_INPUT&&!/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)&&(di.keyboard=!0),Object.defineProperty(di,"active",{get:()=>!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}),di}();const fi={gamepads:!1,mspointer:!1,touch:!1,wheelEvent:null};var gi=(("ontouchstart"in document.documentElement||navigator.maxTouchPoints&&navigator.maxTouchPoints>=1)&&(fi.touch=!0),(navigator.msPointerEnabled||navigator.pointerEnabled)&&(fi.mspointer=!0),navigator.getGamepads&&(fi.gamepads=!0),"onwheel"in window||li.ie&&"WheelEvent"in window?fi.wheelEvent="wheel":"onmousewheel"in window?fi.wheelEvent="mousewheel":li.firefox&&"MouseScrollEvent"in window&&(fi.wheelEvent="DOMMouseScroll"),fi);let yi="";var mi=(()=>{const t=t=>{const e=["i","webkitI","msI","mozI","oI"];for(let i=0;i<e.length;i++){const n=`${e[i]}mageSmoothingEnabled`;if(n in t)return n}return null};return{disable:e=>(""===yi&&(yi=t(e)),yi&&(e[yi]=!1),e),enable:e=>(""===yi&&(yi=t(e)),yi&&(e[yi]=!0),e),getPrefix:t,isEnabled:t=>null!==yi?t[yi]:null}})();const vi=[];let xi=!1;var wi=(()=>{const t=(t,i=1,n=1,r=1,s=!1)=>{let a,o=e(r);return null===o?(o={parent:t,canvas:document.createElement("canvas"),type:r},1===r&&vi.push(o),a=o.canvas):(o.parent=t,a=o.canvas),s&&(o.parent=a),a.width=i,a.height=n,xi&&1===r&&mi.disable(a.getContext("2d")),a},e=(t=1)=>{if(2===t)return null;for(let e=0;e<vi.length;e++){const i=vi[e];if(!i.parent&&i.type===t)return i}return null},i=()=>{let t=0;return vi.forEach(e=>{e.parent&&(t+=1)}),t};return{create2D:(e,i,n)=>t(e,i,n,1),create:t,createWebGL:(e,i,n)=>t(e,i,n,2),disableSmoothing:()=>{xi=!0},enableSmoothing:()=>{xi=!1},first:e,free:()=>vi.length-i(),pool:vi,remove:t=>{const e=t instanceof HTMLCanvasElement;vi.forEach(i=>{(e&&i.canvas===t||!e&&i.parent===t)&&(i.parent=null,i.canvas.width=1,i.canvas.height=1)})},total:i}})();const bi={canvas:!1,canvasBitBltShift:null,file:!1,fileSystem:!1,getUserMedia:!0,littleEndian:!1,localStorage:!1,pointerLock:!1,support32bit:!1,vibration:!1,webGL:!1,worker:!1};var Ai=function(){bi.canvas=!!window.CanvasRenderingContext2D;try{bi.localStorage=!!localStorage.getItem}catch(t){bi.localStorage=!1}bi.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),bi.fileSystem=!!window.requestFileSystem;let t=!1;return bi.webGL=(()=>{if(window.WebGLRenderingContext)try{const e=wi.createWebGL(this),i=e.getContext("webgl")||e.getContext("experimental-webgl"),n=wi.create2D(this),r=n.getContext("2d").createImageData(1,1);return t=r.data instanceof Uint8ClampedArray,wi.remove(e),wi.remove(n),!!i}catch(t){return!1}return!1})(),bi.worker=!!window.Worker,bi.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,bi.getUserMedia=bi.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,li.firefox&&li.firefoxVersion<21&&(bi.getUserMedia=!1),!oi.iOS&&(li.ie||li.firefox||li.chrome)&&(bi.canvasBitBltShift=!0),(li.safari||li.mobileSafari)&&(bi.canvasBitBltShift=!1),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(bi.vibration=!0),"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(bi.littleEndian=function(){const t=new ArrayBuffer(4),e=new Uint8Array(t),i=new Uint32Array(t);return e[0]=161,e[1]=178,e[2]=195,e[3]=212,3569595041===i[0]||2712847316!==i[0]&&null}()),bi.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==bi.littleEndian&&t,bi}();const Mi={supportInverseAlpha:!1,supportNewBlendModes:!1};var _i=(void 0!==document&&(Mi.supportNewBlendModes=function(){const t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",e="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",i=new Image;return i.onload=()=>{const n=new Image;n.onload=()=>{const t=wi.create(n,6,1).getContext("2d");if(t.globalCompositeOperation="multiply",t.drawImage(i,0,0),t.drawImage(n,2,0),!t.getImageData(2,0,1,1))return;const{data:e}=t.getImageData(2,0,1,1);wi.remove(n),Mi.supportNewBlendModes=255===e[0]&&0===e[1]&&0===e[2]},n.src=`${t}/wCKxvRF${e}`},i.src=`${t}AP804Oa6${e}`,!1}(),Mi.supportInverseAlpha=function(){const t=wi.create(this,2,1).getContext("2d");t.fillStyle="rgba(10, 20, 30, 0.5)",t.fillRect(0,0,1,1);const e=t.getImageData(0,0,1,1);if(null===e)return!1;t.putImageData(e,1,0);const i=t.getImageData(1,0,1,1);return i.data[0]===e.data[0]&&i.data[1]===e.data[1]&&i.data[2]===e.data[2]&&i.data[3]===e.data[3]}()),Mi);const Si={h264Video:!1,hlsVideo:!1,mp4Video:!1,oggVideo:!1,vp9Video:!1,webmVideo:!1};var Pi=(()=>{const t=document.createElement("video"),e=!!t.canPlayType;try{e&&(t.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(Si.oggVideo=!0),t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(Si.h264Video=!0,Si.mp4Video=!0),t.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(Si.webmVideo=!0),t.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(Si.vp9Video=!0),t.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(Si.hlsVideo=!0))}catch(t){}return Si})();function Yi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ci(t,e,i){return e&&Xi(t.prototype,e),i&&Xi(t,i),t}function Ei(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var ki=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Yi(this,t),Ei(this,"minFps",15),Ei(this,"targetFps",60),Ei(this,"maxRestartAttempts",1/0),Ei(this,"runTime",1/0),Ei(this,"forceSetTimeout",!1),Object.assign(this,e)}return Ci(t,[{key:"minFpsCalc",get:function(){return Math.floor(1e3/this.minFps)}},{key:"targetFpsCalc",get:function(){return Math.floor(1e3/this.targetFps)}}]),t}(),Bi=function(){function t(){Yi(this,t),Ei(this,"id",0),Ei(this,"running",!1),Ei(this,"fn",function(){}),Ei(this,"usingSetTimeout",!1),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||function(){clearTimeout(this.id)}}return Ci(t,[{key:"start",value:function(t,e){var i=this;this.running||(this.running=!0,this.fn=t,e?(this.usingSetTimeout=!0,this.updateTimeout()):window.requestAnimationFrame(function(t){return i.updateRAF(t)}))}},{key:"updateRAF",value:function(t){var e=this;this.running=!0,this.fn(t),this.id=window.requestAnimationFrame(function(t){return e.updateRAF(t)})}},{key:"updateTimeout",value:function(){var t=this,e=window.performance.now();this.fn(e),this.id=window.setTimeout(function(){return t.updateTimeout()},1e3/60)}},{key:"restart",value:function(){var t=this;this.usingSetTimeout?window.clearTimeout(this.id):window.cancelAnimationFrame(this.id),this.id=0,this.running=!1,this.usingSetTimeout?this.updateTimeout():window.requestAnimationFrame(function(e){return t.updateRAF(e)}),this.running=!0}},{key:"stop",value:function(){this.usingSetTimeout?window.clearTimeout(this.id):window.cancelAnimationFrame(this.id),this.id=0,this.running=!1,this.fn=function(){}}}]),t}(),Ti=function(){function t(e){Yi(this,t),Ei(this,"_options",void 0),Ei(this,"_restartAttempts",void 0),Ei(this,"_running",void 0),Ei(this,"_paused",void 0),Ei(this,"_fn",void 0),Ei(this,"_frame",void 0),Ei(this,"_time",void 0),Ei(this,"_prevTime",void 0),Ei(this,"_delta",void 0),Ei(this,"_deltaAverage",void 0),Ei(this,"_deltaHistory",void 0),Ei(this,"_deltaIndex",void 0),Ei(this,"_raf",void 0),Ei(this,"_hidden",void 0),this._options=new ki(e),this._restartAttempts=0,this._running=!1,this._paused=!1,this._fn=function(){},this._frame=0,this._time=0,this._prevTime=0,this._delta=0,this._deltaAverage=0,this._deltaHistory=[],this._deltaIndex=0,this._raf=new Bi,this._hidden=document.hidden,this._boot()}return Ci(t,[{key:"start",value:function(t){var e=this;this._fn=t,this._prevTime=0,this._running=!0,this._raf.start(function(t){return e._update(t)},this._options.forceSetTimeout)}},{key:"pause",value:function(){this._paused=!0,this._running=!1}},{key:"resume",value:function(){this._paused=!1,this._prevTime=window.performance.now(),this._running=!0}},{key:"stop",value:function(){var t=this;this._restartAttempts=0,this._running=!1,this._paused=!1,this._fn=function(){},this._frame=0,this._time=0,this._prevTime=0,this._delta=0,this._deltaHistory=[],this._deltaIndex=0,document.removeEventListener("visibilitychange",function(){return t._visibilityChange}),this._raf.stop()}},{key:"_boot",value:function(){var t=this;document.addEventListener("visibilitychange",function(){return t._visibilityChange})}},{key:"_update",value:function(t){if(!this._paused)if(t>=this._options.runTime)this.stop();else{this._time=t,this._delta=t-this._prevTime,10===this._deltaIndex&&(this._deltaIndex=0),this._deltaHistory[this._deltaIndex]=this._delta,this._deltaIndex++;for(var e=0,i=0;i<this._deltaHistory.length;++i)e+=this._deltaHistory[i];if(e/=10,this._deltaAverage=e,this._deltaAverage>=this._options.minFpsCalc){if(this._restartAttempts===this._options.maxRestartAttempts)return void this.stop();this._raf.restart(),this._restartAttempts++}this._deltaAverage>=this._options.targetFpsCalc&&(this._frame++,this._fn(t,this._delta,this._deltaAverage),this._prevTime=t)}}},{key:"_visibilityChange",value:function(){var t=document.visibilityState;"visible"===t?this.resume():"hidden"===t&&this.pause()}},{key:"timesRestarted",get:function(){return this._restartAttempts}},{key:"isRunning",get:function(){return this._running}},{key:"isPaused",get:function(){return this._paused}},{key:"frame",get:function(){return this._frame}}]),t}();const Ri=new e,{log:Oi}=console,Ii=g(window.location.search,{ignoreQueryPrefix:!0});Oi(oi),Oi(li),Oi(ui),Oi(pi),Oi(gi),Oi(Ai),Oi(_i),Oi(Pi);const Fi=parseInt(Ii.units,10),Li=parseInt(Ii.foods,10),Di=parseInt(Ii.radius,10);Ri.showPanel(0),document.body.appendChild(Ri.dom);const Ui=document.getElementById("cas"),ji=window.innerWidth,Wi=window.innerHeight,Vi={SPACE:32,SHIFT:16},zi=new class extends O{constructor({playerID:t="player",canvas:e=document.createElement("canvas"),vWidth:i=window.innerWidth,vHeight:n=window.innerHeight,scale:r=1,x:s=0,y:a=0,radius:o=y,drawDebug:h=R}){super(),this.canvas=e,this.radius=o,this.pow2R=o*o,this.x=s,this.y=a,this.vWidth=i,this.vHeight=n,this.canvas.width=i,this.canvas.height=n,this.ctx=this.canvas.getContext("2d"),this.drawDebug=h,this.view=new Ce(this,i,n),this.smallMap=new Xe(this,30,50),this.units=[],this.playerID=t,this.foods=new St,this.globalColliders=new St,this.updateQuene=new ie,this.setScale(r),this.toScale=this.scale,this.numBotsToUpdate=0,this.botUpdateIdx=0,this.foodsOnField=0,this.isScaled=!1,this.tempVec=new Dt,this.tempVec1=new Dt}initUnits(t){let e=-1;for(;++e<t;){let i=oe(this.x,this.y,this.radius,2*M*4);const n=e===t-1,r=new Ye(this,{x:i.x,y:i.y,size:M,length:_,angle:pe(0,2*Math.PI,Math.random()),fillColor:"#00FF00",idx:e,isPlayer:n,isActive:!0,key:n?this.playerID:`unit${e}`});for(;this.globalColliders.collides(r.head.getAABB());)i=oe(this.x,this.y,this.radius,2*M*4),r.setXY(i.x,i.y);this.units.push(r),this.globalColliders.insert(r.head.getAABB())}this.player=this.units[this.units.length-1],this.numBotsToUpdate=Math.ceil(this.units.length/(60*b)),Ee(`${this.numBotsToUpdate} bots will be updated in one tick`)}initFoods(t){this.foodsOnField=t;for(let e=t;e;e-=1){const t=re(1,10),e=Math.floor(2*t+10),i=oe(this.x,this.y,this.radius,2*e);this.foods.insert(new Me(this,{size:e,point:t,x:i.x,y:i.y,lightSpeed:w}))}}updateAABBsQuene(){let t=!0;for(;this.updateQuene.length>0&&t;){const e=this.updateQuene.shift();e.inQuene=!1,e.needResize=e.width>e.shadowSize-.1*S,e.isActive&&e.needResize&&e.width>.9*e.shadowSize?(t=!1,e.needResize=!1,e.shadowSize+=S,e.updateAABBs(),Ee(`AABBs Quene updated. Quene length: ${this.updateQuene.length}, updated Snake ${e.idx}`)):Ee(`Snake ${e.idx} shift from quene without update`)}}setScale(t){this.scale!==t&&(this.scale=t<1?1:t,this.paintRadius=this.view.relativeW(this.radius),this.emit("scale_changed"))}setToScale(t){this.toScale=t}clear(){this.ctx.clearRect(0,0,this.view.width,this.view.height)}update(t){this.updateAABBsQuene(),this.checkCollisions(),this.scale!==this.toScale&&this.setScale(this.toScale);let e=-1;for(;++e<this.units.length;){const i=this.units[e];i.update(t);const n=i.head.getPoly(),r=[n.l0X,n.l0Y,n.r0X,n.r0Y,n.r1X,n.r1Y,n.l1X,n.l1Y],s=ce(n.l1X,n.l1Y,this.x,this.y),a=ce(n.r1X,n.r1Y,this.x,this.y);if(s<this.pow2R&&a<this.pow2R){const t=Ae(n.l1X,n.l1Y,i.vx,i.vy,this.x,this.y,this.radius),o=Ae(n.r1X,n.r1Y,i.vx,i.vy,this.x,this.y,this.radius),h=Ae(i.x,i.y,i.vx,i.vy,this.x,this.y,this.radius),l=Math.min(ce(t.isec[0].x,t.isec[0].y,n.l1X,n.l1Y),ce(o.isec[0].x,o.isec[0].y,n.r1X,n.r1Y));this.tempVec.set(this.x-h.isec[0].x,this.y-h.isec[0].y),this.tempVec.normalize();const c=100*i.speed/(2*Math.sin(1e3*A))+i.width;if((l<c*c||Math.min(s,a)<c-25)&&!i.isPlayer){const t=ye([i.vx,i.vy],[this.tempVec.x,this.tempVec.y]);i.speedDown(),i.toAngle=Math.atan2(t[1],t[0]),i.boundsAway=!0}else i.boundsAway=!1;const u=this.foods.search(i.head.getAABB());let d=-1;for(;++d<u.length;)if(_t(r,u[d].x,u[d].y,.5*u[d].width)){this.foods.remove(u[d]),this.units[e].eat(u[d]);const t=Math.floor(30*Math.random()+50),i=Math.floor(t/3),n=oe(this.x,this.y,this.radius,2*i);this.foods.insert(new Me(this,{size:i,point:t,x:n.x,y:n.y,lightSpeed:w}))}}else this.kill(i)}this.updateBots()}kill(t){}render(t){this.view.trace(this.player),this.clear(),this.drawBackup(),this.drawFoods(t),this.drawSnakes(),this.smallMap.render()}drawBackup(){const{view:t,ctx:e}=this,{aabb:i}=t,n=i.minX-this.x,r=i.minY-this.y,s=i.maxX-this.x,a=i.maxY-this.y,o=n*n,h=r*r,l=s*s,c=a*a,u=o+h,d=l+h,p=o+c,f=l+c;Math.max(u,d,p,f)>this.pow2R?this.drawBounds():(e.save(),e.fillStyle="#FFFFE0",e.fillRect(0,0,t.width,t.height),e.restore()),e.restore()}checkCollisions(){let t=-1;for(;++t<this.units.length;){this.units[t].isCollided=!1;const e=this.units[t].head.getPoly(),i=this.globalColliders.search(this.units[t].head.getAABB());let n=-1;for(;++n<i.length;)if(i[n].snakeIdx!==this.units[t].idx){const r=i[n].parent.getPoly(i[n].parent.width);if(Mt([e.l0X,e.l0Y,e.r0X,e.r0Y,e.r1X,e.r1Y,e.l1X,e.l1Y],[r.l0X,r.l0Y,r.r0X,r.r0Y,r.r1X,r.r1Y,r.l1X,r.l1Y])){this.units[t].isCollided=!0;break}}}}updateBots(){const t=this.botUpdateIdx;let e=0,i=!0;for(;i;){if(this.units[this.botUpdateIdx].isActive&&!this.units[this.botUpdateIdx].boundsAway){e+=1;const t=this.units[this.botUpdateIdx];0!==t.distances.length&&(t.distances.length=0);const i=ke.bind(null,t.idx),{cX:n,cY:r,x:s,y:a}=t.head,o=t.head.getPoly(),h=[o.l0X,o.l0Y,o.r0X,o.r0Y,o.r1X,o.r1Y,o.l1X,o.l1Y],l=Be.bind(null,t),c=Et(this.foods,n,r,1,l);if(c.length>0){t.toAngle=Math.atan2(c[0].y-a,c[0].x-s);const e=ce(c[0].x,c[0].y,s,a);e<(600+t.width)*(600+t.width)&&e>(150+t.width)*(150+t.width)&&Math.abs(ge(t.angle,t.toAngle))<.261799?t.speedUp():t.speedDown()}const u=Et(this.globalColliders,n,r,void 0,i,9e4);if(u.length>0){let e=-1,i=0,n=0;for(;++e<u.length;){const r=u[e].parent.getPoly(),s=te.distance(h,[r.l0X,r.l0Y,r.r0X,r.r0Y,r.r1X,r.r1Y,r.l1X,r.l1Y]);if(s.distance<=k&&s.distance>0){s.direction.negate();const e=s.direction.clone().scale(k/s.distance);t.distances.push(s),i+=2*e.x*e.y,n+=e.x*e.x-e.y*e.y}}if(t.distances.length>0){const e=.5*Math.atan2(i,n);t.head.sumDirectionX=Math.cos(e),t.head.sumDirectionY=Math.sin(e)}}}this.botUpdateIdx=(this.botUpdateIdx+1)%(this.units.length-1),i=this.botUpdateIdx!==t&&e<this.numBotsToUpdate}}drawBounds(){const{ctx:t,view:e}=this,i=[],n=e.relativeX(this.x),r=e.relativeY(this.y),s=be(n,r,this.paintRadius,0,0,e.width,e.height);if(s.length>0){t.save(),t.beginPath(),t.moveTo(s[0].x,s[0].y);let a=-1;for(;++a<s.length;){const o=s[(a+1)%s.length];if(!Ft(s[a].x,o.x)||!Ft(s[a].y,o.y)){const h=s[a].x,l=s[a].y,c=o.x,u=o.y;let d=ve(Math.atan2(l-r,h-n)),p=ve(Math.atan2(u-r,c-n));const f=.5*(h+c),g=.5*(l+u);if(le(p,d)<0){const t=d;d=p,p=t}f>0&&f<e.width&&g>0&&g<e.height?(t.arc(n,r,this.paintRadius,d,p),i.push({angle1:d,angle2:p})):t.lineTo(c,u)}}for(t.fillStyle="#FFFFE0",t.closePath(),t.fill(),t.restore(),a=-1,t.save(),t.lineCap="square",t.strokeStyle="#FFFFFF",t.lineWidth=e.relativeW(10),t.shadowOffsetY=e.relativeW(X),t.shadowOffsetX=e.relativeW(Y),t.shadowBlur=e.relativeW(C),t.shadowColor="rgba(0, 0, 0, 0.5)",t.beginPath();++a<i.length;)t.beginPath(),t.arc(n,r,this.paintRadius+.5*e.relativeW(10),i[a].angle1,i[a].angle2),t.stroke();t.restore(),a=-1,t.save();const o=e.relativeW(15),h=e.relativeW(30);for(t.lineCap="square",t.strokeStyle="#FF0000",t.lineWidth=e.relativeW(10);++a<i.length;){t.beginPath(),t.arc(n,r,this.paintRadius+.5*e.relativeW(10),i[a].angle1,i[a].angle2);const s=this.paintRadius*i[a].angle1;t.setLineDash([o,h]),t.lineDashOffset=s,t.stroke()}t.restore()}}drawFoods(t){const e=this.foods.search(this.view.aabb);let i=-1;for(this.ctx.save();++i<e.length;)e[i].render(t);this.ctx.restore()}drawSnakes(){const{view:t,ctx:e}=this,i=this.globalColliders.search(t.aabb);V(i).asc(["snakeIdx","idx"]);let n=0,r=0;for(;n<i.length;){const s=i[n].parent.snake,a=s.idx,o=s.width,h=s.fillColor;if(e.save(),e.lineCap="butt",e.lineJoin="round",e.strokeStyle=h,e.lineWidth=t.relativeW(o),s.speed!==m){const i=s.width*E;e.shadowBlur=t.relativeW(re(i-3,i+3)),e.shadowColor="rgba(255, 0, 0, 0.5)"}else e.shadowColor="rgba(0, 0, 0, 0)";let l=!1,c=i[r].idx;for(e.beginPath(),e.moveTo(t.relativeX(i[r].parent.x),t.relativeY(i[r].parent.y));r<i.length&&i[r].snakeIdx===a;){l=i[r].parent.isHead;const n=i[r].idx;l||(c!==n&&e.moveTo(t.relativeX(i[r].parent.x),t.relativeY(i[r].parent.y)),e.lineTo(t.relativeX(i[r].parent.nextX),t.relativeY(i[r].parent.nextY))),c=n+1,r+=1}e.stroke(),e.restore(),l&&this.drawHead(s),n=r}if(this.drawDebug){for(e.save(),e.lineWidth=1,n=-1;++n<i.length;){const r=i[n].parent.getPoly(i[n].parent.snake.width),s=i[n];e.strokeStyle="#000",e.beginPath(),e.moveTo(t.relativeX(r.l0X),t.relativeY(r.l0Y)),e.lineTo(t.relativeX(r.r0X),t.relativeY(r.r0Y)),e.lineTo(t.relativeX(r.r1X),t.relativeY(r.r1Y)),e.lineTo(t.relativeX(r.l1X),t.relativeY(r.l1Y)),e.closePath(),e.stroke(),e.strokeStyle="#FF1493",e.beginPath(),e.moveTo(t.relativeX(s.minX),t.relativeY(s.minY)),e.lineTo(t.relativeX(s.maxX),t.relativeY(s.minY)),e.lineTo(t.relativeX(s.maxX),t.relativeY(s.maxY)),e.lineTo(t.relativeX(s.minX),t.relativeY(s.maxY)),e.closePath(),e.stroke()}e.strokeStyle="FF0000",e.beginPath(),e.moveTo(t.relativeX(t.aabb.minX),t.relativeY(t.aabb.minY)),e.lineTo(t.relativeX(t.aabb.maxX),t.relativeY(t.aabb.minY)),e.lineTo(t.relativeX(t.aabb.maxX),t.relativeY(t.aabb.maxY)),e.lineTo(t.relativeX(t.aabb.minX),t.relativeY(t.aabb.maxY)),e.closePath(),e.stroke(),e.restore()}}drawHead(t){const{view:e,ctx:i}=this;i.save(),i.translate(e.relativeX(t.x),e.relativeY(t.y)),i.rotate(t.angle),i.fillStyle="blue",i.shadowOffsetY=e.relativeW(4),i.shadowBlur=e.relativeW(7),i.shadowColor="rgba(0, 0, 0, 0.5)",i.fillRect(0,-.5*e.relativeW(t.width),e.relativeH(t.height),e.relativeW(t.width)),i.setTransform(1,0,0,1,0,0),i.translate(e.relativeX(t.x),e.relativeY(t.y+P)),i.rotate(t.angle),i.fillStyle=this.drawDebug&&t.isCollided?"#FF0000":"blue",i.shadowOffsetY=0,i.shadowBlur=0,i.shadowColor="rgba(0, 0, 0, 0)",i.fillRect(0,-.5*e.relativeW(t.width),e.relativeH(t.height),e.relativeW(t.width)),i.fillStyle="white";const n=e.relativeW(t.width),r=e.relativeH(t.height);if(i.fillRect(.2*r,-.3*n,.6*r,.6*n),i.setTransform(1,0,0,1,0,0),i.restore(),this.drawDebug){i.save();const{head:n}=t,r=e.relativeH(t.height+50),s=e.relativeX(n.x),a=e.relativeY(n.y);i.lineWidth=1;const o=e.relativeX(t.x+Math.cos(t.angle-t.halfVisionAngle)*(t.height+100)),h=e.relativeY(t.y+Math.sin(t.angle-t.halfVisionAngle)*(t.height+100));if(i.beginPath(),i.moveTo(s,a),i.lineTo(o,h),i.arc(s,a,r+50,t.angle-t.halfVisionAngle,t.angle+t.halfVisionAngle),i.globalAlpha=.2,i.fillStyle="#228B22",i.fill(),t.angle!==t.toAngle){const e=s+Math.cos(t.toAngle)*r,n=a+Math.sin(t.toAngle)*r;i.beginPath(),i.moveTo(s,a),i.lineTo(e,n),i.arc(s,a,r,t.toAngle,t.angle,le(t.angle,t.toAngle)<0),i.globalAlpha=.3,i.fillStyle="#DC143C",i.fill(),i.globalAlpha=1,i.beginPath(),i.moveTo(s,a),i.lineTo(e,n),i.strokeStyle="#DC143C",i.stroke()}if(i.strokeStyle="#8A2BE2",i.beginPath(),i.moveTo(s,a),i.lineTo(s+t.vx*r,a+t.vy*r),i.stroke(),i.lineWidth=1,i.strokeStyle="#FFD700",t.distances.length>0){let e=-1;for(;++e<t.distances.length;)i.beginPath(),i.moveTo(s,a),i.lineTo(s+t.distances[e].direction.x*r,a+t.distances[e].direction.y*r),i.stroke();i.strokeStyle="#CD853F",i.beginPath(),i.moveTo(s,a),i.lineTo(s+n.sumDirectionX*r*1.5,a+n.sumDirectionY*r*1.5),i.stroke()}i.restore()}}}({playerID:"player",canvas:Ui,vWidth:ji,vHeight:Wi,radius:Di||y});Oi(`Создан игровой мир с радиусом ${zi.radius}`);const Hi={},$i=new Ti({minFps:5,maxRestartAttempts:10});Oi("Инициализация игры"),Oi("Инициализация слайзеров"),zi.initUnits(Fi||T),Oi(`Создано ${zi.units.length} слайзеров`),Oi("Инициализация еды"),zi.initFoods(Li||B),Oi(`Создано ${zi.foodsOnField} единиц еды`),Oi("Биндинг глобальных листенеров"),function(){function t(t){if(t.preventDefault(),t.touches)Hi.x=t.touches[0].pageX,Hi.y=t.touches[0].pageY;else{const e=t||window.event;Hi.x=e.clientX,Hi.y=e.clientY}zi.player.toAngle=function(t,e,i,n){const r=i-t,s=n-e;return Math.atan2(s,r)}(zi.player.x,zi.player.y,zi.view.absoluteX(Hi.x),zi.view.absoluteY(Hi.y))}navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)?(window.addEventListener("touchstart",t),window.addEventListener("touchmove",t)):(window.addEventListener("mousemove",t),window.addEventListener("mousedown",()=>{zi.player.length<=zi.player.minLength||zi.player.speedUp()}),window.addEventListener("mouseup",()=>{zi.player.speedDown()}),window.addEventListener("keyup",t=>{switch(t.keyCode){case Vi.SPACE:zi.drawDebug=!zi.drawDebug,Oi(`Draw debug: ${zi.drawDebug}`);break;case Vi.SHIFT:zi.isScaled=!zi.isScaled,Oi(`Scale game: ${zi.isScaled}`)}})),Re(zi),zi.on(Te.HIDDEN,function(){$i.pause(),zi.emit(Te.PAUSE),Oi("Игра остановлена")}),zi.on(Te.VISIBLE,function(){$i.resume(),zi.emit(Te.RESUME),Oi("Игра запущена")})}(),Oi("Старт игрового процесса"),zi.emit(Te.VISIBLE),$i.start(function(t,e,i){Ri.begin(),zi.isScaled&&zi.scale<2?zi.setToScale(zi.scale+.1):zi.scale>1&&!zi.isScaled&&zi.setToScale(zi.scale-.1);let n=e;e<i&&(n=i);zi.update(n),zi.render(n),Ri.end()})}();
//# sourceMappingURL=bundle.js.map
