!function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}var i=e(function(t,e){var i;t.exports=((i=function(){var t=0,e=document.createElement("div");function n(t){return e.appendChild(t.dom),t}function s(i){for(var n=0;n<e.children.length;n++)e.children[n].style.display=n===i?"block":"none";t=i}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(i){i.preventDefault(),s(++t%e.children.length)},!1);var r=(performance||Date).now(),h=r,a=0,o=n(new i.Panel("FPS","#0ff","#002")),l=n(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=n(new i.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:e,addPanel:n,showPanel:s,begin:function(){r=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-r,200),h+1e3<=t&&(o.update(1e3*a/(t-h),100),h=t,a=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:e,setMode:s}}).Panel=function(t,e,i){var n=1/0,s=0,r=Math.round,h=r(window.devicePixelRatio||1),a=80*h,o=48*h,l=3*h,c=2*h,u=3*h,f=15*h,d=74*h,p=30*h,v=document.createElement("canvas");v.width=a,v.height=o,v.style.cssText="width:80px;height:48px";var g=v.getContext("2d");return g.font="bold "+9*h+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,a,o),g.fillStyle=e,g.fillText(t,l,c),g.fillRect(u,f,d,p),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u,f,d,p),{dom:v,update:function(o,m){n=Math.min(n,o),s=Math.max(s,o),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,a,f),g.fillStyle=e,g.fillText(r(o)+" "+t+" ("+r(n)+"-"+r(s)+")",l,c),g.drawImage(v,u+h,f,d-h,p,u,f,d-h,p),g.fillRect(u+d-h,f,h,p),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u+d-h,f,h,r((1-o/m)*p))}}},i)}),n=e(function(t){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}});function s(){}function r(){r.init.call(this)}function h(t){return void 0===t._maxListeners?r.defaultMaxListeners:t._maxListeners}function a(t,e,i,n){var r,a,o,l;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),o=a[e]):(a=t._events=new s,t._eventsCount=0),o){if("function"==typeof o?o=a[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),!o.warned&&(r=h(t))&&r>0&&o.length>r){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,l=c,"function"==typeof console.warn?console.warn(l):console.log(l)}}else o=a[e]=i,++t._eventsCount;return t}function o(t,e,i){var n=!1;function s(){t.removeListener(e,s),n||(n=!0,i.apply(t,arguments))}return s.listener=i,s}function l(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function c(t,e){for(var i=new Array(e);e--;)i[e]=t[e];return i}s.prototype=Object.create(null),r.EventEmitter=r,r.usingDomains=!1,r.prototype.domain=void 0,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.init=function(){this.domain=null,r.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new s,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},r.prototype.getMaxListeners=function(){return h(this)},r.prototype.emit=function(t){var e,i,n,s,r,h,a,o="error"===t;if(h=this._events)o=o&&null==h.error;else if(!o)return!1;if(a=this.domain,o){if(e=arguments[1],!a){if(e instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=a,e.domainThrown=!1,a.emit("error",e),!1}if(!(i=h[t]))return!1;var u="function"==typeof i;switch(n=arguments.length){case 1:!function(t,e,i){if(e)t.call(i);else for(var n=t.length,s=c(t,n),r=0;r<n;++r)s[r].call(i)}(i,u,this);break;case 2:!function(t,e,i,n){if(e)t.call(i,n);else for(var s=t.length,r=c(t,s),h=0;h<s;++h)r[h].call(i,n)}(i,u,this,arguments[1]);break;case 3:!function(t,e,i,n,s){if(e)t.call(i,n,s);else for(var r=t.length,h=c(t,r),a=0;a<r;++a)h[a].call(i,n,s)}(i,u,this,arguments[1],arguments[2]);break;case 4:!function(t,e,i,n,s,r){if(e)t.call(i,n,s,r);else for(var h=t.length,a=c(t,h),o=0;o<h;++o)a[o].call(i,n,s,r)}(i,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(s=new Array(n-1),r=1;r<n;r++)s[r-1]=arguments[r];!function(t,e,i,n){if(e)t.apply(i,n);else for(var s=t.length,r=c(t,s),h=0;h<s;++h)r[h].apply(i,n)}(i,u,this,s)}return!0},r.prototype.addListener=function(t,e){return a(this,t,e,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(t,e){return a(this,t,e,!0)},r.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,o(this,t,e)),this},r.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,o(this,t,e)),this},r.prototype.removeListener=function(t,e){var i,n,r,h,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(i=n[t]))return this;if(i===e||i.listener&&i.listener===e)0==--this._eventsCount?this._events=new s:(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,h=i.length;h-- >0;)if(i[h]===e||i[h].listener&&i[h].listener===e){a=i[h].listener,r=h;break}if(r<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new s,this;delete n[t]}else!function(t,e){for(var i=e,n=i+1,s=t.length;n<s;i+=1,n+=1)t[i]=t[n];t.pop()}(i,r);n.removeListener&&this.emit("removeListener",t,a||e)}return this},r.prototype.removeAllListeners=function(t){var e,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new s,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new s:delete i[t]),this;if(0===arguments.length){for(var n,r=Object.keys(i),h=0;h<r.length;++h)"removeListener"!==(n=r[h])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new s,this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},r.prototype.listeners=function(t){var e,i=this._events;return i&&(e=i[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(e):[]},r.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):l.call(t,e)},r.prototype.listenerCount=l,r.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var u=t.performance&&t.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date},f="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function d(){throw new Error("setTimeout has not been defined")}function p(){throw new Error("clearTimeout has not been defined")}var v=d,g=p;function m(t){if(v===setTimeout)return setTimeout(t,0);if((v===d||!v)&&setTimeout)return v=setTimeout,setTimeout(t,0);try{return v(t,0)}catch(e){try{return v.call(null,t,0)}catch(e){return v.call(this,t,0)}}}"function"==typeof f.setTimeout&&(v=setTimeout),"function"==typeof f.clearTimeout&&(g=clearTimeout);var y,x=[],w=!1,b=-1;function M(){w&&y&&(w=!1,y.length?x=y.concat(x):b=-1,x.length&&_())}function _(){if(!w){var t=m(M);w=!0;for(var e=x.length;e;){for(y=x,x=[];++b<e;)y&&y[b].run();b=-1,e=x.length}y=null,w=!1,function(t){if(g===clearTimeout)return clearTimeout(t);if((g===p||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(t);try{g(t)}catch(e){try{return g.call(null,t)}catch(e){return g.call(this,t)}}}(t)}}function Y(t,e){this.fun=t,this.array=e}Y.prototype.run=function(){this.fun.apply(null,this.array)};function X(){}var A=X,B=X,S=X,L=X,k=X,P=X,E=X;var C=f.performance||{},R=C.now||C.mozNow||C.msNow||C.oNow||C.webkitNow||function(){return(new Date).getTime()};var T=new Date;for(var D={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];x.push(new Y(t,e)),1!==x.length||w||m(_)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:A,addListener:B,once:S,off:L,removeListener:k,removeAllListeners:P,emit:E,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*R.call(C),i=Math.floor(e),n=Math.floor(e%1*1e9);return t&&(i-=t[0],(n-=t[1])<0&&(i--,n+=1e9)),[i,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-T)/1e3}},I=e(function(e){(function(){var t,i,n,s,r,h;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:null!=D&&D.hrtime?(e.exports=function(){return(t()-r)/1e6},i=D.hrtime,s=(t=function(){var t;return 1e9*(t=i())[0]+t[1]})(),h=1e9*D.uptime(),r=s-h):Date.now?(e.exports=function(){return Date.now()-n},n=Date.now()):(e.exports=function(){return(new Date).getTime()-n},n=(new Date).getTime())}).call(t)}),F="undefined"==typeof window?t:window,W=["moz","webkit"],z="AnimationFrame",O=F["request"+z],H=F["cancel"+z]||F["cancelRequest"+z],N=0;!O&&N<W.length;N++)O=F[W[N]+"Request"+z],H=F[W[N]+"Cancel"+z]||F[W[N]+"CancelRequest"+z];if(!O||!H){var j=0,q=0,U=[];O=function(t){if(0===U.length){var e=I(),i=Math.max(0,1e3/60-(e-j));j=i+e,setTimeout(function(){var t=U.slice(0);U.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(j)}catch(t){setTimeout(function(){throw t},0)}},Math.round(i))}return U.push({handle:++q,callback:t,cancelled:!1}),q},H=function(t){for(var e=0;e<U.length;e++)U[e].handle===t&&(U[e].cancelled=!0)}}var Q=function(t){return O.call(F,t)};Q.cancel=function(){H.apply(F,arguments)},Q.polyfill=function(t){t||(t=F),t.requestAnimationFrame=O,t.cancelAnimationFrame=H};var $=J;function J(t){if(!(this instanceof J))return new J(t);this.running=!1,this.last=u(),this._frame=0,this._tick=this.tick.bind(this),t&&this.on("tick",t)}n(J,r.EventEmitter),J.prototype.start=function(){if(!this.running)return this.running=!0,this.last=u(),this._frame=Q(this._tick),this},J.prototype.stop=function(){return this.running=!1,0!==this._frame&&Q.cancel(this._frame),this._frame=0,this},J.prototype.tick=function(){this._frame=Q(this._tick);var t=u(),e=t-this.last;this.emit("tick",e),this.last=t};const V=5e3,K=.3,G=.01,Z=40,tt=0,et=20,it=-6,nt=0,st=4,rt=7,ht=10,at=1e3,ot=100,lt=!1;var ct=e(function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(t,e,n,r,h){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,r||t,h),o=i?i+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],a]:t._events[o].push(a):(t._events[o]=a,t._eventsCount++),t}function h(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,n,s=[];if(0===this._eventsCount)return s;for(n in t=this._events)e.call(t,n)&&s.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},a.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,r=n.length,h=new Array(r);s<r;s++)h[s]=n[s].fn;return h},a.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,s,r,h){var a=i?i+t:t;if(!this._events[a])return!1;var o,l,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,s),!0;case 5:return c.fn.call(c.context,e,n,s,r),!0;case 6:return c.fn.call(c.context,e,n,s,r,h),!0}for(l=1,o=new Array(u-1);l<u;l++)o[l-1]=arguments[l];c.fn.apply(c.context,o)}else{var f,d=c.length;for(l=0;l<d;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,n);break;case 4:c[l].fn.call(c[l].context,e,n,s);break;default:if(!o)for(f=1,o=new Array(u-1);f<u;f++)o[f-1]=arguments[f];c[l].fn.apply(c[l].context,o)}}return!0},a.prototype.on=function(t,e,i){return r(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return r(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,n,s){var r=i?i+t:t;if(!this._events[r])return this;if(!e)return h(this,r),this;var a=this._events[r];if(a.fn)a.fn!==e||s&&!a.once||n&&a.context!==n||h(this,r);else{for(var o=0,l=[],c=a.length;o<c;o++)(a[o].fn!==e||s&&!a[o].once||n&&a[o].context!==n)&&l.push(a[o]);l.length?this._events[r]=1===l.length?l[0]:l:h(this,r)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&h(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a});const ut=function(t,e,i){return e===i?0:e<i?-t:null==e?1:null==i?-1:t},ft=function(t,e,i,n,s,r){return gt(t(s),t(r),e,i,n,s,r)},dt=function(t,e,i,n,s,r){return gt(s[t],r[t],e,i,n,s,r)},pt=function(t,e,i,n,s,r){const h=t.asc||t.desc,a=t.asc?1:-1;if(!h)throw Error("sort: Invalid 'by' sorting configuration.\n      Expecting object with 'asc' or 'desc' key");return vt(h)(h,e,i,a,s,r)},vt=function(t){const e=typeof t;return"string"===e?dt:"function"===e?ft:pt},gt=function(t,e,i,n,s,r,h){if(t===e||null==t&&null==e){if(i.length>n){return vt(i[n])(i[n],i,n+1,s,r,h)}return 0}return ut(s,t,e)},mt=function(t,e,i){if(!Array.isArray(e))return e;let n;return Array.isArray(i)&&i.length<2&&([i]=i),n=i?"string"==typeof i?function(t,e,i,n){return ut(t,i[e],n[e])}.bind(void 0,t,i):"function"==typeof i?function(t,e,i,n){return ut(t,e(i),e(n))}.bind(void 0,t,i):vt(i[0]).bind(void 0,i.shift(),i,0,t):ut.bind(void 0,t),e.sort(n)};var yt=function(t){return{asc:e=>mt(1,t,e),desc:e=>mt(-1,t,e),by:e=>{if(!Array.isArray(t))return t;if(!Array.isArray(e))throw Error("sort: Invalid usage of 'by' sorter. Array syntax is required.\n          Did you mean to use 'asc' or 'desc' sorter instead?");if(1===e.length){const i=e[0].asc?1:-1,n=e[0].asc||e[0].desc;if(!n)throw Error("sort: Invalid 'by' sorting configuration.\n            Expecting object with 'asc' or 'desc' key");return mt(i,t,n)}const i=pt.bind(void 0,e.shift(),e,0,void 0);return t.sort(i)}}},xt=function(t,e,i,n,s){var r=n-t,h=s-e;return r*r+h*h<=i*i},wt=function(t,e,i,n,s,r,h){var a=[s-t,r-e],o=[i-t,n-e],l=bt(o,o),c=bt(a,o)/l,u=[o[0]*(c=(c=c<0?0:c)>1?1:c)+t-s,o[1]*c+e-r];return bt(u,u)<=h*h};function bt(t,e){return t[0]*e[0]+t[1]*e[1]}var Mt=function(t,e,i,n,s,r,h){var a=i/2,o=n/2,l=Math.abs(s-(t+i/2)),c=Math.abs(r-(e+n/2));if(l>a+h||c>o+h)return!1;if(l<=a||c<=o)return!0;var u=l-a,f=c-o;return u*u+f*f<=h*h};function _t(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))}var Yt,Xt,At,Bt=function(t,e,i,n,s,r,h){return h=h||1,Math.abs(_t(t,e,i,n)-(_t(t,e,s,r)+_t(i,n,s,r)))<=h},St=function(t,e,i,n){var s,r,h=t.length,a=!1;for(s=0,r=h-2;s<h;s+=2)t[s+1]>i!=t[r+1]>i&&e<(t[r]-t[s])*(i-t[s+1])/(t[r+1]-t[s+1])+t[s]&&(a=!a),r=s;if(a)return!0;for(s=0;s<h;s+=2){var o,l,c=t[s],u=t[s+1];if(s===h-2?(o=t[0],l=t[1]):(o=t[s+2],l=t[s+3]),Bt(c,u,o,l,e,i,n))return!0}return!1},Lt=function(t,e,i,n){if(St(t,e,i))return!0;for(var s=t.length,r=0;r<s-2;r+=2)if(wt(t[r],t[r+1],t[r+2],t[r+3],e,i,n))return!0;return wt(t[0],t[1],t[s-2],t[s-1],e,i,n)},kt=10;function Pt(){Yt=[],Xt=[];for(var t=0;t<=kt;t++){var e=4<<t;Yt[t]=.5/Math.cos(4*Math.acos(0)/e),Xt[t]=.5/(Math.cos(2*Math.acos(0)/e)*Math.cos(2*Math.acos(0)/e))}At=!0}function Et(t,e,i,n,s,r,h){for(var a=1;a<=kt;a++){var o=(i+s)*Yt[a],l=(n+r)*Yt[a],c=t-o,u=e-l;if(c*c+u*u<=h)return!0;var f=s-o,d=r-l;if(c*f+u*d>=0&&c*f+u*d<=f*f+d*d&&(u*f-c*d>=0||h*(f*f+d*d)>=(u*f-c*d)*(u*f-c*d)))return!0;var p=i-o,v=n-l;if(c*p+u*v>=0&&c*p+u*v<=p*p+v*v&&(u*p-c*v<=0||h*(p*p+v*v)>=(u*p-c*v)*(u*p-c*v)))return!0;var g=(i+o)*Xt[a],m=(n+l)*Xt[a];if((g-t)*(g-t)+(m-e)*(m-e)<h)s=o,r=l;else{var y=o-g+o,x=l-m+l;if(!((y-t)*(y-t)+(x-e)*(x-e)<h)){var w=g-o,b=m-l;if(u*w-c*b<=0||h*(w*w+b*b)>(u*w-c*b)*(u*w-c*b))if(c*w+u*b>0){if(Math.abs(c*w+u*b)<=w*w+b*b||(t-g)*(i-g)+(e-m)*(n-m)>=0){s=o,r=l;continue}}else if(-(c*w+u*b)<=w*w+b*b||(t-y)*(s-y)+(e-x)*(r-x)>=0){i=o,n=l;continue}return!1}i=o,n=l}}return!1}var Ct={ellipseCircle:function(t,e,i,n,s,r,h){At||Pt();var a=Math.abs(s-t),o=Math.abs(r-e);return a*a+(n-o)*(n-o)<=h*h||(i-a)*(i-a)+o*o<=h*h||a*n+o*i<=i*n||(a*n+o*i-i*n)*(a*n+o*i-i*n)<=h*h*(i*i+n*n)&&a*i-o*n>=-n*n&&a*i-o*n<=i*i||((a-i)*(a-i)+(o-n)*(o-n)<=h*h||a<=i&&o-h<=n||o<=n&&a-h<=i)&&Et(a,o,i,0,0,n,h*h)},ellipseEllipse:function(t,e,i,n,s,r,h,a){At||Pt();var o=Math.abs(s-t)*a,l=Math.abs(r-e)*h;i*=a;var c=h*a;return o*o+((n*=h)-l)*(n-l)<=c*c||(i-o)*(i-o)+l*l<=c*c||o*n+l*i<=i*n||(o*n+l*i-i*n)*(o*n+l*i-i*n)<=c*c*(i*i+n*n)&&o*i-l*n>=-n*n&&o*i-l*n<=i*i||((o-i)*(o-i)+(l-n)*(l-n)<=c*c||o<=i&&l-c<=n||l<=n&&o-c<=i)&&Et(o,l,i,0,0,n,c*c)}},Rt=function(t,e,i,n,s,r,h){return Ct.ellipseCircle(t,e,i,n,s,r,h)},Tt=function(t,e,i,n,s,r,h,a){a=a||1;var o=0;return o+=xt(t,e,i,n,s)?1:0,o+=xt(t,e,i,n+r,s)?1:0,o+=xt(t,e,i,n,s+h)?1:0,0===(o+=xt(t,e,i,n+r,s+h)?1:0)?Mt(n,s,r,h,t,e,i):o>=1&&o<=3||(4===o?!(xt(t,e,i-a,n,s)&&xt(t,e,i-a,n+r,s)&&xt(t,e,i-a,n,s+h)&&xt(t,e,i-a,n+r,s+h)):void 0)},Dt=function(t,e,i,n,s,r,h,a){return a=a||1,wt(n,s,r,h,t,e,i)&&!(xt(t,e,i-a,n,s)&&xt(t,e,i-a,r,h))},It=function(t,e,i,n,s,r){return r=r||1,xt(t,e,i,n,s)&&!xt(t,e,i-r,n,s)},Ft=function(t,e,i,n,s,r,h,a){var o=i-t,l=n-e,c=h-s,u=a-r,f=(-l*(t-s)+o*(e-r))/(-c*l+o*u),d=(c*(e-r)-u*(t-s))/(-c*l+o*u);return f>=0&&f<=1&&d>=0&&d<=1},Wt=function(t,e,i,n,s,r){var h=s.length;if(St(s,t,e,r))return!0;for(var a=0;a<h;a+=2){var o=(a+2)%h;if(Ft(t,e,i,n,s[a],s[a+1],s[o],s[o+1]))return!0}return!1},zt=function(t,e){for(var i,n,s,r,h,a,o=t,l=e,c=[o,l],u=0;u<c.length;u++)for(var f=c[u],d=0;d<f.length;d+=2){var p=(d+2)%f.length,v={x:f[p+1]-f[d+1],y:f[d]-f[p]};for(i=n=null,a=0;a<o.length;a+=2)s=v.x*o[a]+v.y*o[a+1],(null===i||s<i)&&(i=s),(null===n||s>n)&&(n=s);for(r=h=null,a=0;a<l.length;a+=2)s=v.x*l[a]+v.y*l[a+1],(null===r||s<r)&&(r=s),(null===h||s>h)&&(h=s);if(n<r||h<i)return!1}return!0},Ot=function(t,e,i,n,s){return zt(t,[e,i,e+n,i,e+n,i+s,e,i+s])},Ht=function(t,e,i,n,s,r,h,a){s-=t,h-=t,r-=e,a-=e;var o=Math.pow(h-s,2)/i/i+Math.pow(a-r,2)/n/n,l=2*s*(h-s)/i/i+2*r*(a-r)/n/n,c=l*l-4*o*(s*s/i/i+r*r/n/n-1);if(0===c){var u=-l/2/o;return u>=0&&u<=1}if(c>0){var f=Math.sqrt(c),d=(-l+f)/2/o,p=(-l-f)/2/o;return d>=0&&d<=1||p>=0&&p<=1}return!1},Nt=function(t,e,i,n,s,r,h,a){return Ht(s,r,h,a,t,e,i,n)},jt=function(t,e,i,n,s){if(St(t,e,i))return!0;for(var r=t.length,h=0;h<r-2;h+=2)if(Nt(t[h],t[h+1],t[h+2],t[h+3],e,i,n,s))return!0;return Nt(t[0],t[1],t[r-2],t[r-1],e,i,n,s)},qt=function(t,e,i,n,s,r){return s>=t&&s<=t+i&&r>=e&&r<=e+n},Ut=function(t,e,i,n,s){const r=Math.atan2(n-e,i-t)-Math.PI/2,h=s/2,a=Math.cos(r)*h,o=Math.sin(r)*h;return[t-a,e-o,i-a,n-o,i+a,n+o,t+a,e+o]},Qt=function(t,e,i,n,s,r,h,a,o,l){return o||l?function(t,e,i,n,s,r,h,a,o,l){if(o&&l)return zt(Ut(t,e,i,n,o),Ut(s,r,h,a,l));if(o)return Wt(s,r,h,a,Ut(t,e,i,n,o));if(l)return Wt(t,e,i,n,Ut(s,r,h,a,o))}(t,e,i,n,s,r,h,a,o,l):Ft(t,e,i,n,s,r,h,a)};var $t=function(t,e,i,n,s,r,h,a){return!(!qt(s,r,h,a,t,e)&&!qt(s,r,h,a,i,n))||(Qt(t,e,i,n,s,r,s+h,r)||Qt(t,e,i,n,s+h,r,s+h,r+a)||Qt(t,e,i,n,s,r+a,s+h,r+a)||Qt(t,e,i,n,s,r,s,r+a))},Jt=function(t,e,i,n,s,r,h,a){return qt(s,r,h,a,t,e)||Ht(t,e,i,n,s,r,s+h,r)||Ht(t,e,i,n,s,r+a,s+h,r+a)||Ht(t,e,i,n,s,r,s,r+a)||Ht(t,e,i,n,s+h,r,s+h,r+a)},Vt=function(t,e,i,n,s,r){return Math.pow(s-t,2)/(i*i)+Math.pow(r-e,2)/(n*n)<=1},Kt={circlePoint:xt,circleCircle:function(t,e,i,n,s,r){var h=t-n,a=s-e,o=i+r;return h*h+a*a<=o*o},circleLine:function(t,e,i,n,s,r,h){return wt(n,s,r,h,t,e,i)},circleBox:function(t,e,i,n,s,r,h){return Mt(n,s,r,h,t,e,i)},circlePolygon:function(t,e,i,n){return Lt(n,t,e,i)},circleEllipse:function(t,e,i,n,s,r,h){return Rt(n,s,r,h,t,e,i)},circleOutlineBox:Tt,circleOutlineLine:Dt,circleOutlinePoint:It,polygonPoint:St,polygonLine:function(t,e,i,n,s,r){return Wt(e,i,n,s,t,r)},polygonPolygon:zt,polygonBox:Ot,polygonCircle:Lt,polygonEllipse:jt,boxPoint:qt,boxBox:function(t,e,i,n,s,r,h,a){return t<s+h&&t+i>s&&e<r+a&&e+n>r},boxLine:function(t,e,i,n,s,r,h,a){return $t(s,r,h,a,t,e,i,n)},boxPolygon:function(t,e,i,n,s){return Ot(s,t,e,i,n)},boxCircle:Mt,boxEllipse:function(t,e,i,n,s,r,h,a){return Jt(s,r,h,a,t,e,i,n)},boxCircleOutline:function(t,e,i,n,s,r,h,a){return Tt(s,r,h,t,e,i,n,a)},pointBox:function(t,e,i,n,s,r){return qt(i,n,s,r,t,e)},pointPolygon:function(t,e,i,n){return St(i,t,e,n)},pointCircle:function(t,e,i,n,s){return xt(i,n,s,t,e)},pointLine:function(t,e,i,n,s,r){return Bt(i,n,s,r,t,e)},pointEllipse:function(t,e,i,n,s,r){return Vt(i,n,s,r,t,e)},pointCircleOutline:function(t,e,i,n,s,r){return It(t,e,i,n,s,r)},lineLine:Qt,lineBox:$t,linePolygon:Wt,lineCircle:wt,linePoint:Bt,lineEllipse:Nt,lineCircleOutline:function(t,e,i,n,s,r,h,a){return Dt(s,r,h,t,e,i,n,a)},ellipsePoint:Vt,ellipseLine:Ht,ellipseBox:Jt,ellipseCircle:Rt,ellipseEllipse:function(t,e,i,n,s,r,h,a){return Ct.ellipseEllipse(t,e,i,n,s,r,h,a)},ellipsePolygon:function(t,e,i,n,s){return jt(s,t,e,i,n)}},Gt=Kt.polygonPolygon,Zt=Kt.polygonCircle,te=e(function(t,e){t.exports=function(){function t(t,n,s,r,h){!function t(i,n,s,r,h){for(;r>s;){if(r-s>600){var a=r-s+1,o=n-s+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(o-a/2<0?-1:1),f=Math.max(s,Math.floor(n-o*c/a+u)),d=Math.min(r,Math.floor(n+(a-o)*c/a+u));t(i,n,f,d,h)}var p=i[n],v=s,g=r;for(e(i,s,n),h(i[r],p)>0&&e(i,s,r);v<g;){for(e(i,v,g),v++,g--;h(i[v],p)<0;)v++;for(;h(i[g],p)>0;)g--}0===h(i[s],p)?e(i,s,g):e(i,++g,r),g<=n&&(s=g+1),n<=g&&(r=g-1)}}(t,n,s||0,r||t.length-1,h||i)}function e(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function i(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function r(t,e){h(t,0,t.children.length,e,t)}function h(t,e,i,n,s){s||(s=p(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var r=e;r<i;r++){var h=t.children[r];a(s,t.leaf?n(h):h)}return s}function a(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function o(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(e,i,n,s,r){for(var h=[i,n];h.length;)if(!((n=h.pop())-(i=h.pop())<=s)){var a=i+Math.ceil((n-i)/s/2)*s;t(e,a,i,n,r),h.push(i,a,a,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,i=[];if(!d(t,e))return i;for(var n=this.toBBox,s=[];e;){for(var r=0;r<e.children.length;r++){var h=e.children[r],a=e.leaf?n(h):h;d(t,a)&&(e.leaf?i.push(h):f(t,a)?this._all(h,i):s.push(h))}e=s.pop()}return i},n.prototype.collides=function(t){var e=this.data;if(!d(t,e))return!1;for(var i=[];e;){for(var n=0;n<e.children.length;n++){var s=e.children[n],r=e.leaf?this.toBBox(s):s;if(d(t,r)){if(e.leaf||f(t,r))return!0;i.push(s)}}e=i.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=p([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var i,n,r,h=this.data,a=this.toBBox(t),o=[],l=[];h||o.length;){if(h||(h=o.pop(),n=o[o.length-1],i=l.pop(),r=!0),h.leaf){var c=s(t,h.children,e);if(-1!==c)return h.children.splice(c,1),o.push(h),this._condense(o),this}r||h.leaf||!f(h,a)?n?(i++,h=n.children[i],r=!1):h=null:(o.push(h),l.push(i),i=0,n=h,h=h.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},n.prototype._build=function(t,e,i,n){var s,h=i-e+1,a=this._maxEntries;if(h<=a)return r(s=p(t.slice(e,i+1)),this.toBBox),s;n||(n=Math.ceil(Math.log(h)/Math.log(a)),a=Math.ceil(h/Math.pow(a,n-1))),(s=p([])).leaf=!1,s.height=n;var o=Math.ceil(h/a),l=o*Math.ceil(Math.sqrt(a));v(t,e,i,l,this.compareMinX);for(var c=e;c<=i;c+=l){var u=Math.min(c+l-1,i);v(t,c,u,o,this.compareMinY);for(var f=c;f<=u;f+=o){var d=Math.min(f+o-1,u);s.children.push(this._build(t,f,d,n-1))}}return r(s,this.toBBox),s},n.prototype._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var s=1/0,r=1/0,h=void 0,a=0;a<e.children.length;a++){var o=e.children[a],l=c(o),u=(f=t,d=o,(Math.max(d.maxX,f.maxX)-Math.min(d.minX,f.minX))*(Math.max(d.maxY,f.maxY)-Math.min(d.minY,f.minY))-l);u<r?(r=u,s=l<s?l:s,h=o):u===r&&l<s&&(s=l,h=o)}e=h||e.children[0]}var f,d;return e},n.prototype._insert=function(t,e,i){var n=i?t:this.toBBox(t),s=[],r=this._chooseSubtree(n,this.data,e,s);for(r.children.push(t),a(r,n);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(n,s,e)},n.prototype._split=function(t,e){var i=t[e],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);var h=this._chooseSplitIndex(i,s,n),a=p(i.children.splice(h,i.children.length-h));a.height=i.height,a.leaf=i.leaf,r(i,this.toBBox),r(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},n.prototype._splitRoot=function(t,e){this.data=p([t,e]),this.data.height=t.height+1,this.data.leaf=!1,r(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,i){for(var n,s,r,a,o,l,u,f=1/0,d=1/0,p=e;p<=i-e;p++){var v=h(t,0,p,this.toBBox),g=h(t,p,i,this.toBBox),m=(s=v,r=g,a=void 0,o=void 0,l=void 0,u=void 0,a=Math.max(s.minX,r.minX),o=Math.max(s.minY,r.minY),l=Math.min(s.maxX,r.maxX),u=Math.min(s.maxY,r.maxY),Math.max(0,l-a)*Math.max(0,u-o)),y=c(v)+c(g);m<f?(f=m,n=p,d=y<d?y:d):m===f&&y<d&&(d=y,n=p)}return n},n.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:o,s=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,s)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var s=this.toBBox,r=h(t,0,e,s),o=h(t,i-e,i,s),l=u(r)+u(o),c=e;c<i-e;c++){var f=t.children[c];a(r,t.leaf?s(f):f),l+=u(r)}for(var d=i-e-1;d>=e;d--){var p=t.children[d];a(o,t.leaf?s(p):p),l+=u(o)}return l},n.prototype._adjustParentBBoxes=function(t,e,i){for(var n=i;n>=0;n--)a(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():r(t[e],this.toBBox)},n}()}),ee=ne,ie=ne;function ne(t,e){if(!(this instanceof ne))return new ne(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||se,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function se(t,e){return t<e?-1:t>e?1:0}ne.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,n=e[t];t>0;){var s=t-1>>1,r=e[s];if(i(n,r)>=0)break;e[t]=r,t=s}e[t]=n},_down:function(t){for(var e=this.data,i=this.compare,n=this.length>>1,s=e[t];t<n;){var r=1+(t<<1),h=r+1,a=e[r];if(h<this.length&&i(e[h],a)<0&&(r=h,a=e[h]),i(a,s)>=0)break;e[t]=a,t=r}e[t]=s}},ee.default=ie;var re=ae,he=ae;function ae(t,e,i,n,s,r){for(var h,a,o,l,c=t.data,u=[],f=t.toBBox,d=new ee(null,oe);c;){for(h=0;h<c.children.length;h++)a=c.children[h],o=le(e,i,c.leaf?f(a):a),(!r||o<=r)&&d.push({node:a,isItem:c.leaf,dist:o});for(;d.length&&d.peek().isItem;)if(l=d.pop().node,s&&!s(l)||u.push(l),n&&u.length===n)return u;(c=d.pop())&&(c=c.node)}return u}function oe(t,e){return t.dist-e.dist}function le(t,e,i){var n=ce(t,i.minX,i.maxX),s=ce(e,i.minY,i.maxY);return n*n+s*s}function ce(t,e,i){return t<e?e-t:t<=i?0:t-i}re.default=he;var ue="EPSILON"in Number?Number.EPSILON:2.220446049250313e-16,fe=function(t,e){return Math.abs(t-e)<ue};const de=(t,e)=>{let i=t+Math.random()*(e+1-t);return i=Math.floor(i)},pe=t=>0|t,ve=(t,e,i,n,s,r)=>{const h=i-t,a=n-e;return{x:pe(r*h-s*a+t),y:pe(s*h+r*a+e)}},ge=(t,e,i,n)=>{const s=2*Math.PI*Math.random(),r=Math.random()+Math.random(),h=(r>1?2-r:r)*(i-.5*n);return{x:pe(Math.cos(s)*h+t),y:pe(Math.sin(s)*h+e)}},me=(t,e,i)=>t+(e-t)*i,ye=(t,e)=>Math.atan2(Math.sin(t-e),Math.cos(t-e)),xe=(t,e,i,n)=>{const s=t-i,r=e-n;return s*s+r*r},we=2*Math.PI;function be(t){const e=t%we;return e<0?e+we:e}const{sqrt:Me}=Math,_e=(t,e,i,n,s,r,h)=>{const a=[],o=(r-n)*(r-n)+(h-s)*(h-s),l=2*((r-n)*(n-t)+(h-s)*(s-e)),c=l*l-4*o*(t*t+e*e+n*n+s*s-2*(t*n+e*s)-i*i);if(c>0){const t=Me(c),e=(-l+t)/(2*o),i=(-l-t)/(2*o);e>=0&&e<=1&&a.push({x:me(n,r,e),y:me(s,h,e)}),i>=0&&i<=1&&a.push({x:me(n,r,i),y:me(s,h,i)})}return a},Ye=(t,e,i,n,s,r,h)=>{const a=_e(t,e,i,n,s,r,s),o=_e(t,e,i,r,s,r,h),l=_e(t,e,i,r,h,n,h),c=_e(t,e,i,n,h,n,s),u=[],f=i*i,d=n-t,p=s-e,v=r-t,g=h-e,m=d*d,y=p*p,x=v*v,w=g*g;return a.length>0&&(2===a.length?a[0].x>a[1].x?u.push(a[1],a[0]):u.push(a[0],a[1]):u.push(a[0])),x+y<f&&u.push({x:r,y:s}),o.length>0&&(2===o.length?o[0].y>o[1].y?u.push(o[1],o[0]):u.push(o[0],o[1]):u.push(o[0])),x+w<f&&u.push({x:r,y:h}),l.length>0&&(2===l.length?l[0].x<l[1].x?u.push(l[1],l[0]):u.push(l[0],l[1]):u.push(l[0])),m+w<f&&u.push({x:n,y:h}),c.length>0&&(2===c.length?c[0].y<c[1].y?u.push(c[1],c[0]):u.push(c[0],c[1]):u.push(c[0])),m+y<f&&u.push({x:n,y:s}),u},Xe=(t,e,i,n,s,r,h)=>{const a={type:0,isec:[]},o=t-s,l=e-r,c=i*o+n*l;let u=h*h-o*o+l*l+c*c;if(u<0)return a;if(c<(u=Math.sqrt(u))){if(fe(u,0))return a.type=1,a.isec.push({x:i*c+t,y:n*c+e}),a;if(c+u>=0){u=-u,a.type=2;const s=c-u;return a.isec.push({x:i*s+t,y:n*s+e}),a}return a}a.type=3;const f=c-u,d=c+u;return a.isec.push({x:i*f+t,y:n*f+e},{x:i*d+t,y:n*d+e}),a};class Ae{constructor(t,e){if(this.gameMap=t,this.x=+(e.x||0),this.y=+(e.y||0),this.width=e.size||e.width||0,this.height=e.size||e.height||0,!this.width||!this.height)throw new Error("element size can not be undefined");this.lightDirection=!0,this.point=e.point,this.lightSize=this.width/2,this.minX=this.x-this.width,this.minY=this.y-this.width,this.maxX=this.x+this.width,this.maxY=this.y+this.width}render(){this.lightSize+=this.lightDirection?1:-1,(this.lightSize>this.width||this.lightSize<this.width/2)&&(this.lightDirection=!this.lightDirection);const t=this.gameMap.view.relativeX(this.x),e=this.gameMap.view.relativeY(this.y),i=this.gameMap.view.relativeW(this.width);this.gameMap.ctx.fillStyle="\t#FFA07A",this.gameMap.ctx.globalAlpha=.2,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(t,e,this.lightSize*i/this.width,0,2*Math.PI),this.gameMap.ctx.fill(),this.gameMap.ctx.globalAlpha=1,this.gameMap.ctx.beginPath(),this.gameMap.ctx.arc(t,e,i/2,0,2*Math.PI),this.gameMap.ctx.fill()}}class Be{constructor(t,e,i,n,s,r,h,a,o){this.x=t,this.y=e,this.vx=i,this.vy=n,this.speed=s,this.angle=r,this.sin=Math.sin(r),this.cos=Math.cos(r),this.nextAngle=r,this.poly={},this.aabb={},this.aabb.parent=this,this.snake=o,this.aabb.snakeIdx=o.idx,this.setIdx(a),this.calcPoly(h),this.isHead=!1}setNext(t,e,i){this.nextX=t,this.nextY=e,this.nextAngle=i,this.nextSin=Math.sin(i),this.nextCos=Math.cos(i),this.calcPoly(.5*this.width)}setXY(t,e){this.x=t,this.y=e,this.calcPoly(.5*this.width)}calcRotates(t){const e=ve(this.x,this.y,this.x,this.y+t,this.sin,this.cos),i=ve(this.x,this.y,this.x,this.y-t,this.sin,this.cos),n=ve(this.nextX,this.nextY,this.nextX,this.nextY+t,this.nextSin,this.nextCos);return{rotateLeft:i,rotateRight:e,nextRotateLeft:ve(this.nextX,this.nextY,this.nextX,this.nextY-t,this.nextSin,this.nextCos),nextRotateRight:n}}setIdx(t){this.aabb.idx=t}calcPoly(t){const e=this.calcRotates(.5*t);this.poly.l0X=e.nextRotateLeft.x,this.poly.l0Y=e.nextRotateLeft.y,this.poly.r0X=e.nextRotateRight.x,this.poly.r0Y=e.nextRotateRight.y,this.poly.l1X=e.rotateLeft.x,this.poly.l1Y=e.rotateLeft.y,this.poly.r1X=e.rotateRight.x,this.poly.r1Y=e.rotateRight.y,this.width=t}getPoly(t){return fe(t,this.width)||this.calcPoly(t),this.poly}setAABB(t){const e=this.calcRotates(.5*t);this.aabb.minX=Math.min(e.rotateRight.x,e.rotateLeft.x,e.nextRotateLeft.x,e.nextRotateRight.x),this.aabb.minY=Math.min(e.rotateRight.y,e.rotateLeft.y,e.nextRotateLeft.y,e.nextRotateRight.y),this.aabb.maxX=Math.max(e.rotateRight.x,e.rotateLeft.x,e.nextRotateLeft.x,e.nextRotateRight.x),this.aabb.maxY=Math.max(e.rotateRight.y,e.rotateLeft.y,e.nextRotateLeft.y,e.nextRotateRight.y)}getAABB(){return this.aabb}destroy(){this.poly=void 0,this.aabb.parent=void 0,this.aabb=void 0}}var Se=e(function(t,e){!function(){function e(t,e,i){this.next=i,i&&(i.prev=this),this.prev=e,e&&(e.next=this),this.data=t}function i(){if(!(this instanceof i))return new i;this._head=null,this._tail=null,this.length=0}i.prototype={push:function(t){this._tail=new e(t,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(0!==this.length){var t=this._tail;return this._tail=t.prev,t.prev&&(t.prev=this._tail.next=null),this.length--,1===this.length?this._head=this._tail:0===this.length&&(this._head=this._tail=null),t.data}},unshift:function(t){this._head=new e(t,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(0!==this.length){var t=this._head;return this._head=t.next,t.next&&(t.next=this._head.prev=null),this.length--,1===this.length?this._tail=this._head:0===this.length&&(this._head=this._tail=null),t.data}},item:function(t){t<0&&(t=this.length+t);for(var e=this._head;t-- >0&&e;)e=e.next;return e?e.data:void 0},slice:function(t,e){if(t||(t=0),e||(e=this.length),e<0&&(e=this.length+e),t<0&&(t=this.length+t),e===t)return[];if(e<t)throw new Error("invalid offset: "+t+","+e+" (length="+this.length+")");for(var i=e-t,n=new Array(i),s=0,r=this._head;t-- >0&&r;)r=r.next;for(;s<i&&r;)n[s++]=r.data,r=r.next;return n},drop:function(){i.call(this)},forEach:function(t,e){for(var i=this._head,n=0,s=this.length;n<s&&i;)t.call(e||this,i.data,n,this),i=i.next,n++},map:function(t,e){var n=new i;return this.forEach(function(i,s,r){n.push(t.call(e||r,i,s,r))}),n},filter:function(t,e){var n=new i;return this.forEach(function(i,s,r){t.call(e||r,i,s,r)&&n.push(i)}),n},reduce:function(t,e,i){var n=0,s=this._head,r=this.length;for(e||(n=1,e=s&&s.data,s=s&&s.next);n<r&&s;)e=t.call(i||this,e,s.data,this),n++,s=s.next;return e}},t.exports=i}()});class Le extends Se{constructor(){super()}every(t,e){let i,n=this._head,s=0;const r=this.length;let h=!0;for(;s<r&&n&&h;)h=t.call(e||this,n.data,i,s,this),i=n.data,n=n.next,s+=1}getHead(){if(this._head)return this._head.data}getTail(){if(this._tail)return this._tail.data}}const{log:ke}=console;class Pe{constructor(t,e){this.gameMap=t,this.x=+(e.x||0),this.y=+(e.y||0),this.width=+(e.size||e.width||0),this.height=+(e.size||e.height||0),this.shadowSize=this.width+et,this.needResize=!1,this.point=0,this.isSpeedUp=!1,this.fillColor="",this.stopped=!1,this.head={},this.head.aabb={},this.head.aabb.snakeIdx=this.idx=e.idx,this.head.aabb.parent=this.head,this.head.snake=this,this.head.getPoly=t=>this.head.poly,this.head.getAABB=()=>this.head.aabb,this.head.isHead=!0,this.head.poly={},this.head.width=this.width,this.closestDistance=5e3,this.visionAngle=170,this.closestSnake=null,this.closestFood=null,this.closestSnakeID=null,this.closestFoodID=null,this.colliders=this.gameMap.globalColliders,this.movementQueue=new Le,this.mIdx=0,this.collidersArray=[],this.speed=this.oldSpeed=K,this.turnSpeed=G,this.vx=0,this.vy=0,this.oldVx=0,this.oldVy=0,this.fillColor=e.fillColor||"#fff",this.angle=this.toAngle=e.angle||0,this.length=this.lastLength=e.length||0,this.viewLength=0,this.isPlayer=e.isPlayer,this.key=e.key,this.distances=[],this.updateSize(),this.turnAround(0),this.calcHead()}zeroClosest(){this.closestDistance=5e3}setXY(t,e){this.x=t,this.y=e,this.calcHead()}setAngle(t){this.angle=t,this.toAngle=t,this.velocity(),this.calcHead()}setClosest(t){this.closestDistance=t}updateSize(t=0){this.width+=.5*t,this.height+=.5*t,this.lastLength=this.length,this.length+=10*t,this.width>this.shadowSize&&(this.shadowSize+=et,this.needResize=!0),this.head.width=this.width}turnAround(t){const e=ye(this.toAngle,this.angle),i=this.turnSpeed*t*this.gameMap.scale;if(Math.abs(e)<=i)this.angle=this.toAngle,this.tau=0;else{this.angle+=Math.sign(e)*i;const t=this.height*Math.sin(this.angle);this.tau=this.speed/t}this.vx=Math.cos(this.angle),this.vy=Math.sin(this.angle)}speedUp(){this.isSpeedUp||(this.isSpeedUp=!0,this.oldSpeed=this.speed,this.speed*=2)}speedDown(){this.isSpeedUp&&(this.isSpeedUp=!1,this.speed=this.oldSpeed)}eat(t){this.point+=t.point;const e=t.point/200;this.updateSize(e)}update(t){if(this.stopped||fe(this.speed,0))return;let e=!1;const i=this.speed*t;let n=this.movementQueue.getTail();if(n&&fe(n.angle,this.angle)&&(this.colliders.remove(n.getAABB()),n.speed+=i,e=!0),e||(n=new Be(this.x,this.y,this.vx,this.vy,i,this.angle,this.width,this.mIdx,this),this.movementQueue.push(n),this.mIdx+=1),this.viewLength+=i,this.turnAround(t),this.x+=this.vx*i,this.y+=this.vy*i,n.setNext(this.x,this.y,this.angle),n.setAABB(this.shadowSize),this.colliders.insert(n.getAABB()),this.movementQueue.length>0&&this.viewLength>this.length){let t;for(;this.movementQueue.length>0&&this.viewLength>this.length;)t=this.movementQueue.shift(),this.colliders.remove(t.getAABB()),this.viewLength-=t.speed;const e=this.length-this.viewLength;if(e>0){const i=e/t.speed;t.speed=e;const n=t.nextX-(t.nextX-t.x)*i,s=t.nextY-(t.nextY-t.y)*i;t.setXY(n,s),t.setAABB(this.shadowSize),this.movementQueue.unshift(t),this.colliders.insert(t.getAABB()),this.viewLength+=t.speed}}this.needResize&&(this.needResize=!1,this.mIdx=0,this.movementQueue.forEach(t=>{this.colliders.remove(t.getAABB()),t.setAABB(this.shadowSize),t.setIdx(this.mIdx),this.mIdx+=1,this.collidersArray.push(t.getAABB())}),ke(`${this.key} resize width ${this.collidersArray.length} colliders`),this.colliders.load(this.collidersArray),this.collidersArray.length=0),this.colliders.remove(this.head.getAABB()),this.calcHead(),this.head.aabb.idx=this.mIdx,this.colliders.insert(this.head.getAABB())}calcHead(){const t=ve(this.x,this.y,this.x+this.height,this.y-.5*this.width,this.vy,this.vx),e=ve(this.x,this.y,this.x+this.height,this.y+.5*this.width,this.vy,this.vx),i=ve(this.x,this.y,this.x,this.y+.5*this.width,this.vy,this.vx),n=ve(this.x,this.y,this.x,this.y-.5*this.width,this.vy,this.vx),s=ve(this.x,this.y,this.x+this.width,this.y,this.vy,this.vx);this.head.poly.l1X=t.x,this.head.poly.l1Y=t.y,this.head.poly.r1X=e.x,this.head.poly.r1Y=e.y,this.head.poly.r0X=i.x,this.head.poly.r0Y=i.y,this.head.poly.l0X=n.x,this.head.poly.l0Y=n.y,this.head.nextX=s.x,this.head.nextY=s.y,this.head.x=this.x,this.head.y=this.y,this.head.cX=.5*(this.head.x+this.head.nextX),this.head.cY=.5*(this.head.y+this.head.nextY),this.head.aabb.minX=Math.min(this.head.poly.l0X,this.head.poly.l1X,this.head.poly.r0X,this.head.poly.r1X),this.head.aabb.minY=Math.min(this.head.poly.l0Y,this.head.poly.l1Y,this.head.poly.r0Y,this.head.poly.r1Y),this.head.aabb.maxX=Math.max(this.head.poly.l0X,this.head.poly.l1X,this.head.poly.r0X,this.head.poly.r1X),this.head.aabb.maxY=Math.max(this.head.poly.l0Y,this.head.poly.l1Y,this.head.poly.r0Y,this.head.poly.r1Y)}}class Ee{constructor(t,e,i){this.gameMap=t,this.margin=e,this.radius=i,this.image=document.createElement("canvas"),this.initImage()}initImage(){this.image.width=2*(this.radius+2),this.image.height=2*(this.radius+2),this.x=this.gameMap.view.width-2*(this.radius+2)-this.margin,this.y=this.gameMap.view.height-2*(this.radius+2)-this.margin,this.mapX=this.x+this.radius+2,this.mapY=this.y+this.radius+2;const t=this.image.getContext("2d");t.save(),t.beginPath(),t.arc(this.radius+2,this.radius+2,this.radius,0,2*Math.PI),t.fillStyle="#ccc",t.fill(),t.beginPath(),t.arc(this.radius+2,this.radius+2,this.radius+1,0,2*Math.PI),t.lineWidth=2,t.strokeStyle="#fff",t.stroke(),t.beginPath(),t.arc(this.radius+2,this.radius+2,this.radius+1,0,2*Math.PI),t.strokeStyle="#FF0000",t.setLineDash([5,5]),t.stroke(),t.restore()}render(){const t=this.radius/this.gameMap.paintRadius,e=this.radius/this.gameMap.radius,{ctx:i}=this.gameMap,n=this.gameMap.view.x*t+this.mapX,s=this.gameMap.view.y*t+this.mapY,r=this.gameMap.view.width*t,h=this.gameMap.view.height*t;i.save(),i.globalAlpha=.8,i.drawImage(this.image,this.x,this.y),i.strokeStyle="#fff",i.strokeRect(n,s,r,h);let a=-1;for(;++a<this.gameMap.units.length;){const t=this.gameMap.units[a],n=t.x*e+this.mapX,s=t.y*e+this.mapY;i.fillStyle=t.isPlayer?"#1E90FF":"#F00",i.fillRect(n-1,s-1,2,2)}i.restore()}}class Ce{constructor(t,e,i,n=0,s=0){this.width=e,this.height=i,this.x=n,this.y=s,this.gameMap=t,this.aabb={}}trace(t){this.x=this.aabb.minX=t.x/this.gameMap.scale-.5*this.width,this.y=this.aabb.minY=t.y/this.gameMap.scale-.5*this.height,this.aabb.minX=this.absoluteW(this.x),this.aabb.minY=this.absoluteW(this.y),this.aabb.maxX=this.aabb.minX+this.absoluteW(this.width),this.aabb.maxY=this.aabb.minY+this.absoluteH(this.height)}absoluteX(t){return(t+this.x)*this.gameMap.scale}absoluteY(t){return(t+this.y)*this.gameMap.scale}absoluteW(t){return t*this.gameMap.scale}absoluteH(t){return t*this.gameMap.scale}relativeX(t){return t/this.gameMap.scale-this.x}relativeY(t){return t/this.gameMap.scale-this.y}relativeW(t){return t/this.gameMap.scale}relativeH(t){return t/this.gameMap.scale}}const{log:Re}=console;const Te=new i,{log:De}=console;Te.showPanel(0),document.body.appendChild(Te.dom);const Ie=document.getElementById("cas"),Fe=window.innerWidth,We=window.innerHeight,ze={SPACE:32};De("Создание игрового мира...");const Oe=new class extends ct{constructor(t="player",e=document.createElement("canvas"),i=window.innerWidth,n=window.innerHeight,s=1,r=0,h=0,a=V,o=lt){super(),this.canvas=e,this.radius=a,this.pow2R=a*a,this.x=r,this.y=h,this.vWidth=i,this.vHeight=n,this.canvas.width=i,this.canvas.height=n,this.ctx=this.canvas.getContext("2d"),this.drawDebug=o,this.view=new Ce(this,i,n),this.smallMap=new Ee(this,30,50),this.units=[],this.playerID=t,this.foods=new te,this.globalColliders=new te,this.setScale(s),this.toScale=this.scale}initUnits(t){let e=-1;for(;++e<t;){let i=ge(0,0,V,2*Z*2);const n=e===t-1,s=new Pe(this,{x:i.x,y:i.y,size:Z,length:tt,angle:2*Math.random()*Math.PI,fillColor:"#00FF00",idx:e,isPlayer:n,key:n?this.playerID:`unit${e}`});for(;this.globalColliders.collides(s.head.getAABB());)i=ge(0,0,V,2*Z*2),s.setXY(i.x,i.y);this.units.push(s),this.globalColliders.insert(s.head.getAABB())}this.player=this.units[this.units.length-1]}initFoods(t){for(let e=t;e;e-=1){const t=de(1,10),e=Math.floor(2*t+10),i=ge(0,0,V,e);this.foods.insert(new Ae(this,{size:e,point:t,x:i.x,y:i.y}))}}setScale(t){this.scale!==t&&(this.scale=t<1?1:t,this.paintRadius=this.view.relativeW(this.radius),this.emit("scale_changed"))}setToScale(t){this.toScale=t}clear(){this.ctx.clearRect(0,0,this.view.width,this.view.height)}update(t){this.checkCollisions(),this.scale!==this.toScale&&this.setScale(this.toScale);let e=-1;for(;++e<this.units.length;){const i=this.units[e];0!==i.distances.length&&(i.distances.length=0),i.update(t);const n=i.head.getPoly(),{cX:s,cY:r}=i.head,h=[n.l0X,n.l0Y,n.r0X,n.r0Y,n.r1X,n.r1Y,n.l1X,n.l1Y],a=Xe(n.l1X,n.l1Y,i.vx,i.vy,this.x,this.y,this.radius),o=Xe(n.r1X,n.r1Y,i.vx,i.vy,this.x,this.y,this.radius);if(2===a.type&&2===o.type){Math.min(xe(a.isec[0][0],a.isec[0][1],n.l1X,n.l1Y),xe(o.isec[0][0],o.isec[0][1],n.r1X,n.r1Y));const t=this.foods.search(i.head.getAABB());let l=-1;for(;++l<t.length;)if(Zt(h,t[l].x,t[l].y,.5*t[l].width)){this.foods.remove(t[l]),this.units[e].eat(t[l]);const i=Math.floor(30*Math.random()+50),n=Math.floor(i/3),s=ge(0,0,V,n);this.foods.insert(new Ae(this,{size:n,point:i,x:s.x,y:s.y}))}if(!i.isPlayer){const t=re(this.foods,s,r,1);t.length>0&&(i.toAngle=Math.atan2(t[0].y-i.y,t[0].x-i.x))}}else this.kill(i)}}kill(t){Re(`${t.key} killed`)}render(){this.view.trace(this.player),this.clear(),this.drawbuckup(),this.drawFoods(),this.drawSnakes(),this.smallMap.render()}drawbuckup(){const{view:t,ctx:e}=this,{aabb:i}=t,n=i.minX-this.x,s=i.minY-this.y,r=i.maxX-this.x,h=i.maxY-this.y,a=n*n,o=s*s,l=r*r,c=h*h,u=a+o,f=l+o,d=a+c,p=l+c;Math.max(u,f,d,p)>this.pow2R?this.drawBounds():(e.save(),e.fillStyle="#FFFFE0",e.fillRect(0,0,t.width,t.height),e.restore()),e.restore()}checkCollisions(){let t=-1;for(;++t<this.units.length;){const e=this.units[t].head.getPoly(),i=this.globalColliders.search(this.units[t].head.getAABB());let n=-1;for(;++n<i.length;)if(i[n].snakeIdx!==this.units[t].idx){const t=i[n].parent.getPoly(i[n].parent.width);if(Gt([e.l0X,e.l0Y,e.r0X,e.r0Y,e.r1X,e.r1Y,e.l1X,e.l1Y],[t.l0X,t.l0Y,t.r0X,t.r0Y,t.r1X,t.r1Y,t.l1X,t.l1Y]))break}}}drawBounds(){const{ctx:t,view:e}=this,i=[],n=e.relativeX(this.x),s=e.relativeY(this.y),r=Ye(n,s,this.paintRadius,0,0,e.width,e.height);if(r.length>0){t.save(),t.beginPath(),t.moveTo(r[0].x,r[0].y);let h=-1;for(;++h<r.length;){const a=r[(h+1)%r.length];if(fe(r[h].x,a.x)&&fe(r[h].y,a.y))continue;const o=r[h].x,l=r[h].y,c=a.x,u=a.y;let f=be(Math.atan2(l-s,o-n)),d=be(Math.atan2(u-s,c-n));const p=.5*(o+c),v=.5*(l+u);if(ye(d,f)<0){const t=f;f=d,d=t}p>0&&p<e.width&&v>0&&v<e.height?(t.arc(n,s,this.paintRadius,f,d),i.push({angle1:f,angle2:d})):t.lineTo(c,u)}for(t.fillStyle="#FFFFE0",t.closePath(),t.fill(),t.restore(),h=-1,t.save(),t.lineCap="square",t.strokeStyle="#FFFFFF",t.lineWidth=e.relativeW(10),t.shadowOffsetY=e.relativeW(st),t.shadowOffsetX=e.relativeW(nt),t.shadowBlur=e.relativeW(rt),t.shadowColor="rgba(0, 0, 0, 0.5)",t.beginPath();++h<i.length;)t.beginPath(),t.arc(n,s,this.paintRadius+.5*e.relativeW(10),i[h].angle1,i[h].angle2),t.stroke();t.restore(),h=-1,t.save();const a=e.relativeW(15),o=e.relativeW(30);for(t.lineCap="square",t.strokeStyle="#FF0000",t.lineWidth=e.relativeW(10);++h<i.length;){t.beginPath(),t.arc(n,s,this.paintRadius+.5*e.relativeW(10),i[h].angle1,i[h].angle2);const r=this.paintRadius*i[h].angle1;t.setLineDash([a,o]),t.lineDashOffset=r,t.stroke()}t.restore()}}drawFoods(){const t=this.foods.search(this.view.aabb);let e=-1;for(;++e<t.length;)t[e].render()}drawSnakes(){const{view:t,ctx:e}=this,i=this.globalColliders.search(t.aabb);yt(i).asc(["snakeIdx","idx"]);let n=0,s=0;for(;n<i.length;){const r=i[n].parent.snake,h=r.idx,a=r.width,o=r.fillColor;e.save(),e.lineCap="butt",e.lineJoin="round",e.strokeStyle=o,e.lineWidth=t.relativeW(a),r.isSpeedUp?(e.shadowBlur=t.relativeW(de(ht-3,ht+3)),e.shadowColor="rgba(255, 0, 0, 0.5)"):e.shadowColor="rgba(0, 0, 0, 0)";let l=!1,c=i[s].idx;for(e.beginPath(),e.moveTo(t.relativeX(i[s].parent.x),t.relativeY(i[s].parent.y));s<i.length&&i[s].snakeIdx===h;){l=i[s].parent.isHead;const n=i[s].idx;l||(c!==n&&e.moveTo(t.relativeX(i[s].parent.x),t.relativeY(i[s].parent.y)),e.lineTo(t.relativeX(i[s].parent.nextX),t.relativeY(i[s].parent.nextY))),c=n+1,s+=1}e.stroke(),e.restore(),l&&this.drawHead(r),n=s}if(this.drawDebug){for(e.save(),e.lineWidth=1,n=-1;++n<i.length;){const s=i[n].parent.getPoly(i[n].parent.snake.width),r=i[n];e.strokeStyle="#000",e.beginPath(),e.moveTo(t.relativeX(s.l0X),t.relativeY(s.l0Y)),e.lineTo(t.relativeX(s.r0X),t.relativeY(s.r0Y)),e.lineTo(t.relativeX(s.r1X),t.relativeY(s.r1Y)),e.lineTo(t.relativeX(s.l1X),t.relativeY(s.l1Y)),e.closePath(),e.stroke(),e.strokeStyle="#FF1493",e.beginPath(),e.moveTo(t.relativeX(r.minX),t.relativeY(r.minY)),e.lineTo(t.relativeX(r.maxX),t.relativeY(r.minY)),e.lineTo(t.relativeX(r.maxX),t.relativeY(r.maxY)),e.lineTo(t.relativeX(r.minX),t.relativeY(r.maxY)),e.closePath(),e.stroke()}e.strokeStyle="FF0000",e.beginPath(),e.moveTo(t.relativeX(t.aabb.minX),t.relativeY(t.aabb.minY)),e.lineTo(t.relativeX(t.aabb.maxX),t.relativeY(t.aabb.minY)),e.lineTo(t.relativeX(t.aabb.maxX),t.relativeY(t.aabb.maxY)),e.lineTo(t.relativeX(t.aabb.minX),t.relativeY(t.aabb.maxY)),e.closePath(),e.stroke(),e.restore()}}drawHead(t){const{view:e,ctx:i}=this;i.save(),i.translate(e.relativeX(t.x),e.relativeY(t.y)),i.rotate(t.angle),i.fillStyle="blue",i.shadowOffsetY=e.relativeW(4),i.shadowBlur=e.relativeW(7),i.shadowColor="rgba(0, 0, 0, 0.5)",i.fillRect(0,-.5*e.relativeW(t.width),e.relativeH(t.height),e.relativeW(t.width)),i.setTransform(1,0,0,1,0,0),i.translate(e.relativeX(t.x),e.relativeY(t.y+it)),i.rotate(t.angle),i.fillStyle="blue",i.shadowOffsetY=0,i.shadowBlur=0,i.shadowColor="rgba(0, 0, 0, 0)",i.fillRect(0,-.5*e.relativeW(t.width),e.relativeH(t.height),e.relativeW(t.width)),i.fillStyle="white";const n=e.relativeW(t.width),s=e.relativeH(t.height);if(i.fillRect(.2*s,-.3*n,.6*s,.6*n),i.setTransform(1,0,0,1,0,0),i.restore(),this.drawDebug){i.save();const{head:n}=t,s=e.relativeH(100),r=e.relativeX(n.x),h=e.relativeY(n.y);i.strokeStyle="#8A2BE2",i.beginPath(),i.moveTo(r,h),i.lineTo(r+t.vx*s,h+t.vy*s),i.stroke(),i.lineWidth=1,i.strokeStyle="#DC143C",i.beginPath(),i.moveTo(r,h),i.lineTo(r+Math.cos(t.toAngle)*s,h+Math.sin(t.toAngle)*s),i.stroke(),i.restore()}}}("player",Ie,Fe,We);let He=!1;const Ne={},je=$(t=>{Te.begin(),He&&Oe.scale<2?Oe.setToScale(Oe.scale+.1):Oe.scale>1&&!He&&Oe.setToScale(Oe.scale-.1),Oe.update(t),Oe.render(),Te.end()});De("Инициализация игры"),De("Инициализация слайзеров"),Oe.initUnits(ot),De(`Создано ${ot} слайзеров`),De("Инициализация еды"),Oe.initFoods(at),De(`Создано ${at} единиц еды`),De("Биндинг глобальных листенеров"),function(){function t(t){if(t.preventDefault(),t.touches)Ne.x=t.touches[0].pageX,Ne.y=t.touches[0].pageY;else{const e=t||window.event;Ne.x=e.clientX,Ne.y=e.clientY}Oe.player.toAngle=function(t,e,i,n){const s=i-t,r=n-e;return Math.atan2(r,s)}(Oe.player.x,Oe.player.y,Oe.view.absoluteX(Ne.x),Oe.view.absoluteY(Ne.y))}navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)?(window.addEventListener("touchstart",t),window.addEventListener("touchmove",t)):(window.addEventListener("mousemove",t),window.addEventListener("mousedown",()=>{Oe.player.speedUp(),He=!0}),window.addEventListener("mouseup",()=>{Oe.player.speedDown(),He=!1}),window.addEventListener("keyup",t=>{switch(t.keyCode){case ze.SPACE:Oe.drawDebug=!Oe.drawDebug,De(`Draw debug: ${Oe.drawDebug}`)}}))}(),De("Старт игрового процесса"),je.start()}();
//# sourceMappingURL=bundle.js.map
