(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,function(c,u,n){c.exports=n(14)},function(c,u,n){var E=n(12),r=n(13);r=r.__esModule?r.default:r,typeof r=="string"&&(r=[[c.i,r,""]]);var o={};o.insert="head",o.singleton=!1;var T=E(r,o);c.exports=r.locals||{}},,function(c,u,n){},function(c,u,n){"use strict";n.r(u);var E=n(11),r=n(0),o=n.n(r),T=n(1),d=n.n(T),S=n(3),b=n.n(S),A=n(7),L=n(8),x=n(9);const O={type:o.a.AUTO,disableContextMenu:!0,render:{transparent:!0},scale:{parent:"gameContainer",mode:o.a.Scale.FIT,autoCenter:o.a.Scale.CENTER_BOTH,width:640,height:960,expandParent:!1},physics:{default:"matter",matter:{gravity:{x:0,y:0}}}};class y extends o.a.Scene{constructor(e){super(e);this.key=e.key,this.log=d.a.get(this.key),this.log.info("boot")}init(){this.log.info("init"),this.events.once("shutdown",this.shutdown,this),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this),this.events.off("destroy",this.destroy,this)}shutdown(){this.log.info("shutdown"),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.once("destroy",this.destroy,this)}sleep(){this.log.info("sleep"),this.events.off("pause",this.pause,this),this.events.once("wake",this.wake,this)}pause(){this.log.info("pause"),this.events.once("resume",this.resume,this)}wake(){this.log.info("wake"),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this)}resume(){this.log.info("resume"),this.events.once("pause",this.pause,this)}destroy(){this.log.info("destroy"),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.off("shutdown",this.shutdown,this),this.log=void 0}}class P extends y{constructor(){super({key:"BootScene"})}create(){this.log.info("create"),this.load.rexWebFont({google:{families:["Roboto"]}}),this.load.image("hour_hand","assets/images/hour_hand.png"),this.load.image("bg","assets/images/bg.png"),this.load.image("seasons_wheel","assets/images/seasons_wheel.png"),this.load.image("play","assets/images/play.png"),this.load.image("restart","assets/images/restart.png"),this.load.atlas("zones","assets/atlases/zones1.png","assets/atlases/zones1.json"),this.load.spritesheet("snail","assets/sprites/snail.png",{frameWidth:75,frameHeight:75}),this.load.json("zone_shapes","assets/jsons/zones.json"),this.load.on("complete",()=>{this.anims.create({key:"run",frames:this.anims.generateFrameNumbers("snail",{start:0,end:14}),frameRate:30,yoyo:!1,repeat:-1,showOnStart:!0}),document.querySelector(".loader").classList.toggle("loaded"),this.scene.start("LevelScene")}),this.load.start()}}var z=n(6),D=n.n(z);class g{constructor(e,t,s,i){this.scene=e,this.arrowAngle=0,this.image=this.scene.matter.add.image(0,0,"zones",i,{shape:this.scene.cache.json.get("zone_shapes")[i],isStatic:!0,isSensor:!0}).setName(i).setFriction(0).setFrictionAir(0),this.scene.matter.alignBody(this.image,t+.5*this.image.width,s+.5*this.image.height,o.a.Display.Align.CENTER),this.wheel=this.scene.add.image(this.image.x,this.image.y,"seasons_wheel").setScale(.4).setAlpha(.6).setDepth(2),this.arrow=this.scene.add.image(this.wheel.x,this.wheel.y,"hour_hand").setDepth(2).setScale(.25).setOrigin(.5,.87).setAngle(this.arrowAngle),this.lastTime=0,this.updateSeason()}clearTime(){this.lastTime=0}setLastTime(e){this.lastTime=e}clearSeason(){this.arrow.setAngle(this.arrowAngle),this.setSeason()}updateSeason(){this.arrowAngle=o.a.Math.Angle.RandomDegrees(),this.arrow.setAngle(this.arrowAngle),this.setSeason()}getSeason(){return this.season}setSeason(){const e=t(this.arrow.rotation);if(this.prevSeason=this.season,this.season=e,this.prevSeason!==e)switch(e){case"winter":this.image.setTint(114687);break;case"spring":this.image.setTint(11009025);break;case"summer":this.image.setTint(16776704);break;default:this.image.setTint(16744192)}function t(s){const{PI:i}=Math,a=o.a.Math.Angle.Normalize(s);return a>=0&&a<i/2?"spring":a>=i/2&&a<i?"summer":a>=i&&a<3*i/2?"fall":"winter"}}}class B extends y{constructor(){super({key:"LevelScene"});this.currentPointer=null,this.path=null,this.following=!1,this.drawing=!1,this.timeSpeed=.02,this.pathSpeed=10,this.snailSpeedFactor=0.5,this.pathTween=null,this.gameActive=!1,this.previosTime=0}create(){this.log.info("create");const{centerX:e,centerY:t,width:s,height:i}=this.cameras.main;this.matter.world.enabled=!1,this.pathes=new Map,this.zones=new Map([["zone1_0",new g(this,132,614,"zone1_0")],["zone1_1",new g(this,126,753,"zone1_1")],["zone1_2",new g(this,0,661,"zone1_2")],["zone1_3",new g(this,221,349,"zone1_3")],["zone1_4",new g(this,0,307,"zone1_4")],["zone1_5",new g(this,399,0,"zone1_5")],["zone1_6",new g(this,202,0,"zone1_6")],["zone1_7",new g(this,0,0,"zone1_7")]]),this.add.image(e,t,"bg").setDepth(1).setAlpha(.6),this.graphics=this.add.graphics(),this.snail=this.matter.add.sprite(0,0,"snail",0,{isSensor:!0}).setName("snail").setDepth(1).setBody({type:"circle",radius:8}).setFriction(0).setFrictionAir(0).setActive(!1).setVisible(!1),this.restartBtn=this.rexButtonn.add(this.add.image(s-10,10,"restart").setScale(.4).setAlpha(.5).setOrigin(1,0).setDepth(5)).setEnable(!this.drawing).setMode(0).on("click",()=>{this.following?(this.zones.forEach(a=>{a.clearSeason(),a.clearTime()}),this.stopGame(),this.newGame()):this.drawing||this.zones.forEach(a=>{a.updateSeason()})}),this.playObj=this.add.image(e,i-20,"play").setDepth(5).setScale(.5).setOrigin(.5,1).setAlpha(0),this.playBtn=this.rexButtonn.add(this.playObj).setEnable(!1).on("click",()=>{this.hideBanner()}),this.bannerText=this.add.text(e,t,"",{fontFamily:"Roboto",fontSize:"72px",fontStyle:"bold",align:"center",stroke:"grey",strokeThickness:4}).setOrigin(.5).setDepth(5).setAlpha(0),this.pathFollower=this.rexPathFollower.add(this.snail),this.pathFollower.setRotateToPath(!0,Math.PI*.5),this.input.on("pointerdown",this.pointerDown,this),this.input.on("pointermove",this.pointerMove,this),this.input.on("pointerup",this.pointerUp,this),this.input.on("gameout",this.gameOut,this),this.matter.world.on("collisionactive",this.onCollide,this),this.gameActive=!0,this.pathPoints=[]}onCollide(e){const t=e.pairs;let s=[];t.forEach(({bodyA:i,bodyB:a})=>{let h;if(i.gameObject.name!=="snail"?h=i.gameObject.name:h=a.gameObject.name,!this.pathes.has(h)){this.log.info("create path in:",h);const l=this.add.path(this.snail.x,this.snail.y);this.zones.get(h).clearTime(),this.pathes.set(h,l)}s.push(h)}),s=[...new Set(s)],this.zones.forEach((i,a)=>{const h=s.some(l=>l===a);if(!h&&this.pathes.has(a)){this.log.info("delete path from:",a);const l=this.pathes.get(a);this.pathes.delete(a),this.zones.get(a).clearTime(),l&&l.destroy()}})}pointerDown(e){if(this.gameActive&&(this.currentPointer!==null||this.following))return;this.drawing=!0,this.restartBtn.setEnable(!1);const{x:t,y:s}=e;this.log.info("pointer down"),this.snail.setPosition(t,s),this.matter.world.enabled=!0,this.currentPointer=e,this.graphics.lineStyle(16,3066944),this.graphics.fillStyle(3066944),this.graphics.fillCircle(t,s,8),this.pathPoints.push({x:t,y:s})}pointerMove(e){const{x:t,y:s}=e;if(e!==this.currentPointer)return;this.pathPoints.push({x:t,y:s}),this.pathes.forEach((i,a)=>{if(i){i.lineTo(t,s);const h=i.getLength(),l=h*this.pathSpeed,p=this.zones.get(a),m=l-p.lastTime,w=p.arrow.angle+m*this.timeSpeed;p.arrow.setAngle(w),p.setLastTime(l),p.setSeason()}}),this.graphics.lineBetween(this.snail.x,this.snail.y,t,s),this.graphics.fillCircle(t,s,8),this.snail.setPosition(t,s)}pointerUp(e){if(e!==this.currentPointer)return;this.drawing=!1,this.matter.world.enabled=!1,this.pathes.forEach(s=>{s&&s.destroy()}),this.zones.forEach(s=>{s.clearSeason(),s.clearTime()}),this.pathes.clear(),this.log.info("pointer up"),this.currentPointer=null;const t=D()(this.pathPoints,.8);if(this.log.info(`path simplify: ${this.pathPoints.length}->${t.length}`),this.pathPoints.length=0,t.length>0){this.path=this.add.path(t[0].x,t[0].y);for(let s=1;s<t.length;s++)this.path.lineTo(t[s].x,t[s].y);this.followPath()}else this.restartBtn.setEnable(!0),this.graphics.clear()}gameOut(){if(this.currentPointer===null)return;this.pointerUp(this.currentPointer)}followPath(){this.pathFollower.t=0,this.pathFollower.setPath(this.path);const e=this.path.getLength();this.log.info(e),this.pathTween=this.tweens.add({targets:this.pathFollower,t:1,ease:"Linear",duration:e*this.pathSpeed*this.snailSpeedFactor,repeat:0,yoyo:!1,onStart:()=>{this.matter.world.enabled=!0,this.following=!0,this.snail.setActive(!0).setVisible(!0),this.snail.play("run"),this.restartBtn.setEnable(!0)},onComplete:()=>{this.matter.world.enabled=!1,this.restartBtn.setEnable(!1),this.following=!1,this.pathTween=null,this.pathFollower.setPath(),this.path.destroy(),this.path=null,this.pathes.forEach(t=>{t&&t.destroy()}),this.pathes.clear(),this.checkWin()?this.gameWin():(this.graphics.clear(),this.zones.forEach(t=>{t.clearSeason(),t.clearTime()}),this.snail.setVisible(!1).setActive(!1),this.restartBtn.setEnable(!0),this.gameActive=!0)},onUpdate:()=>{this.pathes.forEach((t,s)=>{const{x:i,y:a}=this.snail;if(t){t.lineTo(i,a);const h=t.getLength(),l=h*this.pathSpeed,p=this.zones.get(s),m=l-p.lastTime,w=p.arrow.angle+m*this.timeSpeed;p.arrow.setAngle(w),p.setLastTime(l),p.setSeason()}})}})}checkWin(){let e=null,t=!0;return this.zones.forEach(s=>{const i=s.getSeason();e===null?e=i:e!==i&&(t=!1)}),t}gameOver(){this.log.info("LEVEL LOOSE"),this.stopGame(),this.showBanner(`LEVEL
LOOSE`,"red")}gameWin(){this.log.info("LEVEL COMPLETE"),this.showBanner(`LEVEL
COMPLETE`,"green")}stopGame(){this.matter.world.enabled=!1,this.restartBtn.setEnable(!1),this.following=!1,this.pathTween!==null&&this.pathTween.stop(),this.pathTween=null,this.pathFollower.setPath(),this.path.destroy(),this.path=null,this.pathes.forEach(e=>{e&&e.destroy()}),this.pathes.clear()}newGame(){this.snail.setVisible(!1).setActive(!1),this.graphics.clear(),this.restartBtn.setEnable(!0),this.gameActive=!0}hideBanner(){this.playBtn.setEnable(!1),this.tweens.add({targets:[this.playObj,this.bannerText],alpha:0,duration:300,onComplete:()=>{this.zones.forEach(e=>{e.updateSeason(),e.clearTime()}),this.newGame()}})}showBanner(e,t){this.bannerText.setText(e),this.bannerText.setColor(t),this.tweens.add({targets:[this.playObj,this.bannerText],alpha:1,duration:300,onComplete:()=>{this.playBtn.setEnable(!0)}})}}var v=Object.assign;b.a.disablePageScroll(),d.a.useDefaults(),d.a.setLevel(d.a.OFF);const f=d.a.get("index");f.info("start");const M={global:[{key:"rexWebFontLoader",plugin:A.a,start:!0},{key:"rexButtonn",plugin:L.a,start:!0,mapping:"rexButtonn"},{key:"rexPathFollower",plugin:x.a,start:!0,mapping:"rexPathFollower"}],scene:[]};window.onload=()=>{window.game=new o.a.Game(v(v({},O),{plugins:M,scene:[P,B],callbacks:{preBoot:e=>{f.info("game booting start")},postBoot:e=>{f.info("game booting complete")}}}))}}],[[10,1,2]]]);
