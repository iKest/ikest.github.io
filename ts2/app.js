(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,function(c,u,n){c.exports=n(13)},function(c,u,n){var E=n(11),r=n(12);r=r.__esModule?r.default:r,typeof r=="string"&&(r=[[c.i,r,""]]);var h={};h.insert="head",h.singleton=!1;var T=E(r,h);c.exports=r.locals||{}},,function(c,u,n){},function(c,u,n){"use strict";n.r(u);var E=n(10),r=n(0),h=n.n(r),T=n(1),d=n.n(T),y=n(3),b=n.n(y),L=n(6),A=n(7),O=n(8);const x={type:h.a.AUTO,disableContextMenu:!0,render:{transparent:!0},scale:{parent:"gameContainer",mode:h.a.Scale.FIT,autoCenter:h.a.Scale.CENTER_BOTH,width:640,height:960,expandParent:!1},physics:{default:"matter",matter:{gravity:{x:0,y:0}}}};class v extends h.a.Scene{constructor(e){super(e);this.key=e.key,this.log=d.a.get(this.key),this.log.info("boot")}init(){this.log.info("init"),this.events.once("shutdown",this.shutdown,this),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this),this.events.off("destroy",this.destroy,this)}shutdown(){this.log.info("shutdown"),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.once("destroy",this.destroy,this)}sleep(){this.log.info("sleep"),this.events.off("pause",this.pause,this),this.events.once("wake",this.wake,this)}pause(){this.log.info("pause"),this.events.once("resume",this.resume,this)}wake(){this.log.info("wake"),this.events.once("sleep",this.sleep,this),this.events.once("pause",this.pause,this)}resume(){this.log.info("resume"),this.events.once("pause",this.pause,this)}destroy(){this.log.info("destroy"),this.events.off("sleep",this.sleep,this),this.events.off("pause",this.pause,this),this.events.off("shutdown",this.shutdown,this),this.log=void 0}}class z extends v{constructor(){super({key:"BootScene"})}create(){this.log.info("create"),this.load.rexWebFont({google:{families:["Roboto"]}}),this.load.image("hour_hand","assets/images/hour_hand.png"),this.load.image("bg","assets/images/bg.png"),this.load.image("seasons_wheel","assets/images/seasons_wheel.png"),this.load.image("play","assets/images/play.png"),this.load.image("restart","assets/images/restart.png"),this.load.atlas("zones","assets/atlases/zones1.png","assets/atlases/zones1.json"),this.load.spritesheet("snail","assets/sprites/snail.png",{frameWidth:75,frameHeight:75}),this.load.json("zone_shapes","assets/jsons/zones.json"),this.load.on("complete",()=>{this.anims.create({key:"run",frames:this.anims.generateFrameNumbers("snail",{start:0,end:14}),frameRate:30,yoyo:!1,repeat:-1,showOnStart:!0}),document.querySelector(".loader").classList.toggle("loaded"),this.scene.start("LevelScene")}),this.load.start()}}class g{constructor(e,t,a,s){this.scene=e,this.arrowAngle=0,this.image=this.scene.matter.add.image(0,0,"zones",s,{shape:this.scene.cache.json.get("zone_shapes")[s],isStatic:!0,isSensor:!0}).setName(s).setFriction(0).setFrictionAir(0),this.scene.matter.alignBody(this.image,t+.5*this.image.width,a+.5*this.image.height,h.a.Display.Align.CENTER),this.wheel=this.scene.add.image(this.image.x,this.image.y,"seasons_wheel").setScale(.4),this.arrow=this.scene.add.image(this.wheel.x,this.wheel.y,"hour_hand").setScale(.25).setOrigin(.5,.87).setAngle(this.arrowAngle),this.lastTime=0,this.updateSeason()}clearTime(){this.lastTime=0}setLastTime(e){this.lastTime=e}clearSeason(){this.arrow.setAngle(this.arrowAngle),this.setSeason()}updateSeason(){this.arrowAngle=h.a.Math.Angle.RandomDegrees(),this.arrow.setAngle(this.arrowAngle),this.setSeason()}getSeason(){return this.season}setSeason(){const e=t(this.arrow.rotation);if(this.prevSeason=this.season,this.season=e,this.prevSeason!==e)switch(e){case"winter":this.image.setTint(114687);break;case"spring":this.image.setTint(11009025);break;case"summer":this.image.setTint(16776704);break;default:this.image.setTint(16744192)}function t(a){const{PI:s}=Math,i=h.a.Math.Angle.Normalize(a);return i>=0&&i<s/2?"spring":i>=s/2&&i<s?"summer":i>=s&&i<3*s/2?"fall":"winter"}}}class P extends v{constructor(){super({key:"LevelScene"});this.currentPointer=null,this.path=null,this.following=!1,this.drawing=!1,this.timeSpeed=.02,this.pathSpeed=10,this.pathTween=null,this.gameActive=!1,this.previosTime=0}create(){this.log.info("create");const{centerX:e,centerY:t,width:a,height:s}=this.cameras.main;this.matter.world.enabled=!1,this.pathes=new Map,this.zones=new Map([["zone1_0",new g(this,132,614,"zone1_0")],["zone1_1",new g(this,126,753,"zone1_1")],["zone1_2",new g(this,0,661,"zone1_2")],["zone1_3",new g(this,221,349,"zone1_3")],["zone1_4",new g(this,0,307,"zone1_4")],["zone1_5",new g(this,399,0,"zone1_5")],["zone1_6",new g(this,202,0,"zone1_6")],["zone1_7",new g(this,0,0,"zone1_7")]]),this.add.image(e,t,"bg"),this.graphics=this.add.graphics(),this.snail=this.matter.add.sprite(0,0,"snail",0,{isSensor:!0}).setName("snail").setBody({type:"circle",radius:8}).setFriction(0).setFrictionAir(0).setActive(!1).setVisible(!1),this.restartBtn=this.rexButtonn.add(this.add.image(a-10,10,"restart").setScale(.4).setAlpha(.5).setOrigin(1,0)).setEnable(!this.drawing).setMode(0).on("click",()=>{this.following?(this.zones.forEach(i=>{i.clearSeason(),i.clearTime()}),this.stopGame(),this.newGame()):this.drawing||this.zones.forEach(i=>{i.updateSeason()})}),this.playObj=this.add.image(e,s-20,"play").setScale(.5).setOrigin(.5,1).setAlpha(0),this.playBtn=this.rexButtonn.add(this.playObj).setEnable(!1).on("click",()=>{this.hideBanner()}),this.bannerText=this.add.text(e,t,"",{fontFamily:"Roboto",fontSize:"72px",fontStyle:"bold",align:"center",stroke:"grey",strokeThickness:4}).setOrigin(.5).setAlpha(0),this.pathFollower=this.rexPathFollower.add(this.snail),this.pathFollower.setRotateToPath(!0,Math.PI*.5),this.input.on("pointerdown",this.pointerDown,this),this.input.on("pointermove",this.pointerMove,this),this.input.on("pointerup",this.pointerUp,this),this.input.on("gameout",this.gameOut,this),this.matter.world.on("collisionactive",this.onCollide,this),this.gameActive=!0}onCollide(e){const t=e.pairs;let a=[];t.forEach(({bodyA:s,bodyB:i})=>{let o;if(s.gameObject.name!=="snail"?o=s.gameObject.name:o=i.gameObject.name,!this.pathes.has(o)){this.log.info("create path in:",o);const l=this.add.path(this.snail.x,this.snail.y);this.zones.get(o).clearTime(),this.pathes.set(o,l)}a.push(o)}),a=[...new Set(a)],this.zones.forEach((s,i)=>{const o=a.some(l=>l===i);if(!o&&this.pathes.has(i)){this.log.info("delete path from:",i);const l=this.pathes.get(i);this.pathes.delete(i),this.zones.get(i).clearTime(),l&&l.destroy()}})}pointerDown(e){if(this.gameActive&&(this.currentPointer!==null||this.following))return;this.drawing=!0,this.restartBtn.setEnable(!1);const{x:t,y:a}=e;this.log.info("pointer down"),this.snail.setPosition(t,a),this.matter.world.enabled=!0,this.currentPointer=e,this.path=this.add.path(t,a)}pointerMove(e){const{x:t,y:a}=e;if(e!==this.currentPointer)return;this.path.lineTo(t,a),this.pathes.forEach((s,i)=>{if(s){s.lineTo(t,a);const o=s.getLength(),l=o*this.pathSpeed,p=this.zones.get(i),f=l-p.lastTime,w=p.arrow.angle+f*this.timeSpeed;p.arrow.setAngle(w),p.setLastTime(l),p.setSeason()}}),this.snail.setPosition(t,a),this.graphics.clear(),this.graphics.lineStyle(16,3066944,.5),this.path.draw(this.graphics)}pointerUp(e){if(e!==this.currentPointer)return;this.drawing=!1,this.matter.world.enabled=!1,this.pathes.forEach(t=>{t&&t.destroy()}),this.zones.forEach(t=>{t.clearSeason(),t.clearTime()}),this.pathes.clear(),this.log.info("pointer up"),this.currentPointer=null,this.path.getLength()>0?this.followPath():(this.restartBtn.setEnable(!0),this.path.destroy(),this.path=null,this.graphics.clear())}gameOut(){if(this.currentPointer===null)return;this.pointerUp(this.currentPointer)}followPath(){this.pathFollower.t=0,this.pathFollower.setPath(this.path);const e=this.path.getLength();this.log.info(e),this.pathTween=this.tweens.add({targets:this.pathFollower,t:1,ease:"Linear",duration:e*this.pathSpeed,repeat:0,yoyo:!1,onStart:()=>{this.matter.world.enabled=!0,this.following=!0,this.snail.setActive(!0).setVisible(!0),this.snail.play("run"),this.restartBtn.setEnable(!0)},onComplete:()=>{this.matter.world.enabled=!1,this.restartBtn.setEnable(!1),this.following=!1,this.pathTween=null,this.pathFollower.setPath(),this.path.destroy(),this.path=null,this.pathes.forEach(t=>{t&&t.destroy()}),this.pathes.clear(),this.checkWin()?this.gameWin():(this.graphics.clear(),this.zones.forEach(t=>{t.clearSeason(),t.clearTime()}),this.snail.setVisible(!1).setActive(!1),this.gameActive=!0)},onUpdate:()=>{this.pathes.forEach((t,a)=>{const{x:s,y:i}=this.snail;if(t){t.lineTo(s,i);const o=t.getLength(),l=o*this.pathSpeed,p=this.zones.get(a),f=l-p.lastTime,w=p.arrow.angle+f*this.timeSpeed;p.arrow.setAngle(w),p.setLastTime(l),p.setSeason()}})}})}checkWin(){let e=null,t=!0;return this.zones.forEach(a=>{const s=a.getSeason();e===null?e=s:e!==s&&(t=!1)}),t}gameOver(){this.log.info("LEVEL LOOSE"),this.stopGame(),this.showBanner(`LEVEL
LOOSE`,"red")}gameWin(){this.log.info("LEVEL COMPLETE"),this.showBanner(`LEVEL
COMPLETE`,"green")}stopGame(){this.matter.world.enabled=!1,this.restartBtn.setEnable(!1),this.following=!1,this.pathTween!==null&&this.pathTween.stop(),this.pathTween=null,this.pathFollower.setPath(),this.path.destroy(),this.path=null,this.pathes.forEach(e=>{e&&e.destroy()}),this.pathes.clear()}newGame(){this.snail.setVisible(!1).setActive(!1),this.graphics.clear(),this.gameActive=!0}hideBanner(){this.playBtn.setEnable(!1),this.tweens.add({targets:[this.playObj,this.bannerText],alpha:0,duration:300,onComplete:()=>{this.zones.forEach(e=>{e.updateSeason(),e.clearTime()}),this.newGame()}})}showBanner(e,t){this.bannerText.setText(e),this.bannerText.setColor(t),this.tweens.add({targets:[this.playObj,this.bannerText],alpha:1,duration:300,onComplete:()=>{this.playBtn.setEnable(!0)}})}}var S=Object.assign;b.a.disablePageScroll(),d.a.useDefaults(),d.a.setLevel(d.a.OFF);const m=d.a.get("index");m.info("start");const M={global:[{key:"rexWebFontLoader",plugin:L.a,start:!0},{key:"rexButtonn",plugin:A.a,start:!0,mapping:"rexButtonn"},{key:"rexPathFollower",plugin:O.a,start:!0,mapping:"rexPathFollower"}],scene:[]};window.onload=()=>{window.game=new h.a.Game(S(S({},x),{plugins:M,scene:[z,P],callbacks:{preBoot:e=>{m.info("game booting start")},postBoot:e=>{m.info("game booting complete")}}}))}}],[[9,1,2]]]);
